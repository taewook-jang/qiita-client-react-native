[{"rendered_body":"\u003cp\u003eSNSなどのサーチの結果の生のCSVをダウンロードすると、ダブルクオーテーションの途中で改行が挟まり、うまく読み込んでくれません。\u003cbr\u003e\n正規表現(魔法の呪文)で一発で消し去ってやりましょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e方法\u003c/h2\u003e\n\n\u003cp\u003eMeryなどの正規表現による置き換えに対応しているソフトで\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: center\"\u003e項目\u003c/th\u003e\n\u003cth style=\"text-align: center\"\u003e\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e検索文字列\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\n\u003ccode\u003e([^\\\"｜\\n])(\\n)+\u003c/code\u003e←｜が全角なのでコピペ不可\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: center\"\u003e置換後の文字列\u003c/td\u003e\n\u003ctd style=\"text-align: center\"\u003e\u003ccode\u003e\\1\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eにして、[全文置き換え]\u003c/p\u003e\n\n\u003cp\u003eこれだけ\u003c/p\u003e\n","body":"SNSなどのサーチの結果の生のCSVをダウンロードすると、ダブルクオーテーションの途中で改行が挟まり、うまく読み込んでくれません。\n正規表現(魔法の呪文)で一発で消し去ってやりましょう。\n\n## 方法\nMeryなどの正規表現による置き換えに対応しているソフトで\n\n|項目||\n|:-:|:-:|\n|検索文字列|`([^\\\"｜\\n])(\\n)+`←｜が全角なのでコピペ不可|\n|置換後の文字列|`\\1`|\n\nにして、[全文置き換え]\n\nこれだけ\n","coediting":false,"created_at":"2017-05-18T00:28:23+09:00","group":null,"id":"4b1fa63f0733491ca288","private":false,"tags":[{"name":"CSV","versions":[]},{"name":"テキストエディタ","versions":[]}],"title":"CSVの\"\"の途中の改行を除去する","updated_at":"2017-05-18T00:28:23+09:00","url":"http://qiita.com/tamaina/items/4b1fa63f0733491ca288","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":"tamaina","id":"tamaina","items_count":6,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":94641,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94641/profile-images/1494255799","twitter_screen_name":"tamaina_simu","website_url":null}},{"rendered_body":"\u003cp\u003e\u003ca href=\"http://redux.js.org/docs/recipes/UsingObjectSpreadOperator.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003ereduxの公式サイト(Using Object Spread Operator)\u003c/a\u003eに書いてある話です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結論\u003c/h1\u003e\n\n\u003cp\u003eこうだったのが\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ereducerの一部\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nx\"\u003eSET_VISIBILITY_FILTER\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eassign\u003c/span\u003e\u003cspan class=\"p\"\u003e({},\u003c/span\u003e \u003cspan class=\"nx\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003evisibilityFilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこうなります\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ereducerの一部\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nx\"\u003eSET_VISIBILITY_FILTER\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e\u003cspan class=\"nx\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003evisibilityFilter\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"必要なこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e必要なこと\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"http://babeljs.io/docs/plugins/transform-object-rest-spread/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ebabelのpreset\u003c/a\u003eをつかいます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.babelrc\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"plugins\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"transform-object-rest-spread\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"なぜこれを書いたか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%81%9C%E3%81%93%E3%82%8C%E3%82%92%E6%9B%B8%E3%81%84%E3%81%9F%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなぜこれを書いたか\u003c/h1\u003e\n\n\u003cp\u003ereactの勉強会に行ったときにImmutablejsが現役であるかのような話が多かったのですが、\u003ca href=\"http://redux.js.org/docs/recipes/UsingImmutableJS.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式サイトだと結構デメリットも語られてて\u003c/a\u003eそのへんの温度感が気になったので書いてみたくなったのでした。\u003cbr\u003e\nredux的にはObject Spreadを推してるような喋りっぷりだと感じてます。\u003c/p\u003e\n","body":"[reduxの公式サイト(Using Object Spread Operator)](http://redux.js.org/docs/recipes/UsingObjectSpreadOperator.html)に書いてある話です。\n\n# 結論\n\nこうだったのが\n\n```js:reducerの一部\ncase SET_VISIBILITY_FILTER:\n  return Object.assign({}, state, {\n    visibilityFilter: action.filter\n  })\n```\n\nこうなります\n\n```js:reducerの一部\ncase SET_VISIBILITY_FILTER:\n  return { ...state,\n    visibilityFilter: action.filter\n  }\n```\n\n# 必要なこと\n[babelのpreset](http://babeljs.io/docs/plugins/transform-object-rest-spread/)をつかいます。\n\n```json:.babelrc\n{\n  \"plugins\": [\"transform-object-rest-spread\"]\n}\n```\n\n# なぜこれを書いたか\nreactの勉強会に行ったときにImmutablejsが現役であるかのような話が多かったのですが、[公式サイトだと結構デメリットも語られてて](http://redux.js.org/docs/recipes/UsingImmutableJS.html)そのへんの温度感が気になったので書いてみたくなったのでした。\nredux的にはObject Spreadを推してるような喋りっぷりだと感じてます。\n","coediting":false,"created_at":"2017-05-18T00:19:05+09:00","group":null,"id":"2c5b6fe9d2c7d87c66e0","private":false,"tags":[{"name":"immutable-js","versions":[]},{"name":"babel","versions":[]},{"name":"redux","versions":[]}],"title":"reduxでimmutablejsの代わりにObject Spreadを使う","updated_at":"2017-05-18T00:19:05+09:00","url":"http://qiita.com/193/items/2c5b6fe9d2c7d87c66e0","user":{"description":"giftee.coでrails書いたりjs書いたりしています。gifteeでは一緒に働く仲間を募集しています！\r\nhttps://www.wantedly.com/companies/giftee/info","facebook_id":"","followees_count":12,"followers_count":25,"github_login_name":"yamatatsu","id":"193","items_count":23,"linkedin_id":"","location":"","name":"","organization":"giftee.co","permanent_id":76640,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/76640/profile-images/1473700557","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003e順番に表示させる記述です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e    \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003ejun\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eacco_02\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003eclick_t\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"要素\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003echild\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"要素\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n      \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003efadeFn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e要素\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eclick\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e要素\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                  \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e500\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efadeIn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003efadeFn\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eforを使う方法と、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eacco_02\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eclick_t\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"要素\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"要素\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003echild\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003echildren\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003elen\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003echild\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n          \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"nx\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003earr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003echild\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003edelay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e500\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efadeIn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003eclick_t\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eclick\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n           \u003cspan class=\"nx\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \n        \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eacco_02\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eです。もっとうまいことかけると思います。\u003cbr\u003e\nかなり、鈍臭くなってしまいました。自分で編集するかもですが。。。\u003c/p\u003e\n\n\u003cp\u003eいい書き方ぜひ伺いたいです。\u003c/p\u003e\n\n\u003cp\u003eポイントは、順番に表示させたい要素をnoneしといて、時間差でfadeInするといったことです。\u003c/p\u003e\n\n\u003cp\u003eでは、参考までに\u003c/p\u003e\n","body":"順番に表示させる記述です。\n\n```js\n    function jun(){\n      let acco_02 = {\n          click_t : $(\"要素\"),\n          child : $(\"要素\"),\n      };\n\n      let fadeFn = function(){\n        $(要素).click(function() {\n          $(要素).each(function(i) {\n                  $(this).delay(500 * i).fadeIn(1000);\n            });\n        });\n      };\n      fadeFn();\n    }\n```\nforを使う方法と、\n\n```js\n   var acco_02 = function() {\n        var click_t = $(\"要素\");\n        var target = $(\"要素\");\n        var child = target.children();\n        var len = child.length;\n        var f = function(){\n          for (var i = 0; i \u003c= len; i++) {\n            var arr = child[i];\n            $(arr).delay(500 * i).fadeIn(1000);\n        }\n        };\n        \n        click_t.click(function(){\n           f(); \n        });\n    };\n    acco_02();\n```\n\nです。もっとうまいことかけると思います。\nかなり、鈍臭くなってしまいました。自分で編集するかもですが。。。\n\nいい書き方ぜひ伺いたいです。\n\nポイントは、順番に表示させたい要素をnoneしといて、時間差でfadeInするといったことです。\n\nでは、参考までに\n","coediting":false,"created_at":"2017-05-18T00:07:25+09:00","group":null,"id":"73ce2022954a914c4807","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"jQuery","versions":[]}],"title":"順番に表示　基本メモ","updated_at":"2017-05-18T00:07:52+09:00","url":"http://qiita.com/Masaru_free/items/73ce2022954a914c4807","user":{"description":"","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":"miyaudi","id":"Masaru_free","items_count":12,"linkedin_id":"","location":"","name":"miyaudi masaru","organization":"","permanent_id":166233,"profile_image_url":"https://pbs.twimg.com/profile_images/832640838693908483/7TnvL7Vf_normal.jpg","twitter_screen_name":"masaru_free","website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"mockeryとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#mockery%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003emockeryとは\u003c/h1\u003e\n\n\u003cp\u003eReflectionClassやPHPUnit内蔵のMockBuilderを小難しく使わずとも2行でmock作れます。そうmockeryならね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"もうちょっと詳しく\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%82%E3%81%86%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E8%A9%B3%E3%81%97%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eもうちょっと詳しく\u003c/h1\u003e\n\n\u003cp\u003eとりあえずサンプル見てもらえると早いと思います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"php\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$mock\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eMockery\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003emock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'Hoge'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$mock\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'fuga'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eandReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'hogehogefugafuga!'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$mock\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003efuga\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// hogehogefugafuga!\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eMockery::mock('Hoge');\u003c/code\u003eで指定しているクラス名\u003ccode\u003eHoge\u003c/code\u003eは実在するクラスを指定すれば、そのクラスを継承したmockを作成するとのことです。\u003cbr\u003e\nテキトーな文字列を指定した場合は空のクラスのmockを作成します。\u003c/p\u003e\n\n\u003cp\u003eこれだけだとイマイチ凄さが分かりませんが、私が感動したのは下記の方法。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"php\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003egetFugaName\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003e$fuga\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eFuga\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$fuga\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003egetName\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFuga\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003egetName\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s1\"\u003e'fuga'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$mock\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eMockery\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003emock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'overload:Fuga'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$mock\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'getName'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eandReturn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'overwritten fuga'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nx\"\u003eHoge\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003egetFugaName\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// overwritten fuga\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなんと\u003ccode\u003e:overload\u003c/code\u003eプレフィックスをつけることで、テスト対象（上の例の場合は\u003ccode\u003eHoge\u003c/code\u003e）の内部で生成している\u003ccode\u003eFuga\u003c/code\u003eを上書きしてmockを使用させることができます。\u003cbr\u003e\nMockeryを使用する前は苦肉の策でメンバ変数や引数などで\u003ccode\u003eFuga\u003c/code\u003eインスタンスを渡せる仕組みを\u003ccode\u003eHoge\u003c/code\u003eに実装していて、あんまりイケてない感じがして好きじゃなかったのですがこんなにお手軽に解決できるとはびっくらぽんです。\u003c/p\u003e\n\n\u003cp\u003eもちろんPHPUnitのMockBuilderで可能な、引数によって返却値を変える仕組みや、\u003ccode\u003eonce()\u003c/code\u003eや\u003ccode\u003etwice()\u003c/code\u003e等のメソッドを呼ぶ回数に制限を掛ける等もできます。\u003cbr\u003e\nさらにあれこれ返却値を決定する際に処理が必要な場合は\u003ccode\u003eandReturnUsing()\u003c/code\u003eなんてものもあって至れり尽くせりです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"php\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eHoge\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003efoo\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003e$fuga\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eFuga\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$fuga\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003efugaMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'引数1'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'引数2'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'引数3'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003ebar\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003e$fuga\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eFuga\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$fuga\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003efugaMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'引数4'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'引数5'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'引数6'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFuga\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003efugaMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//何か色々処理\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$mock\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eMockery\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003emock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'overload:Fuga'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$mock\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldReceive\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'fugaMethod'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eandReturnUsing\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003efunc_get_args\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$foo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eHoge\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003efoo\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// array('引数1', '引数2', '引数3')\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$bar\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eHoge\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"na\"\u003ebar\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e// array('引数4', '引数5', '引数6')\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考にさせていただいたドキュメント\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%95%E3%81%9B%E3%81%A6%E3%81%84%E3%81%9F%E3%81%A0%E3%81%84%E3%81%9F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考にさせていただいたドキュメント\u003c/h1\u003e\n\n\u003cp\u003eインストール方法や更なる使い方については下記の記事にて詳しく解説されておりますのでそちらを参照されると良いかと思います。\u003cbr\u003e\n（というかcomposerならインストール一発です）\u003cbr\u003e\n・Mockery 0.8.0 日本語ドキュメント\u003cbr\u003e\n\u003ca href=\"https://kore1server.com/202/Mockery+0.8.0+%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://kore1server.com/202/Mockery+0.8.0+%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88\u003c/a\u003e\u003cbr\u003e\n・「Mockery」を使ってサクッとPHPのテストを書いてみる\u003cbr\u003e\n\u003ca href=\"http://tech.aainc.co.jp/archives/3918\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://tech.aainc.co.jp/archives/3918\u003c/a\u003e\u003cbr\u003e\n・MockeryとPHPUnitを使う（最低限）\u003cbr\u003e\n\u003ca href=\"http://qiita.com/zaburo/items/b559782179565bb1c538\" class=\"autolink\" id=\"reference-81ac8048b7289aa9b7e2\"\u003ehttp://qiita.com/zaburo/items/b559782179565bb1c538\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h1\u003e\n\n\u003cp\u003eここまでお読みいただきありがとうございました。\u003cbr\u003e\n皆様も良きMockeryライフを！ｖ・。・ｖ\u003c/p\u003e\n","body":"# mockeryとは\n\nReflectionClassやPHPUnit内蔵のMockBuilderを小難しく使わずとも2行でmock作れます。そうmockeryならね。\n\n# もうちょっと詳しく\n\nとりあえずサンプル見てもらえると早いと思います。\n\n```php\n\u003c?php\n$mock = Mockery::mock('Hoge');\n$mock-\u003eshouldReceive('fuga')-\u003eandReturn('hogehogefugafuga!');\n\necho $mock-\u003efuga(); // hogehogefugafuga!\n```\n\n`Mockery::mock('Hoge');`で指定しているクラス名`Hoge`は実在するクラスを指定すれば、そのクラスを継承したmockを作成するとのことです。\nテキトーな文字列を指定した場合は空のクラスのmockを作成します。\n\nこれだけだとイマイチ凄さが分かりませんが、私が感動したのは下記の方法。\n\n```php\n\u003c?php\nclass Hoge\n{\n    public static function getFugaName()\n    {\n        $fuga = new Fuga();\n        return $fuga-\u003egetName();\n    }\n}\n\nclass Fuga\n{\n    public function getName()\n    {\n        return 'fuga';\n    }\n}\n\n$mock = Mockery::mock('overload:Fuga');\n$mock-\u003eshouldReceive('getName')-\u003eandReturn('overwritten fuga');\n\necho Hoge::getFugaName(); // overwritten fuga\n```\n\nなんと`:overload`プレフィックスをつけることで、テスト対象（上の例の場合は`Hoge`）の内部で生成している`Fuga`を上書きしてmockを使用させることができます。\nMockeryを使用する前は苦肉の策でメンバ変数や引数などで`Fuga`インスタンスを渡せる仕組みを`Hoge`に実装していて、あんまりイケてない感じがして好きじゃなかったのですがこんなにお手軽に解決できるとはびっくらぽんです。\n\nもちろんPHPUnitのMockBuilderで可能な、引数によって返却値を変える仕組みや、`once()`や`twice()`等のメソッドを呼ぶ回数に制限を掛ける等もできます。\nさらにあれこれ返却値を決定する際に処理が必要な場合は`andReturnUsing()`なんてものもあって至れり尽くせりです。\n\n```php\n\u003c?php\nclass Hoge\n{\n    public static function foo()\n    {\n        $fuga = new Fuga();\n        return $fuga-\u003efugaMethod('引数1', '引数2', '引数3');\n    }\n\n    public static function bar()\n    {\n        $fuga = new Fuga();\n        return $fuga-\u003efugaMethod('引数4', '引数5', '引数6');\n    }\n}\n\nclass Fuga\n{\n    public function fugaMethod()\n    {\n        //何か色々処理\n        return true;\n    }\n}\n\n$mock = Mockery::mock('overload:Fuga');\n$mock-\u003eshouldReceive('fugaMethod')-\u003eandReturnUsing(function() { return func_get_args(); });\n\n$foo = Hoge::foo(); // array('引数1', '引数2', '引数3')\n$bar = Hoge::bar(); // array('引数4', '引数5', '引数6')\n```\n\n# 参考にさせていただいたドキュメント\nインストール方法や更なる使い方については下記の記事にて詳しく解説されておりますのでそちらを参照されると良いかと思います。\n（というかcomposerならインストール一発です）\n・Mockery 0.8.0 日本語ドキュメント\nhttps://kore1server.com/202/Mockery+0.8.0+%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88\n・「Mockery」を使ってサクッとPHPのテストを書いてみる\nhttp://tech.aainc.co.jp/archives/3918\n・MockeryとPHPUnitを使う（最低限）\nhttp://qiita.com/zaburo/items/b559782179565bb1c538\n\n# 最後に\nここまでお読みいただきありがとうございました。\n皆様も良きMockeryライフを！ｖ・。・ｖ\n","coediting":false,"created_at":"2017-05-18T00:02:18+09:00","group":null,"id":"834f1229cffc06b539bc","private":false,"tags":[{"name":"PHP","versions":[]},{"name":"test","versions":[]},{"name":"PHPUnit","versions":[]},{"name":"mockery","versions":[]}],"title":"たった2行で自動テスト時のmockが作れちゃうmockeryに感動したのでポエムを綴ってみました","updated_at":"2017-05-18T00:02:18+09:00","url":"http://qiita.com/myr/items/834f1229cffc06b539bc","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":null,"id":"myr","items_count":2,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":62478,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/62478/profile-images/1481709445","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch2\u003e\n\u003cspan id=\"raspiコマンドまとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#raspi%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRasPiコマンドまとめ\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eShutdown\n\u003ccode\u003e$ sudo shutdown -h now\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eReboot\n\u003ccode\u003e$ sudo shutdown -r now\u003c/code\u003e, \u003ccode\u003e$ sudo reboot\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003essh config (.ssh/config)\n\u003ccode\u003e\nHost Sample\n    HostName xxx.xxx.xxx.xxx\n    User sampleUser\n    ServerAliveInterval xx\n\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"raspi設定まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#raspi%E8%A8%AD%E5%AE%9A%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRasPi設定まとめ\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"raspiのupdate\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#raspi%E3%81%AEupdate\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRaspiのupdate\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003e$ sudo rpi-update\u003c/code\u003eで実行\u003c/p\u003e\n\n\u003cp\u003eその後\u003ccode\u003e$ sudo reboot\u003c/code\u003eで再起動\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"rootのパスワード設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#root%E3%81%AE%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003erootのパスワード設定\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003epi@raspberrypi:~ $ sudo passwd root\nEnter new UNIX password:\nRetype new UNIX password:\npasswd: password updated successfully\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eroot userでログインできるか確認\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003epi@raspberrypi:~ $ su\nPassword:\nroot@raspberrypi:/home/pi# exit\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"pi-userのパスワード設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pi-user%E3%81%AE%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003epi userのパスワード設定\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003epi@raspberrypi:~ $ sudo passwd pi\nEnter new UNIX password:\nRetype new UNIX password:\npasswd: password updated successfully\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"user-sampleuser加える\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#user-sampleuser%E5%8A%A0%E3%81%88%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003euser (sampleUser)加える\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003epi@raspberrypi:~ $ sudo adduser sampleUser\nAdding user `sampleUser' ...\nAdding new group `sampleUser' (1001) ...\nAdding new user `sampleUser' (1001) with group `sampleUser' ...\nCreating home directory `/home/sampleUser' ...\nCopying files from `/etc/skel' ...\nEnter new UNIX password:\nRetype new UNIX password:\npasswd: password updated successfully\nChanging the user information for sampleUser\nEnter the new value, or press ENTER for the default\n    Full Name []: \u0026lt; 空白でOK\n    Room Number []:\n    Work Phone []:\n    Home Phone []:\n    Other []:\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"piと同様の権限をsampleuserに渡す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pi%E3%81%A8%E5%90%8C%E6%A7%98%E3%81%AE%E6%A8%A9%E9%99%90%E3%82%92sampleuser%E3%81%AB%E6%B8%A1%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003epiと同様の権限をsampleUserに渡す\u003c/h3\u003e\n\n\u003cp\u003eまずpiがどの権限を持ってるのか確認\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003epi@raspberrypi:~ $ groups pi\npi : pi adm dialout cdrom sudo audio video plugdev games users input netdev spi i2c gpio\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの権限をsampleUserに渡し、最後に\u003ccode\u003e$ groups sampleUser\u003c/code\u003eで権限確認\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003epi@raspberrypi:~ $ sudo usermod -G pi,adm,dialout,cdrom,sudo,audio,video,plugdev,games,users,netdev,input,spi,gpio sampleUser\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ssh-keyをraspiに渡す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ssh-key%E3%82%92raspi%E3%81%AB%E6%B8%A1%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSSH KeyをRasPiに渡す\u003c/h2\u003e\n\n\u003cp\u003eTerminal 2つ [Local]と[Raspi]開きましょう (keygenミスったりすると入れなくなります)\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"1-keyを作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-key%E3%82%92%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. Keyを作成\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003e[local]$ ssh-keygen -t rsa\u003c/code\u003eにより\u003ccode\u003e~/.ssh/id_rsa\u003c/code\u003eにpublic keyとprivate key作成される\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"2-keyをraspi側に移す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-key%E3%82%92raspi%E5%81%B4%E3%81%AB%E7%A7%BB%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. KeyをRaspi側に移す\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003e[local]$ scp id_rsa.pub yourRasPiAddr:~/.ssh\u003c/code\u003epublic Keyを移動\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"3-public-keyをauthorized_keysに書き出す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-public-key%E3%82%92authorized_keys%E3%81%AB%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. public Keyをauthorized_keysに書き出す\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e[Raspi]@raspberrypi:~/.ssh $ cat id_rsa.pub \u0026gt;\u0026gt; authorized_keys\n[Raspi]@raspberrypi:~/.ssh $ ls -a\n.  ..  authorized_key  id_rsa.pub\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"4-権限設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-%E6%A8%A9%E9%99%90%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. 権限設定\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e[Raspi]@raspberrypi:~/.ssh $ chmod 600 authorized_key\n[Raspi]@raspberrypi:~ $ chmod 700 .ssh\n[Raspi]@raspberrypi:~/.ssh $ su\nPassword:\nroot@raspberrypi:/home/[Raspi]/.ssh# cd /etc/ssh\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"5-デーモン書き換え\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E6%9B%B8%E3%81%8D%E6%8F%9B%E3%81%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. デーモン書き換え\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eroot@raspberrypi:/etc/ssh# vim sshd_config\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以下のファイル書き換え\u003cbr\u003e\n\u003ccode\u003e\u003cbr\u003e\nAuthorizedKeysFile      %h/.ssh/authorized_keys\u003cbr\u003e\nPasswordAuthentication no\u003cbr\u003e\nPermitRootLogin no\u003cbr\u003e\n\u003c/code\u003e\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"6-デーモン再起動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6-%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E5%86%8D%E8%B5%B7%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e6. デーモン再起動\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e[Raspi]@raspberrypi:~/.ssh $ sudo /etc/init.d/ssh restart\n[ ok ] Restarting ssh (via systemctl): ssh.service.\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"7-raspiにlocalから接続\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#7-raspi%E3%81%ABlocal%E3%81%8B%E3%82%89%E6%8E%A5%E7%B6%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e7. RasPiに[local]から接続\u003c/h4\u003e\n","body":"\n## RasPiコマンドまとめ\n* Shutdown\n`$ sudo shutdown -h now`\n* Reboot\n`$ sudo shutdown -r now`, `$ sudo reboot`\n* ssh config (.ssh/config)\n  ```\n  Host Sample\n        HostName xxx.xxx.xxx.xxx\n        User sampleUser\n        ServerAliveInterval xx\n  ```\n\n## RasPi設定まとめ\n### Raspiのupdate\n`$ sudo rpi-update`で実行\n\nその後`$ sudo reboot`で再起動\n\n### rootのパスワード設定\n\n```\npi@raspberrypi:~ $ sudo passwd root\nEnter new UNIX password:\nRetype new UNIX password:\npasswd: password updated successfully\n```\n\nroot userでログインできるか確認\n\n```\npi@raspberrypi:~ $ su\nPassword:\nroot@raspberrypi:/home/pi# exit\n```\n\n### pi userのパスワード設定\n```\npi@raspberrypi:~ $ sudo passwd pi\nEnter new UNIX password:\nRetype new UNIX password:\npasswd: password updated successfully\n```\n### user (sampleUser)加える\n```\npi@raspberrypi:~ $ sudo adduser sampleUser\nAdding user `sampleUser' ...\nAdding new group `sampleUser' (1001) ...\nAdding new user `sampleUser' (1001) with group `sampleUser' ...\nCreating home directory `/home/sampleUser' ...\nCopying files from `/etc/skel' ...\nEnter new UNIX password:\nRetype new UNIX password:\npasswd: password updated successfully\nChanging the user information for sampleUser\nEnter the new value, or press ENTER for the default\n\tFull Name []: \u003c 空白でOK\n\tRoom Number []:\n\tWork Phone []:\n\tHome Phone []:\n\tOther []:\n```\n\n### piと同様の権限をsampleUserに渡す\nまずpiがどの権限を持ってるのか確認\n\n```\npi@raspberrypi:~ $ groups pi\npi : pi adm dialout cdrom sudo audio video plugdev games users input netdev spi i2c gpio\n```\nこの権限をsampleUserに渡し、最後に`$ groups sampleUser`で権限確認\n\n```\npi@raspberrypi:~ $ sudo usermod -G pi,adm,dialout,cdrom,sudo,audio,video,plugdev,games,users,netdev,input,spi,gpio sampleUser\n```\n\n## SSH KeyをRasPiに渡す\nTerminal 2つ [Local]と[Raspi]開きましょう (keygenミスったりすると入れなくなります)\n#### 1. Keyを作成\n`[local]$ ssh-keygen -t rsa`により`~/.ssh/id_rsa`にpublic keyとprivate key作成される\n#### 2. KeyをRaspi側に移す\n`[local]$ scp id_rsa.pub yourRasPiAddr:~/.ssh`public Keyを移動\n\n#### 3. public Keyをauthorized_keysに書き出す\n```\n[Raspi]@raspberrypi:~/.ssh $ cat id_rsa.pub \u003e\u003e authorized_keys\n[Raspi]@raspberrypi:~/.ssh $ ls -a\n.  ..  authorized_key  id_rsa.pub\n```\n#### 4. 権限設定\n```\n[Raspi]@raspberrypi:~/.ssh $ chmod 600 authorized_key\n[Raspi]@raspberrypi:~ $ chmod 700 .ssh\n[Raspi]@raspberrypi:~/.ssh $ su\nPassword:\nroot@raspberrypi:/home/[Raspi]/.ssh# cd /etc/ssh\n```\n#### 5. デーモン書き換え\n```\nroot@raspberrypi:/etc/ssh# vim sshd_config\n```\n\n以下のファイル書き換え\n```\nAuthorizedKeysFile      %h/.ssh/authorized_keys\nPasswordAuthentication no\nPermitRootLogin no\n```\n\n#### 6. デーモン再起動\n```\n[Raspi]@raspberrypi:~/.ssh $ sudo /etc/init.d/ssh restart\n[ ok ] Restarting ssh (via systemctl): ssh.service.\n```\n\n#### 7. RasPiに[local]から接続\n","coediting":false,"created_at":"2017-05-18T00:00:35+09:00","group":null,"id":"f2aaf89cff871a41e471","private":false,"tags":[{"name":"RaspberryPi","versions":[]}],"title":"Raspberry Piまとめ","updated_at":"2017-05-18T00:00:35+09:00","url":"http://qiita.com/orihomotakanat/items/f2aaf89cff871a41e471","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":1,"github_login_name":"orihomotakanat","id":"orihomotakanat","items_count":5,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":179534,"profile_image_url":"https://avatars0.githubusercontent.com/u/21169234?v=3","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003eSlackには \u003ccode\u003ePin\u003c/code\u003e という機能があります。\u003cbr\u003e\n重要なメッセージやファイルなどをチャンネルにピン留めしておくことで\u003cbr\u003e\nいつでも参照できるという機能です。\u003c/p\u003e\n\n\u003cp\u003e先日、新たに参加したメンバーがSlackの使い方をよく理解しておらず、\u003cbr\u003e\nチャンネル内にピン留されたメッセージなどをすべてはずしてしまうということがありました。\u003c/p\u003e\n\n\u003cp\u003eそこで誤ってピンが外れされてしまったとしても、再度自動でピンをしてくれるBotを\u003cbr\u003e\nbotkitを使って作成してみました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"成果物\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%88%90%E6%9E%9C%E7%89%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e　成果物\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/55219/b58eb9df-c41f-e373-2ac2-a440c61447cc.gif\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/55219/b58eb9df-c41f-e373-2ac2-a440c61447cc.gif\" alt=\"repin_bot4.gif\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eピンが外れされたら、外した人へ警告メッセージを送信すると同時に\u003cbr\u003e\n再度ピン留を行っています。\u003c/p\u003e\n\n\u003cp\u003eピンを外したい場合は特定のキーワードを発言することで、\u003cbr\u003e\n一定時間のみピンをはずすことができます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ebot.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'Error: Specify token in environment'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eBotkit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'botkit'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eBotkit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslackbot\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003edebug\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ebot\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003espawn\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etoken\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eretry\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003estartRTM\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ecanPinRemoved\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehears\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ピンはずさせてやー'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'direct_message'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'direct_mention'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'mention'\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ecanPinRemoved\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ebot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'30秒だけ待ったる'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003ebot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ecanPinRemoved\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'ほい時間ぎれー'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ebot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'pin_removed'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecanPinRemoved\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003ebot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eapi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eusers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003euserName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003ebot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eapi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epins\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003echannel\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003echannel_id\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ets\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003ebot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esay\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"sb\"\u003e`ちょっと @\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003euserName\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"sb\"\u003e はん。 勝手にピンはずさんといてやー。\u003c/span\u003e\u003cspan class=\"err\"\u003e\\\u003c/span\u003e\u003cspan class=\"sb\"\u003enしゃあないからもっかいピンしといたでー`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003elink_names\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003echannel\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003echannel_id\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003econtroller.on で \u003ccode\u003epin_removed\u003c/code\u003e イベントを待機します。\u003cbr\u003e\nイベントが発生したら \u003ccode\u003emessage\u003c/code\u003e オブジェクトから必要な値を取得していきます。\u003cbr\u003e\nここではイベントを発生したユーザーがIDで渡ってくるので\u003cbr\u003e\n\u003ccode\u003eusers.info\u003c/code\u003e API を使用してユーザー名を取得しています。\u003c/p\u003e\n\n\u003cp\u003eピン留は \u003ccode\u003epins.add\u003c/code\u003e APIを使用して行っています。\u003cbr\u003e\nここでは \u003ccode\u003etimestamp\u003c/code\u003e に対象のメッセージのtimestampを設定することで\u003cbr\u003e\nメッセージのピン留めを行うことができます。\u003c/p\u003e\n\n\u003cp\u003e今回の実装ではファイルなどのピン留めには対応していないため、\u003cbr\u003e\nまた対応できるようにしていきたいです。\u003c/p\u003e\n\n\u003cp\u003eコードは\u003ca href=\"https://github.com/tamanugi/repin-bot\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003eにもあげております。\u003c/p\u003e\n","body":"Slackには `Pin` という機能があります。\n重要なメッセージやファイルなどをチャンネルにピン留めしておくことで\nいつでも参照できるという機能です。\n\n先日、新たに参加したメンバーがSlackの使い方をよく理解しておらず、\nチャンネル内にピン留されたメッセージなどをすべてはずしてしまうということがありました。\n\nそこで誤ってピンが外れされてしまったとしても、再度自動でピンをしてくれるBotを\nbotkitを使って作成してみました。\n\n#　成果物\n![repin_bot4.gif](https://qiita-image-store.s3.amazonaws.com/0/55219/b58eb9df-c41f-e373-2ac2-a440c61447cc.gif)\n\nピンが外れされたら、外した人へ警告メッセージを送信すると同時に\n再度ピン留を行っています。\n\nピンを外したい場合は特定のキーワードを発言することで、\n一定時間のみピンをはずすことができます。\n\n# コード\n\n```javascript:bot.js\nif (!process.env.token) {\n  console.log('Error: Specify token in environment');\n  process.exit(1);\n}\n\nvar Botkit = require('botkit');\n\nvar controller = Botkit.slackbot({\n  debug: false\n});\n\nvar bot = controller.spawn({\n  token: process.env.token,\n  retry: true\n}).startRTM(function(error){\n  if(error){\n    throw new Error(error);\n  }\n});\n\nlet canPinRemoved = false;\n\ncontroller.hears('ピンはずさせてやー', ['direct_message', 'direct_mention', 'mention'], (bot, message) =\u003e {\n  canPinRemoved = true;\n  bot.reply(message, '30秒だけ待ったる');\n  setTimeout((bot, message) =\u003e {\n    canPinRemoved = false;\n    bot.reply(message, 'ほい時間ぎれー');\n  }, 10000, bot, message);\n});\n\ncontroller.on('pin_removed', function(bot, message) {\n\n  if(canPinRemoved) return;\n\n  bot.api.users.info({\n    user: message.user\n  }, function(error, result){\n    if(error) console.log(error);\n\n    let userName = result.user.name;\n\n    bot.api.pins.add({\n      channel: message.channel_id,\n      timestamp: message.item.message.ts\n    });\n\n    bot.say({\n      text: `ちょっと @${userName} はん。 勝手にピンはずさんといてやー。\\nしゃあないからもっかいピンしといたでー`,\n      link_names: true,\n      channel: message.channel_id\n    });\n  });\n\n\n});\n\n```\n\ncontroller.on で `pin_removed` イベントを待機します。\nイベントが発生したら `message` オブジェクトから必要な値を取得していきます。\nここではイベントを発生したユーザーがIDで渡ってくるので\n`users.info` API を使用してユーザー名を取得しています。\n\nピン留は `pins.add` APIを使用して行っています。\nここでは `timestamp` に対象のメッセージのtimestampを設定することで\nメッセージのピン留めを行うことができます。\n\n今回の実装ではファイルなどのピン留めには対応していないため、\nまた対応できるようにしていきたいです。\n\n\nコードは[こちら](https://github.com/tamanugi/repin-bot)にもあげております。\n","coediting":false,"created_at":"2017-05-17T23:56:42+09:00","group":null,"id":"73bfc61272de95e3ebd1","private":false,"tags":[{"name":"Slack","versions":[]},{"name":"Botkit","versions":[]}],"title":"[Slack]チャンネルのピンが外されたら再度ピンしてくれるBot","updated_at":"2017-05-17T23:56:42+09:00","url":"http://qiita.com/tamanugi/items/73bfc61272de95e3ebd1","user":{"description":null,"facebook_id":null,"followees_count":6,"followers_count":2,"github_login_name":"tamanugi","id":"tamanugi","items_count":31,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":55219,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/55219/profile-images/1473693620","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch3\u003e\n\u003cspan id=\"事象\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BA%8B%E8%B1%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e事象\u003c/h3\u003e\n\n\u003cp\u003eaws cliでs3コマンドを実行するとタイトルのエラー。\u003cbr\u003e\n\u003c/p\u003e\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n$ aws s3 ls\n\n'str' object has no attribute 'get'\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"原因\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8E%9F%E5%9B%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e原因\u003c/h3\u003e\n\n\u003cp\u003e.aws/configのs3署名バージョン部で改行が入っていない。\u003c/p\u003e\n\n\u003cp\u003e(誤)\u003cbr\u003e\n\u003c/p\u003e\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n$ cat .aws/config\n[default]\noutput = json\nregion = ap-northeast-1\ns3 = signature_version = s3v4\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(正)\u003cbr\u003e\n\u003c/p\u003e\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n$ cat .aws/config\n[default]\noutput = json\nregion = ap-northeast-1\ns3 =\n      signature_version = s3v4\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\u003cbr\u003e\n※[]内は各々で定義したprofile名です。\n\n\u003cp\u003eIAM権限が足りない場合(s3:ListBucketが無い)でも同様のエラーが発生しました。\u003c/p\u003e\n\n\u003cp\u003e切り分けのためにpython、boto、aws cliのバージョンやIAMを見て少し長引いたため共有です。\u003c/p\u003e\n","body":"###事象\naws cliでs3コマンドを実行するとタイトルのエラー。\n\u003cpre\u003e\n$ aws s3 ls\n\n'str' object has no attribute 'get'\n\u003c/pre\u003e\n\n###原因\n.aws/configのs3署名バージョン部で改行が入っていない。\n\n(誤)\n\u003cpre\u003e\n$ cat .aws/config\n[default]\noutput = json\nregion = ap-northeast-1\ns3 = signature_version = s3v4\n\u003c/pre\u003e\n\n(正)\n\u003cpre\u003e\n$ cat .aws/config\n[default]\noutput = json\nregion = ap-northeast-1\ns3 =\n      signature_version = s3v4\n\u003c/pre\u003e\n※[]内は各々で定義したprofile名です。\n\nIAM権限が足りない場合(s3:ListBucketが無い)でも同様のエラーが発生しました。\n\n切り分けのためにpython、boto、aws cliのバージョンやIAMを見て少し長引いたため共有です。\n\n","coediting":false,"created_at":"2017-05-17T23:52:48+09:00","group":null,"id":"04b252ff40bcab0222bf","private":false,"tags":[{"name":"AWS","versions":[]},{"name":"S3","versions":[]},{"name":"awscli","versions":[]}],"title":"'str' object has no attribute 'get'","updated_at":"2017-05-17T23:52:48+09:00","url":"http://qiita.com/lawliteqed/items/04b252ff40bcab0222bf","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":1,"github_login_name":"lawliteqed","id":"lawliteqed","items_count":2,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":121456,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/121456/profile-images/1475932112","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"リンク\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%83%B3%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリンク\u003c/h1\u003e\n\n\u003cp\u003eこの記事は、次の記事と相互リンクです。\u003cbr\u003e\n\u003ca href=\"http://qiita.com/standard-software/items/189241606d32d3cd956d\" id=\"reference-592e100b6df0ed455312\"\u003eVisual Studio Code を外部エディタから開く。 - Qiita\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eVisual Studio Code (VSCode) をIDEの外部エディタとして使用するだけでなく、VSCodeから他のエディタを使えたら、ツール間の連携がとれていいなと思ったので調べました。\u003c/p\u003e\n\n\u003cp\u003eかなりややこしく、かつ、他の方に役に立つと思うのでまとめておきます。\u003c/p\u003e\n\n\u003cp\u003eまだ調べきれていないことや、コマンド入力欄の正式な名前などがわからない所があるので、何かご存知の事あればコメントをください。\u003c/p\u003e\n\n\u003cp\u003e私は、EmEditorを使っているので他のエディタは調べきれていないのですが、この記事で扱う内容でVSCodeとEmEditorで相互で同じファイルを編集できるやり方がわかれば、他のエディタに応用することは簡単にできると思うのでご利用ください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h1\u003e\n\n\u003cp\u003e環境はWindowsです。\u003c/p\u003e\n\n\u003cp\u003eVSCodeのインストールはしておいてください。やり方はどこかで探しましょう。\u003c/p\u003e\n\n\u003cp\u003eコマンドラインで実行した現在(最新)のバージョンは次の通りです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u0026gt; code -v\n1.12.2\n19222cdc84ce72202478ba1cec5cb557b71163de\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ecodeコマンドで起動できるのはかっこいいです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"目次\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E6%AC%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目次\u003c/h1\u003e\n\n\u003col\u003e\n\u003cli\u003etasks.json を利用して、VSCodeから外部エディタを開く\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-拡張機能-open-in-editor-を利用してvscodeから外部エディタを開く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD-open-in-editor-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%A6vscode%E3%81%8B%E3%82%89%E5%A4%96%E9%83%A8%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%82%92%E9%96%8B%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. 拡張機能 Open in Editor を利用して、VSCodeから外部エディタを開く\u003c/h2\u003e\n\n\u003cp\u003etasks.json を使う方法は、外部エディタの起動のために[Ctrl+Pキー]を押してコマンド入力欄(正式名称不明)に、[task editor]などと入力する手間があります。また、tasks.jsonは編集しているファイル群のあるフォルダだけで設定が有効になるので、プロジェクトごとにtasks.jsonファイルを配置が必要です。tasks.jsonで定義したショートカットキーへの割当方法はよくわかりません。\u003c/p\u003e\n\n\u003cp\u003e拡張機能のOpen in Editor は、[Alt+Shift+Eキー]で外部エディタを起動することができます。結構便利です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"tasksjson-を利用してvscodeから外部エディタを開く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tasksjson-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%A6vscode%E3%81%8B%E3%82%89%E5%A4%96%E9%83%A8%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%82%92%E9%96%8B%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etasks.json を利用して、VSCodeから外部エディタを開く\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"tasksjsonの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tasksjson%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etasks.jsonの作成\u003c/h2\u003e\n\n\u003cp\u003eまず、tasks.jsonを作成します。\u003c/p\u003e\n\n\u003cp\u003eVSCodeは、例えば、C:\\Temp\\Test\\A.js のファイルを編集したり実行する際には、Testフォルダをプロジェクトフォルダとして認識します。\u003c/p\u003e\n\n\u003cp\u003eこのプロジェクトフォルダのVSCodeの設定は、\u003c/p\u003e\n\n\u003cp\u003eC:\\Temp\\Test..vscode\u003c/p\u003e\n\n\u003cp\u003eに入っており、tasks.jsonは\u003c/p\u003e\n\n\u003cp\u003eC:\\Temp\\Test..vscode\\tasks.json\u003c/p\u003e\n\n\u003cp\u003eに配置されることになります。\u003cbr\u003e\nこの場所に自分で作成してもいいのですが、VSCodeでも作成できるのでそちらを行います。\u003c/p\u003e\n\n\u003cp\u003eC:\\Temp\\Test\\A.js\u003c/p\u003e\n\n\u003cp\u003eを、開いているとします。(jsファイルではなく、テキストファイルでもなんでもよいです)\u003c/p\u003e\n\n\u003cp\u003eF1キーで、入力欄を表示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u0026gt;task bui\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと入力すると、[Tasks: Run Build Task]、が選択されます。\u003cbr\u003e\n実行すると、「ビルドタスクが構成されていません」みたいなメッセージがでるので「ビルドタスクを構成します」のボタンが表示されているので押します。\u003c/p\u003e\n\n\u003cp\u003eここで、いろいろリストがでます(gulp|grunt|npm|typescript etc..)。一番下に表示される[Others 任意の外部コマンドを...]を、選択します。\u003c/p\u003e\n\n\u003cp\u003eそうすると、ファイルと同階層に、[.vscode\\tasks.json]ファイルが作成されます。\u003c/p\u003e\n\n\u003cp\u003e※また、[.vscode\\tasks.json]ファイルを作るのは、\u003cbr\u003e\n```\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003econfigure task runner \u003cbr\u003e\n```\u003cbr\u003e\nこちらのコマンドでもよいようです。こちらもリストが表示されるので、[Others 任意の外部コマンドを...]を選択してください。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e次の場所にファイルが作成されます。\u003cbr\u003e\nこのファイルを編集することで、taskコマンドを拡張することができます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eC\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"err\"\u003e//\u003c/span\u003e \u003cspan class=\"err\"\u003eSee\u003c/span\u003e \u003cspan class=\"err\"\u003ehttps://go.microsoft.com/fwlink/?LinkId=733558\u003c/span\u003e\n  \u003cspan class=\"err\"\u003e//\u003c/span\u003e \u003cspan class=\"err\"\u003efor\u003c/span\u003e \u003cspan class=\"err\"\u003ethe\u003c/span\u003e \u003cspan class=\"err\"\u003edocumentation\u003c/span\u003e \u003cspan class=\"err\"\u003eabout\u003c/span\u003e \u003cspan class=\"err\"\u003ethe\u003c/span\u003e \u003cspan class=\"err\"\u003etasks.json\u003c/span\u003e \u003cspan class=\"err\"\u003eformat\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"0.1.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"command\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"echo\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"isShellCommand\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"args\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Hello World\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\"showOutput\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"外部エディタを定義する-tasksjson-の設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%A4%96%E9%83%A8%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B-tasksjson-%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e外部エディタを定義する tasks.json の設定\u003c/h2\u003e\n\n\u003cp\u003etasks.json を次のようにします。\u003cbr\u003e\nこれは、VSCodeを使っても、エディタを使って編集してもいいでしょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etasks.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"0.1.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"command\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"cmd\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"err\"\u003e//あるいは\u003c/span\u003e \u003cspan class=\"nt\"\u003e\"command\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"cmd.exe\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"isShellCommand\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"showOutput\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"args\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"/C\"\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"tasks\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\"taskName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"editor\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\"suppressTaskName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\"args\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\\\"C:\\\\Program Files (x86)\\\\EmEditor\\\\EmEditor.exe\\\" /l ${lineNumber} ${file}\"\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\"showOutput\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"never\"\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\"taskName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"test\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\"suppressTaskName\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\"args\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"echo Hello World! \"\u003c/span\u003e \u003cspan class=\"p\"\u003e],\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\"showOutput\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"always\"\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003etaskName として、editor と test を登録してみています。\u003cbr\u003e\nこれを真似して書いてもらえれば、いくつでもタスクを増やすことができます。\u003c/p\u003e\n\n\u003cp\u003e今回使うのは、\"taskName\": \"editor\", の所だけです。\u003c/p\u003e\n\n\u003cp\u003eこのように書くことで、VSCode の機能が拡張されます。\u003c/p\u003e\n\n\u003cp\u003eダブルクォーテーションや、パス区切り記号を間違えないように注意して設定してください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"vscode-から動作を確認する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vscode-%E3%81%8B%E3%82%89%E5%8B%95%E4%BD%9C%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVSCode から動作を確認する。\u003c/h2\u003e\n\n\u003cp\u003eVSCode に戻り、C:\\Temp\\Test\\A.js を開いた状態にして\u003c/p\u003e\n\n\u003cp\u003e[Ctrl + P キー]を押してください。F1キーをおした時と同じ入力欄が出ます。\u003cbr\u003e\n(コマンド入力モードか、そうでないか、が違いがあるようです。)\u003c/p\u003e\n\n\u003cp\u003eそこで、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003etask editor\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと入力、Enter を押すと、外部エディタとしてEmEditorが起動します。\u003cbr\u003e\nVSCodeで編集しているカーソル(キャレット)のある行が、EmEditor でも開くようになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"拡張機能-open-in-editor-を利用してvscodeから外部エディタを開く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD-open-in-editor-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%A6vscode%E3%81%8B%E3%82%89%E5%A4%96%E9%83%A8%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%82%92%E9%96%8B%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e拡張機能 Open in Editor を利用して、VSCodeから外部エディタを開く\u003c/h1\u003e\n\n\u003cp\u003e拡張機能 Open in Editor を使うと、わざわざ [tasks …]とか入力しなくてもショートカットキーでエディタが開けるので、毎回開くファイルごとフォルダごとにtasks.jsonを編集して外部エディタを開く設定をするよりも便利です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"インストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eインストール\u003c/h2\u003e\n\n\u003cp\u003eOpen in editor 拡張機能のインストール手順です。\u003c/p\u003e\n\n\u003cp\u003eF1キーを押して、コマンド入力欄を出し\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u0026gt;install\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eと入力すると、いくつかコマンドが出て来るので[Extensions: Install]を選んでください。拡張機能欄が表示されます。\u003c/p\u003e\n\n\u003cp\u003e[open in editor]\u003c/p\u003e\n\n\u003cp\u003eで検索すると、open in editor 拡張を選択することができるので、[インストール]を押してインストールしてください。\u003c/p\u003e\n\n\u003cp\u003eしばらくすると、[インストール]ボタンが、[再読み込む]ボタン(む？)に変わるので押してください。ダイアログがでて、[ウィンドウの再読み込み]ボタンを押します。これは、VSCodeの内部の枠だけが再起動されるような機能になっています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定\u003c/h2\u003e\n\n\u003cp\u003eOpen in Editor の設定は、VSCodeの普通の設定で行います。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eメニューの[ファイル][基本設定][設定]を選択\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e表示される、[settinngs.json]を下にスクロールすると、\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eOpen in External Editor configuration が現れるので中身を展開してみる。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e次の2つの設定を行う\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esettings.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e    \u003cspan class=\"s2\"\u003e\"alt-editor.binary\"\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"C:\\\\Program Files (x86)\\\\EmEditor\\\\EmEditor.exe\"\u003c/span\u003e\u003cspan class=\"err\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s2\"\u003e\"alt-editor.args\"\u003c/span\u003e\u003cspan class=\"err\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"/l {line} {filename}\"\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e動作確認\u003c/h2\u003e\n\n\u003cp\u003eVSCodeでファイルを見ている時に、[Alt+Shift+Eキー]を押すと、EmEditorが起動します。\u003c/p\u003e\n\n\u003cp\u003eVSCodeで編集しているカーソル(キャレット)のある行が、EmEditor でも開くようになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考にした記事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E8%A8%98%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考にした記事\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://www.atmarkit.co.jp/ait/articles/1509/08/news019_2.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e特集：Visual Studio Code早分かりガイド：Visual Studio Codeの使い勝手をよくするツール (2/5) - ＠IT\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/usagi/items/5a0f4edc99420173abb3\" id=\"reference-502c337ce3cd47893a7f\"\u003eVisual Studio Code: Task 機能に複数の任意のコマンドを簡単に仕込む方法 - Qiita\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://renga.hatenadiary.com/entry/2016/07/16/004018\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVisual Studio Codeのtasks.jsonメモ - レンガ積みのブログ\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとても参考になりました。ありがとうございます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ということで\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A8%E3%81%84%E3%81%86%E3%81%93%E3%81%A8%E3%81%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eということで\u003c/h1\u003e\n\n\u003cp\u003eVSCode と 自分のお気に入りのエディタなどを組み合わせて便利に使っていきましょう。\u003c/p\u003e\n","body":"\n# リンク\nこの記事は、次の記事と相互リンクです。\n[Visual Studio Code を外部エディタから開く。 - Qiita](http://qiita.com/standard-software/items/189241606d32d3cd956d)\n\n# はじめに\n\nVisual Studio Code (VSCode) をIDEの外部エディタとして使用するだけでなく、VSCodeから他のエディタを使えたら、ツール間の連携がとれていいなと思ったので調べました。\n\nかなりややこしく、かつ、他の方に役に立つと思うのでまとめておきます。\n\nまだ調べきれていないことや、コマンド入力欄の正式な名前などがわからない所があるので、何かご存知の事あればコメントをください。\n\n私は、EmEditorを使っているので他のエディタは調べきれていないのですが、この記事で扱う内容でVSCodeとEmEditorで相互で同じファイルを編集できるやり方がわかれば、他のエディタに応用することは簡単にできると思うのでご利用ください。\n\n# 環境\n\n環境はWindowsです。\n\nVSCodeのインストールはしておいてください。やり方はどこかで探しましょう。\n\nコマンドラインで実行した現在(最新)のバージョンは次の通りです。\n\n```\n\u003e code -v\n1.12.2\n19222cdc84ce72202478ba1cec5cb557b71163de\n```\n\ncodeコマンドで起動できるのはかっこいいです。\n\n\n# 目次\n1. tasks.json を利用して、VSCodeから外部エディタを開く\n1. 拡張機能 Open in Editor を利用して、VSCodeから外部エディタを開く\n---\ntasks.json を使う方法は、外部エディタの起動のために[Ctrl+Pキー]を押してコマンド入力欄(正式名称不明)に、[task editor]などと入力する手間があります。また、tasks.jsonは編集しているファイル群のあるフォルダだけで設定が有効になるので、プロジェクトごとにtasks.jsonファイルを配置が必要です。tasks.jsonで定義したショートカットキーへの割当方法はよくわかりません。\n\n拡張機能のOpen in Editor は、[Alt+Shift+Eキー]で外部エディタを起動することができます。結構便利です。\n\n\n# tasks.json を利用して、VSCodeから外部エディタを開く\n\n## tasks.jsonの作成\n\nまず、tasks.jsonを作成します。\n\nVSCodeは、例えば、C:\\Temp\\Test\\A.js のファイルを編集したり実行する際には、Testフォルダをプロジェクトフォルダとして認識します。\n\nこのプロジェクトフォルダのVSCodeの設定は、\n\nC:\\Temp\\Test\\..vscode\n\nに入っており、tasks.jsonは\n\nC:\\Temp\\Test\\..vscode\\tasks.json\n\nに配置されることになります。\nこの場所に自分で作成してもいいのですが、VSCodeでも作成できるのでそちらを行います。\n\nC:\\Temp\\Test\\A.js\n\nを、開いているとします。(jsファイルではなく、テキストファイルでもなんでもよいです)\n\nF1キーで、入力欄を表示します。\n\n```\n\u003etask bui\n```\n\nと入力すると、[Tasks: Run Build Task]、が選択されます。\n実行すると、「ビルドタスクが構成されていません」みたいなメッセージがでるので「ビルドタスクを構成します」のボタンが表示されているので押します。\n\nここで、いろいろリストがでます(gulp|grunt|npm|typescript etc..)。一番下に表示される[Others 任意の外部コマンドを...]を、選択します。\n\nそうすると、ファイルと同階層に、[.vscode\\tasks.json]ファイルが作成されます。\n\n※また、[.vscode\\tasks.json]ファイルを作るのは、\n```\n\u003econfigure task runner \n```\nこちらのコマンドでもよいようです。こちらもリストが表示されるので、[Others 任意の外部コマンドを...]を選択してください。\n\n次の場所にファイルが作成されます。\nこのファイルを編集することで、taskコマンドを拡張することができます。\n\n```json:C:\\Temp\\Test\\.vscode\\tasks.json\n{\n  // See https://go.microsoft.com/fwlink/?LinkId=733558\n  // for the documentation about the tasks.json format\n  \"version\": \"0.1.0\",\n  \"command\": \"echo\",\n  \"isShellCommand\": true,\n  \"args\": [\"Hello World\"],\n  \"showOutput\": \"always\"\n}\n```\n\n## 外部エディタを定義する tasks.json の設定\n\ntasks.json を次のようにします。\nこれは、VSCodeを使っても、エディタを使って編集してもいいでしょう。\n\n```json:tasks.json\n{\n    \"version\": \"0.1.0\",\n    \"command\": \"cmd\",\n    //あるいは \"command\": \"cmd.exe\",\n    \"isShellCommand\": true,\n    \"showOutput\": \"always\",\n    \"args\": [\"/C\"],\n    \"tasks\": [\n        {\n            \"taskName\": \"editor\",\n            \"suppressTaskName\": true,\n            \"args\": [ \"\\\"C:\\\\Program Files (x86)\\\\EmEditor\\\\EmEditor.exe\\\" /l ${lineNumber} ${file}\" ],\n            \"showOutput\": \"never\"\n        },\n        {\n            \"taskName\": \"test\",\n            \"suppressTaskName\": true,\n            \"args\": [ \"echo Hello World! \" ],\n            \"showOutput\": \"always\"\n        }\n    ]\n}\n```\n\ntaskName として、editor と test を登録してみています。\nこれを真似して書いてもらえれば、いくつでもタスクを増やすことができます。\n\n今回使うのは、\"taskName\": \"editor\", の所だけです。\n\nこのように書くことで、VSCode の機能が拡張されます。\n\nダブルクォーテーションや、パス区切り記号を間違えないように注意して設定してください。\n\n## VSCode から動作を確認する。\n\nVSCode に戻り、C:\\Temp\\Test\\A.js を開いた状態にして\n\n[Ctrl + P キー]を押してください。F1キーをおした時と同じ入力欄が出ます。\n(コマンド入力モードか、そうでないか、が違いがあるようです。)\n\nそこで、\n\n```\ntask editor\n```\n\nと入力、Enter を押すと、外部エディタとしてEmEditorが起動します。\nVSCodeで編集しているカーソル(キャレット)のある行が、EmEditor でも開くようになります。\n\n\n# 拡張機能 Open in Editor を利用して、VSCodeから外部エディタを開く\n\n拡張機能 Open in Editor を使うと、わざわざ [tasks …]とか入力しなくてもショートカットキーでエディタが開けるので、毎回開くファイルごとフォルダごとにtasks.jsonを編集して外部エディタを開く設定をするよりも便利です。\n\n## インストール\n\nOpen in editor 拡張機能のインストール手順です。\n\nF1キーを押して、コマンド入力欄を出し\n\n```\n\u003einstall\n```\n\nと入力すると、いくつかコマンドが出て来るので[Extensions: Install]を選んでください。拡張機能欄が表示されます。\n\n[open in editor]\n\nで検索すると、open in editor 拡張を選択することができるので、[インストール]を押してインストールしてください。\n\nしばらくすると、[インストール]ボタンが、[再読み込む]ボタン(む？)に変わるので押してください。ダイアログがでて、[ウィンドウの再読み込み]ボタンを押します。これは、VSCodeの内部の枠だけが再起動されるような機能になっています。\n\n## 設定\n\nOpen in Editor の設定は、VSCodeの普通の設定で行います。\n\n* メニューの[ファイル][基本設定][設定]を選択\n\n* 表示される、[settinngs.json]を下にスクロールすると、\n\n* Open in External Editor configuration が現れるので中身を展開してみる。\n\n* 次の2つの設定を行う\n\n```settings.json\n    \"alt-editor.binary\": \"C:\\\\Program Files (x86)\\\\EmEditor\\\\EmEditor.exe\",\n    \"alt-editor.args\": \"/l {line} {filename}\"\n```\n\n## 動作確認\n\nVSCodeでファイルを見ている時に、[Alt+Shift+Eキー]を押すと、EmEditorが起動します。\n\nVSCodeで編集しているカーソル(キャレット)のある行が、EmEditor でも開くようになります。\n\n\n# 参考にした記事\n\n* [特集：Visual Studio Code早分かりガイド：Visual Studio Codeの使い勝手をよくするツール (2/5) - ＠IT](http://www.atmarkit.co.jp/ait/articles/1509/08/news019_2.html)\n* [Visual Studio Code: Task 機能に複数の任意のコマンドを簡単に仕込む方法 - Qiita](http://qiita.com/usagi/items/5a0f4edc99420173abb3)\n* [Visual Studio Codeのtasks.jsonメモ - レンガ積みのブログ](http://renga.hatenadiary.com/entry/2016/07/16/004018)\n\nとても参考になりました。ありがとうございます。\n\n# ということで\n\nVSCode と 自分のお気に入りのエディタなどを組み合わせて便利に使っていきましょう。\n\n","coediting":false,"created_at":"2017-05-17T23:50:17+09:00","group":null,"id":"785e3c27865a8e8d0b92","private":false,"tags":[{"name":"code","versions":[]},{"name":"Studio","versions":[]},{"name":"Visual","versions":[]}],"title":"Visual Studio Code から外部エディタを開く。","updated_at":"2017-05-18T00:11:17+09:00","url":"http://qiita.com/standard-software/items/785e3c27865a8e8d0b92","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":1,"github_login_name":"standard-software","id":"standard-software","items_count":7,"linkedin_id":"","location":"Tokyo","name":"","organization":"Standard Software","permanent_id":96423,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/96423/profile-images/1494598363","twitter_screen_name":null,"website_url":"https://www.facebook.com/stndardsoftware/"}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"やってみたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやってみたいこと\u003c/h1\u003e\n\n\u003cp\u003enginx でロードバランスを行い、WEB#1/WEB#2 を起動して apache のログを fluend でログサーバへ転送してその内容をリアルタイムで確認して ABテスト環境のベースを作成したい。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"動機\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%95%E6%A9%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e動機\u003c/h1\u003e\n\n\u003cp\u003eWEB#1/WEB#2 で冗長構成で運用されているサービスをいつも見かけるけど。その中で自分のリリースしたサービスが本当に価値のあるものあのかを確認できるようにすることで技術を提案できるのではとおもったから\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"環境構築\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境構築\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"いつもどおり-vagrant-で仮想環境を構築\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%84%E3%81%A4%E3%82%82%E3%81%A9%E3%81%8A%E3%82%8A-vagrant-%E3%81%A7%E4%BB%AE%E6%83%B3%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eいつもどおり Vagrant で仮想環境を構築\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eVagrantfile\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e  \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edefine\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"nginx\"\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003enginx\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n      \u003cspan class=\"n\"\u003enginx\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebox\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"centos7\"\u003c/span\u003e\n      \u003cspan class=\"n\"\u003enginx\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enetwork\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"forwarded_port\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003eguest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e80\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e8080\u003c/span\u003e\n      \u003cspan class=\"n\"\u003enginx\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enetwork\u003c/span\u003e \u003cspan class=\"ss\"\u003e:private_network\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003eip\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"192.168.33.10\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003evirtualbox__intnet\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"intnet\"\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edefine\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"web1\"\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003eweb1\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eweb1\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebox\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"centos7\"\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e#web1.vm.network :forwarded_port, id: \"ssh\", guest: 22, host: 2222\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e#web1.vm.network \"forwarded_port\", guest: 80, host: 8080\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eweb1\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enetwork\u003c/span\u003e \u003cspan class=\"ss\"\u003e:private_network\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003eip\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"192.168.33.100\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003evirtualbox__intnet\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"intnet\"\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edefine\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"web2\"\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003eweb2\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eweb2\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebox\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"centos7\"\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eweb2\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enetwork\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"forwarded_port\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003eguest\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e80\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e8082\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eweb2\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evm\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enetwork\u003c/span\u003e \u003cspan class=\"ss\"\u003e:private_network\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003eip\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"192.168.33.102\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003evirtualbox__intnet\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"intnet\"\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"nginx-インストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nginx-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enginx インストール\u003c/h1\u003e\n\n\u003cp\u003eここの centos 用の設定を参照\u003cbr\u003e\n\u003ca href=\"https://www.nginx.com/resources/wiki/start/topics/tutorials/install/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.nginx.com/resources/wiki/start/topics/tutorials/install/\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e/etc/yum.repos.d/nginx.repo\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/centos/$releasever/$basearch/\ngpgcheck=0\nenabled=1\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e$ \u003ccode\u003esudo yum -y install nginx\u003c/code\u003e\u003cbr\u003e\n$ \u003ccode\u003enginx -v\u003c/code\u003e\u003cbr\u003e\n\u003cem\u003e今回インストールしたバージョンは\u003ccode\u003enginx version: nginx/1.12.0\u003c/code\u003eでした\u003c/em\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"nginx-起動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nginx-%E8%B5%B7%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enginx 起動\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ sudo systemctl start nginx\n$ sudo systemctl status nginx\nnginx.service - nginx - high performance web server\n   Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled)\n   Active: active (running) since 火 2017-05-16 14:02:29 UTC; 6s ago\n     Docs: http://nginx.org/en/docs/\n  Process: 21017 ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf (code=exited, status=0/SUCCESS)\n  Process: 21015 ExecStartPre=/usr/sbin/nginx -t -c /etc/nginx/nginx.conf (code=exited, status=0/SUCCESS)\n Main PID: 21019 (nginx)\n   CGroup: /system.slice/nginx.service\n           ├─21019 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\n           └─21020 nginx: worker process\n\n 5月 16 14:02:28 localhost.localdomain systemd[1]: Starting nginx - high performance web server...\n 5月 16 14:02:28 localhost.localdomain nginx[21015]: nginx: the configuration file /etc/nginx/nginx.conf... ok\n 5月 16 14:02:28 localhost.localdomain nginx[21015]: nginx: configuration file /etc/nginx/nginx.conf tes...ful\n 5月 16 14:02:28 localhost.localdomain systemd[1]: PID 20976 read from file /run/nginx.pid does not exist.\n 5月 16 14:02:29 localhost.localdomain systemd[1]: Started nginx - high performance web server.\nHint: Some lines were ellipsized, use -l to show in full.\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"nginx-動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nginx-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enginx 動作確認\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://localhost:8080\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://localhost:8080\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"apache-インストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#apache-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eapache インストール\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e共通設定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ sudo systemctl stop firewalld\n$ sudo ssytemctl disable firewalld\n$ sudo yum install httpd\n$ sudo systemctl status httpd\n$ sudo systemctl start httpd\n$ sudo systemctl status httpd\n$ sudo systemctl enable httpd\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eweb#1\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ sudo echo \"\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;web1 running ...\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\" \u0026gt; /var/www/html/index.html \n$ curl localhost\n\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;web1 running ...\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eweb#2\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ sudo echo \"\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;web2 running ...\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\" \u0026gt; /var/www/html/index.html \n$ curl localhost\n\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;web2 running ...\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ロードバランス設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%83%BC%E3%83%89%E3%83%90%E3%83%A9%E3%83%B3%E3%82%B9%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eロードバランス設定\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"web1web2-に-nginx-のロードバランスできるように設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#web1web2-%E3%81%AB-nginx-%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%89%E3%83%90%E3%83%A9%E3%83%B3%E3%82%B9%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eweb#1/web#2 に nginx のロードバランスできるように設定\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e/etc/nginx/conf.d/server.conf\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eupstream myapp1 {\n    server 192.168.33.100;\n    server 192.168.33.102;\n}\n\nserver {\n    listen       80;\n    location / {\n        set $do_not_cache 0;\n        proxy_pass http://myapp1;\n    }\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eちょっとはまりました。上記フォルダに default.conf があり server.conf を作成した場合に default.conf の設定を参照していてロードバランスの確認が出来なかったです。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003enginx\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ sudo systemctl restart nginx\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"動作確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e動作確認\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"http://localhost:8080\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://localhost:8080\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h1\u003e\n\n\u003cp\u003e前回の \u003ca href=\"http://qiita.com/wankosob/items/3d4b7cff0306b382b68e\" id=\"reference-deaf96d89592034bb3d4\"\u003eFluentd ってどんなことができるのか試してみたかった（メモ+α）\u003c/a\u003eを活用して今後は apache のサーバログを使ってABテストの準備環境を作成したいと思います。\u003c/p\u003e\n","body":"# やってみたいこと\nnginx でロードバランスを行い、WEB#1/WEB#2 を起動して apache のログを fluend でログサーバへ転送してその内容をリアルタイムで確認して ABテスト環境のベースを作成したい。\n\n# 動機\nWEB#1/WEB#2 で冗長構成で運用されているサービスをいつも見かけるけど。その中で自分のリリースしたサービスが本当に価値のあるものあのかを確認できるようにすることで技術を提案できるのではとおもったから\n\n# 環境構築\n## いつもどおり Vagrant で仮想環境を構築\n```rb:Vagrantfile\n  config.vm.define \"nginx\" do |nginx|\n      nginx.vm.box = \"centos7\"\n      nginx.vm.network \"forwarded_port\", guest: 80, host: 8080\n      nginx.vm.network :private_network, ip: \"192.168.33.10\", virtualbox__intnet: \"intnet\"\n  end\n  config.vm.define \"web1\" do |web1|\n      web1.vm.box = \"centos7\"\n      #web1.vm.network :forwarded_port, id: \"ssh\", guest: 22, host: 2222\n      #web1.vm.network \"forwarded_port\", guest: 80, host: 8080\n      web1.vm.network :private_network, ip: \"192.168.33.100\", virtualbox__intnet: \"intnet\"\n  end\n  config.vm.define \"web2\" do |web2|\n      web2.vm.box = \"centos7\"\n      web2.vm.network \"forwarded_port\", guest: 80, host: 8082\n      web2.vm.network :private_network, ip: \"192.168.33.102\", virtualbox__intnet: \"intnet\"\n  end\n\n```\n# nginx インストール\nここの centos 用の設定を参照\n[https://www.nginx.com/resources/wiki/start/topics/tutorials/install/](https://www.nginx.com/resources/wiki/start/topics/tutorials/install/)\n\n```/etc/yum.repos.d/nginx.repo\n[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/centos/$releasever/$basearch/\ngpgcheck=0\nenabled=1\n```\n\n$ `sudo yum -y install nginx`\n$ `nginx -v`\n*今回インストールしたバージョンは`nginx version: nginx/1.12.0`でした*\n\n# nginx 起動\n```\n$ sudo systemctl start nginx\n$ sudo systemctl status nginx\nnginx.service - nginx - high performance web server\n   Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled)\n   Active: active (running) since 火 2017-05-16 14:02:29 UTC; 6s ago\n     Docs: http://nginx.org/en/docs/\n  Process: 21017 ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf (code=exited, status=0/SUCCESS)\n  Process: 21015 ExecStartPre=/usr/sbin/nginx -t -c /etc/nginx/nginx.conf (code=exited, status=0/SUCCESS)\n Main PID: 21019 (nginx)\n   CGroup: /system.slice/nginx.service\n           ├─21019 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\n           └─21020 nginx: worker process\n\n 5月 16 14:02:28 localhost.localdomain systemd[1]: Starting nginx - high performance web server...\n 5月 16 14:02:28 localhost.localdomain nginx[21015]: nginx: the configuration file /etc/nginx/nginx.conf... ok\n 5月 16 14:02:28 localhost.localdomain nginx[21015]: nginx: configuration file /etc/nginx/nginx.conf tes...ful\n 5月 16 14:02:28 localhost.localdomain systemd[1]: PID 20976 read from file /run/nginx.pid does not exist.\n 5月 16 14:02:29 localhost.localdomain systemd[1]: Started nginx - high performance web server.\nHint: Some lines were ellipsized, use -l to show in full.\n```\n# nginx 動作確認\n- [http://localhost:8080](http://localhost:8080)\n\n# apache インストール\n```:共通設定\n$ sudo systemctl stop firewalld\n$ sudo ssytemctl disable firewalld\n$ sudo yum install httpd\n$ sudo systemctl status httpd\n$ sudo systemctl start httpd\n$ sudo systemctl status httpd\n$ sudo systemctl enable httpd\n```\n```:web#1\n$ sudo echo \"\u003chtml\u003e\u003cbody\u003eweb1 running ...\u003c/body\u003e\u003c/html\u003e\" \u003e /var/www/html/index.html \n$ curl localhost\n\u003chtml\u003e\u003cbody\u003eweb1 running ...\u003c/body\u003e\u003c/html\u003e\n```\n```:web#2\n$ sudo echo \"\u003chtml\u003e\u003cbody\u003eweb2 running ...\u003c/body\u003e\u003c/html\u003e\" \u003e /var/www/html/index.html \n$ curl localhost\n\u003chtml\u003e\u003cbody\u003eweb2 running ...\u003c/body\u003e\u003c/html\u003e\n```\n\n# ロードバランス設定\n## web#1/web#2 に nginx のロードバランスできるように設定\n```:/etc/nginx/conf.d/server.conf\nupstream myapp1 {\n    server 192.168.33.100;\n    server 192.168.33.102;\n}\n\nserver {\n    listen       80;\n    location / {\n        set $do_not_cache 0;\n        proxy_pass http://myapp1;\n    }\n}\n```\n\n**ちょっとはまりました。上記フォルダに default.conf があり server.conf を作成した場合に default.conf の設定を参照していてロードバランスの確認が出来なかったです。**\n\n```:nginx\n$ sudo systemctl restart nginx\n```\n## 動作確認\n[http://localhost:8080](http://localhost:8080)\n\n# 最後に\n前回の [Fluentd ってどんなことができるのか試してみたかった（メモ+α）](http://qiita.com/wankosob/items/3d4b7cff0306b382b68e)を活用して今後は apache のサーバログを使ってABテストの準備環境を作成したいと思います。\n","coediting":false,"created_at":"2017-05-17T23:38:11+09:00","group":null,"id":"2959a0f8a659d21c37c8","private":false,"tags":[{"name":"nginx","versions":[]},{"name":"fluentd","versions":[]},{"name":"vagrant","versions":[]},{"name":"Apach","versions":[]}],"title":"ABテスト環境を構築する(その１)","updated_at":"2017-05-17T23:42:30+09:00","url":"http://qiita.com/wankosob/items/2959a0f8a659d21c37c8","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":1,"github_login_name":null,"id":"wankosob","items_count":4,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":174596,"profile_image_url":"https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=50","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003econfirm on rails 5.0.3 \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://stackoverflow.com/questions/35959490/rails-server-doesnt-see-code-changes-and-reload-files\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/35959490/rails-server-doesnt-see-code-changes-and-reload-files\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://stackoverflow.com/questions/28878832/rails-does-not-reload-controllers-helpers-on-each-request-in-freebsd-9-1\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/28878832/rails-does-not-reload-controllers-helpers-on-each-request-in-freebsd-9-1\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/rails/rails/issues/16678\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/rails/rails/issues/16678\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/burke/zeus/issues/388\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/burke/zeus/issues/388\u003c/a\u003e\u003c/p\u003e\n","body":"confirm on rails 5.0.3 \n\nhttp://stackoverflow.com/questions/35959490/rails-server-doesnt-see-code-changes-and-reload-files\n\nhttp://stackoverflow.com/questions/28878832/rails-does-not-reload-controllers-helpers-on-each-request-in-freebsd-9-1\n\nhttps://github.com/rails/rails/issues/16678\n\nhttps://github.com/burke/zeus/issues/388\n","coediting":false,"created_at":"2017-05-17T23:37:23+09:00","group":null,"id":"3ac6a068abf4158aedb5","private":false,"tags":[{"name":"Rails","versions":[]},{"name":"Linux","versions":[]},{"name":"vagrant","versions":[]}],"title":"rails does not reload on vagrant","updated_at":"2017-05-17T23:37:23+09:00","url":"http://qiita.com/chen7897499/items/3ac6a068abf4158aedb5","user":{"description":null,"facebook_id":null,"followees_count":8,"followers_count":3,"github_login_name":"chen7897499","id":"chen7897499","items_count":456,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":41165,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/41165/profile-images/1473688690","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e趣味でSwiftをもう一度書こうと思い、ブログを書きました。\u003cbr\u003e\nつまり、ブログの宣伝です。\u003c/p\u003e\n\n\u003cp\u003e※注意：\u003cbr\u003e\n私自身の勉強備忘ブログでもあります。\u003cbr\u003e\nそのため、表現等が誤っている可能性もあります。\u003cbr\u003e\nもしお気付きの場合はご指摘、ご鞭撻等を頂ければ幸いです。\u003cbr\u003e\nまた、質問等も受け付けておりますので、ご気軽にコメントいただけると幸いです。\u003cbr\u003e\n(ブログへのコメント欄、本記事でのコメント欄どちらでも構いません。)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ブログ内容\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%96%E3%83%AD%E3%82%B0%E5%86%85%E5%AE%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eブログ内容\u003c/h1\u003e\n\n\u003cp\u003e今回は\u003cstrong\u003e「フローの制御に関して」\u003c/strong\u003eをテーマにしています。\u003cbr\u003e\n取り扱う内容は以下の通りです。\u003cbr\u003e\n○ \u003cstrong\u003e\u003ccode\u003eif文\u003c/code\u003e\u003c/strong\u003e\u003cbr\u003e\n○ \u003cstrong\u003e\u003ccode\u003eswitch文\u003c/code\u003e\u003c/strong\u003e\u003cbr\u003e\n○ \u003cstrong\u003e\u003ccode\u003efor-in文\u003c/code\u003e\u003c/strong\u003e\u003cbr\u003e\n○ \u003cstrong\u003e\u003ccode\u003ewhile文\u003c/code\u003e\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e※注：「\u003cstrong\u003e\u003ccode\u003efor-in文\u003c/code\u003e\u003c/strong\u003e」と「\u003cstrong\u003e\u003ccode\u003ewhile文\u003c/code\u003e\u003c/strong\u003e」については記事は、\u003cbr\u003e\n今後追加する予定ではありますが、\u003cbr\u003e\n(2017.05.17現在)書かれていない状態です。\u003cbr\u003e\nご了承ください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ブログはこちら\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%96%E3%83%AD%E3%82%B0%E3%81%AF%E3%81%93%E3%81%A1%E3%82%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eブログはこちら\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://provinsite.com/dev/?p=359\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSwiftをもう一度勉強してみた#2\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"改定履歴\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%94%B9%E5%AE%9A%E5%B1%A5%E6%AD%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e改定履歴\u003c/h1\u003e\n\n\u003cp\u003e-\u003c/p\u003e\n","body":"# はじめに\n趣味でSwiftをもう一度書こうと思い、ブログを書きました。\nつまり、ブログの宣伝です。\n\n※注意：\n私自身の勉強備忘ブログでもあります。\nそのため、表現等が誤っている可能性もあります。\nもしお気付きの場合はご指摘、ご鞭撻等を頂ければ幸いです。\nまた、質問等も受け付けておりますので、ご気軽にコメントいただけると幸いです。\n(ブログへのコメント欄、本記事でのコメント欄どちらでも構いません。)\n\n# ブログ内容\n今回は**「フローの制御に関して」**をテーマにしています。\n取り扱う内容は以下の通りです。\n○ **`if文`**\n○ **`switch文`**\n○ **`for-in文`**\n○ **`while文`**\n\n※注：「**`for-in文`**」と「**`while文`**」については記事は、\n今後追加する予定ではありますが、\n(2017.05.17現在)書かれていない状態です。\nご了承ください。\n\n# ブログはこちら\n[Swiftをもう一度勉強してみた#2](https://provinsite.com/dev/?p=359)\n\n# 改定履歴\n-\n","coediting":false,"created_at":"2017-05-17T23:27:35+09:00","group":null,"id":"f96e96acb29e0f925c82","private":false,"tags":[{"name":"Swift","versions":[]}],"title":"Swiftをもう一度勉強してみた#2","updated_at":"2017-05-17T23:27:35+09:00","url":"http://qiita.com/fantm21/items/f96e96acb29e0f925c82","user":{"description":"","facebook_id":"","followees_count":42,"followers_count":26,"github_login_name":"fantm21","id":"fantm21","items_count":66,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":32946,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/32946/profile-images/1490789470","twitter_screen_name":"FumiProgrammer","website_url":"https://provinsite.com/web/"}},{"rendered_body":"\u003cp\u003eRecyclerViewで使うItemTouchHelperは簡単にドラッグ\u0026amp;ドロップやスワイプを実装できます。\u003c/p\u003e\n\n\u003cp\u003eしかし、ドロッグ\u0026amp;ドロップでは内部的にリストデータの順番を変えることはできない？\u003cbr\u003e\nので、そのリストを保存しても次回起動時に元に戻ってしまう。\u003cbr\u003e\nそこで少しコード追加。\u003c/p\u003e\n\n\u003cp\u003eといっても単純。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"java\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nd\"\u003e@Override\u003c/span\u003e\n\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003eboolean\u003c/span\u003e \u003cspan class=\"nf\"\u003eonMove\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRecyclerView\u003c/span\u003e \u003cspan class=\"n\"\u003erecyclerView\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRecyclerView\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eViewHolder\u003c/span\u003e \u003cspan class=\"n\"\u003eviewHolder\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRecyclerView\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eViewHolder\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efinal\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003efromPosition\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eviewHolder\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetAdapterPosition\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efinal\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003etoPosition\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetAdapterPosition\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003erecyclerAdapter\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003enotifyItemMoved\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efromPosition\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etoPosition\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//追加ここから\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003etemp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003earrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efromPosition\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003earrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eremove\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efromPosition\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003earrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoPosition\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etemp\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//ここまで\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e消してから追加するのがポイント。\u003c/p\u003e\n","body":"RecyclerViewで使うItemTouchHelperは簡単にドラッグ\u0026ドロップやスワイプを実装できます。\n\nしかし、ドロッグ\u0026ドロップでは内部的にリストデータの順番を変えることはできない？\nので、そのリストを保存しても次回起動時に元に戻ってしまう。\nそこで少しコード追加。\n\nといっても単純。\n\n```java\n@Override\npublic boolean onMove(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder, RecyclerView.ViewHolder target)\n{\n    final int fromPosition = viewHolder.getAdapterPosition();\n    final int toPosition = target.getAdapterPosition();\n    recyclerAdapter.notifyItemMoved(fromPosition, toPosition);\n    //追加ここから\n    String temp = arrayList.get(fromPosition);\n    arrayList.remove(fromPosition);\n    arrayList.add(toPosition, temp);\n    //ここまで\n    return true;\n}\n\n```\n\n消してから追加するのがポイント。\n","coediting":false,"created_at":"2017-05-17T23:22:18+09:00","group":null,"id":"cb12dffb7095b8f64c4a","private":false,"tags":[{"name":"Java","versions":[]},{"name":"Android","versions":[]}],"title":"ItemTouchHelperのドラッグ\u0026ドロップでArrayListも並び替える","updated_at":"2017-05-17T23:22:18+09:00","url":"http://qiita.com/hisurga/items/cb12dffb7095b8f64c4a","user":{"description":"営業マン","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":"hisurga","id":"hisurga","items_count":3,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":181869,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/181869/profile-images/1494948654","twitter_screen_name":"hisurga","website_url":"http://blog.hisurga.com"}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"gcegoogle-compute-engineのvmインスタンスのアカウントスコープを後から変更する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gcegoogle-compute-engine%E3%81%AEvm%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97%E3%82%92%E5%BE%8C%E3%81%8B%E3%82%89%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGCE(Google Compute Engine)のVMインスタンスのアカウントスコープを後から変更する\u003c/h1\u003e\n\n\u003cp\u003eGCEのVMインスタンスでアカウントスコープを途中で変更したい場合、少し工夫する必要があったのでメモ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"アクセス-スコープとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9-%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアクセス スコープとは\u003c/h2\u003e\n\n\u003cp\u003eそれぞれのGoogle Cloud Platform上のサービスのAPIに対して、インスタンスがアクセスを許可されている範囲のこと。\u003cbr\u003e\nGoogle Cloud Platform上の各サービスのAPIに対して、インスタンスがアクセス可能かどうかを「有効」/「無効」で表している。\u003cbr\u003e\nこれが有効のサービスのみ、インスタンスはそのサービスのAPIにアクセスすることができる。\u003cbr\u003e\n\u003ca href=\"https://cloud.google.com/compute/docs/access/service-accounts?hl=ja\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cloud.google.com/compute/docs/access/service-accounts?hl=ja\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"アクセススコープを変更する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアクセススコープを変更する\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"アクセススコープを変更するには\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアクセススコープを変更するには\u003c/h3\u003e\n\n\u003cp\u003eここからが本記事の本題だが、アクセススコープは、インスタンスの作成時か、インスタンスをシャットダウンしている状態でしか編集できないようだ。\u003c/p\u003e\n\n\u003cp\u003eそのため、「そのインスタンスで当初BigQueryのAPIを使う予定がなかったので、アクセススコープは、『無効』にしたが、後にやっぱりBigQueryのAPIを使いたくなったので、アクセススコープを『有効』にしたい」\u003cbr\u003e\nという場合は、前述したが以下の2つの方法しかない。(他にあったら教えてください…)\u003cbr\u003e\n1.  インスタンスを作成し直す\u003cbr\u003e\n2. インスタンスをシャットダウンして変更する                                                                                   \u003c/p\u003e\n\n\u003cp\u003e自分は当初それを知らなかったため、VMインスタンスのコンソール画面で何回編集を押してもアクセススコープが変更できなくて、泣きそうになりました。\u003c/p\u003e\n\n\u003cp\u003e今回は、「2.インスタンスをシャットダウンして変更する」を行い、アクセススコープを変更する。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"アクセススコープを変更するための手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアクセススコープを変更するための手順\u003c/h3\u003e\n\n\u003cp\u003eアクセススコープを変更するためには以下の手順が必要\u003cbr\u003e\n1. アクセススコープを変更したいVMインスタンスをシャットダウンする\u003cbr\u003e\n2. gcloudコマンドで、アクセス権を変更する\u003cbr\u003e\n3. インスタンスを再起動する\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実際にやってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実際にやってみる\u003c/h3\u003e\n\n\u003cp\u003e1.アクセススコープを変更したいVMインスタンスをシャットダウンする\u003cbr\u003e\n以下の公式ドキュメントを参考にVMインスタンスをシャットダウンする\u003cbr\u003e\n\u003ca href=\"https://cloud.google.com/compute/docs/instances/stopping-or-deleting-an-instance\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cloud.google.com/compute/docs/instances/stopping-or-deleting-an-instance\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e2.以下のcloudコマンドで、アクセス権を変更する\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003egcloud beta compute instances set-scopes projects/プロジェクト名/zones/ゾーン/instances/インスタンス名  --service-account サービスアカウントのメール \u0026lt;—no-scopes(無効にしたい場合) か --scopes(有効にしたい場合)\u0026gt;  変更するスコープ\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e「変更するスコープ」は、以下の一覧にあるurlかエイリアスを使用する\u003cbr\u003e\n\u003ca href=\"https://cloud.google.com/sdk/gcloud/reference/beta/compute/instances/set-scopes\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cloud.google.com/sdk/gcloud/reference/beta/compute/instances/set-scopes\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e3インスタンスを再起動する\u003cbr\u003e\n\u003ca href=\"https://cloud.google.com/compute/docs/instances/restarting-an-instance#restarting_a_stopped_instance\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cloud.google.com/compute/docs/instances/restarting-an-instance#restarting_a_stopped_instance\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実際にやってみた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実際にやってみた\u003c/h3\u003e\n\n\u003cp\u003e実際にインスタンス作成時には「無効」であったBigqueryのアクセススコープを「有効」に変更する。\u003c/p\u003e\n\n\u003cp\u003e「1. アクセススコープを変更したいVMインスタンスをシャットダウンする」と「3. インスタンスを再起動する」は、省略\u003c/p\u003e\n\n\u003cp\u003egcloudを実行\u003cbr\u003e\n\u003ccode\u003e\u003cbr\u003e\ngcloud beta compute instances set-scopes projects/プロジェクト名/zones/ゾーン/instances/インスタンス名  --service-account サービスアカウントのメール --scopes https://www.googleapis.com/auth/bigquery\u003cbr\u003e\n\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e結果\u003cbr\u003e\nVMインスタンスのコンソールの「Cloud APIアクセス範囲」のBigQueryが「無効」から「有効」になった。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"参考にさせていただいたサイト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%95%E3%81%9B%E3%81%A6%E3%81%84%E3%81%9F%E3%81%A0%E3%81%84%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考にさせていただいたサイト\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://cloud.google.com/compute/docs/access/service-accounts?hl=ja\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cloud.google.com/compute/docs/access/service-accounts?hl=ja\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://cloud.google.com/compute/docs/instances/stopping-or-deleting-an-instance\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cloud.google.com/compute/docs/instances/stopping-or-deleting-an-instance\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://cloud.google.com/sdk/gcloud/reference/beta/compute/instances/set-scopes\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cloud.google.com/sdk/gcloud/reference/beta/compute/instances/set-scopes\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://cloud.google.com/compute/docs/instances/restarting-an-instance#restarting_a_stopped_instance\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cloud.google.com/compute/docs/instances/restarting-an-instance#restarting_a_stopped_instance\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://stackoverflow.com/questions/31855049/how-to-change-the-scope-of-compute-engine-service-account-to-write-data-on-googl\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/31855049/how-to-change-the-scope-of-compute-engine-service-account-to-write-data-on-googl\u003c/a\u003e\u003c/p\u003e\n","body":"# GCE(Google Compute Engine)のVMインスタンスのアカウントスコープを後から変更する\nGCEのVMインスタンスでアカウントスコープを途中で変更したい場合、少し工夫する必要があったのでメモ。\n\n## アクセス スコープとは\nそれぞれのGoogle Cloud Platform上のサービスのAPIに対して、インスタンスがアクセスを許可されている範囲のこと。\nGoogle Cloud Platform上の各サービスのAPIに対して、インスタンスがアクセス可能かどうかを「有効」/「無効」で表している。\nこれが有効のサービスのみ、インスタンスはそのサービスのAPIにアクセスすることができる。\nhttps://cloud.google.com/compute/docs/access/service-accounts?hl=ja\n\n## アクセススコープを変更する\n\n### アクセススコープを変更するには\nここからが本記事の本題だが、アクセススコープは、インスタンスの作成時か、インスタンスをシャットダウンしている状態でしか編集できないようだ。\n\nそのため、「そのインスタンスで当初BigQueryのAPIを使う予定がなかったので、アクセススコープは、『無効』にしたが、後にやっぱりBigQueryのAPIを使いたくなったので、アクセススコープを『有効』にしたい」\nという場合は、前述したが以下の2つの方法しかない。(他にあったら教えてください…)\n1.  インスタンスを作成し直す\n2. インスタンスをシャットダウンして変更する                                                                                   \n\n自分は当初それを知らなかったため、VMインスタンスのコンソール画面で何回編集を押してもアクセススコープが変更できなくて、泣きそうになりました。\n\n今回は、「2.インスタンスをシャットダウンして変更する」を行い、アクセススコープを変更する。\n\n### アクセススコープを変更するための手順\n\nアクセススコープを変更するためには以下の手順が必要\n1. アクセススコープを変更したいVMインスタンスをシャットダウンする\n2. gcloudコマンドで、アクセス権を変更する\n3. インスタンスを再起動する\n\n### 実際にやってみる\n1.アクセススコープを変更したいVMインスタンスをシャットダウンする\n以下の公式ドキュメントを参考にVMインスタンスをシャットダウンする\nhttps://cloud.google.com/compute/docs/instances/stopping-or-deleting-an-instance\n\n2.以下のcloudコマンドで、アクセス権を変更する\n\n```\ngcloud beta compute instances set-scopes projects/プロジェクト名/zones/ゾーン/instances/インスタンス名  --service-account サービスアカウントのメール \u003c—no-scopes(無効にしたい場合) か --scopes(有効にしたい場合)\u003e  変更するスコープ\n```\n\n「変更するスコープ」は、以下の一覧にあるurlかエイリアスを使用する\nhttps://cloud.google.com/sdk/gcloud/reference/beta/compute/instances/set-scopes\n\n3インスタンスを再起動する\nhttps://cloud.google.com/compute/docs/instances/restarting-an-instance#restarting_a_stopped_instance\n\n\n### 実際にやってみた\n実際にインスタンス作成時には「無効」であったBigqueryのアクセススコープを「有効」に変更する。\n\n「1. アクセススコープを変更したいVMインスタンスをシャットダウンする」と「3. インスタンスを再起動する」は、省略\n\ngcloudを実行\n```\ngcloud beta compute instances set-scopes projects/プロジェクト名/zones/ゾーン/instances/インスタンス名  --service-account サービスアカウントのメール --scopes https://www.googleapis.com/auth/bigquery\n```\n\n結果\nVMインスタンスのコンソールの「Cloud APIアクセス範囲」のBigQueryが「無効」から「有効」になった。\n\n## 参考にさせていただいたサイト\n\n\nhttps://cloud.google.com/compute/docs/access/service-accounts?hl=ja\n\nhttps://cloud.google.com/compute/docs/instances/stopping-or-deleting-an-instance\n\nhttps://cloud.google.com/sdk/gcloud/reference/beta/compute/instances/set-scopes\n\nhttps://cloud.google.com/compute/docs/instances/restarting-an-instance#restarting_a_stopped_instance\n\nhttp://stackoverflow.com/questions/31855049/how-to-change-the-scope-of-compute-engine-service-account-to-write-data-on-googl\n","coediting":false,"created_at":"2017-05-17T23:07:35+09:00","group":null,"id":"e1ae602a1a2a4edb17df","private":false,"tags":[{"name":"googlecomputeengine","versions":[]},{"name":"GoogleCloudPlatform","versions":[]},{"name":"gcloud","versions":[]},{"name":"gce","versions":[]},{"name":"gcp","versions":[]}],"title":"GCE(Google Compute Engine)のVMインスタンスのアカウントスコープを後から変更する","updated_at":"2017-05-17T23:17:19+09:00","url":"http://qiita.com/Sekky0905/items/e1ae602a1a2a4edb17df","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":13,"github_login_name":"SekiguchiKai","id":"Sekky0905","items_count":26,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":145611,"profile_image_url":"https://avatars.githubusercontent.com/u/20237968?v=3","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003eNode.js can be use frontend as well as backend for coding purpose in web app development. IT firms prefer expert level knowledge, huge experience and advanced vision for coding in Node.js programming.\u003cbr\u003e\n\u003ca href=\"https://semidotinfotech.com/blog/nodejs-web-app-development/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://semidotinfotech.com/blog/nodejs-web-app-development/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/167006/c31d2e9e-aa1e-9ecf-33d4-5ecd37fb2c43.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/167006/c31d2e9e-aa1e-9ecf-33d4-5ecd37fb2c43.jpeg\" alt=\"Express-Web-App-Development-Skills-with-Node.jpg\"\u003e\u003c/a\u003e\u003c/p\u003e\n","body":"Node.js can be use frontend as well as backend for coding purpose in web app development. IT firms prefer expert level knowledge, huge experience and advanced vision for coding in Node.js programming.\nhttps://semidotinfotech.com/blog/nodejs-web-app-development/\n![Express-Web-App-Development-Skills-with-Node.jpg](https://qiita-image-store.s3.amazonaws.com/0/167006/c31d2e9e-aa1e-9ecf-33d4-5ecd37fb2c43.jpeg)\n","coediting":false,"created_at":"2017-05-17T23:02:49+09:00","group":null,"id":"d0595d1820bbe7e9bec7","private":false,"tags":[{"name":"Mobile","versions":[]},{"name":"development","versions":[]},{"name":"Web","versions":[]},{"name":"nodejs","versions":[]},{"name":"application,","versions":[]}],"title":"Nodejs Web Application Development in Australia","updated_at":"2017-05-17T23:02:49+09:00","url":"http://qiita.com/semidot/items/d0595d1820bbe7e9bec7","user":{"description":"Rohan Singh is a versatile techy who has vast experience in wide array of technologies and is the Tech Director and CTO of the company. He oversees all the tech side of Semidot.","facebook_id":"semidotinfo","followees_count":0,"followers_count":0,"github_login_name":"semidot","id":"semidot","items_count":2,"linkedin_id":"company/semidot-infotech-pvt-ltd","location":"Boulder","name":"Rohan Singh","organization":"SemiDot InfoTech","permanent_id":167006,"profile_image_url":"https://lh4.googleusercontent.com/-lhBa0Bm6XOg/AAAAAAAAAAI/AAAAAAAAAB4/T7lT8Pk1UlM/photo.jpg?sz=50","twitter_screen_name":"DotSemi","website_url":"https://semidotinfotech.com"}},{"rendered_body":"\u003cp\u003ePerlは後方互換性がとても高い言語だけど、後方互換性については4つのレベルがあると考える。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e言語を実装しているAPIレベル(C言語API)\u003c/li\u003e\n\u003cli\u003e言語レベル(Perl言語)\u003c/li\u003e\n\u003cli\u003e標準関数と標準モジュール\u003c/li\u003e\n\u003cli\u003e第三者が作ったモジュール\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e後方互換性はこの4つのレベルを考える。Perlは上の三つは、ものすごく高い。4つめはCPANに挙げられているモジュールのことだけれど、Perlコミュニティは、一般的な傾向として、互換性については非常に気を使っている。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"標準モジュールの後方互換性はどの程度か\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A8%99%E6%BA%96%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E5%BE%8C%E6%96%B9%E4%BA%92%E6%8F%9B%E6%80%A7%E3%81%AF%E3%81%A9%E3%81%AE%E7%A8%8B%E5%BA%A6%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e標準モジュールの後方互換性はどの程度か\u003c/h1\u003e\n\n\u003cp\u003eでは、標準モジュールの後方互換性はどの程度かといいますが、Perlの開発が始まっていらい、99%くらい互換性が保たれているといえるでしょう(感覚的に)。\u003c/p\u003e\n\n\u003cp\u003e僕がPerlを初めてからも10年以上がたちますが、標準モジュールの互換性が壊れたということは聞いたことがありませんし、ほぼ枯れているといえます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eFile::Basename\u003c/li\u003e\n\u003cli\u003eFindBin\u003c/li\u003e\n\u003cli\u003eFile::Path\u003c/li\u003e\n\u003cli\u003eFile::Copy\u003c/li\u003e\n\u003cli\u003elib\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ePerlモジュールにとっては、標準モジュール入りすることは、後方互換性を保たなければならない制約を受けるような感じです。\u003c/p\u003e\n","body":"Perlは後方互換性がとても高い言語だけど、後方互換性については4つのレベルがあると考える。\n\n- 言語を実装しているAPIレベル(C言語API)\n- 言語レベル(Perl言語)\n- 標準関数と標準モジュール\n- 第三者が作ったモジュール\n\n後方互換性はこの4つのレベルを考える。Perlは上の三つは、ものすごく高い。4つめはCPANに挙げられているモジュールのことだけれど、Perlコミュニティは、一般的な傾向として、互換性については非常に気を使っている。\n\n# 標準モジュールの後方互換性はどの程度か\n\nでは、標準モジュールの後方互換性はどの程度かといいますが、Perlの開発が始まっていらい、99%くらい互換性が保たれているといえるでしょう(感覚的に)。\n\n僕がPerlを初めてからも10年以上がたちますが、標準モジュールの互換性が壊れたということは聞いたことがありませんし、ほぼ枯れているといえます。\n\n- File::Basename\n- FindBin\n- File::Path\n- File::Copy\n- lib\n\nPerlモジュールにとっては、標準モジュール入りすることは、後方互換性を保たなければならない制約を受けるような感じです。\n","coediting":false,"created_at":"2017-05-17T22:51:52+09:00","group":null,"id":"9ef9a8a7be1a052a1c44","private":false,"tags":[{"name":"Perl","versions":[]},{"name":"プログラミング","versions":[]},{"name":"モジュール","versions":[]},{"name":"ITエンジニアお役立ち","versions":[]},{"name":"後方互換性","versions":[]}],"title":"Perlの標準モジュールの後方互換性について","updated_at":"2017-05-17T22:51:52+09:00","url":"http://qiita.com/yukikimoto/items/9ef9a8a7be1a052a1c44","user":{"description":"","facebook_id":"yukikimoto4","followees_count":123,"followers_count":36,"github_login_name":"yuki-kimoto","id":"yukikimoto","items_count":164,"linkedin_id":"","location":"東京","name":"木本 裕紀","organization":"","permanent_id":155418,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/155418/profile-images/1481942273","twitter_screen_name":"yukikimoto2","website_url":"http://d.hatena.ne.jp/perlcodesample/"}},{"rendered_body":"\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/160563/3fc3c52f-8485-7861-1784-719e0edf15f0.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/160563/3fc3c52f-8485-7861-1784-719e0edf15f0.png\" alt=\"VLOOKUP2つめ.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"利用シチュエーション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%A9%E7%94%A8%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e利用シチュエーション\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eVLOOKUP関数を用いて検索値の二つ目以降のデータを抽出したい時\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"直面した問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%B4%E9%9D%A2%E3%81%97%E3%81%9F%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e直面した問題\u003c/h2\u003e\n\n\u003cp\u003e　×　VLOOKUP関数では検索値に引っかかる値が複数ある時に、最初に引っかかった値しか抽出しない\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"記述方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%98%E8%BF%B0%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e記述方法\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eqiita.rb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e=VLOOKUP(検索値,INDEX(元データの検索値,MATCH(検索値,元値の検索値,0)+1):元の値の2列目最末行,2,)\n\n\u0026lt;記述例\u0026gt;\n=VLOOKUP(A2,INDEX(E2:E13,MATCH(A2,E2:E13,0)+1):F13,2,)\n\n\u0026lt;補足\u0026gt;\n※3個目、4個目を抽出したい場合は+1の値を1ずつプラスする\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e前提条件\u003c/strong\u003e\u003cbr\u003e\nA列に購入日(下に行くごとに1日ずれる)\u003cbr\u003e\nE列・F列に「購入した日」と「購入した商品」を上から記載\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/160563/13e86a2b-1e95-4b9a-cbf2-49c7b761f393.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/160563/13e86a2b-1e95-4b9a-cbf2-49c7b761f393.png\" alt=\"抽出前.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003chr\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e抽出結果\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/160563/2adef7de-32c5-5fae-c163-93c99ec0f7d3.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/160563/2adef7de-32c5-5fae-c163-93c99ec0f7d3.png\" alt=\"抽出後.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003chr\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e解説\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e範囲の抽出\u003c/strong\u003e\u003cbr\u003e\n* INDEX関数で指定した範囲内で検索値に引っかかる行数をMATCH関数で指定。\u003cbr\u003e\n* 抽出した行数より1つ下(+1)から商品名の一番下までをVLOOKUPの検索範囲に指定。\u003cbr\u003e\n* 指定した範囲の2行目から該当のデータを抽出。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"個々の関数の説明\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E3%80%85%E3%81%AE%E9%96%A2%E6%95%B0%E3%81%AE%E8%AA%AC%E6%98%8E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個々の関数の説明\u003c/h4\u003e\n\n\u003cp\u003eINDEX関数は指定された行と列が交差する位置にあるセルの値を返す\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e書き方\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e利用例\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e書式\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eINDEX(範囲, 行番号, 列番号, 領域番号)\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eINDEX(E2:E13,E3:F13,2)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e引数1\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e1つまたは複数のセルのを範囲を指定\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eE3:F13\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e引数2\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e指定した範囲の上からの行数を指定\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e引数3\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e指定した範囲の左からの行列数を指定\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e(省略)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e引数4\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e複数の領域を選択した場合、どちらの範囲を使用するか指定\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eMATCH関数は、指定したセルの範囲から検索値が上から何番目にあるかを返す\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e書き方\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e利用例\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e書式\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eMATCH(検査値, 検査範囲, 照合の型)\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eMATCH(A2,E2:E13,0)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e引数1\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e検索する値またはセル参照を指定\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eA2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e引数2\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e検索するセルの範囲を指定\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eE2:E13\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e引数3\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e1、0、-1の数値で指定(0は完全一致)\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e0\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eVLOOKUP関数は、指定された範囲の1列目で値を検索し、その指定範囲内の別の列の同じ行にある値を返す\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: left\"\u003e\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e書き方\u003c/th\u003e\n\u003cth style=\"text-align: left\"\u003e利用例\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e書式\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eVLOOKUP(検索値, 範囲, 列番号, 検索の型)\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eVLOOKUP(A2,E3:F13,2)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e引数1\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e検索する値またはセル参照を指定\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eA2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e引数2\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e2列以上のセル範囲を指定\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003eE3:F13\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: left\"\u003e引数3\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e目的データが入力されている列番号を指定\u003c/td\u003e\n\u003ctd style=\"text-align: left\"\u003e2\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"サンプル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサンプル\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://goo.gl/svhkyt\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGoogleスプレットシート\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"補足\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A3%9C%E8%B6%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e補足\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eqiita.rb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eサンプルシートでは、2つめの商品がある場合のみVLOOKUPを実行するようにIF関数で制御\n=IF(COUNTIF(E2:E13,A2)\u0026lt;2,\"\",VLOOKUPで検索)\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n","body":"![VLOOKUP2つめ.png](https://qiita-image-store.s3.amazonaws.com/0/160563/3fc3c52f-8485-7861-1784-719e0edf15f0.png)\n\n\n#利用シチュエーション\n\n* VLOOKUP関数を用いて検索値の二つ目以降のデータを抽出したい時\n\n##直面した問題\n　×　VLOOKUP関数では検索値に引っかかる値が複数ある時に、最初に引っかかった値しか抽出しない\n\n#記述方法\n```text:qiita.rb\n=VLOOKUP(検索値,INDEX(元データの検索値,MATCH(検索値,元値の検索値,0)+1):元の値の2列目最末行,2,)\n\n\u003c記述例\u003e\n=VLOOKUP(A2,INDEX(E2:E13,MATCH(A2,E2:E13,0)+1):F13,2,)\n\n\u003c補足\u003e\n※3個目、4個目を抽出したい場合は+1の値を1ずつプラスする\n```\n\n\u003e **前提条件**\n\u003e A列に購入日(下に行くごとに1日ずれる)\n\u003e E列・F列に「購入した日」と「購入した商品」を上から記載\n\u003e ![抽出前.png](https://qiita-image-store.s3.amazonaws.com/0/160563/13e86a2b-1e95-4b9a-cbf2-49c7b761f393.png)\n\n\n\n\n\n---\n\n\u003e **抽出結果**\n\u003e ![抽出後.png](https://qiita-image-store.s3.amazonaws.com/0/160563/2adef7de-32c5-5fae-c163-93c99ec0f7d3.png)\n\n\n\n\n\n\n---\n\n\u003e **解説**\n\n\u003e **範囲の抽出**\n\u003e * INDEX関数で指定した範囲内で検索値に引っかかる行数をMATCH関数で指定。\n\u003e * 抽出した行数より1つ下(+1)から商品名の一番下までをVLOOKUPの検索範囲に指定。\n\u003e * 指定した範囲の2行目から該当のデータを抽出。\n\n\n\u003e ####個々の関数の説明####\n\u003e INDEX関数は指定された行と列が交差する位置にあるセルの値を返す\n\n\u003e ||書き方|利用例|\n\u003e |:---|:---|:---|\n\u003e |書式|INDEX(範囲, 行番号, 列番号, 領域番号)|INDEX(E2:E13,E3:F13,2)|\n\u003e |引数1|1つまたは複数のセルのを範囲を指定|E3:F13|\n\u003e |引数2|指定した範囲の上からの行数を指定|2|\n\u003e |引数3|指定した範囲の左からの行列数を指定|(省略)|\n\u003e |引数4|複数の領域を選択した場合、どちらの範囲を使用するか指定||\n\n\u003e MATCH関数は、指定したセルの範囲から検索値が上から何番目にあるかを返す\n\n\u003e ||書き方|利用例|\n\u003e |:---|:---|:---|\n\u003e |書式|MATCH(検査値, 検査範囲, 照合の型)|MATCH(A2,E2:E13,0)|\n\u003e |引数1|検索する値またはセル参照を指定|A2|\n\u003e |引数2|検索するセルの範囲を指定|E2:E13|\n\u003e |引数3|1、0、-1の数値で指定(0は完全一致)|0|\n\n\u003e VLOOKUP関数は、指定された範囲の1列目で値を検索し、その指定範囲内の別の列の同じ行にある値を返す\n\n\u003e ||書き方|利用例|\n\u003e |:---|:---|:---|\n\u003e |書式|VLOOKUP(検索値, 範囲, 列番号, 検索の型)|VLOOKUP(A2,E3:F13,2)|\n\u003e |引数1|検索する値またはセル参照を指定|A2|\n\u003e |引数2|2列以上のセル範囲を指定|E3:F13|\n\u003e |引数3|目的データが入力されている列番号を指定|2|\n\n\n#サンプル\n\n* [Googleスプレットシート](https://goo.gl/svhkyt)\n\n##補足\n```text:qiita.rb\nサンプルシートでは、2つめの商品がある場合のみVLOOKUPを実行するようにIF関数で制御\n=IF(COUNTIF(E2:E13,A2)\u003c2,\"\",VLOOKUPで検索)\n```\n","coediting":false,"created_at":"2017-05-17T22:47:26+09:00","group":null,"id":"a4ffeff03b81e7d03abb","private":false,"tags":[{"name":"Excel","versions":[]},{"name":"GoogleSpreadSheet","versions":[]}],"title":"検索値が複数該当する時に2つ目以降の数値をVLOOKUP関数で抽出する","updated_at":"2017-05-17T22:47:26+09:00","url":"http://qiita.com/AquaMeria/items/a4ffeff03b81e7d03abb","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":"hirokihonma","id":"AquaMeria","items_count":19,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":160563,"profile_image_url":"https://avatars.githubusercontent.com/u/7047070?v=3","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"前口上\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E5%8F%A3%E4%B8%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前口上\u003c/h1\u003e\n\n\u003cp\u003eExcel上でも変化点検出をやってみたくなったので、pythonの\u003ca href=\"http://argmax.jp/index.php?changefinder\" rel=\"nofollow noopener\" target=\"_blank\"\u003echangefinder\u003c/a\u003eをVBAに移植してみました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"移植\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A7%BB%E6%A4%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e移植\u003c/h1\u003e\n\n\u003cp\u003eARIMAの方は省略して、２つのクラスで構成しました。\u003cbr\u003e\n最初にSDARの部分。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSDAR1.cls\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eOption\u003c/span\u003e \u003cspan class=\"n\"\u003eExplicit\u003c/span\u003e\n\u003cspan class=\"k\"\u003eOption\u003c/span\u003e \u003cspan class=\"n\"\u003eBase\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e'SDAR1 for VBA\u003c/span\u003e\n\u003cspan class=\"c\"\u003e'Copyright (c) 2017 acknpop\u003c/span\u003e\n\u003cspan class=\"c\"\u003e'This software is released under the MIT License.\u003c/span\u003e\n\u003cspan class=\"c\"\u003e'http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eConst\u003c/span\u003e \u003cspan class=\"n\"\u003eM_PI\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e3.14159265358979\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003emyR\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003emyMu\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003emySigma\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eLevinsonDurbin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eVariant\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elpcOrder\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eReDim\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elpcOrder\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eReDim\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elpcOrder\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e#\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003elam\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003elam\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"n\"\u003elpcOrder\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elam\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e#\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elam\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elam\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eNext\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elam\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elam\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eReDim\u003c/span\u003e \u003cspan class=\"n\"\u003eU\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eU\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eU\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eNext\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eU\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eReDim\u003c/span\u003e \u003cspan class=\"n\"\u003eV\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eV\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eStep\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eV\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eNext\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eV\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eU\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003elam\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eV\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eNext\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e#\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003elam\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003elam\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNext\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eLevinsonDurbin\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eFunction\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eSub\u003c/span\u003e \u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaOrder\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emyR\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emyMu\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eRnd\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emySigma\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eRnd\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaOrder\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eReDim\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eFunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eterm\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eVariant\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003exhat\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emyMu\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003emyR\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003emyMu\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003emyR\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003emyR\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003emyR\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003emyMu\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eterm\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eterm\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003emyMu\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNext\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003emyR\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003emyR\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003emyMu\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003emyMu\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003ewhat\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ewhat\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eLevinsonDurbin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003ett\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ett\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eterm\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eIf\u003c/span\u003e \u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewhat\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ett\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e \u003cspan class=\"n\"\u003ett\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewhat\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003exhat\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"n\"\u003ett\u003c/span\u003e\n        \u003cspan class=\"n\"\u003exhat\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003exhat\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ewhat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eterm\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eterm\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003emyMu\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNext\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003exhat\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003exhat\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003emyMu\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emySigma\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003emyR\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003emySigma\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003emyR\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003exhat\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003exhat\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eUpdate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eLog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eExp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003exhat\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e^\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003emySigma\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eM_PI\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e^\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emySigma\u003c/span\u003e \u003cspan class=\"o\"\u003e^\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eFunction\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eChangeFinderの本体。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eChangeFinder.cls\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eOption\u003c/span\u003e \u003cspan class=\"n\"\u003eExplicit\u003c/span\u003e\n\u003cspan class=\"k\"\u003eOption\u003c/span\u003e \u003cspan class=\"n\"\u003eBase\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e'ChangeFinder for VBA\u003c/span\u003e\n\u003cspan class=\"c\"\u003e'Copyright (c) 2017 acknpop\u003c/span\u003e\n\u003cspan class=\"c\"\u003e'This software is released under the MIT License.\u003c/span\u003e\n\u003cspan class=\"c\"\u003e'http://opensource.org/licenses/mit-license.php\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003emySmooth\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003emySmooth2\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003emyR\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003efirst_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003esmoothed_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003esecond_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003esdar_first\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"n\"\u003eSDAR1\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"n\"\u003esdar_second\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"n\"\u003eSDAR1\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e'コンストラクタ\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e \u003cspan class=\"nf\"\u003eClass_Initialize\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSet\u003c/span\u003e \u003cspan class=\"n\"\u003esdar_first\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eSDAR1\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSet\u003c/span\u003e \u003cspan class=\"n\"\u003esdar_second\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eSDAR1\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e'デストラクタ\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e \u003cspan class=\"nf\"\u003eClass_Terminate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSet\u003c/span\u003e \u003cspan class=\"n\"\u003esdar_first\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNothing\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSet\u003c/span\u003e \u003cspan class=\"n\"\u003esdar_second\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNothing\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e'初期化\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePublic\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e \u003cspan class=\"nf\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eOptional\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eOptional\u003c/span\u003e \u003cspan class=\"n\"\u003eaOrder\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eOptional\u003c/span\u003e \u003cspan class=\"n\"\u003eSmooth\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emySmooth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSmooth\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emySmooth2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSmooth\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e#))\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaOrder\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emyR\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eReDim\u003c/span\u003e \u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eReDim\u003c/span\u003e \u003cspan class=\"n\"\u003efirst_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eReDim\u003c/span\u003e \u003cspan class=\"n\"\u003esmoothed_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eReDim\u003c/span\u003e \u003cspan class=\"n\"\u003esecond_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eCall\u003c/span\u003e \u003cspan class=\"n\"\u003esdar_first\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eCall\u003c/span\u003e \u003cspan class=\"n\"\u003esdar_second\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e'更新\u003c/span\u003e\n\u003cspan class=\"k\"\u003ePublic\u003c/span\u003e \u003cspan class=\"k\"\u003eFunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003escore\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003escore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003epredict\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epredict\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003epredict2\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epredict2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n    \u003cspan class=\"c\"\u003e'第一段学習\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eIf\u003c/span\u003e \u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e\n        \u003cspan class=\"n\"\u003escore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esdar_first\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epredict\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eCall\u003c/span\u003e \u003cspan class=\"n\"\u003eadd_one\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escore\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efirst_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emySmooth\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eIf\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eCall\u003c/span\u003e \u003cspan class=\"n\"\u003eadd_one\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003esecond_target\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esecond_target\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n    \u003cspan class=\"c\"\u003e'平滑化\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eIf\u003c/span\u003e \u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efirst_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emySmooth\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esecond_target\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esmoothing\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efirst_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eIf\u003c/span\u003e\n\n    \u003cspan class=\"c\"\u003e'第二段学習\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eIf\u003c/span\u003e \u003cspan class=\"n\"\u003esecond_target\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"ow\"\u003eAnd\u003c/span\u003e \u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esmoothed_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e\n        \u003cspan class=\"n\"\u003escore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esdar_second\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esecond_target\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esmoothed_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epredict2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eCall\u003c/span\u003e \u003cspan class=\"n\"\u003eadd_one\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escore\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esecond_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emySmooth2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eIf\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eIf\u003c/span\u003e \u003cspan class=\"n\"\u003esecond_target\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eCall\u003c/span\u003e \u003cspan class=\"n\"\u003eadd_one\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esecond_target\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esmoothed_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emyOrder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eIf\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eIf\u003c/span\u003e \u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esecond_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emySmooth2\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eUpdate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esmoothing\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esecond_scores\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eElse\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eUpdate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e#\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eIf\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epredict\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eFunction\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e \u003cspan class=\"nf\"\u003eadd_one\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eone\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ets\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eVariant\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaSize\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003emax\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emax\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eIf\u003c/span\u003e \u003cspan class=\"n\"\u003emax\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eaSize\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eReDim\u003c/span\u003e \u003cspan class=\"n\"\u003ePreserve\u003c/span\u003e \u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emax\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emax\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eone\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eElse\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emax\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eStep\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eNext\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eone\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eIf\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003ePrivate\u003c/span\u003e \u003cspan class=\"k\"\u003eFunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esmoothing\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ets\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eVariant\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esmoothing\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eCDbl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWorksheetFunction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eUBound\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ets\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eFunction\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eGISTにも置いておきました。\u003cbr\u003e\n\u003ca href=\"https://gist.github.com/acknpop/197d6e06096fb8ab9e78bc6a750ba154\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://gist.github.com/acknpop/197d6e06096fb8ab9e78bc6a750ba154\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eライセンスはオリジナルに準拠してMITで。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い方\u003c/h1\u003e\n\n\u003cp\u003eA列にデータを貼り付けておいて、下記を実行するとB列に変化点スコアを埋めていきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vbnet\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eSub\u003c/span\u003e \u003cspan class=\"nf\"\u003eCF_test\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003ecf\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"n\"\u003eChangeFinder\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eSet\u003c/span\u003e \u003cspan class=\"n\"\u003ecf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eNew\u003c/span\u003e \u003cspan class=\"n\"\u003eChangeFinder\u003c/span\u003e    \u003cspan class=\"c\"\u003e'生成\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003epredict\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eCall\u003c/span\u003e \u003cspan class=\"n\"\u003ecf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.01\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e    \u003cspan class=\"c\"\u003e'初期化（パラメータは省略可能）\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003eval\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"ow\"\u003eAs\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"mi\"\u003e1200\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eval\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCells\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epredict\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eCells\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNext\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e    \n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使用上の注意\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E7%94%A8%E4%B8%8A%E3%81%AE%E6%B3%A8%E6%84%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使用上の注意\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eテスト不十分なので思わぬ誤動作の可能性があります。\u003c/li\u003e\n\u003cli\u003eこのクラスを使用したことにより、なんらかの不利益を被ったとしても当方は一切関知しません。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"問題点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%95%8F%E9%A1%8C%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e問題点\u003c/h2\u003e\n\n\u003cp\u003e実はオリジナル（v0.3）の出力値\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/116888/21809e47-e80e-10b6-8a4d-4514c7e66b9d.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/116888/21809e47-e80e-10b6-8a4d-4514c7e66b9d.png\" alt=\"by_python.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e（pythonで実行したサンプルコードの出力をExcelに取り込んでグラフにしたもの）\u003c/p\u003e\n\n\u003cp\u003eと異なった値（スコアが半分程度で反応の立下りが早い）が生成\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/116888/86217466-c250-5007-f5c9-4b7ebf60b2f0.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/116888/86217466-c250-5007-f5c9-4b7ebf60b2f0.png\" alt=\"by_vba.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eされてしまっているので、どこか実装に問題がありそうです。\u003c/p\u003e\n\n\u003cp\u003e１発目のピーキーな反応と常に10近くあるオフセットが消えているのは良さそうな気もしてるのですが…。\u003c/p\u003e\n\n\u003cp\u003eバグ指摘＆改善点提案（特に高速化）、よろしくお願いします。（実はこれが本題）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"後書き\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BE%8C%E6%9B%B8%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e後書き\u003c/h1\u003e\n\n\u003cp\u003eえ？これを何に応用するか、聞きたい？\u003cbr\u003e\nその答えは…、トランキーロ！焦ンなよ。\u003c/p\u003e\n","body":"\n# 前口上\n\nExcel上でも変化点検出をやってみたくなったので、pythonの[changefinder](http://argmax.jp/index.php?changefinder)をVBAに移植してみました。\n\n# 移植\n\nARIMAの方は省略して、２つのクラスで構成しました。\n最初にSDARの部分。\n\n```vbnet:SDAR1.cls\nOption Explicit\nOption Base 1\n\n'SDAR1 for VBA\n'Copyright (c) 2017 acknpop\n'This software is released under the MIT License.\n'http://opensource.org/licenses/mit-license.php\n\nConst M_PI As Double = 3.14159265358979\n\nPrivate myR As Double\nPrivate myMu As Double\nPrivate mySigma As Double\nPrivate c() As Double\nPrivate myOrder As Long\n\nFunction LevinsonDurbin(r As Variant, lpcOrder As Long) As Double()\n    \n    ReDim a(lpcOrder + 1) As Double\n    ReDim e(lpcOrder + 1) As Double\n\n    a(1) = 1#\n    a(2) = -r(2) / r(1)\n    e(2) = r(1) + r(2) * a(2)\n    Dim lam As Double: lam = -r(2) / r(1)\n\n    Dim i As Long\n    Dim k As Long\n    For k = 1 To lpcOrder\n        lam = 0#\n        For i = 1 To k\n            lam = lam - a(i) * r(k + 1 - i)\n        Next i\n        lam = lam / e(k + 1)\n\n        ReDim U(k + 2) As Double\n        U(1) = 1\n        For i = 1 To k + 1\n            U(1 + i) = a(i)\n        Next i\n        U(k + 2) = 0\n        \n        ReDim V(k + 2) As Double\n        V(1) = 0\n        For i = k + 1 To 1 Step -1\n            V(1 + k + 1 - i) = a(i)\n        Next i\n        V(k + 2) = 1\n\n        For i = 1 To UBound(a)\n            a(i) = U(i) + lam * V(i)\n        Next i\n        \n        e(k + 1) = e(k) * (1# - lam * lam)\n    Next k\n\n    LevinsonDurbin = a\n    \nEnd Function\n\nSub Init(r As Double, aOrder As Long)\n    myR = r\n    myMu = Rnd()\n    mySigma = Rnd()\n    myOrder = aOrder\n    ReDim c(myOrder + 1) As Double\nEnd Sub\n\nFunction Update(x As Double, term As Variant, xhat As Double) As Double\n    myMu = (1 - myR) * myMu + myR * x\n    Dim i As Long\n    For i = 1 To myOrder\n        c(i) = (1 - myR) * c(i) + myR * (x - myMu) * (term(UBound(term) - i + 1) - myMu)\n    Next i\n    c(1) = (1 - myR) * c(1) + myR * (x - myMu) * (x - myMu)\n    \n    Dim what() As Double\n    what = LevinsonDurbin(c, myOrder)\n    Dim tt As Long\n    tt = UBound(term)\n    If UBound(what) \u003c tt Then tt = UBound(what)\n    xhat = 0\n    For i = 1 To tt\n        xhat = xhat - what(i) * (term(UBound(term) - i + 1) - myMu)\n    Next i\n    xhat = xhat + myMu\n    mySigma = (1 - myR) * mySigma + myR * (x - xhat) * (x - xhat)\n    \n    Update = -Log(Exp(-0.5 * ((x - xhat) ^ 2) / mySigma) / (((2 * M_PI) ^ 0.5) * (mySigma ^ 0.5)))\n\nEnd Function\n```\n\nChangeFinderの本体。\n\n```vbnet:ChangeFinder.cls\nOption Explicit\nOption Base 1\n\n'ChangeFinder for VBA\n'Copyright (c) 2017 acknpop\n'This software is released under the MIT License.\n'http://opensource.org/licenses/mit-license.php\n\nPrivate mySmooth As Long\nPrivate mySmooth2 As Long\nPrivate myOrder As Long\nPrivate myR As Double\n\nPrivate ts() As Double\nPrivate first_scores() As Double\nPrivate smoothed_scores() As Double\nPrivate second_scores() As Double\n\nPrivate sdar_first As SDAR1\nPrivate sdar_second As SDAR1\n\n'コンストラクタ\nPrivate Sub Class_Initialize()\n    Set sdar_first = New SDAR1\n    Set sdar_second = New SDAR1\nEnd Sub\n\n'デストラクタ\nPrivate Sub Class_Terminate()\n    Set sdar_first = Nothing\n    Set sdar_second = Nothing\nEnd Sub\n\n'初期化\nPublic Sub Init(Optional r As Double = 0.5, Optional aOrder As Long = 1, Optional Smooth As Long = 7)\n    mySmooth = Smooth\n    mySmooth2 = Int(Round(Smooth / 2#))\n    myOrder = aOrder\n    myR = r\n    \n    ReDim ts(myOrder)\n    ReDim first_scores(myOrder)\n    ReDim smoothed_scores(myOrder)\n    ReDim second_scores(myOrder)\n    \n    Call sdar_first.Init(r, myOrder)\n    Call sdar_second.Init(r, myOrder)\nEnd Sub\n\n'更新\nPublic Function Update(x As Double, p As Double) As Double\n    Dim ret() As Double\n\n    Dim score As Double: score = 0\n    Dim predict As Double: predict = x\n    Dim predict2 As Double: predict2 = 0\n    \n    '第一段学習\n    If UBound(ts) = myOrder Then\n        score = sdar_first.Update(x, ts, predict)\n        Call add_one(score, first_scores, mySmooth)\n    End If\n        \n    Call add_one(x, ts, myOrder)\n    \n    Dim second_target As Double: second_target = 0\n    \n    '平滑化\n    If UBound(first_scores) = mySmooth Then\n        second_target = smoothing(first_scores)\n    End If\n    \n    '第二段学習\n    If second_target \u003c\u003e 0 And UBound(smoothed_scores) = myOrder Then\n        score = sdar_second.Update(second_target, smoothed_scores, predict2)\n        Call add_one(score, second_scores, mySmooth2)\n    End If\n        \n    If second_target Then\n        Call add_one(second_target, smoothed_scores, myOrder)\n    End If\n        \n    If UBound(second_scores) = mySmooth2 Then\n        Update = smoothing(second_scores)\n    Else\n        Update = 0#\n    End If\n    p = predict\n\nEnd Function\n\nPrivate Sub add_one(one As Double, ts As Variant, aSize As Long)\n    Dim i As Long\n    Dim max As Long: max = UBound(ts)\n    If max \u003c aSize Then\n        ReDim Preserve ts(max + 1)\n        ts(max + 1) = one\n    Else\n        For i = max - 1 To 1 Step -1\n            ts(i) = ts(i + 1)\n        Next i\n        ts(max) = one\n    End If\nEnd Sub\n\nPrivate Function smoothing(ts As Variant) As Double\n    smoothing = CDbl(WorksheetFunction.Sum(ts) / UBound(ts))\nEnd Function\n```\n\nGISTにも置いておきました。\nhttps://gist.github.com/acknpop/197d6e06096fb8ab9e78bc6a750ba154\n\nライセンスはオリジナルに準拠してMITで。\n\n# 使い方\n\nA列にデータを貼り付けておいて、下記を実行するとB列に変化点スコアを埋めていきます。\n\n```vbnet\nSub CF_test()\n    Dim cf As ChangeFinder\n    Set cf = New ChangeFinder    '生成\n    \n    Dim ret As Double\n    Dim predict As Double\n    \n    Call cf.Init(0.01, 1, 7)    '初期化（パラメータは省略可能）\n    \n    Dim val As Double\n    Dim r As Long\n    For r = 1 To 1200\n        val = Cells(r, 1).Value\n        ret = cf.Update(val, predict)\n        Cells(r, 2).Value = ret\n    Next r    \nEnd Sub\n```\n\n## 使用上の注意\n\n- テスト不十分なので思わぬ誤動作の可能性があります。\n- このクラスを使用したことにより、なんらかの不利益を被ったとしても当方は一切関知しません。\n\n## 問題点\n\n実はオリジナル（v0.3）の出力値\n\n![by_python.png](https://qiita-image-store.s3.amazonaws.com/0/116888/21809e47-e80e-10b6-8a4d-4514c7e66b9d.png)\n\n（pythonで実行したサンプルコードの出力をExcelに取り込んでグラフにしたもの）\n\nと異なった値（スコアが半分程度で反応の立下りが早い）が生成\n\n![by_vba.png](https://qiita-image-store.s3.amazonaws.com/0/116888/86217466-c250-5007-f5c9-4b7ebf60b2f0.png)\n\nされてしまっているので、どこか実装に問題がありそうです。\n\n１発目のピーキーな反応と常に10近くあるオフセットが消えているのは良さそうな気もしてるのですが…。\n\nバグ指摘＆改善点提案（特に高速化）、よろしくお願いします。（実はこれが本題）\n\n# 後書き\n\nえ？これを何に応用するか、聞きたい？\nその答えは…、トランキーロ！焦ンなよ。\n","coediting":false,"created_at":"2017-05-17T22:43:25+09:00","group":null,"id":"85f8792278c53a2ea263","private":false,"tags":[{"name":"Excel","versions":[]},{"name":"VBA","versions":[]},{"name":"changefinder","versions":[]},{"name":"異常検知と状態変化","versions":[]}],"title":"ChangeFinder for VBA","updated_at":"2017-05-17T22:43:25+09:00","url":"http://qiita.com/acknpop/items/85f8792278c53a2ea263","user":{"description":"にゃ？","facebook_id":"","followees_count":0,"followers_count":1,"github_login_name":"acknpop","id":"acknpop","items_count":14,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":116888,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/116888/profile-images/1473713407","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003eJava Day Tokyo 2017に参加してきたのでその時のメモ。\u003cbr\u003e\n自分用に書いていたので歯抜けが多く申し訳ないです。\u003cbr\u003e\n間違いや補足事項あればご指摘いただけるを幸いです。\u003c/p\u003e\n\n\u003cp\u003e公式ページ：\u003ca href=\"http://www.oracle.co.jp/events/javaday/2017/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://www.oracle.co.jp/events/javaday/2017/\u003c/a\u003e\u003cbr\u003e\nハッシュタグ: \u003ca href=\"https://twitter.com/hashtag/JavaDayTokyo?src=hash\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#JavaDayTokyo\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"java-day-tokyo-2017-基調講演\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java-day-tokyo-2017-%E5%9F%BA%E8%AA%BF%E8%AC%9B%E6%BC%94\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJava Day Tokyo 2017 基調講演\u003c/h1\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"概要公式ページより\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81%E5%85%AC%E5%BC%8F%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%88%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要(公式ページより)\u003c/h4\u003e\n\n\u003cp\u003eいよいよJava SE 9とJava EE 8のリリースが近づいてきました！今回のJava Day Tokyoの基調講演は、Java SE、Java EEそれぞれの開発部門のVice Presidentが、直接みなさまへ新バージョンの価値をご紹介します。新バージョンの注目すべきポイント、さらにその先に何があるのかを、ぜひみなさまご自身でお確かめください。ご参加をお待ちしています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"日本オラクル代表取締役杉原博茂-氏\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%97%A5%E6%9C%AC%E3%82%AA%E3%83%A9%E3%82%AF%E3%83%AB%E4%BB%A3%E8%A1%A8%E5%8F%96%E7%B7%A0%E5%BD%B9%E6%9D%89%E5%8E%9F%E5%8D%9A%E8%8C%82-%E6%B0%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e日本オラクル代表取締役　杉原博茂 氏\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e「日本を幸せにするカンパニーへ」\u003c/li\u003e\n\u003cli\u003eITの人材不足が課題、2030年には60万人の不足に\u003c/li\u003e\n\u003cli\u003eオンプレ(12兆)　＞　IaaS(2100億)\u003c/li\u003e\n\u003cli\u003eCloud上で最適化するための機能強化\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"bernard-traversat-氏\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bernard-traversat-%E6%B0%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBernard Traversat 氏\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eCloudの基盤となる\n\n\u003cul\u003e\n\u003cli\u003eAWS,MS AzuleなどのコアにJavaが使われている\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eJava is deadはOracleに買収されて払拭された\u003c/li\u003e\n\u003cli\u003e先日、Dockerとのパートナーシップを発表した\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"java9\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJava9\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e122のフィーチャーが入った\n\n\u003cul\u003e\n\u003cli\u003emodule system\u003c/li\u003e\n\u003cli\u003emodular JDK\u003c/li\u003e\n\u003cli\u003eJShell\u003c/li\u003e\n\u003cli\u003eEncapsulate Internal APIs\u003c/li\u003e\n\u003cli\u003eJLink: Java Linker\u003c/li\u003e\n\u003cli\u003eAhead of time compilation(AOT)\n\n\u003cul\u003e\n\u003cli\u003eJava9ではスタティックのコンパイレーションを利用可能\u003c/li\u003e\n\u003cli\u003eコンパイラがリアリタイム情報を取得可能に\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"java9以降の動向openjdk\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java9%E4%BB%A5%E9%99%8D%E3%81%AE%E5%8B%95%E5%90%91openjdk\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJava9以降の動向（OpenJDK）\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"project-valhalla\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#project-valhalla\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eproject Valhalla\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eValueTypes\u003c/li\u003e\n\u003cli\u003eSpecialized Generics\u003c/li\u003e\n\u003cli\u003eVar Handles\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"project-panama\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#project-panama\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProject Panama\u003c/h4\u003e\n\n\u003cp\u003eビッグデータへの適用\u003cbr\u003e\nGPUでの実行\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eForeign Function Inteerface\u003c/li\u003e\n\u003cli\u003eDate Layout Control\u003c/li\u003e\n\u003cli\u003eArrays 2.0\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"matsudaでのjavaの利用について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#matsuda%E3%81%A7%E3%81%AEjava%E3%81%AE%E5%88%A9%E7%94%A8%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMatsudaでのJavaの利用について\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"従来型\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BE%93%E6%9D%A5%E5%9E%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e従来型\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eビジネスプロセスをサポート\u003c/li\u003e\n\u003cli\u003e機能要件・非機能要件をサポートするのは必須\u003c/li\u003e\n\u003cli\u003e全ての開発者は共通の開発環境、アーキテクチャ、開発ルール、FWを使っている\u003c/li\u003e\n\u003cli\u003e自動生成ツールを作成\u003c/li\u003e\n\u003cli\u003e言語が長生きしてくれるのも重要\u003c/li\u003e\n\u003cli\u003e下位互換性（バージョンアップしやすい）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"最近の流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E8%BF%91%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最近の流れ\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e組み合わせ\n\n\u003cul\u003e\n\u003cli\u003eStrategy Pattern →関数型に\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e期待\n\n\u003cul\u003e\n\u003cli\u003e開発環境やFWの共通化→肥大化→Jigsawに期待\u003c/li\u003e\n\u003cli\u003e大量データ→GCの問題→BigData/AI時代のJavaに期待\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"jshell\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#jshell\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJShell\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eREPLのようにインタラクティブに実行可能となる\u003c/li\u003e\n\u003cli\u003emvn jshell compile\u003c/li\u003e\n\u003cli\u003e補完機能もついている\u003c/li\u003e\n\u003cli\u003eプロトタイプをJShellで作成し、形ができてきたらコードに落とし込む\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"will-lions-氏\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#will-lions-%E6%B0%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWill Lions 氏\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eJavaEE8は早ければ今年の夏に発表予定\u003c/li\u003e\n\u003cli\u003eHTTP/2は速度が速くセキュア、アプリケーションに変更必要なし\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"jjug\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#jjug\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJJUG\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e現在6300人以上、コアは20-30代\u003c/li\u003e\n\u003cli\u003eなぜコミュニティに参加するのか\n\n\u003cul\u003e\n\u003cli\u003e一緒に考えてくれる仲間に出会える\u003c/li\u003e\n\u003cli\u003eすごいエンジニアを知ることが出来る\u003c/li\u003e\n\u003cli\u003e発信して勉強できる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"java-9-and-beyond-java-renaissance-in-the-cloud\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java-9-and-beyond-java-renaissance-in-the-cloud\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJava 9 and Beyond: Java Renaissance in the Cloud\u003c/h1\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要公式ページより-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81%E5%85%AC%E5%BC%8F%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%88%E3%82%8A-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要(公式ページより)\u003c/h3\u003e\n\n\u003cp\u003e本セッションはJava 9リリースのアップデート情報をお届けします。Java 9は、エンジニアがjavaサービスをクラウド上にjavaサービスを開発し展開する方法を根本的に変えます。新たなツールであるAOTやJLinkはJava 9の新モジュールシステムを活用して新しいタイプのパフォーマンスと密度の最適化を可能にします。Java 9でデフォルトGCに位置づけられたG1はビッグデータクラウドサービス向けの新たなレベルのスケーラビリティを提供します。さらに、value typeやJNIの移行、言語の改良など、Java 9以降の新機能についても触れたいと思います。またこのセッションでは、これら新機能のデモを通してクラウドベースの開発者にとってのJava 9の重要性を理解頂きます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"java9-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java9-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJava9\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eJavaの問題\n\n\u003cul\u003e\n\u003cli\u003e冗長性\u003c/li\u003e\n\u003cli\u003eメモリを食う\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eJavaの優先度\n\n\u003cul\u003e\n\u003cli\u003eセキュリティ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"新機能\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B0%E6%A9%9F%E8%83%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e新機能\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003ejigsaw\u003c/li\u003e\n\u003cli\u003eJLink\u003c/li\u003e\n\u003cli\u003eAhead of Time(AOT) Java Compiler\u003c/li\u003e\n\u003cli\u003eJShell\u003c/li\u003e\n\u003cli\u003eG1 GC as the Default\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"java-se-advanced\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java-se-advanced\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJava SE Advanced\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eFlight Recorder Performance\n\n\u003cul\u003e\n\u003cli\u003e条件に基づいた情報をトレーシングすることが可能\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eJava Mission Control Console\n\n\u003cul\u003e\n\u003cli\u003e問題箇所を調査することが出来る\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAdvanced Management Console\n\n\u003cul\u003e\n\u003cli\u003e特定のアプリだけ古いJavaを利用、などを設定できる（セキュリティの向上）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"java9以降の動向\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java9%E4%BB%A5%E9%99%8D%E3%81%AE%E5%8B%95%E5%90%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJava9以降の動向\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eUniform\n\n\u003cul\u003e\n\u003cli\u003eArray, Values, types\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ememory\n\n\u003cul\u003e\n\u003cli\u003eなるべくコンパクトに、もっとライトウェイトなスレッド\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCompatible\n\n\u003cul\u003e\n\u003cli\u003e互換性\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePerformance\n\n\u003cul\u003e\n\u003cli\u003eCPU/GPU\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"modular-development-with-jdk-9-日本オラクル株式会社デイビッドバック\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#modular-development-with-jdk-9-%E6%97%A5%E6%9C%AC%E3%82%AA%E3%83%A9%E3%82%AF%E3%83%AB%E6%A0%AA%E5%BC%8F%E4%BC%9A%E7%A4%BE%E3%83%87%E3%82%A4%E3%83%93%E3%83%83%E3%83%89%E3%83%90%E3%83%83%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eModular Development with JDK 9 日本オラクル株式会社　デイビッド・バック\u003c/h1\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要公式ページより-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81%E5%85%AC%E5%BC%8F%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%88%E3%82%8A-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要(公式ページより)\u003c/h3\u003e\n\n\u003cp\u003eモジュラー開発スタイルは全てのJava開発者（あなたのアプリケーションがたった１つのJARであっても100個のJARであっても）にメリットがあります。本セッションでは内部APIを強力に保護しながら数十の再利用可能なモジュールとしてJDKを構造化したJava 9のモジュールシステムを紹介します。\u003cbr\u003e\nそして、セッションではモジュールをどのようにして作成するか、一般的に利用されているライブラリ潜むJDKの内部APIへの依存の回避をどのように行うかについて解説します。最後に、モジュールのために用意されたツール群について説明します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"programs-are-classes--package-mogules\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#programs-are-classes--package-mogules\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePrograms are \u003cdel\u003eClasses\u003c/del\u003e  \u003cdel\u003ePackage\u003c/del\u003e Mogules\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e“public” no longer mean “accessile ti everyone”.\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/41569/955ca7d5-2fa6-cb01-014c-6a2e6886c33a.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/41569/955ca7d5-2fa6-cb01-014c-6a2e6886c33a.jpeg\" alt=\"新規ドキュメント 2017-05-17 14.13.09_1.jpg\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/41569/ff1b7b87-3b9a-28da-d5ac-c5d82de8dabd.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/41569/ff1b7b87-3b9a-28da-d5ac-c5d82de8dabd.jpeg\" alt=\"新規ドキュメント 2017-05-17 14.14.37_1.jpg\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eexports はパッケージ単位。requires はモジュール単位\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/41569/99a17a1f-a1a4-1a46-76a7-3c8973ebf467.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/41569/99a17a1f-a1a4-1a46-76a7-3c8973ebf467.jpeg\" alt=\"新規ドキュメント 2017-05-17 14.20.12_1.jpg\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eJLinkを利用すると、JDKのクラスモジュールのうち必要なものだけ指定して読み込むことが出来る\u003cbr\u003e\n→メリットは？\u003cbr\u003e\ncloudなどで多数のJDKを起動する場合などに、リソースの節約になる\u003c/p\u003e\n\n\u003cp\u003ejdepsでjarの依存関係を検査することができる（Java8から提供されている）\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/41569/0589433a-9d19-485c-a194-8b68abcde906.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/41569/0589433a-9d19-485c-a194-8b68abcde906.jpeg\" alt=\"新規ドキュメント 2017-05-17 14.32.35_1.jpg\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAutomatic Modules\u003cbr\u003e\n既存のJarを自動的にmodule化する機能\u003cbr\u003e\nモジュールベースで開発されてないものは、Automatic modules機能を使う。Jarの変更なし\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"servlet-40-で始めるhttp2--日本オラクル株式会社柳原-伸弥\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#servlet-40-%E3%81%A7%E5%A7%8B%E3%82%81%E3%82%8Bhttp2--%E6%97%A5%E6%9C%AC%E3%82%AA%E3%83%A9%E3%82%AF%E3%83%AB%E6%A0%AA%E5%BC%8F%E4%BC%9A%E7%A4%BE%E6%9F%B3%E5%8E%9F-%E4%BC%B8%E5%BC%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eServlet 4.0 で始めるHTTP/2  日本オラクル株式会社　柳原 伸弥\u003c/h1\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要公式ページより-3\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81%E5%85%AC%E5%BC%8F%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%88%E3%82%8A-3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要(公式ページより)\u003c/h3\u003e\n\n\u003cp\u003eHTTPの仕様が16年ぶりにHTTP/1.1 からHTTP/2に更新され、通信効率を向上するさまざまな仕組みが取り込まれました。Servlet 4.0では、HTTP/2の活用するアップデートが行われています。本セッションでは、Servlet 4.0を用いたHTTP/2 の活用例についてご紹介します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"servlet振り返り\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#servlet%E6%8C%AF%E3%82%8A%E8%BF%94%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eServlet振り返り\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eサーバサイドで動作するJava\u003c/li\u003e\n\u003cli\u003eControllerとしての役割\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"servlet40概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#servlet40%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eServlet4.0概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eServlet4.0 2017/7リリース予定\u003c/li\u003e\n\u003cli\u003eHTTP２対応\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"http２概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#http%EF%BC%92%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHTTP／２概要\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e1系\n\n\u003cul\u003e\n\u003cli\u003eTCPコネクションについて、リクエスト・レスポンスが1:1\u003c/li\u003e\n\u003cli\u003e原則として１つのリクエストの完了を待ってから、次のリクエストを送信→待ちが発生\u003c/li\u003e\n\u003cli\u003e高速化の取り組み\n\n\u003cul\u003e\n\u003cli\u003eCSSスプライト\u003c/li\u003e\n\u003cli\u003eインラインイメージ\u003c/li\u003e\n\u003cli\u003eドメインシャーディング\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e2系\n\n\u003cul\u003e\n\u003cli\u003eTCPコネクションについて、ストリームの多重化\u003c/li\u003e\n\u003cli\u003eストリーム優先度\u003c/li\u003e\n\u003cli\u003eServer Push\u003c/li\u003e\n\u003cli\u003eヘッダー圧縮（オーバーヘッドを少なくする）\u003c/li\u003e\n\u003cli\u003eバイナリー・フレーム（今まではテキストベースだった）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"server-push\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#server-push\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eServer Push\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e一つのリクエストに複数のレスポンスを返す\u003c/li\u003e\n\u003cli\u003ePushBuilderオブジェクトを作成 (request.newPushBuilder();)\u003c/li\u003e\n\u003cli\u003ePushBuilderオブジェクトは再利用可能\u003c/li\u003e\n\u003cli\u003eGETまたはHEADを利用する（「キャッシュ可能」かつ「安全」であること(RFC 7540の仕様に準拠)）\u003c/li\u003e\n\u003cli\u003eJSファイルの結合や、CSSスプライトを行う必要がなくなる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/41569/5be30a24-d77c-72be-3ec0-1be8fd1661aa.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/41569/5be30a24-d77c-72be-3ec0-1be8fd1661aa.jpeg\" alt=\"新規ドキュメント 2017-05-17 14.32.35_2.jpg\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"java-se-9のすすめjava-in-the-box櫻庭-祐一\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java-se-9%E3%81%AE%E3%81%99%E3%81%99%E3%82%81java-in-the-box%E6%AB%BB%E5%BA%AD-%E7%A5%90%E4%B8%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJava SE 9のすすめ　Java in the Box　櫻庭 祐一\u003c/h1\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要公式ページより-4\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81%E5%85%AC%E5%BC%8F%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%88%E3%82%8A-4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要(公式ページより)\u003c/h3\u003e\n\n\u003cp\u003eJava SE 9というと、Project JigsawやJShellを思い浮かべるかもしれません。しかし、Java SE 9はそれだけではありません。Java SEの機能追加を定めるJEPの数は89もあります。\u003cbr\u003e\n本セッションでは、Java SE 9の多くの新機能の中から言語仕様の変更や、コアライブラリの変更点、また互換性に問題がある点などについて実例と共に解説します。\u003c/p\u003e\n\n\u003cp\u003eJigsaw, JShellの話はしない\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"アジェンダ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアジェンダ\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eCompatibility\u003c/li\u003e\n\u003cli\u003eBrand new\u003c/li\u003e\n\u003cli\u003eUpdate\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"compatibility\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#compatibility\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCompatibility\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eLanguage \u0026amp; Library\n\n\u003cul\u003e\n\u003cli\u003eアンダースコアのみの変数名は使用できなくなった\u003c/li\u003e\n\u003cli\u003e消えたメソッド\n\n\u003cul\u003e\n\u003cli\u003eOSに直結するようなメソッドは隠蔽された（Jigsaw絡み)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003edeprecated\n\n\u003cul\u003e\n\u003cli\u003ethreadのStop\u003c/li\u003e\n\u003cli\u003eReflection系のメソッド \u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eVM\u0026amp;Tools\n\n\u003cul\u003e\n\u003cli\u003eNo More Java Plug-in Applet\u003c/li\u003e\n\u003cli\u003eNo More Windows x86 Clinent VM\u003c/li\u003e\n\u003cli\u003eNo More Java DB\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eOperation \u0026amp; Management\n\n\u003cul\u003e\n\u003cli\u003eNo More Visual VM\u003c/li\u003e\n\u003cli\u003eNo More hprof(heapのプロファイラ), jhat\u003c/li\u003e\n\u003cli\u003eJRE Structure\n\n\u003cul\u003e\n\u003cli\u003eディレクトリ構成が変わった\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eNo More rt.jar, tools,jar, lib/ext\u003c/li\u003e\n\u003cli\u003eNo More -Xbootclasspath\u003c/li\u003e\n\u003cli\u003eDefault GC: G1GC (今まではパラレルGC)\u003c/li\u003e\n\u003cli\u003eDeprecated: CMS(GCの一種)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"brand-new\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#brand-new\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBrand New\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eJigsaw\u003c/li\u003e\n\u003cli\u003eProject Kulla/JShell\u003c/li\u003e\n\u003cli\u003eReactive Streams\n\n\u003cul\u003e\n\u003cli\u003e非同期プロセス\u003c/li\u003e\n\u003cli\u003ePublisher-Subscriver Model (w / Back Pressure)\u003c/li\u003e\n\u003cli\u003eFlowインターフェース\n\n\u003cul\u003e\n\u003cli\u003ePublisher\u003c/li\u003e\n\u003cli\u003eSubscriber\u003c/li\u003e\n\u003cli\u003eSubscription\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eJEP11 Incubator Modules\n\n\u003cul\u003e\n\u003cli\u003eベータ版のような機能をJDKに含める\n\n\u003cul\u003e\n\u003cli\u003eJava SE 9 : HTTP/2 Client\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"update\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#update\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUpdate\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eLanguage: Milling Project Coin\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/SafeVarargs\" class=\"user-mention js-hovercard\" title=\"SafeVarargs\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"SafeVarargs\"\u003e@SafeVarargs\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003etry-with-resources\n\n\u003cul\u003e\n\u003cli\u003efinalのついた変数ならばtry句に使用可能に(実質的finalでもOK(Java8より))\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eダイヤモンド演算子(\u0026lt;\u0026gt;)\n\n\u003cul\u003e\n\u003cli\u003e匿名クラスでも利用可能に\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eInterfaceでprivateメソッド\u003c/li\u003e\n\u003cli\u003eアンダースコア\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eLibrary\u003c/li\u003e\n\u003cli\u003eStream\n\n\u003cul\u003e\n\u003cli\u003eFactory Methods\n\n\u003cul\u003e\n\u003cli\u003eofNullable(t)\n\n\u003cul\u003e\n\u003cli\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eiterate(seed, hasNext, next)\n\n\u003cul\u003e\n\u003cli\u003e条件とつけられるようになった（今までは無限イテレート）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eNew Methods\n\n\u003cul\u003e\n\u003cli\u003etake/dropWhile\u003c/li\u003e\n\u003cli\u003eCollectors.flatMapping\u003c/li\u003e\n\u003cli\u003eCollectors.filtering\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eOptional\n\n\u003cul\u003e\n\u003cli\u003estream()\u003c/li\u003e\n\u003cli\u003eifPresentOrElse(action, elseAction)\u003c/li\u003e\n\u003cli\u003eor(supplier)\n\n\u003cul\u003e\n\u003cli\u003eOptional opt = opt1.or(() -\u0026gt; opt2)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCollection\n\n\u003cul\u003e\n\u003cli\u003eFactory Method \n\n\u003cul\u003e\n\u003cli\u003eof()\n\n\u003cul\u003e\n\u003cli\u003eList l = List.of(0,1,2);\u003c/li\u003e\n\u003cli\u003eMap m = Map.of(0,”a”,1,”b”);\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eMaking Immutable Collection\u003c/li\u003e\n\u003cli\u003eEnumeration.asIterator();\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eString\n\n\u003cul\u003e\n\u003cli\u003echar[] → byte[]\n\n\u003cul\u003e\n\u003cli\u003eheapの使用量がかなり減る\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003econcatenation\n\n\u003cul\u003e\n\u003cli\u003eStringBuilder → InvokeDynamic\n\n\u003cul\u003e\n\u003cli\u003e最適化が可能に\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eDeprecated\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"/Deprecated\" class=\"user-mention js-hovercard\" title=\"Deprecated\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"Deprecated\"\u003e@Deprecated\u003c/a\u003eのついたものは本当に消される\n\n\u003cul\u003e\n\u003cli\u003eDeprecatedの警告が出た場合はすぐに対応すべき\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eJavadoc\n\n\u003cul\u003e\n\u003cli\u003eHTML5対応\u003c/li\u003e\n\u003cli\u003eSearchBox\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"spring-framework-50によるreactive-web-applicationpivotalジャパン株式会社槙-俊明\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#spring-framework-50%E3%81%AB%E3%82%88%E3%82%8Breactive-web-applicationpivotal%E3%82%B8%E3%83%A3%E3%83%91%E3%83%B3%E6%A0%AA%E5%BC%8F%E4%BC%9A%E7%A4%BE%E6%A7%99-%E4%BF%8A%E6%98%8E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSpring Framework 5.0によるReactive Web Application　Pivotalジャパン株式会社　槙 俊明\u003c/h1\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"概要公式ページより-5\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81%E5%85%AC%E5%BC%8F%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%88%E3%82%8A-5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要(公式ページより)\u003c/h3\u003e\n\n\u003cp\u003eSpring Framework 5.0の目玉機能としてReactiveプログラミング対応が加わり、Spring WebFluxという新しいWebフレームワーク及びランタイムが追加されます。\u003cbr\u003e\n本セッションでは、Reactive対応の背景とReactive Streams/Project Reactorの説明から入り、Spring Boot 2.0を交えたSpring WebFluxの使い方をコード例を中心にご紹介します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"発表資料\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%99%BA%E8%A1%A8%E8%B3%87%E6%96%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e発表資料\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.slideshare.net/makingx/spring-framework-50-reactive-web-application-javadaytokyo\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.slideshare.net/makingx/spring-framework-50-reactive-web-application-javadaytokyo\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"reactiveとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#reactive%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eReactiveとは？\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eNon-Blocking\u003c/li\u003e\n\u003cli\u003eevent-driven\u003c/li\u003e\n\u003cli\u003ebackpressure\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"種類\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A8%AE%E9%A1%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e種類\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eSync/Bloking\u003c/li\u003e\n\u003cli\u003eAsync \u0026amp; Blocking\n\n\u003cul\u003e\n\u003cli\u003eマルチスレッド\u003c/li\u003e\n\u003cli\u003eスレッドを立ち上げる処理が重い\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAsync \u0026amp; Non-Blocking\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eEvent-Loop\u003c/li\u003e\n\u003cli\u003eI/Oの待ち時間を有効に利用できる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eServletを使うと必然的にBlockingになる\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eNettyを利用するとNon-Blocking \u0026amp; Event-Loop (Apple, Twitterなどで利用されている)\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"springがreactive対応する理由\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#spring%E3%81%8Creactive%E5%AF%BE%E5%BF%9C%E3%81%99%E3%82%8B%E7%90%86%E7%94%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSpringがReactive対応する理由\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eマイクロサービス→無駄なくスケール可能に\u003c/li\u003e\n\u003cli\u003eスロークライアントからのアクセス\u003c/li\u003e\n\u003cli\u003eスケーラビリティ・安定性など\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"reactive-streams\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#reactive-streams\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eReactive Streams\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003enon-blocking\u003c/li\u003e\n\u003cli\u003eback prassure\n\n\u003cul\u003e\n\u003cli\u003eデータの流量を調節する機構\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"対応ライブラリ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AF%BE%E5%BF%9C%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e対応ライブラリ\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eRxJava\u003c/li\u003e\n\u003cli\u003eReactor\u003c/li\u003e\n\u003cli\u003eAcca Stream\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"reactorの場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#reactor%E3%81%AE%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eReactorの場合\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"fluxmono\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#fluxmono\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFlux/Mono\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eFlux\n\n\u003cul\u003e\n\u003cli\u003ePublisherの実装0~N件のデータを表現する場合に使用\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eMono\n\n\u003cul\u003e\n\u003cli\u003ePublisherの実装 0または1のデータを表現する場合に使用\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eSpringFW5.0でのReactive Stream\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/41569/dfda7529-2ee0-8b79-175a-20d4c05a2128.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/41569/dfda7529-2ee0-8b79-175a-20d4c05a2128.jpeg\" alt=\"新規ドキュメント 2017-05-17 17.52.39_1.jpg\"\u003e\u003c/a\u003e\u003c/p\u003e\n","body":"Java Day Tokyo 2017に参加してきたのでその時のメモ。\n自分用に書いていたので歯抜けが多く申し訳ないです。\n間違いや補足事項あればご指摘いただけるを幸いです。\n\n公式ページ：http://www.oracle.co.jp/events/javaday/2017/\nハッシュタグ: [#JavaDayTokyo](https://twitter.com/hashtag/JavaDayTokyo?src=hash)\n\n# Java Day Tokyo 2017 基調講演\n#### 概要(公式ページより)\nいよいよJava SE 9とJava EE 8のリリースが近づいてきました！今回のJava Day Tokyoの基調講演は、Java SE、Java EEそれぞれの開発部門のVice Presidentが、直接みなさまへ新バージョンの価値をご紹介します。新バージョンの注目すべきポイント、さらにその先に何があるのかを、ぜひみなさまご自身でお確かめください。ご参加をお待ちしています。\n\n\n## 日本オラクル代表取締役　杉原博茂 氏\n\n- 「日本を幸せにするカンパニーへ」\n- ITの人材不足が課題、2030年には60万人の不足に\n- オンプレ(12兆)　＞　IaaS(2100億)\n- Cloud上で最適化するための機能強化\n\n\n## Bernard Traversat 氏\n\n- Cloudの基盤となる\n  - AWS,MS AzuleなどのコアにJavaが使われている\n- Java is deadはOracleに買収されて払拭された\n- 先日、Dockerとのパートナーシップを発表した\n\n### Java9\n- 122のフィーチャーが入った\n  - module system\n  - modular JDK\n  - JShell\n  - Encapsulate Internal APIs\n  - JLink: Java Linker\n  - Ahead of time compilation(AOT)\n      - Java9ではスタティックのコンパイレーションを利用可能\n      - コンパイラがリアリタイム情報を取得可能に\n\n### Java9以降の動向（OpenJDK）\n####project Valhalla\n\n* ValueTypes\n* Specialized Generics\n* Var Handles\n\n#### Project Panama\nビッグデータへの適用\nGPUでの実行\n\n* Foreign Function Inteerface\n* Date Layout Control\n* Arrays 2.0\n\n\n## MatsudaでのJavaの利用について\n###従来型\n* ビジネスプロセスをサポート\n* 機能要件・非機能要件をサポートするのは必須\n* 全ての開発者は共通の開発環境、アーキテクチャ、開発ルール、FWを使っている\n* 自動生成ツールを作成\n* 言語が長生きしてくれるのも重要\n* 下位互換性（バージョンアップしやすい）\n\n###最近の流れ\n* 組み合わせ\n    * Strategy Pattern →関数型に\n* 期待\n    * 開発環境やFWの共通化→肥大化→Jigsawに期待\n    * 大量データ→GCの問題→BigData/AI時代のJavaに期待\n\n\n###JShell\n- REPLのようにインタラクティブに実行可能となる\n- mvn jshell compile\n- 補完機能もついている\n- プロトタイプをJShellで作成し、形ができてきたらコードに落とし込む\n\n\n##Will Lions 氏\n\n- JavaEE8は早ければ今年の夏に発表予定\n- HTTP/2は速度が速くセキュア、アプリケーションに変更必要なし\n\n###JJUG\n- 現在6300人以上、コアは20-30代\n- なぜコミュニティに参加するのか\n  * 一緒に考えてくれる仲間に出会える\n  * すごいエンジニアを知ることが出来る\n  * 発信して勉強できる\n\n\n\n#Java 9 and Beyond: Java Renaissance in the Cloud\n###概要(公式ページより)\n本セッションはJava 9リリースのアップデート情報をお届けします。Java 9は、エンジニアがjavaサービスをクラウド上にjavaサービスを開発し展開する方法を根本的に変えます。新たなツールであるAOTやJLinkはJava 9の新モジュールシステムを活用して新しいタイプのパフォーマンスと密度の最適化を可能にします。Java 9でデフォルトGCに位置づけられたG1はビッグデータクラウドサービス向けの新たなレベルのスケーラビリティを提供します。さらに、value typeやJNIの移行、言語の改良など、Java 9以降の新機能についても触れたいと思います。またこのセッションでは、これら新機能のデモを通してクラウドベースの開発者にとってのJava 9の重要性を理解頂きます。\n\n\n### Java9\n- Javaの問題\n  * 冗長性\n  * メモリを食う\n- Javaの優先度\n  * セキュリティ\n\n###新機能\n* jigsaw\n* JLink\n* Ahead of Time(AOT) Java Compiler\n* JShell\n* G1 GC as the Default\n\n###Java SE Advanced\n* Flight Recorder Performance\n    * 条件に基づいた情報をトレーシングすることが可能\n* Java Mission Control Console\n    * 問題箇所を調査することが出来る\n* Advanced Management Console\n    * 特定のアプリだけ古いJavaを利用、などを設定できる（セキュリティの向上）\n\n###Java9以降の動向\n* Uniform\n    * Array, Values, types\n* memory\n    * なるべくコンパクトに、もっとライトウェイトなスレッド\n* Compatible\n    * 互換性\n* Performance\n    * CPU/GPU\n\n# Modular Development with JDK 9 日本オラクル株式会社　デイビッド・バック\n###概要(公式ページより)\nモジュラー開発スタイルは全てのJava開発者（あなたのアプリケーションがたった１つのJARであっても100個のJARであっても）にメリットがあります。本セッションでは内部APIを強力に保護しながら数十の再利用可能なモジュールとしてJDKを構造化したJava 9のモジュールシステムを紹介します。\nそして、セッションではモジュールをどのようにして作成するか、一般的に利用されているライブラリ潜むJDKの内部APIへの依存の回避をどのように行うかについて解説します。最後に、モジュールのために用意されたツール群について説明します。\n\n###Programs are ~~Classes~~  ~~Package~~ Mogules\n* “public” no longer mean “accessile ti everyone”.\n![新規ドキュメント 2017-05-17 14.13.09_1.jpg](https://qiita-image-store.s3.amazonaws.com/0/41569/955ca7d5-2fa6-cb01-014c-6a2e6886c33a.jpeg)\n\n![新規ドキュメント 2017-05-17 14.14.37_1.jpg](https://qiita-image-store.s3.amazonaws.com/0/41569/ff1b7b87-3b9a-28da-d5ac-c5d82de8dabd.jpeg)\n\nexports はパッケージ単位。requires はモジュール単位\n![新規ドキュメント 2017-05-17 14.20.12_1.jpg](https://qiita-image-store.s3.amazonaws.com/0/41569/99a17a1f-a1a4-1a46-76a7-3c8973ebf467.jpeg)\n\n\nJLinkを利用すると、JDKのクラスモジュールのうち必要なものだけ指定して読み込むことが出来る\n→メリットは？\ncloudなどで多数のJDKを起動する場合などに、リソースの節約になる\n\n\njdepsでjarの依存関係を検査することができる（Java8から提供されている）\n![新規ドキュメント 2017-05-17 14.32.35_1.jpg](https://qiita-image-store.s3.amazonaws.com/0/41569/0589433a-9d19-485c-a194-8b68abcde906.jpeg)\n\n\nAutomatic Modules\n既存のJarを自動的にmodule化する機能\nモジュールベースで開発されてないものは、Automatic modules機能を使う。Jarの変更なし\n\n\n#Servlet 4.0 で始めるHTTP/2  日本オラクル株式会社　柳原 伸弥\n###概要(公式ページより)\nHTTPの仕様が16年ぶりにHTTP/1.1 からHTTP/2に更新され、通信効率を向上するさまざまな仕組みが取り込まれました。Servlet 4.0では、HTTP/2の活用するアップデートが行われています。本セッションでは、Servlet 4.0を用いたHTTP/2 の活用例についてご紹介します。\n\n###Servlet振り返り\n* サーバサイドで動作するJava\n* Controllerとしての役割\n\n###Servlet4.0概要\n* Servlet4.0 2017/7リリース予定\n* HTTP２対応\n\n###HTTP／２概要\n* 1系\n    * TCPコネクションについて、リクエスト・レスポンスが1:1\n    * 原則として１つのリクエストの完了を待ってから、次のリクエストを送信→待ちが発生\n    * 高速化の取り組み\n        * CSSスプライト\n        * インラインイメージ\n        * ドメインシャーディング\n* 2系\n    * TCPコネクションについて、ストリームの多重化\n    * ストリーム優先度\n    * Server Push\n    * ヘッダー圧縮（オーバーヘッドを少なくする）\n    * バイナリー・フレーム（今まではテキストベースだった）\n\n###Server Push\n* 一つのリクエストに複数のレスポンスを返す\n* PushBuilderオブジェクトを作成 (request.newPushBuilder();)\n* PushBuilderオブジェクトは再利用可能\n* GETまたはHEADを利用する（「キャッシュ可能」かつ「安全」であること(RFC 7540の仕様に準拠)）\n* JSファイルの結合や、CSSスプライトを行う必要がなくなる\n\n![新規ドキュメント 2017-05-17 14.32.35_2.jpg](https://qiita-image-store.s3.amazonaws.com/0/41569/5be30a24-d77c-72be-3ec0-1be8fd1661aa.jpeg)\n\n#Java SE 9のすすめ　Java in the Box　櫻庭 祐一 \n###概要(公式ページより)\nJava SE 9というと、Project JigsawやJShellを思い浮かべるかもしれません。しかし、Java SE 9はそれだけではありません。Java SEの機能追加を定めるJEPの数は89もあります。\n本セッションでは、Java SE 9の多くの新機能の中から言語仕様の変更や、コアライブラリの変更点、また互換性に問題がある点などについて実例と共に解説します。\n\n\nJigsaw, JShellの話はしない\n\n###アジェンダ\n* Compatibility\n* Brand new\n* Update\n\n###Compatibility\n* Language \u0026 Library\n    * アンダースコアのみの変数名は使用できなくなった\n    * 消えたメソッド\n        * OSに直結するようなメソッドは隠蔽された（Jigsaw絡み)\n    * deprecated\n        * threadのStop\n        * Reflection系のメソッド \n* VM\u0026Tools\n    * No More Java Plug-in Applet\n    * No More Windows x86 Clinent VM\n    * No More Java DB\n* Operation \u0026 Management\n    * No More Visual VM\n    * No More hprof(heapのプロファイラ), jhat\n    * JRE Structure\n        * ディレクトリ構成が変わった\n    * No More rt.jar, tools,jar, lib/ext\n    * No More -Xbootclasspath\n    * Default GC: G1GC (今まではパラレルGC)\n    * Deprecated: CMS(GCの一種)\n\n\n###Brand New\n* Jigsaw\n* Project Kulla/JShell\n* Reactive Streams\n    * 非同期プロセス\n    * Publisher-Subscriver Model (w / Back Pressure)\n    * Flowインターフェース\n        * Publisher\n        * Subscriber\n        * Subscription\n* JEP11 Incubator Modules\n    * ベータ版のような機能をJDKに含める\n        * Java SE 9 : HTTP/2 Client\n\n###Update\n* Language: Milling Project Coin\n    * @SafeVarargs\n    * try-with-resources\n        * finalのついた変数ならばtry句に使用可能に(実質的finalでもOK(Java8より))\n    * ダイヤモンド演算子(\u003c\u003e)\n        * 匿名クラスでも利用可能に\n    * Interfaceでprivateメソッド\n    * アンダースコア\n* Library\n* Stream\n    * Factory Methods\n        * ofNullable(t)\n            * \n        * iterate(seed, hasNext, next)\n            * 条件とつけられるようになった（今までは無限イテレート）\n    * New Methods\n        * take/dropWhile\n        * Collectors.flatMapping\n        * Collectors.filtering\n* Optional\n    * stream()\n    * ifPresentOrElse(action, elseAction)\n    * or(supplier)\n        * Optional\u003cString\u003e opt = opt1.or(() -\u003e opt2)\n* Collection\n    * Factory Method \n        * of()\n            * List\u003cInteger\u003e l = List.of(0,1,2);\n            * Map\u003cInteger, String\u003e m = Map.of(0,”a”,1,”b”);\n    * Making Immutable Collection\n    * Enumeration.asIterator();\n* String\n    * char[] → byte[]\n        * heapの使用量がかなり減る\n    * concatenation\n        * StringBuilder → InvokeDynamic\n            * 最適化が可能に\n* Deprecated\n    * @Deprecatedのついたものは本当に消される\n        * Deprecatedの警告が出た場合はすぐに対応すべき\n* Javadoc\n    * HTML5対応\n    * SearchBox\n\n\n#Spring Framework 5.0によるReactive Web Application　Pivotalジャパン株式会社　槙 俊明\n###概要(公式ページより)\nSpring Framework 5.0の目玉機能としてReactiveプログラミング対応が加わり、Spring WebFluxという新しいWebフレームワーク及びランタイムが追加されます。\n本セッションでは、Reactive対応の背景とReactive Streams/Project Reactorの説明から入り、Spring Boot 2.0を交えたSpring WebFluxの使い方をコード例を中心にご紹介します。\n###発表資料\nhttps://www.slideshare.net/makingx/spring-framework-50-reactive-web-application-javadaytokyo\n\n\n###Reactiveとは？\n* Non-Blocking\n* event-driven\n* backpressure\n\n###種類\n* Sync/Bloking\n* Async \u0026 Blocking\n  * マルチスレッド\n    * スレッドを立ち上げる処理が重い\n* Async \u0026 Non-Blocking\n  * Event-Loop\n  * I/Oの待ち時間を有効に利用できる\n\n- Servletを使うと必然的にBlockingになる\n- Nettyを利用するとNon-Blocking \u0026 Event-Loop (Apple, Twitterなどで利用されている)\n\n###SpringがReactive対応する理由\n* マイクロサービス→無駄なくスケール可能に\n* スロークライアントからのアクセス\n* スケーラビリティ・安定性など\n\n\n###Reactive Streams\n* non-blocking\n* back prassure\n    * データの流量を調節する機構\n\n###対応ライブラリ\n* RxJava\n* Reactor\n* Acca Stream\n\n###Reactorの場合\n####Flux/Mono\n* Flux\u003cT\u003e\n    * Publisherの実装0~N件のデータを表現する場合に使用\n* Mono\u003cT\u003e\n    * Publisherの実装 0または1のデータを表現する場合に使用\n\nSpringFW5.0でのReactive Stream\n![新規ドキュメント 2017-05-17 17.52.39_1.jpg](https://qiita-image-store.s3.amazonaws.com/0/41569/dfda7529-2ee0-8b79-175a-20d4c05a2128.jpeg)\n","coediting":false,"created_at":"2017-05-17T22:39:56+09:00","group":null,"id":"64f7fe693e5fe47aff32","private":false,"tags":[{"name":"Java","versions":[]},{"name":"勉強会","versions":[]},{"name":"Java9","versions":[]}],"title":"【勉強会メモ】Java Day Tokyo 2017","updated_at":"2017-05-17T22:50:41+09:00","url":"http://qiita.com/nesheep5/items/64f7fe693e5fe47aff32","user":{"description":"決済代行サービスの開発をしています。\r\n仕事では主にJavaを使用。最近は機械学習を勉強中です。","facebook_id":"shogo.watanabe.583","followees_count":98,"followers_count":38,"github_login_name":"nesheep5","id":"nesheep5","items_count":23,"linkedin_id":"","location":"Tokyo","name":"Shogo Watanabe","organization":"株式会社ディー・エヌ・エー","permanent_id":41569,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/41569/profile-images/1473688843","twitter_screen_name":"nesheep5","website_url":"http://nesheep5.hatenablog.com/"}},{"rendered_body":"\u003cp\u003eDBIx::Handler\u003cbr\u003e\n\u003ca href=\"http://search.cpan.org/~nekokak/DBIx-Handler/lib/DBIx/Handler.pm\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://search.cpan.org/~nekokak/DBIx-Handler/lib/DBIx/Handler.pm\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eDBIx::Handlerは、fork安全で簡単なトランザクション処理DBIハンドラです。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e  use DBIx::Handler;\n  my $handler = DBIx::Handler-\u0026gt;new($dsn, $user, $pass, $opts);\n  my $dbh = $handler-\u0026gt;dbh;\n  $dbh-\u0026gt;do(...);\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"DBIx::Handler\nhttp://search.cpan.org/~nekokak/DBIx-Handler/lib/DBIx/Handler.pm\n\n\u003e\nDBIx::Handlerは、fork安全で簡単なトランザクション処理DBIハンドラです。\n\n```\n  use DBIx::Handler;\n  my $handler = DBIx::Handler-\u003enew($dsn, $user, $pass, $opts);\n  my $dbh = $handler-\u003edbh;\n  $dbh-\u003edo(...);\n```\n","coediting":false,"created_at":"2017-05-17T22:37:13+09:00","group":null,"id":"718745a1b7e376b180ac","private":false,"tags":[{"name":"Perl","versions":[]},{"name":"プログラミング","versions":[]},{"name":"データベース","versions":[]},{"name":"cpan","versions":[]},{"name":"ITエンジニアお役立ち","versions":[]}],"title":"DBIx::Handler -  フォーク・セーフで簡単なトランザクション処理DBIハンドラ【Perlモジュール紹介】","updated_at":"2017-05-17T22:37:13+09:00","url":"http://qiita.com/yukikimoto/items/718745a1b7e376b180ac","user":{"description":"","facebook_id":"yukikimoto4","followees_count":123,"followers_count":36,"github_login_name":"yuki-kimoto","id":"yukikimoto","items_count":164,"linkedin_id":"","location":"東京","name":"木本 裕紀","organization":"","permanent_id":155418,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/155418/profile-images/1481942273","twitter_screen_name":"yukikimoto2","website_url":"http://d.hatena.ne.jp/perlcodesample/"}},{"rendered_body":"\u003cp\u003eDBIx::Log4perl\u003cbr\u003e\n\u003ca href=\"http://search.cpan.org/dist/DBIx-Connector/lib/DBIx/Connector.pm\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://search.cpan.org/dist/DBIx-Connector/lib/DBIx/Connector.pm\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eDBIx::Log4perlはDBI上のラッパーで、Log::Log4perlハンドルを介してDBIアクティビティのログを追加します。Log::Log4perlには多くの利点がありますが。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e  use DBIx::Connector;\n\n  # Create a connection.\n  my $conn = DBIx::Connector-\u0026gt;new($dsn, $username, $password, {\n      RaiseError =\u0026gt; 1,\n      AutoCommit =\u0026gt; 1,\n  });\n\n  # Get the database handle and do something with it.\n  my $dbh  = $conn-\u0026gt;dbh;\n  $dbh-\u0026gt;do('INSERT INTO foo (name) VALUES (?)', undef, 'Fred' );\n\n  # Do something with the handle more efficiently.\n  $conn-\u0026gt;run(fixup =\u0026gt; sub {\n      $_-\u0026gt;do('INSERT INTO foo (name) VALUES (?)', undef, 'Fred' );\n  });\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"DBIx::Log4perl\nhttp://search.cpan.org/dist/DBIx-Connector/lib/DBIx/Connector.pm\n\n\u003eDBIx::Log4perlはDBI上のラッパーで、Log::Log4perlハンドルを介してDBIアクティビティのログを追加します。Log::Log4perlには多くの利点がありますが。\n\n```\n  use DBIx::Connector;\n\n  # Create a connection.\n  my $conn = DBIx::Connector-\u003enew($dsn, $username, $password, {\n      RaiseError =\u003e 1,\n      AutoCommit =\u003e 1,\n  });\n\n  # Get the database handle and do something with it.\n  my $dbh  = $conn-\u003edbh;\n  $dbh-\u003edo('INSERT INTO foo (name) VALUES (?)', undef, 'Fred' );\n\n  # Do something with the handle more efficiently.\n  $conn-\u003erun(fixup =\u003e sub {\n      $_-\u003edo('INSERT INTO foo (name) VALUES (?)', undef, 'Fred' );\n  });\n```\n","coediting":false,"created_at":"2017-05-17T22:34:57+09:00","group":null,"id":"79700092a7f1821521ce","private":false,"tags":[{"name":"Perl","versions":[]},{"name":"プログラミング","versions":[]},{"name":"データベース","versions":[]},{"name":"cpan","versions":[]},{"name":"ITエンジニアお役立ち","versions":[]}],"title":"DBIx::Log4perl - DBIのPerl拡張で、DBIメソッド、SQL、パラメータ、結果セット、トランザクションなどをLog::Log4perlハンドルに選択的にロギングすることができます。【Perlモジュール紹介】","updated_at":"2017-05-17T22:34:57+09:00","url":"http://qiita.com/yukikimoto/items/79700092a7f1821521ce","user":{"description":"","facebook_id":"yukikimoto4","followees_count":123,"followers_count":36,"github_login_name":"yuki-kimoto","id":"yukikimoto","items_count":164,"linkedin_id":"","location":"東京","name":"木本 裕紀","organization":"","permanent_id":155418,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/155418/profile-images/1481942273","twitter_screen_name":"yukikimoto2","website_url":"http://d.hatena.ne.jp/perlcodesample/"}},{"rendered_body":"\u003cp\u003e前回は、とりあえず環境を構築して、アプリケーションのデフォルト画面を表示するところまで試した。\u003cbr\u003e\n今回は、あらためてアプリケーションを作成し、Railsアプリの全体像をざっくり掴むところまでいければと思う。\u003c/p\u003e\n\n\u003cp\u003e※ ここからは \u003ca href=\"https://railstutorial.jp/?version=5.0\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRuby on Rails チュートリアル\u003c/a\u003e に沿って進めつつ、書籍やWEBの情報で補足するスタイルでしばらく進めてみる\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"0-前提\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#0-%E5%89%8D%E6%8F%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【0】 前提\u003c/h3\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e前回の記事 で構築した環境を前提にしています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eDocker for Mac のCentOS7コンテナ上で環境を構築している\u003c/li\u003e\n\u003cli\u003erbenv で Ruby をインストールしている\u003c/li\u003e\n\u003cli\u003eGem の管理には bundler を利用している\u003c/li\u003e\n\u003cli\u003eコンテナ側(CentOS)とホスト側(Mac)で、作業用フォルダを共有している\u003c/li\u003e\n\u003cli\u003eMac側のブラウザから、コンテナのRubyアプリを参照可能\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e上記と違う環境で作業する人は、適宜読み替えて解釈してください。\u003c/p\u003e\n\n\u003cp\u003e　\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"１-bundler-で-rails-をグローバルにインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%91-bundler-%E3%81%A7-rails-%E3%82%92%E3%82%B0%E3%83%AD%E3%83%BC%E3%83%90%E3%83%AB%E3%81%AB%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【１】 bundler で Rails をグローバルにインストール\u003c/h3\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e前回は試しに特定のアプリケーションのフォルダにRailsをインストールした。\u003cbr\u003e\nここで、あらためてグローバルにRailsをインストールする。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003emkdir ~/install\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e ~/install\nbundle init\n\n↓\nvi Gemfile\n   \u003cspan class=\"c1\"\u003e#「gem \"rails\"」を有効化（#をはずす）\u003c/span\u003e\n\n↓\nbundle install\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e　\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"２rbenv-rehash-コマンドでrailsコマンドを使えるようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%92rbenv-rehash-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7rails%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【２】rbenv rehash コマンドで、railsコマンドを使えるようにする\u003c/h3\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e「rbenv rehash」を実行することで、インストール済みのGemのコマンドが ~/.rbenv/shims に設置されて、実行できるようになる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ ls ~/.rbenv/shims/\nbundle  bundler  erb  gem  irb  rake  rdoc  ri  ruby\n\n$ rbenv rehash\n\n$ ls ~/.rbenv/shims/\nbundle  bundler  erb  gem  irb  nokogiri  rackup  rails  rake  rdoc  ri  ruby  sprockets  thor\n\n\u003cspan class=\"c1\"\u003e# ↑いろいろ追加された！\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e　\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"３rails-コマンドによるアプリケーションの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%93rails-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AB%E3%82%88%E3%82%8B%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【３】rails コマンドによるアプリケーションの作成\u003c/h3\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e前回の記事では「bundle exec rails new .」でRailsアプリケーションを作ったが、今回は、railsコマンドで作ってみる（Ruby on Rails チュートリアル がそうなっているので、とりあえず合わせてみる）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# Macと共有しているフォルダに移動\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /docker-host/share/webapps/\n\n\u003cspan class=\"c1\"\u003e# Railsのバージョンを指定して、「hello_app」というアプリをnewする\u003c/span\u003e\nrails _5.1.1_ new hello_app\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e↑ Gemfile でRailsのバージョンを指定せずにインストールしたので、最新版がインストールされている。\u003cbr\u003e\nなので、上記は作業時点での最新版である「\u003cem\u003e5.1.1\u003c/em\u003e」を指定しているが、作業タイミングによってはもっと新しいバージョンがインストールされているかもしれないので、適宜バージョンを確認してから作業する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ rails --version\nRails \u003cspan class=\"m\"\u003e5\u003c/span\u003e.1.1\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e　\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"４railsアプリケーションのフォルダファイル構成を大まかに見てみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%94rails%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%A7%8B%E6%88%90%E3%82%92%E5%A4%A7%E3%81%BE%E3%81%8B%E3%81%AB%E8%A6%8B%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【４】Railsアプリケーションのフォルダ・ファイル構成を大まかに見てみる\u003c/h3\u003e\n\n\u003chr\u003e\n\n\u003cp\u003ePHPとかで最近のフレームワークを触っている人なら、あんまり違和感のない構造だと思う。\u003cbr\u003e\nてか、あれらがRailsを参考にしている部分も多いのかな　(｡ ・ω・))ﾌﾑﾌﾑ\u003c/p\u003e\n\n\u003cp\u003eとりあえずざっと眺めて、ここでは深追いせずに先に進む。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ tree hello_app/ -L \u003cspan class=\"m\"\u003e2\u003c/span\u003e\nhello_app/\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- Gemfile\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- Gemfile.lock\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- README.md\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- Rakefile\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- app\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- assets\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- channels\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- controllers\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- helpers\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- \u003cspan class=\"nb\"\u003ejobs\u003c/span\u003e\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- mailers\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- models\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"sb\"\u003e`\u003c/span\u003e-- views\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- bin\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- bundle\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- rails\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- rake\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- setup\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- spring\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- update\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"sb\"\u003e`\u003c/span\u003e-- yarn\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- config\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- application.rb\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- boot.rb\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- cable.yml\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- database.yml\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- environment.rb\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- environments\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- initializers\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- locales\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- puma.rb\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- routes.rb\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- secrets.yml\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"sb\"\u003e`\u003c/span\u003e-- spring.rb\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- config.ru\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- db\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"sb\"\u003e`\u003c/span\u003e-- seeds.rb\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- lib\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- assets\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"sb\"\u003e`\u003c/span\u003e-- tasks\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- log\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- package.json\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- public\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- \u003cspan class=\"m\"\u003e404\u003c/span\u003e.html\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- \u003cspan class=\"m\"\u003e422\u003c/span\u003e.html\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- \u003cspan class=\"m\"\u003e500\u003c/span\u003e.html\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- apple-touch-icon-precomposed.png\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- apple-touch-icon.png\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- favicon.ico\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"sb\"\u003e`\u003c/span\u003e-- robots.txt\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- \u003cspan class=\"nb\"\u003etest\u003c/span\u003e\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- application_system_test_case.rb\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- controllers\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- fixtures\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- helpers\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- integration\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- mailers\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- models\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- system\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"sb\"\u003e`\u003c/span\u003e-- test_helper.rb\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e-- tmp\n       \u003cspan class=\"p\"\u003e|\u003c/span\u003e   \u003cspan class=\"sb\"\u003e`\u003c/span\u003e-- cache\n       \u003cspan class=\"sb\"\u003e`\u003c/span\u003e-- vendor\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e　\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"５gemのバージョンを固定する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%95gem%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E5%9B%BA%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【５】Gemのバージョンを固定する？\u003c/h3\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eここで、チュートリアルでは、プロジェクトのGemfileを編集して、各Gemのバージョンを固定しておくように指示がある。\u003cbr\u003e\nたしかに bundle install したときに意図しないGemまで更新されて、思わぬ不具合が出るかもしれないので、上げるときは個別に指定して意図して上げるほうが良いのかもしれない。（チュートリアルでは、説明の統一のためにやっている面もあるだろうが）\u003c/p\u003e\n\n\u003cp\u003e※実際は、出たばかりのGemは頻繁に更新されて不具合や脆弱性が解消されたりするかもしれないので、一概には言えないだろう。\u003c/p\u003e\n\n\u003cp\u003eやるとすれば「bundle list」とかで今はいっているGemのバージョンを確認して、Gemfileに明示することになると思うが、たいへんなので今回はそのまま進める。\u003c/p\u003e\n\n\u003cp\u003e　\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"補足-gemfile-で-gem-のバージョンを指定する方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A3%9C%E8%B6%B3-gemfile-%E3%81%A7-gem-%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e[補足] Gemfile で gem のバージョンを指定する方法\u003c/h4\u003e\n\n\u003cp\u003e前回も書いたが、Gemfileにおけるバージョン指定方法を整理しておく\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e# 最新版をインストール\ngem \"rails\"\n\n# バージョン決め打ち\ngem \"rails\", \"5.1.0\"\n\n# あるバージョン`以上`の最新版をインストール\ngem 'uglifier', '\u0026gt;= 1.3.0'\n\n# 指定のバージョンのマイナーバージョンアップまでならインストールされる \n# （以下の例だと、4.0.9 =\u0026gt;OK  4.1.0=\u0026gt;NG）\ngem 'coffee-rails', '~\u0026gt; 4.0.0'\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e　\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"補足-railsデフォルト同梱のgemの変化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A3%9C%E8%B6%B3-rails%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%90%8C%E6%A2%B1%E3%81%AEgem%E3%81%AE%E5%A4%89%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e[補足] Railsデフォルト同梱のGemの変化\u003c/h4\u003e\n\n\u003cp\u003e「Ruby on Rails チュートリアル」は、Rails5.0.0.1 を前提にしていて、今回インストールしたのは Rails5.1.1。\u003cbr\u003e\nアプリケーション構築直後のGemfileを見ると、同梱されているGemに少し差がある。\u003c/p\u003e\n\n\u003cp\u003e・5.0.0.1 にあって 5.1.1 に無いもの（デフォルトから外されたもの）\u003cbr\u003e\njquery-rails\u003cbr\u003e\n　　jQuery依存から脱却する方向に進んでいるらしい\u003c/p\u003e\n\n\u003cp\u003e・5.1.1 にあって 5.0.0.1 に無いもの（新しく追加されたもの）\u003cbr\u003e\ncapybara\u003cbr\u003e\nselenium-webdriver\u003cbr\u003e\n　　どちらもブラウザ操作を想定したテストのためのGemと思われる\u003c/p\u003e\n\n\u003cp\u003e　\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"６puma-を起動してアクセス確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%96puma-%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【６】Puma を起動してアクセス確認\u003c/h3\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e前回の記事では「bundle exec rails s」でPumaを起動したが、今回はrailsコマンドで起動してみる\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ \u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /docker-host/share/webapps/hello_app\n\n$ rails \u003cspan class=\"nv\"\u003eserver\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; Booting \u003cspan class=\"nv\"\u003ePuma\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; Rails \u003cspan class=\"m\"\u003e5\u003c/span\u003e.1.1 application starting in development on http://localhost:3000\n\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; Run \u003cspan class=\"sb\"\u003e`\u003c/span\u003erails server -h\u003cspan class=\"sb\"\u003e`\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e more startup options\nPuma starting in single mode...\n* Version \u003cspan class=\"m\"\u003e3\u003c/span\u003e.8.2 \u003cspan class=\"o\"\u003e(\u003c/span\u003eruby \u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.1-p111\u003cspan class=\"o\"\u003e)\u003c/span\u003e, codename: Sassy Salamander\n* Min threads: \u003cspan class=\"m\"\u003e5\u003c/span\u003e, max threads: \u003cspan class=\"m\"\u003e5\u003c/span\u003e\n* Environment: development\n* Listening on tcp://0.0.0.0:3000\nUse Ctrl-C to stop\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eで、Macのブラウザから「 \u003ca href=\"http://localhost:3000\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://localhost:3000\u003c/a\u003e 」で、Rails のデフォルトページ（Yay! You’re on Rails!）が表示されれば、ひとまずOK。\u003c/p\u003e\n\n\u003cp\u003ePuma側には、↓以下のようなアクセスログが表示される。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eStarted GET \u003cspan class=\"s2\"\u003e\"/\"\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"m\"\u003e172\u003c/span\u003e.17.0.1 at \u003cspan class=\"m\"\u003e2017\u003c/span\u003e-05-16 \u003cspan class=\"m\"\u003e02\u003c/span\u003e:40:59 +0900\nCannot render console from \u003cspan class=\"m\"\u003e172\u003c/span\u003e.17.0.1! Allowed networks: \u003cspan class=\"m\"\u003e127\u003c/span\u003e.0.0.1, ::1, \u003cspan class=\"m\"\u003e127\u003c/span\u003e.0.0.0/127.255.255.255\nProcessing by Rails::WelcomeController#index as HTML\n  Rendering /usr/local/ruby/.rbenv/versions/2.4.1/lib/ruby/gems/2.4.0/gems/railties-5.1.1/lib/rails/templates/rails/welcome/index.html.erb\n  Rendered /usr/local/ruby/.rbenv/versions/2.4.1/lib/ruby/gems/2.4.0/gems/railties-5.1.1/lib/rails/templates/rails/welcome/index.html.erb \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e11\u003c/span\u003e.4ms\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nCompleted \u003cspan class=\"m\"\u003e200\u003c/span\u003e OK in 692ms \u003cspan class=\"o\"\u003e(\u003c/span\u003eViews: \u003cspan class=\"m\"\u003e32\u003c/span\u003e.2ms\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ePumaを止めたいときは「Ctrl-C」で。\u003c/p\u003e\n\n\u003cp\u003e　\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"７コントローラとルーティング設定をちょこっといじってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%97%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%A8%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%A1%E3%82%87%E3%81%93%E3%81%A3%E3%81%A8%E3%81%84%E3%81%98%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【７】コントローラとルーティング設定をちょこっといじってみる\u003c/h3\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eせっかくなので、アプリケーションをちょこっといじって表示させてみる。\u003c/p\u003e\n\n\u003cp\u003e今回はアプリケーションを、Dockerのホスト（Mac側）との共有フォルダに作成したので、Macのエディタで編集できる。\u003c/p\u003e\n\n\u003cp\u003e① 既存のコントローラに、アクションメソッドを追加してみる\u003c/p\u003e\n\n\u003cp\u003eここでは、Visual Studio Code 等のエディターで、アプリケーションのフォルダを開いて、以下のファイルを編集する。\u003cbr\u003e\nそして、hello という、\"nya---!\" と表示するだけのアクションメソッドを定義してみる。\u003c/p\u003e\n\n\u003cp\u003e「app/controllers/application_controller.rb」\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eApplicationController\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"no\"\u003eActionController\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eBase\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eprotect_from_forgery\u003c/span\u003e \u003cspan class=\"ss\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"ss\"\u003e:exception\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e# hello というアクションメソッドを追加ニャー！\u003c/span\u003e\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ehello\u003c/span\u003e\n    \u003cspan class=\"n\"\u003erender\u003c/span\u003e \u003cspan class=\"ss\"\u003ehtml\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"nya---!\"\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e② TOPページを変更\u003c/p\u003e\n\n\u003cp\u003eいわゆる「ルーティング」の設定を編集して、上記の①で追加したアクションがルート（ / でアクセスされるTOPページ）になるように変更してみる\u003c/p\u003e\n\n\u003cp\u003e以下のファイルを編集する。\u003c/p\u003e\n\n\u003cp\u003e「config/routes.rb」\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"no\"\u003eRails\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroutes\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edraw\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e# 「application」コントローラの「hello」アクションをルートとして設定する\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eroot\u003c/span\u003e \u003cspan class=\"s1\"\u003e'application#hello'\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e③ んでー、表示確認\u003c/p\u003e\n\n\u003cp\u003ePumaを停止している場合は、再度起動する\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /docker-host/share/webapps/hello_app/\nrails server\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eで、ブラウザから確認。\u003cbr\u003e\n\u003ca href=\"http://localhost:3000/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://localhost:3000/\u003c/a\u003e\u003cbr\u003e\n↓\u003cbr\u003e\nnya---!\u003c/p\u003e\n\n\u003cp\u003e　\u003cbr\u003e\nオッケー！\u003cbr\u003e\nあまり進捗はないが、Railsアプリケーションの一端に触れることができた。\u003cbr\u003e\n今日はここまで！！\u003c/p\u003e\n","body":"\n前回は、とりあえず環境を構築して、アプリケーションのデフォルト画面を表示するところまで試した。\n今回は、あらためてアプリケーションを作成し、Railsアプリの全体像をざっくり掴むところまでいければと思う。\n\n※ ここからは [Ruby on Rails チュートリアル](https://railstutorial.jp/?version=5.0) に沿って進めつつ、書籍やWEBの情報で補足するスタイルでしばらく進めてみる\n\n### 【0】 前提\n---\n\n前回の記事 で構築した環境を前提にしています。\n\n+ Docker for Mac のCentOS7コンテナ上で環境を構築している\n+ rbenv で Ruby をインストールしている\n+ Gem の管理には bundler を利用している\n+ コンテナ側(CentOS)とホスト側(Mac)で、作業用フォルダを共有している\n+ Mac側のブラウザから、コンテナのRubyアプリを参照可能\n\n上記と違う環境で作業する人は、適宜読み替えて解釈してください。\n\n　\n### 【１】 bundler で Rails をグローバルにインストール\n---\n\n前回は試しに特定のアプリケーションのフォルダにRailsをインストールした。\nここで、あらためてグローバルにRailsをインストールする。\n\n```bash\nmkdir ~/install\ncd ~/install\nbundle init\n\n↓\nvi Gemfile\n   #「gem \"rails\"」を有効化（#をはずす）\n\n↓\nbundle install\n```\n\n　\n### 【２】rbenv rehash コマンドで、railsコマンドを使えるようにする\n---\n\n「rbenv rehash」を実行することで、インストール済みのGemのコマンドが ~/.rbenv/shims に設置されて、実行できるようになる。\n\n```bash\n$ ls ~/.rbenv/shims/\nbundle  bundler  erb  gem  irb  rake  rdoc  ri  ruby\n\n$ rbenv rehash\n\n$ ls ~/.rbenv/shims/\nbundle  bundler  erb  gem  irb  nokogiri  rackup  rails  rake  rdoc  ri  ruby  sprockets  thor\n\n# ↑いろいろ追加された！\n```\n\n　\n### 【３】rails コマンドによるアプリケーションの作成\n---\n\n前回の記事では「bundle exec rails new .」でRailsアプリケーションを作ったが、今回は、railsコマンドで作ってみる（Ruby on Rails チュートリアル がそうなっているので、とりあえず合わせてみる）\n\n```bash\n# Macと共有しているフォルダに移動\ncd /docker-host/share/webapps/\n\n# Railsのバージョンを指定して、「hello_app」というアプリをnewする\nrails _5.1.1_ new hello_app\n```\n\n↑ Gemfile でRailsのバージョンを指定せずにインストールしたので、最新版がインストールされている。\nなので、上記は作業時点での最新版である「_5.1.1_」を指定しているが、作業タイミングによってはもっと新しいバージョンがインストールされているかもしれないので、適宜バージョンを確認してから作業する。\n\n```bash\n$ rails --version\nRails 5.1.1\n```\n\n　\n### 【４】Railsアプリケーションのフォルダ・ファイル構成を大まかに見てみる\n---\n\nPHPとかで最近のフレームワークを触っている人なら、あんまり違和感のない構造だと思う。\nてか、あれらがRailsを参考にしている部分も多いのかな　(｡ ・ω・))ﾌﾑﾌﾑ\n\nとりあえずざっと眺めて、ここでは深追いせずに先に進む。\n\n```bash\n$ tree hello_app/ -L 2\nhello_app/\n       |-- Gemfile\n       |-- Gemfile.lock\n       |-- README.md\n       |-- Rakefile\n       |-- app\n       |   |-- assets\n       |   |-- channels\n       |   |-- controllers\n       |   |-- helpers\n       |   |-- jobs\n       |   |-- mailers\n       |   |-- models\n       |   `-- views\n       |-- bin\n       |   |-- bundle\n       |   |-- rails\n       |   |-- rake\n       |   |-- setup\n       |   |-- spring\n       |   |-- update\n       |   `-- yarn\n       |-- config\n       |   |-- application.rb\n       |   |-- boot.rb\n       |   |-- cable.yml\n       |   |-- database.yml\n       |   |-- environment.rb\n       |   |-- environments\n       |   |-- initializers\n       |   |-- locales\n       |   |-- puma.rb\n       |   |-- routes.rb\n       |   |-- secrets.yml\n       |   `-- spring.rb\n       |-- config.ru\n       |-- db\n       |   `-- seeds.rb\n       |-- lib\n       |   |-- assets\n       |   `-- tasks\n       |-- log\n       |-- package.json\n       |-- public\n       |   |-- 404.html\n       |   |-- 422.html\n       |   |-- 500.html\n       |   |-- apple-touch-icon-precomposed.png\n       |   |-- apple-touch-icon.png\n       |   |-- favicon.ico\n       |   `-- robots.txt\n       |-- test\n       |   |-- application_system_test_case.rb\n       |   |-- controllers\n       |   |-- fixtures\n       |   |-- helpers\n       |   |-- integration\n       |   |-- mailers\n       |   |-- models\n       |   |-- system\n       |   `-- test_helper.rb\n       |-- tmp\n       |   `-- cache\n       `-- vendor\n```\n\n　\n### 【５】Gemのバージョンを固定する？\n---\n\nここで、チュートリアルでは、プロジェクトのGemfileを編集して、各Gemのバージョンを固定しておくように指示がある。\nたしかに bundle install したときに意図しないGemまで更新されて、思わぬ不具合が出るかもしれないので、上げるときは個別に指定して意図して上げるほうが良いのかもしれない。（チュートリアルでは、説明の統一のためにやっている面もあるだろうが）\n\n※実際は、出たばかりのGemは頻繁に更新されて不具合や脆弱性が解消されたりするかもしれないので、一概には言えないだろう。\n\nやるとすれば「bundle list」とかで今はいっているGemのバージョンを確認して、Gemfileに明示することになると思うが、たいへんなので今回はそのまま進める。\n\n　\n#### [補足] Gemfile で gem のバージョンを指定する方法\n\n前回も書いたが、Gemfileにおけるバージョン指定方法を整理しておく\n\n```\n# 最新版をインストール\ngem \"rails\"\n\n# バージョン決め打ち\ngem \"rails\", \"5.1.0\"\n\n# あるバージョン`以上`の最新版をインストール\ngem 'uglifier', '\u003e= 1.3.0'\n\n# 指定のバージョンのマイナーバージョンアップまでならインストールされる \n# （以下の例だと、4.0.9 =\u003eOK  4.1.0=\u003eNG）\ngem 'coffee-rails', '~\u003e 4.0.0'\n```\n\n　\n#### [補足] Railsデフォルト同梱のGemの変化\n\n「Ruby on Rails チュートリアル」は、Rails5.0.0.1 を前提にしていて、今回インストールしたのは Rails5.1.1。\nアプリケーション構築直後のGemfileを見ると、同梱されているGemに少し差がある。\n\n・5.0.0.1 にあって 5.1.1 に無いもの（デフォルトから外されたもの）\njquery-rails\n　　jQuery依存から脱却する方向に進んでいるらしい\n\n・5.1.1 にあって 5.0.0.1 に無いもの（新しく追加されたもの）\ncapybara\nselenium-webdriver\n　　どちらもブラウザ操作を想定したテストのためのGemと思われる\n\n　\n### 【６】Puma を起動してアクセス確認\n---\n\n前回の記事では「bundle exec rails s」でPumaを起動したが、今回はrailsコマンドで起動してみる\n\n```bash\n$ cd /docker-host/share/webapps/hello_app\n\n$ rails server\n=\u003e Booting Puma\n=\u003e Rails 5.1.1 application starting in development on http://localhost:3000\n=\u003e Run `rails server -h` for more startup options\nPuma starting in single mode...\n* Version 3.8.2 (ruby 2.4.1-p111), codename: Sassy Salamander\n* Min threads: 5, max threads: 5\n* Environment: development\n* Listening on tcp://0.0.0.0:3000\nUse Ctrl-C to stop\n```\n\nで、Macのブラウザから「 http://localhost:3000 」で、Rails のデフォルトページ（Yay! You’re on Rails!）が表示されれば、ひとまずOK。\n\nPuma側には、↓以下のようなアクセスログが表示される。\n\n```bash\nStarted GET \"/\" for 172.17.0.1 at 2017-05-16 02:40:59 +0900\nCannot render console from 172.17.0.1! Allowed networks: 127.0.0.1, ::1, 127.0.0.0/127.255.255.255\nProcessing by Rails::WelcomeController#index as HTML\n  Rendering /usr/local/ruby/.rbenv/versions/2.4.1/lib/ruby/gems/2.4.0/gems/railties-5.1.1/lib/rails/templates/rails/welcome/index.html.erb\n  Rendered /usr/local/ruby/.rbenv/versions/2.4.1/lib/ruby/gems/2.4.0/gems/railties-5.1.1/lib/rails/templates/rails/welcome/index.html.erb (11.4ms)\nCompleted 200 OK in 692ms (Views: 32.2ms)\n```\n\nPumaを止めたいときは「Ctrl-C」で。\n\n　\n### 【７】コントローラとルーティング設定をちょこっといじってみる\n---\n\nせっかくなので、アプリケーションをちょこっといじって表示させてみる。\n\n今回はアプリケーションを、Dockerのホスト（Mac側）との共有フォルダに作成したので、Macのエディタで編集できる。\n\n① 既存のコントローラに、アクションメソッドを追加してみる\n\nここでは、Visual Studio Code 等のエディターで、アプリケーションのフォルダを開いて、以下のファイルを編集する。\nそして、hello という、\"nya---!\" と表示するだけのアクションメソッドを定義してみる。\n\n「app/controllers/application_controller.rb」\n\n```ruby\nclass ApplicationController \u003c ActionController::Base\n  protect_from_forgery with: :exception\n\n  # hello というアクションメソッドを追加ニャー！\n  def hello\n    render html: \"nya---!\"\n  end\n\nend\n```\n\n② TOPページを変更\n\nいわゆる「ルーティング」の設定を編集して、上記の①で追加したアクションがルート（ / でアクセスされるTOPページ）になるように変更してみる\n\n以下のファイルを編集する。\n\n「config/routes.rb」\n\n```ruby\nRails.application.routes.draw do\n  # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\n\n  # 「application」コントローラの「hello」アクションをルートとして設定する\n  root 'application#hello'\n  \nend\n```\n\n③ んでー、表示確認\n\nPumaを停止している場合は、再度起動する\n\n```bash\ncd /docker-host/share/webapps/hello_app/\nrails server\n```\n\nで、ブラウザから確認。\nhttp://localhost:3000/\n↓\nnya---!\n\n\n　\nオッケー！\nあまり進捗はないが、Railsアプリケーションの一端に触れることができた。\n今日はここまで！！\n\n","coediting":false,"created_at":"2017-05-17T22:30:46+09:00","group":null,"id":"8e7feac358d9ba4cca26","private":false,"tags":[{"name":"Ruby","versions":[]},{"name":"Rails","versions":[]},{"name":"Rails5","versions":[]}],"title":"[Ruby入門 Rails5編] 02. Railsアプリケーションの概要","updated_at":"2017-05-17T22:30:46+09:00","url":"http://qiita.com/prgseek/items/8e7feac358d9ba4cca26","user":{"description":null,"facebook_id":null,"followees_count":4,"followers_count":2,"github_login_name":null,"id":"prgseek","items_count":25,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":74523,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/74523/profile-images/1473699865","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003eDBIx::Connector\u003cbr\u003e\n\u003ca href=\"http://search.cpan.org/dist/DBIx-Connector/lib/DBIx/Connector.pm\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://search.cpan.org/dist/DBIx-Connector/lib/DBIx/Connector.pm\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eDBIx :: Connectorは、迅速かつ安全なDBI接続とトランザクション管理のためのシンプルなインターフェイスを提供します。データベースへの接続は高価なことが多いです。クエリを実行する必要があるたびにアプリケーションを再接続する必要はありません。そのオーバーヘッドを最小限に抑えるために、効率的なことは、データベースへの接続を維持するためにデータベースハンドルをつかんでおくことです。 DBIx::Connectorを使用すると、接続の破損や破損を心配する必要がなくなります。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e  use DBIx::Connector;\n\n  # Create a connection.\n  my $conn = DBIx::Connector-\u0026gt;new($dsn, $username, $password, {\n      RaiseError =\u0026gt; 1,\n      AutoCommit =\u0026gt; 1,\n  });\n\n  # Get the database handle and do something with it.\n  my $dbh  = $conn-\u0026gt;dbh;\n  $dbh-\u0026gt;do('INSERT INTO foo (name) VALUES (?)', undef, 'Fred' );\n\n  # Do something with the handle more efficiently.\n  $conn-\u0026gt;run(fixup =\u0026gt; sub {\n      $_-\u0026gt;do('INSERT INTO foo (name) VALUES (?)', undef, 'Fred' );\n  });\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"DBIx::Connector\nhttp://search.cpan.org/dist/DBIx-Connector/lib/DBIx/Connector.pm\n\n\u003e\nDBIx :: Connectorは、迅速かつ安全なDBI接続とトランザクション管理のためのシンプルなインターフェイスを提供します。データベースへの接続は高価なことが多いです。クエリを実行する必要があるたびにアプリケーションを再接続する必要はありません。そのオーバーヘッドを最小限に抑えるために、効率的なことは、データベースへの接続を維持するためにデータベースハンドルをつかんでおくことです。 DBIx::Connectorを使用すると、接続の破損や破損を心配する必要がなくなります。\n\n```\n  use DBIx::Connector;\n\n  # Create a connection.\n  my $conn = DBIx::Connector-\u003enew($dsn, $username, $password, {\n      RaiseError =\u003e 1,\n      AutoCommit =\u003e 1,\n  });\n\n  # Get the database handle and do something with it.\n  my $dbh  = $conn-\u003edbh;\n  $dbh-\u003edo('INSERT INTO foo (name) VALUES (?)', undef, 'Fred' );\n\n  # Do something with the handle more efficiently.\n  $conn-\u003erun(fixup =\u003e sub {\n      $_-\u003edo('INSERT INTO foo (name) VALUES (?)', undef, 'Fred' );\n  });\n```\n","coediting":false,"created_at":"2017-05-17T22:29:05+09:00","group":null,"id":"19378f1ce84b8f93a85e","private":false,"tags":[{"name":"Perl","versions":[]},{"name":"プログラミング","versions":[]},{"name":"データベース","versions":[]},{"name":"cpan","versions":[]},{"name":"ITエンジニアお役立ち","versions":[]}],"title":"DBIx::Connector - 迅速で安全なDBI接続とトランザクション管理【Perlモジュール紹介】","updated_at":"2017-05-17T22:29:05+09:00","url":"http://qiita.com/yukikimoto/items/19378f1ce84b8f93a85e","user":{"description":"","facebook_id":"yukikimoto4","followees_count":123,"followers_count":36,"github_login_name":"yuki-kimoto","id":"yukikimoto","items_count":164,"linkedin_id":"","location":"東京","name":"木本 裕紀","organization":"","permanent_id":155418,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/155418/profile-images/1481942273","twitter_screen_name":"yukikimoto2","website_url":"http://d.hatena.ne.jp/perlcodesample/"}},{"rendered_body":"\u003cp\u003eDBIx::QueryLog\u003cbr\u003e\n\u003ca href=\"http://search.cpan.org/~xaicron/DBIx-QueryLog-0.32/lib/DBIx/QueryLog.pm\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://search.cpan.org/~xaicron/DBIx-QueryLog-0.32/lib/DBIx/QueryLog.pm\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eDBIx::QueryLogは各実行時間と実際のクエリを記録します。現在、DBD::mysql、DBD::Pg、DBD::sqliteで動作します。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e  use DBIx::QueryLog;\n  my $row = $dbh-\u0026gt;selectrow_hashref('SELECT * FROM people WHERE user_id = ?', undef, qw/1986/);\n  # =\u0026gt; SELECT * FROM people WHERE user_id = '1986';\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"DBIx::QueryLog\nhttp://search.cpan.org/~xaicron/DBIx-QueryLog-0.32/lib/DBIx/QueryLog.pm\n\n\u003eDBIx::QueryLogは各実行時間と実際のクエリを記録します。現在、DBD::mysql、DBD::Pg、DBD::sqliteで動作します。\n\n```\n  use DBIx::QueryLog;\n  my $row = $dbh-\u003eselectrow_hashref('SELECT * FROM people WHERE user_id = ?', undef, qw/1986/);\n  # =\u003e SELECT * FROM people WHERE user_id = '1986';\n```\n","coediting":false,"created_at":"2017-05-17T22:24:40+09:00","group":null,"id":"8494602a50eec4aad0c9","private":false,"tags":[{"name":"Perl","versions":[]},{"name":"プログラミング","versions":[]},{"name":"データベース","versions":[]},{"name":"cpan","versions":[]},{"name":"ITエンジニアお役立ち","versions":[]}],"title":"DBIx::QueryLog - DBIのクエリのロギング【Perlモジュール紹介】","updated_at":"2017-05-17T22:29:27+09:00","url":"http://qiita.com/yukikimoto/items/8494602a50eec4aad0c9","user":{"description":"","facebook_id":"yukikimoto4","followees_count":123,"followers_count":36,"github_login_name":"yuki-kimoto","id":"yukikimoto","items_count":164,"linkedin_id":"","location":"東京","name":"木本 裕紀","organization":"","permanent_id":155418,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/155418/profile-images/1481942273","twitter_screen_name":"yukikimoto2","website_url":"http://d.hatena.ne.jp/perlcodesample/"}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"リンク\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%83%B3%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリンク\u003c/h1\u003e\n\n\u003cp\u003eこの記事は、次の記事と相互リンクです。\u003cbr\u003e\n\u003ca href=\"http://qiita.com/standard-software/items/785e3c27865a8e8d0b92#_reference-592e100b6df0ed455312\" id=\"reference-ba9ae5a986acc6e4d10a\"\u003eVisual Studio Code から外部エディタを開く。 - Qiita\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eVisual Stusio Code (VSCode) を、EmEditor から開く例です。\u003cbr\u003e\nEmEditorの外部エディタとして、VSCodeを、カーソル(キャレット)のある行を維持したまま起動できます。\u003c/p\u003e\n\n\u003cp\u003e他のエディタからでも、コマンドを呼び出せるなら、同じやり方で動かせるでしょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"設定は次の通り\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9A%E3%81%AF%E6%AC%A1%E3%81%AE%E9%80%9A%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定は次の通り\u003c/h1\u003e\n\n\u003cp\u003eEmEditorの外部ツールに登録してください。\u003c/p\u003e\n\n\u003cp\u003e| 設定名  | 内容 |\u003cbr\u003e\n|- | - |\u003cbr\u003e\n| タイトル: | VSCodeでこのファイルを開く |\u003cbr\u003e\n|コマンド: | C:\\Program Files (x86)\\Microsoft VS Code\\Code.exe|\u003cbr\u003e\n|引数: |. -r -g \"$(Path)\":$(CurLine):$(CurCol)|\u003cbr\u003e\n|初期ディレクトリ: |$(Dir)|\u003c/p\u003e\n\n\u003cp\u003eVSCodeは基本的にフォルダ単位でプロジェクトとして扱うので、初期ディレクトリの設定をしないと、ファイルは開いているけどプロジェクトは開けてない、という状態でいまいちになるので、しっかりと初期ディレクトリも設定しておいてください。\u003c/p\u003e\n\n\u003cp\u003eあと、Code.exe はパスが通っているので、フォルダパスなしの、Code.exe とか Code とかでもいいのかな、と思って試してみたらだめでした。フルパスで設定してください。これはEmEditor側の制限だと思います。\u003c/p\u003e\n\n\u003cp\u003eあと、エディタによっては、引数に列を渡せないようなものもあると思いますので、そこは適切に調整してみてください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考にした記事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E8%A8%98%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考にした記事\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://sourcechord.hatenablog.com/entry/2015/07/17/222937\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVSCodeをVSから開く - SourceChord\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# リンク\nこの記事は、次の記事と相互リンクです。\n[Visual Studio Code から外部エディタを開く。 - Qiita](http://qiita.com/standard-software/items/785e3c27865a8e8d0b92#_reference-592e100b6df0ed455312)\n\n# はじめに\nVisual Stusio Code (VSCode) を、EmEditor から開く例です。\nEmEditorの外部エディタとして、VSCodeを、カーソル(キャレット)のある行を維持したまま起動できます。\n\n他のエディタからでも、コマンドを呼び出せるなら、同じやり方で動かせるでしょう。\n\n\n# 設定は次の通り\nEmEditorの外部ツールに登録してください。\n\n| 設定名  | 内容 |\n|- | - |\n| タイトル: | VSCodeでこのファイルを開く |\n|コマンド: | C:\\Program Files (x86)\\Microsoft VS Code\\Code.exe|\n|引数: |. -r -g \"$(Path)\":$(CurLine):$(CurCol)|\n|初期ディレクトリ: |$(Dir)|\n\nVSCodeは基本的にフォルダ単位でプロジェクトとして扱うので、初期ディレクトリの設定をしないと、ファイルは開いているけどプロジェクトは開けてない、という状態でいまいちになるので、しっかりと初期ディレクトリも設定しておいてください。\n\nあと、Code.exe はパスが通っているので、フォルダパスなしの、Code.exe とか Code とかでもいいのかな、と思って試してみたらだめでした。フルパスで設定してください。これはEmEditor側の制限だと思います。\n\nあと、エディタによっては、引数に列を渡せないようなものもあると思いますので、そこは適切に調整してみてください。\n\n\n# 参考にした記事\n\n* [VSCodeをVSから開く - SourceChord](http://sourcechord.hatenablog.com/entry/2015/07/17/222937)\n","coediting":false,"created_at":"2017-05-17T22:23:53+09:00","group":null,"id":"189241606d32d3cd956d","private":false,"tags":[{"name":"code","versions":[]},{"name":"Studio","versions":[]},{"name":"Visual","versions":[]}],"title":"Visual Studio Code を外部エディタから開く。","updated_at":"2017-05-17T23:52:08+09:00","url":"http://qiita.com/standard-software/items/189241606d32d3cd956d","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":1,"github_login_name":"standard-software","id":"standard-software","items_count":7,"linkedin_id":"","location":"Tokyo","name":"","organization":"Standard Software","permanent_id":96423,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/96423/profile-images/1494598363","twitter_screen_name":null,"website_url":"https://www.facebook.com/stndardsoftware/"}},{"rendered_body":"\u003cp\u003emysqldiff\u003cbr\u003e\n\u003ca href=\"http://search.cpan.org/dist/MySQL-Diff/bin/mysqldiff\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://search.cpan.org/dist/MySQL-Diff/bin/mysqldiff\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003emysqldiffは、2つのMySQLデータベースのデータ構造（つまり、スキーマ/テーブル定義）を比較するCPANモジュールMySQL::DiffのPerlスクリプトフロントエンドです。mysqlにパイプでわたすために、第1のデータベースの構造と第2のデータベースの構造の差分をMySQLコマンドとして返します。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e    mysqldiff [B\u0026lt;options\u0026gt;] B\u0026lt;database1\u0026gt; B\u0026lt;database2\u0026gt;\n\n    mysqldiff --help\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"mysqldiff\nhttp://search.cpan.org/dist/MySQL-Diff/bin/mysqldiff\n\n\u003emysqldiffは、2つのMySQLデータベースのデータ構造（つまり、スキーマ/テーブル定義）を比較するCPANモジュールMySQL::DiffのPerlスクリプトフロントエンドです。mysqlにパイプでわたすために、第1のデータベースの構造と第2のデータベースの構造の差分をMySQLコマンドとして返します。\n\n```\n    mysqldiff [B\u003coptions\u003e] B\u003cdatabase1\u003e B\u003cdatabase2\u003e\n\n    mysqldiff --help\n```\n","coediting":false,"created_at":"2017-05-17T22:21:14+09:00","group":null,"id":"ccd4b6cb29a65026b7fd","private":false,"tags":[{"name":"Perl","versions":[]},{"name":"MySQL","versions":[]},{"name":"プログラミング","versions":[]},{"name":"cpan","versions":[]},{"name":"ITエンジニアお役立ち","versions":[]}],"title":"mysqldiff - MySQLデータベースのスキーマを比較する【Perlモジュール紹介】","updated_at":"2017-05-17T22:21:14+09:00","url":"http://qiita.com/yukikimoto/items/ccd4b6cb29a65026b7fd","user":{"description":"","facebook_id":"yukikimoto4","followees_count":123,"followers_count":36,"github_login_name":"yuki-kimoto","id":"yukikimoto","items_count":164,"linkedin_id":"","location":"東京","name":"木本 裕紀","organization":"","permanent_id":155418,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/155418/profile-images/1481942273","twitter_screen_name":"yukikimoto2","website_url":"http://d.hatena.ne.jp/perlcodesample/"}},{"rendered_body":"\u003cp\u003e最近いろんなのが出てきて追いきれてなかったのでメモ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"vectorized-functionsとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vectorized-functions%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVectorized Functionsとは\u003c/h2\u003e\n\n\u003cp\u003edplyrには\u003ccode\u003emutate()\u003c/code\u003eや\u003ccode\u003etransmute()\u003c/code\u003eなど，新たな変数を作成する関数があります。多くの場合，元ある変数から計算(操作)して新たな変数を導くのですが，この計算(操作)に使える便利な関数たちをVectorized Funcitonsと呼ぶようです。\u003c/p\u003e\n\n\u003cp\u003eこれは\u003ca href=\"https://www.rstudio.com/resources/cheatsheets/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRStudioが公開しているチートシート群\u003c/a\u003eの中の，\u003cstrong\u003eData Transformation Cheat Sheet\u003c/strong\u003eの2ページ目に一覧があります\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" rel=\"footnote\" title=\"このチートシート群ですが，頻繁に更新されています。ちょっと前まではdplyr\u0026amp;tidyrだったのですが，区分すら変わってしまってます…\"\u003e1\u003c/a\u003e\u003c/sup\u003e。\u003c/p\u003e\n\n\u003cp\u003e今回はここに紹介してある関数を実際にテストしてみます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"関数一覧\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%A2%E6%95%B0%E4%B8%80%E8%A6%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e関数一覧\u003c/h2\u003e\n\n\u003cp\u003eチートシートの該当箇所にある関数は以下のとおりです:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e  オフセット(Offsets)\n\n\u003cul\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::lag()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::lead()\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e  累積集計(Cumulative Aggregates)\n\n\u003cul\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::cumall()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::cumany()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003ecummax()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003ecummin()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003ecumprod()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003ecumsum()\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e  ランキング(Rankings)\n\n\u003cul\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::cume_dist()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::dense_rank()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::min_rank()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::ntile()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::percent_rank()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::row_number()\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e  Math\n\n\u003cul\u003e\n\u003cli\u003e  \u003ccode\u003e+, -, *, /, %/%, %%\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003elog(), log2(), log10()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003e\u0026lt;, \u0026lt;=, \u0026gt;, \u0026gt;=, !=, ==\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e  その他(Misc)\n\n\u003cul\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::between()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::case_when()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::coalesce()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::if_else()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::na_if()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003epmax()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003epmin()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::recode()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ccode\u003edplyr::recode_factor()\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eただこれらのうち，オフセットと累積，そしてランキングはいわゆるWindow関数と呼ばれるもので，すでに非常にわかりやすい解説記事が以下にあります:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://qiita.com/matsuou1/items/db6e8c48fcfd791dd876\" id=\"reference-a00bc9979129919f569f\"\u003edplyrを使いこなす！Window関数編 - Qiita\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなので，これらについては終わりの方に参照リンクを紹介します\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" rel=\"footnote\" title=\"こちらの記事には，さらにローリング関数についても解説してあります。丁寧でわかりやすい説明があり，本当に感謝です。\"\u003e2\u003c/a\u003e\u003c/sup\u003e。また，Mathについては説明を省略します。従って，結局「その他」に区分されている関数について，実際にテストしていきます。\u003c/p\u003e\n\n\u003cp\u003e以下，この後使うパッケージとデータセットを準備します:\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"r\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kn\"\u003elibrary\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003edplyr\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  \u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  Attaching package: 'dplyr'\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  The following objects are masked from 'package:stats':\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  \u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;      filter, lag\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  The following objects are masked from 'package:base':\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  \u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;      intersect, setdiff, setequal, union\u003c/span\u003e\n\nx \u003cspan class=\"o\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan class=\"kt\"\u003edata.frame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  v1 \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  v2 \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kp\"\u003esample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e replace \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eTRUE\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n  v3 \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eLETTERS\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  v4 \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kp\"\u003esample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003eLETTERS\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e replace \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eTRUE\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n  v5 \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003eNA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\nglimpse\u003cspan class=\"p\"\u003e(\u003c/span\u003ex\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  Observations: 6\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  Variables: 5\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  $ v1 \u0026lt;int\u0026gt; 1, 2, 3, 4, 5, 6\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  $ v2 \u0026lt;int\u0026gt; 2, 1, 1, 1, 2, 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  $ v3 \u0026lt;fctr\u0026gt; A, B, C, D, E, F\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  $ v4 \u0026lt;fctr\u0026gt; B, A, B, B, A, B\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  $ v5 \u0026lt;int\u0026gt; 1, 2, 3, NA, 5, 6\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"between\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#between\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ebetween()\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e範囲を指定し，そこに収まるのであればTRUEを，そうでなければFALSEを返します:\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"r\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ex \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  select\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  mutate\u003cspan class=\"p\"\u003e(\u003c/span\u003eho \u003cspan class=\"o\"\u003e=\u003c/span\u003e between\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;    v1    ho\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  1  1 FALSE\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  2  2  TRUE\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  3  3  TRUE\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  4  4  TRUE\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  5  5 FALSE\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  6  6 FALSE\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e第一引数(\u003ccode\u003ex\u003c/code\u003e)が対象となる数値ベクトル(変数名)，第二引数(\u003ccode\u003eleft\u003c/code\u003e)が下限，第三引数(\u003ccode\u003eright\u003c/code\u003e)が上限となります。なお\u003cstrong\u003e上限と下限に指定した値を含みます\u003c/strong\u003e(つまりは\u003ccode\u003e\u0026gt;=\u003c/code\u003eと\u003ccode\u003e\u0026lt;=\u003c/code\u003e)。\u003c/p\u003e\n\n\u003cp\u003eどちらかというと\u003ccode\u003efilter()\u003c/code\u003eの中で使う場面が多いかと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"if_else\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#if_else\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eif_else()\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003ebaseの\u003ccode\u003eifelse()\u003c/code\u003eと同様ですが，こちらのほうがより厳密で，trueの時の処理内容とfalseの時の処理内容をチェックして，同じ型で同じclassかどうかをみるようです。あとこちらには引数に\u003ccode\u003emissing\u003c/code\u003eがあり，欠損値への処理が可能です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"r\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ex \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  select\u003cspan class=\"p\"\u003e(\u003c/span\u003ev5\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  mutate\u003cspan class=\"p\"\u003e(\u003c/span\u003eho \u003cspan class=\"o\"\u003e=\u003c/span\u003e if_else\u003cspan class=\"p\"\u003e(\u003c/span\u003ev5 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003eNA_integer_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e v5\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n         fu \u003cspan class=\"o\"\u003e=\u003c/span\u003e if_else\u003cspan class=\"p\"\u003e(\u003c/span\u003ev5 \u003cspan class=\"o\"\u003e%%\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"fizz\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \n         \u003cspan class=\"kc\"\u003epi\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e if_else\u003cspan class=\"p\"\u003e(\u003c/span\u003ev5 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"high\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"low\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"missing\"\u003c/span\u003e \u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;    v5 ho   fu      pi\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  1  1  1          low\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  2  2  2          low\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  3  3  3 fizz     low\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  4 NA NA \u0026lt;NA\u0026gt; missing\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  5  5 NA          low\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  6  6 NA fizz    high\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"coalesce\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#coalesce\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ecoalesce()\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e「指定したベクトルのセットから，各行で欠損じゃない最初の値を見つけてきて持ってくる」という仕事をします。SQLの\u003ccode\u003eCOALESCE\u003c/code\u003e関数からインスパイアされたものだそうです:\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"r\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ex \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  select\u003cspan class=\"p\"\u003e(\u003c/span\u003ev5\u003cspan class=\"p\"\u003e,\u003c/span\u003e v2\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  mutate\u003cspan class=\"p\"\u003e(\u003c/span\u003eho \u003cspan class=\"o\"\u003e=\u003c/span\u003e coalesce\u003cspan class=\"p\"\u003e(\u003c/span\u003ev5\u003cspan class=\"p\"\u003e,\u003c/span\u003e v2\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;    v5 v2 ho\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  1  1  2  1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  2  2  1  2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  3  3  1  3\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  4 NA  1  1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  5  5  2  5\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  6  6  2  6\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのコードの場合，v5には4行目にNAがあります。そこでセットにされているベクトル(v5とv4)で，左から順にNAではない値を探しに行き，ヒットした値を持ってきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"na_if\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#na_if\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ena_if()\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e条件に合致した値をNAにします:\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"r\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ex \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  select\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e v3\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  mutate\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    ho \u003cspan class=\"o\"\u003e=\u003c/span\u003e na_if\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    fu \u003cspan class=\"o\"\u003e=\u003c/span\u003e na_if\u003cspan class=\"p\"\u003e(\u003c/span\u003ev3\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"D\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"kc\"\u003epi\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e na_if\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kp\"\u003erep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;    v1 v3 ho   fu pi\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  1  1  A  1    A NA\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  2  2  B  2    B NA\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  3  3  C NA    C NA\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  4  4  D  4 \u0026lt;NA\u0026gt;  4\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  5  5  E  5    E  5\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  6  6  F  6    F  6\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e第二引数には単一の値，もしくは第一引数と同一の長さのベクトルを指定します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"pmax-pmin\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pmax-pmin\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003epmax()\u003c/code\u003e, \u003ccode\u003epmin()\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e並行比較して，最大(or最小)最小を返してきます:\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"r\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ex \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  select\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e v2\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  mutate\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    ho \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kp\"\u003epmax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    fu \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kp\"\u003epmin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e6\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"kc\"\u003epi\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kp\"\u003epmax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e v2\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    ga \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kp\"\u003epmin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e v2\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;    v1 v2 ho fu pi ga\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  1  1  2  6  1  4  1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  2  2  1  5  2  4  1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  3  3  1  4  3  4  1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  4  4  1  4  3  4  1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  5  5  2  5  2  5  2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  6  6  2  6  1  6  2\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e要するに，引数で指定したベクトルを束ね，横方向で見ていって最大(or最小)の値を持ってくる，という仕事をします。\u003cstrong\u003eベクトルの長さが合わない場合は要素を再利用\u003c/strong\u003eすることに注意してください。このあたりの挙動はbaseの関数って感じです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"recode-recode_factor\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#recode-recode_factor\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003erecode()\u003c/code\u003e, \u003ccode\u003erecode_factor()\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e該当する値を書き換えます:\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"r\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ex \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  select\u003cspan class=\"p\"\u003e(\u003c/span\u003ev5\u003cspan class=\"p\"\u003e,\u003c/span\u003e v3\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  mutate\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    ho \u003cspan class=\"o\"\u003e=\u003c/span\u003e recode\u003cspan class=\"p\"\u003e(\u003c/span\u003ev3\u003cspan class=\"p\"\u003e,\u003c/span\u003e A \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"kosaki\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    fu \u003cspan class=\"o\"\u003e=\u003c/span\u003e recode\u003cspan class=\"p\"\u003e(\u003c/span\u003ev3\u003cspan class=\"p\"\u003e,\u003c/span\u003e A \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"kosaki\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e.\u003c/span\u003edefault \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"xxx\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"kc\"\u003epi\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e recode\u003cspan class=\"p\"\u003e(\u003c/span\u003ev5\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"sb\"\u003e`5`\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e55L\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"sb\"\u003e`6`\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e66L\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e.\u003c/span\u003edefault \u003cspan class=\"o\"\u003e=\u003c/span\u003e v5\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    ga \u003cspan class=\"o\"\u003e=\u003c/span\u003e recode\u003cspan class=\"p\"\u003e(\u003c/span\u003ev5\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"sb\"\u003e`5`\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e55L\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"sb\"\u003e`6`\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e66L\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e.\u003c/span\u003edefault \u003cspan class=\"o\"\u003e=\u003c/span\u003e v5\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e.\u003c/span\u003emissing \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e-1L\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;    v5 v3     ho     fu pi ga\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  1  1  A kosaki kosaki  1  1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  2  2  B      B    xxx  2  2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  3  3  C      C    xxx  3  3\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  4 NA  D      D    xxx NA -1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  5  5  E      E    xxx 55 55\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  6  6  F      F    xxx 66 66\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e見てのとおりです。なお，factor型向けに\u003ccode\u003erecode_factor()\u003c/code\u003eがあるのですが，関数のヘルプドキュメントにあるとおりforcatsパッケージを使っていったほうがいいでしょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"case_when\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#case_when\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ecase_when()\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eif_else()\u003c/code\u003eの複数ケースで，まとめてできます:\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"r\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ex \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  select\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e v4\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u0026gt;%\u003c/span\u003e \n  mutate\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    ho \u003cspan class=\"o\"\u003e=\u003c/span\u003e case_when\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      v1 \u003cspan class=\"o\"\u003e%%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Even\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      v1 \u003cspan class=\"o\"\u003e%%\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Odd\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    fu \u003cspan class=\"o\"\u003e=\u003c/span\u003e case_when\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      v1 \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e v1 \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e-1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      between\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"kp\"\u003eas.numeric\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003ev1\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"kc\"\u003eTRUE\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e v1 \u003cspan class=\"o\"\u003e^\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"kc\"\u003epi\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e case_when\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      v4 \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"s\"\u003e\"kosaki\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    yo \u003cspan class=\"o\"\u003e=\u003c/span\u003e case_when\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      v4 \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"s\"\u003e\"kosaki\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"kc\"\u003eTRUE\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"kp\"\u003eas.character\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003ev4\u003cspan class=\"p\"\u003e)\u003c/span\u003e      \n    \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    ga \u003cspan class=\"o\"\u003e=\u003c/span\u003e case_when\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"kc\"\u003eTRUE\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"kp\"\u003eas.character\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003ev4\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      v4 \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"A\"\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e \u003cspan class=\"s\"\u003e\"kosaki\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;    v1 v4   ho fu     pi     yo ga\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  1  1  B  Odd -1   \u0026lt;NA\u0026gt;      B  B\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  2  2  A Even -2 kosaki kosaki  A\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  3  3  B  Odd  3   \u0026lt;NA\u0026gt;      B  B\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  4  4  B Even  4   \u0026lt;NA\u0026gt;      B  B\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  5  5  A  Odd  5 kosaki kosaki  A\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#\u0026gt;  6  6  B Even 36   \u0026lt;NA\u0026gt;      B  B\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ecase_when()\u003c/code\u003eでは複数の条件を指定していくことができ，引数に論理式と置き換える値を記述していきます。この際，\u003ccode\u003e~\u003c/code\u003eを利用したformulaを使用します。\u003c/p\u003e\n\n\u003cp\u003eまた，論理式で拾えなかった要素については全て\u003ccode\u003eNA\u003c/code\u003eが返ってきます。なお，「それ以外」を指し示すのは\u003ccode\u003eTRUE\u003c/code\u003eで，上記のように\u003ccode\u003e~\u003c/code\u003eの左辺に記述すればOKです。\u003c/p\u003e\n\n\u003cp\u003e注意事項ですが，順番が重要で最初に書いてあるものが優先されます。yoとgaのコードと出力を比較してください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"オフセット関数累積関数ランキング関数について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AA%E3%83%95%E3%82%BB%E3%83%83%E3%83%88%E9%96%A2%E6%95%B0%E7%B4%AF%E7%A9%8D%E9%96%A2%E6%95%B0%E3%83%A9%E3%83%B3%E3%82%AD%E3%83%B3%E3%82%B0%E9%96%A2%E6%95%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eオフセット関数，累積関数，ランキング関数について\u003c/h2\u003e\n\n\u003cp\u003e先に紹介した記事にわかりやすい解説がありますので，そちらをぜひ参照してください:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e  \u003ca href=\"http://qiita.com/matsuou1/items/db6e8c48fcfd791dd876#offsetslead--lag\" id=\"reference-a00bc9979129919f569f\"\u003eオフセット関数\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ca href=\"http://qiita.com/matsuou1/items/db6e8c48fcfd791dd876#%E7%B4%AF%E7%A9%8D%E9%96%A2%E6%95%B0\" id=\"reference-a00bc9979129919f569f\"\u003e累積関数\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e  \u003ca href=\"http://qiita.com/matsuou1/items/db6e8c48fcfd791dd876#%E3%83%A9%E3%83%B3%E3%82%AD%E3%83%B3%E3%82%B0%E9%96%A2%E6%95%B0\" id=\"reference-a00bc9979129919f569f\"\u003eランキング関数\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"雑感\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9B%91%E6%84%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e雑感\u003c/h2\u003e\n\n\u003cp\u003eここで実際に取り上げた関数はすごく便利なものもあれば，使いどころが少ないけどいい仕事をするものもあったりして，できればおさておきたいところです。\u003c/p\u003e\n\n\u003cp\u003emutateはデータハンドリングでもかなりポイントになるので，これらの関数についてはできるだけさくっと使えるようになりたいですね。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eEnjoy!\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003eこのチートシート群ですが，頻繁に更新されています。ちょっと前まではdplyr\u0026amp;tidyrだったのですが，区分すら変わってしまってます… \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003eこちらの記事には，さらにローリング関数についても解説してあります。丁寧でわかりやすい説明があり，本当に感謝です。 \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","body":"最近いろんなのが出てきて追いきれてなかったのでメモ。\n\nVectorized Functionsとは\n------------------------\n\ndplyrには`mutate()`や`transmute()`など，新たな変数を作成する関数があります。多くの場合，元ある変数から計算(操作)して新たな変数を導くのですが，この計算(操作)に使える便利な関数たちをVectorized Funcitonsと呼ぶようです。\n\nこれは[RStudioが公開しているチートシート群](https://www.rstudio.com/resources/cheatsheets/)の中の，**Data Transformation Cheat Sheet**の2ページ目に一覧があります[^1]。\n\n今回はここに紹介してある関数を実際にテストしてみます。\n\n関数一覧\n--------\n\nチートシートの該当箇所にある関数は以下のとおりです:\n\n-   オフセット(Offsets)\n    -   `dplyr::lag()`\n    -   `dplyr::lead()`\n-   累積集計(Cumulative Aggregates)\n    -   `dplyr::cumall()`\n    -   `dplyr::cumany()`\n    -   `cummax()`\n    -   `cummin()`\n    -   `cumprod()`\n    -   `cumsum()`\n-   ランキング(Rankings)\n    -   `dplyr::cume_dist()`\n    -   `dplyr::dense_rank()`\n    -   `dplyr::min_rank()`\n    -   `dplyr::ntile()`\n    -   `dplyr::percent_rank()`\n    -   `dplyr::row_number()`\n-   Math\n    -   `+, -, *, /, %/%, %%`\n    -   `log(), log2(), log10()`\n    -   `\u003c, \u003c=, \u003e, \u003e=, !=, ==`\n-   その他(Misc)\n    -   `dplyr::between()`\n    -   `dplyr::case_when()`\n    -   `dplyr::coalesce()`\n    -   `dplyr::if_else()`\n    -   `dplyr::na_if()`\n    -   `pmax()`\n    -   `pmin()`\n    -   `dplyr::recode()`\n    -   `dplyr::recode_factor()`\n\nただこれらのうち，オフセットと累積，そしてランキングはいわゆるWindow関数と呼ばれるもので，すでに非常にわかりやすい解説記事が以下にあります:\n\n[dplyrを使いこなす！Window関数編 - Qiita](http://qiita.com/matsuou1/items/db6e8c48fcfd791dd876)\n\nなので，これらについては終わりの方に参照リンクを紹介します[^2]。また，Mathについては説明を省略します。従って，結局「その他」に区分されている関数について，実際にテストしていきます。\n\n以下，この後使うパッケージとデータセットを準備します:\n\n``` r\nlibrary(dplyr)\n#\u003e  \n#\u003e  Attaching package: 'dplyr'\n#\u003e  The following objects are masked from 'package:stats':\n#\u003e  \n#\u003e      filter, lag\n#\u003e  The following objects are masked from 'package:base':\n#\u003e  \n#\u003e      intersect, setdiff, setequal, union\n\nx \u003c- data.frame(\n  v1 = 1:6,\n  v2 = sample(1:2, 6, replace = TRUE),\n  v3 = LETTERS[1:6],\n  v4 = sample(LETTERS[1:2], 6, replace = TRUE),\n  v5 = c(1:3, NA, 5:6)\n)\n\nglimpse(x)\n#\u003e  Observations: 6\n#\u003e  Variables: 5\n#\u003e  $ v1 \u003cint\u003e 1, 2, 3, 4, 5, 6\n#\u003e  $ v2 \u003cint\u003e 2, 1, 1, 1, 2, 2\n#\u003e  $ v3 \u003cfctr\u003e A, B, C, D, E, F\n#\u003e  $ v4 \u003cfctr\u003e B, A, B, B, A, B\n#\u003e  $ v5 \u003cint\u003e 1, 2, 3, NA, 5, 6\n```\n\n`between()`\n-----------\n\n範囲を指定し，そこに収まるのであればTRUEを，そうでなければFALSEを返します:\n\n``` r\nx %\u003e% \n  select(v1) %\u003e% \n  mutate(ho = between(v1, 2, 4))\n#\u003e    v1    ho\n#\u003e  1  1 FALSE\n#\u003e  2  2  TRUE\n#\u003e  3  3  TRUE\n#\u003e  4  4  TRUE\n#\u003e  5  5 FALSE\n#\u003e  6  6 FALSE\n```\n\n第一引数(`x`)が対象となる数値ベクトル(変数名)，第二引数(`left`)が下限，第三引数(`right`)が上限となります。なお**上限と下限に指定した値を含みます**(つまりは`\u003e=`と`\u003c=`)。\n\nどちらかというと`filter()`の中で使う場面が多いかと思います。\n\n`if_else()`\n-----------\n\nbaseの`ifelse()`と同様ですが，こちらのほうがより厳密で，trueの時の処理内容とfalseの時の処理内容をチェックして，同じ型で同じclassかどうかをみるようです。あとこちらには引数に`missing`があり，欠損値への処理が可能です。\n\n``` r\nx %\u003e% \n  select(v5) %\u003e% \n  mutate(ho = if_else(v5 \u003e 3, NA_integer_, v5),\n         fu = if_else(v5 %% 3 == 0, \"fizz\", \"\"), \n         pi = if_else(v5 \u003e 5, \"high\", \"low\", \"missing\" ))\n#\u003e    v5 ho   fu      pi\n#\u003e  1  1  1          low\n#\u003e  2  2  2          low\n#\u003e  3  3  3 fizz     low\n#\u003e  4 NA NA \u003cNA\u003e missing\n#\u003e  5  5 NA          low\n#\u003e  6  6 NA fizz    high\n```\n\n`coalesce()`\n------------\n\n「指定したベクトルのセットから，各行で欠損じゃない最初の値を見つけてきて持ってくる」という仕事をします。SQLの`COALESCE`関数からインスパイアされたものだそうです:\n\n``` r\nx %\u003e% \n  select(v5, v2) %\u003e% \n  mutate(ho = coalesce(v5, v2))\n#\u003e    v5 v2 ho\n#\u003e  1  1  2  1\n#\u003e  2  2  1  2\n#\u003e  3  3  1  3\n#\u003e  4 NA  1  1\n#\u003e  5  5  2  5\n#\u003e  6  6  2  6\n```\n\nこのコードの場合，v5には4行目にNAがあります。そこでセットにされているベクトル(v5とv4)で，左から順にNAではない値を探しに行き，ヒットした値を持ってきます。\n\n`na_if()`\n---------\n\n条件に合致した値をNAにします:\n\n``` r\nx %\u003e% \n  select(v1, v3) %\u003e% \n  mutate(\n    ho = na_if(v1, 3),\n    fu = na_if(v3, \"D\"),\n    pi = na_if(v1, rep(1:3, 2))\n  )\n#\u003e    v1 v3 ho   fu pi\n#\u003e  1  1  A  1    A NA\n#\u003e  2  2  B  2    B NA\n#\u003e  3  3  C NA    C NA\n#\u003e  4  4  D  4 \u003cNA\u003e  4\n#\u003e  5  5  E  5    E  5\n#\u003e  6  6  F  6    F  6\n```\n\n第二引数には単一の値，もしくは第一引数と同一の長さのベクトルを指定します。\n\n`pmax()`, `pmin()`\n------------------\n\n並行比較して，最大(or最小)最小を返してきます:\n\n``` r\nx %\u003e% \n  select(v1, v2) %\u003e% \n  mutate(\n    ho = pmax(v1, 6:1),\n    fu = pmin(v1, 6:1),\n    pi = pmax(v1, v2, 4),\n    ga = pmin(v1, v2, 4)\n  )\n#\u003e    v1 v2 ho fu pi ga\n#\u003e  1  1  2  6  1  4  1\n#\u003e  2  2  1  5  2  4  1\n#\u003e  3  3  1  4  3  4  1\n#\u003e  4  4  1  4  3  4  1\n#\u003e  5  5  2  5  2  5  2\n#\u003e  6  6  2  6  1  6  2\n```\n\n要するに，引数で指定したベクトルを束ね，横方向で見ていって最大(or最小)の値を持ってくる，という仕事をします。**ベクトルの長さが合わない場合は要素を再利用**することに注意してください。このあたりの挙動はbaseの関数って感じです。\n\n`recode()`, `recode_factor()`\n-----------------------------\n\n該当する値を書き換えます:\n\n``` r\nx %\u003e% \n  select(v5, v3) %\u003e% \n  mutate(\n    ho = recode(v3, A = \"kosaki\"),\n    fu = recode(v3, A = \"kosaki\", .default = \"xxx\"),\n    pi = recode(v5, `5` = 55L, `6` = 66L, .default = v5),\n    ga = recode(v5, `5` = 55L, `6` = 66L, .default = v5, .missing = -1L)\n  )\n#\u003e    v5 v3     ho     fu pi ga\n#\u003e  1  1  A kosaki kosaki  1  1\n#\u003e  2  2  B      B    xxx  2  2\n#\u003e  3  3  C      C    xxx  3  3\n#\u003e  4 NA  D      D    xxx NA -1\n#\u003e  5  5  E      E    xxx 55 55\n#\u003e  6  6  F      F    xxx 66 66\n```\n\n見てのとおりです。なお，factor型向けに`recode_factor()`があるのですが，関数のヘルプドキュメントにあるとおりforcatsパッケージを使っていったほうがいいでしょう。\n\n`case_when()`\n-------------\n\n`if_else()`の複数ケースで，まとめてできます:\n\n``` r\nx %\u003e% \n  select(v1, v4) %\u003e% \n  mutate(\n    ho = case_when(\n      v1 %% 2 == 0 ~ \"Even\",\n      v1 %% 2 == 1 ~ \"Odd\"\n    ),\n    fu = case_when(\n      v1 \u003c= 2 ~ v1 * -1,\n      between(v1, 3, 5) ~ as.numeric(v1),\n      TRUE ~ v1 ^ 2\n    ),\n    pi = case_when(\n      v4 == \"A\" ~ \"kosaki\"\n    ),\n    yo = case_when(\n      v4 == \"A\" ~ \"kosaki\",\n      TRUE ~ as.character(v4)      \n    ),\n    ga = case_when(\n      TRUE ~ as.character(v4),\n      v4 == \"A\" ~ \"kosaki\"\n    )\n  )\n#\u003e    v1 v4   ho fu     pi     yo ga\n#\u003e  1  1  B  Odd -1   \u003cNA\u003e      B  B\n#\u003e  2  2  A Even -2 kosaki kosaki  A\n#\u003e  3  3  B  Odd  3   \u003cNA\u003e      B  B\n#\u003e  4  4  B Even  4   \u003cNA\u003e      B  B\n#\u003e  5  5  A  Odd  5 kosaki kosaki  A\n#\u003e  6  6  B Even 36   \u003cNA\u003e      B  B\n```\n\n`case_when()`では複数の条件を指定していくことができ，引数に論理式と置き換える値を記述していきます。この際，`~`を利用したformulaを使用します。\n\nまた，論理式で拾えなかった要素については全て`NA`が返ってきます。なお，「それ以外」を指し示すのは`TRUE`で，上記のように`~`の左辺に記述すればOKです。\n\n注意事項ですが，順番が重要で最初に書いてあるものが優先されます。yoとgaのコードと出力を比較してください。\n\nオフセット関数，累積関数，ランキング関数について\n------------------------------------------------\n\n先に紹介した記事にわかりやすい解説がありますので，そちらをぜひ参照してください:\n\n-   [オフセット関数](http://qiita.com/matsuou1/items/db6e8c48fcfd791dd876#offsetslead--lag)\n-   [累積関数](http://qiita.com/matsuou1/items/db6e8c48fcfd791dd876#%E7%B4%AF%E7%A9%8D%E9%96%A2%E6%95%B0)\n-   [ランキング関数](http://qiita.com/matsuou1/items/db6e8c48fcfd791dd876#%E3%83%A9%E3%83%B3%E3%82%AD%E3%83%B3%E3%82%B0%E9%96%A2%E6%95%B0)\n\n雑感\n----\n\nここで実際に取り上げた関数はすごく便利なものもあれば，使いどころが少ないけどいい仕事をするものもあったりして，できればおさておきたいところです。\n\nmutateはデータハンドリングでもかなりポイントになるので，これらの関数についてはできるだけさくっと使えるようになりたいですね。\n\n**Enjoy!**\n\n[^1]: このチートシート群ですが，頻繁に更新されています。ちょっと前まではdplyr\u0026tidyrだったのですが，区分すら変わってしまってます…\n\n[^2]: こちらの記事には，さらにローリング関数についても解説してあります。丁寧でわかりやすい説明があり，本当に感謝です。\n","coediting":false,"created_at":"2017-05-17T22:08:40+09:00","group":null,"id":"083605af5f0c4da30b48","private":false,"tags":[{"name":"R","versions":[]},{"name":"dplyr","versions":[]}],"title":"dplyrのVectorized Functionsについて","updated_at":"2017-05-17T22:08:40+09:00","url":"http://qiita.com/kazutan/items/083605af5f0c4da30b48","user":{"description":"ただの残念なぞうさんです。同名のTwitterアカウントでほそぼそと。","facebook_id":"","followees_count":5,"followers_count":46,"github_login_name":"kazutan","id":"kazutan","items_count":69,"linkedin_id":"","location":"Hiroshima, Japan","name":"Maeda Kazuhiro","organization":"Hijiyama University","permanent_id":35118,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/35118/profile-images/1473686610","twitter_screen_name":"kazutan","website_url":"http://kz-md.net/"}},{"rendered_body":"\u003cp\u003e開発中に一部の機能を先行リリースして欲しいとの要望があり、gitについて調べてみると「cherry-pick」という便利なコマンドがあったので備忘録も含め、まとめたいと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cherry-pickとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cherry-pick%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003echerry-pickとは\u003c/h2\u003e\n\n\u003cp\u003eあるコミットの内容を任意のブランチに取り込むコマンド。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い方\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e#取り込みたいブランチに移動\ngit checkout \u0026lt;ブランチ名\u0026gt; \n\n#取り込みたいコミット内容のIDを指定\ngit cherry-pick \u0026lt;コミットID\u0026gt;\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"コンクリフトが発生する場合がある\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%95%E3%83%88%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%8C%E3%81%82%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコンクリフトが発生する場合がある\u003c/h1\u003e\n\n\u003cp\u003e無事に変更内容が取り込めたかと思えばコンクリフトが発生。\u003cbr\u003e\n「cherry-pick」コマンドを使用した際のコミット履歴は以下の通りとなります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eＡ―Ｃ'(master)\n　＼\n　　Ｂ―Ｃ(develop)\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eＡ：初期（「001.txt」の内容：\"a\"）\u003cbr\u003e\nコミットID：d5737ed658e4d75dd5b67cb7a26e2b52f7e399aa\u003c/p\u003e\n\n\u003cp\u003eＢ：「001.txt」に\"b\"を追記\u003cbr\u003e\nコミットID：8cfe601d9fb9b0420441a41907d580b5909ea3b3\u003c/p\u003e\n\n\u003cp\u003eＣ：「001.txt」に\"c\"を追記\u003cbr\u003e\nコミットID：9526e7a62cfa426adcaf0abd164e9cf6410ed47c\u003c/p\u003e\n\n\u003cp\u003eＣ'：Ｃをcherry-pick\u003cbr\u003e\nコミットID：fe8661427c7f57c06728b3eafcee58efed1f47f1\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コンクリフトが発生した手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%95%E3%83%88%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%97%E3%81%9F%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコンクリフトが発生した手順\u003c/h2\u003e\n\n\u003cp\u003e①「master」ブランチには001.txtというファイルがあります。\u003cbr\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e001.txt\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ea\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e②「master」ブランチを元に「develop」ブランチ作成。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003egit checkout master\ngit branch develop\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e③「develop」ブランチに切り替えて001.txtに\"b\"を追記。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003egit checkout develop\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e001.txt\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ea\nb\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e④コミット、プッシュし「develop」ブランチのリモートリポジトリに変更内容を適用。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003egit add 001.txt\ngit commit -m \"変更内容bを追記\"\ngit push origin develop\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e⑤さらに001.txtに\"c\"を追加し、上記と同様にコミット、プッシュ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e001.txt\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ea\nb\nc\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003egit add 001.txt\ngit commit -m \"変更内容cを追記\"\ngit push origin develop\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e⑥「master」ブランチにCの内容を取り込みたいので「master」ブランチに切り替え「cherry-pick」を行う。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003egit checkout master\ngit cherry-pick 9526e7a62cfa426adcaf0abd164e9cf6410ed47c\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コンクリフトが発生した理由\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%95%E3%83%88%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%97%E3%81%9F%E7%90%86%E7%94%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコンクリフトが発生した理由\u003c/h2\u003e\n\n\u003cp\u003e「cherry-pick」はあるコミットの変更内容を取り込むコマンドの為、上記の様にCの変更履歴がBに依存する関係の場合はコンクリフトが発生する。\u003cbr\u003e\n（ここが「merge」コマンドとは違う点。「merge」は変更履歴を含め取り込む。詳しくは「3wayマージ」で調べてみると分かると思います。）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おまけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおまけ\u003c/h1\u003e\n\n\u003cp\u003e複数のファイルでコンクリフトが発生した時に便利なコマンド。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003egit checkout --ours \u0026lt;ファイル名\u0026gt;\n⇒マージ元（チェックアウトしているブランチ側）\ngit checkout --theirs \u0026lt;ファイル名\u0026gt;\n⇒マージ先\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e半角スペースを空けることで複数のファイルを指定可能。\u003c/p\u003e\n","body":"開発中に一部の機能を先行リリースして欲しいとの要望があり、gitについて調べてみると「cherry-pick」という便利なコマンドがあったので備忘録も含め、まとめたいと思います。\n\n##cherry-pickとは\nあるコミットの内容を任意のブランチに取り込むコマンド。\n\n##使い方\n```\n#取り込みたいブランチに移動\ngit checkout \u003cブランチ名\u003e \n\n#取り込みたいコミット内容のIDを指定\ngit cherry-pick \u003cコミットID\u003e\n```\n#コンクリフトが発生する場合がある\n無事に変更内容が取り込めたかと思えばコンクリフトが発生。\n「cherry-pick」コマンドを使用した際のコミット履歴は以下の通りとなります。\n\n```\nＡ―Ｃ'(master)\n　＼\n　　Ｂ―Ｃ(develop)\n```\n\nＡ：初期（「001.txt」の内容：\"a\"）\nコミットID：d5737ed658e4d75dd5b67cb7a26e2b52f7e399aa\n\nＢ：「001.txt」に\"b\"を追記\nコミットID：8cfe601d9fb9b0420441a41907d580b5909ea3b3\n\nＣ：「001.txt」に\"c\"を追記\nコミットID：9526e7a62cfa426adcaf0abd164e9cf6410ed47c\n\nＣ'：Ｃをcherry-pick\nコミットID：fe8661427c7f57c06728b3eafcee58efed1f47f1\n\n##コンクリフトが発生した手順\n①「master」ブランチには001.txtというファイルがあります。\u003cbr/\u003e\n\n```text:001.txt\na\n```\n\n②「master」ブランチを元に「develop」ブランチ作成。\n\n```\ngit checkout master\ngit branch develop\n```\n\n③「develop」ブランチに切り替えて001.txtに\"b\"を追記。\n\n```\ngit checkout develop\n```\n\n```text:001.txt\na\nb\n```\n\n④コミット、プッシュし「develop」ブランチのリモートリポジトリに変更内容を適用。\n\n```\ngit add 001.txt\ngit commit -m \"変更内容bを追記\"\ngit push origin develop\n```\n\n⑤さらに001.txtに\"c\"を追加し、上記と同様にコミット、プッシュ。\n\n```text:001.txt\na\nb\nc\n```\n\n```\ngit add 001.txt\ngit commit -m \"変更内容cを追記\"\ngit push origin develop\n```\n\n⑥「master」ブランチにCの内容を取り込みたいので「master」ブランチに切り替え「cherry-pick」を行う。\n\n```\ngit checkout master\ngit cherry-pick 9526e7a62cfa426adcaf0abd164e9cf6410ed47c\n```\n\n##コンクリフトが発生した理由\n「cherry-pick」はあるコミットの変更内容を取り込むコマンドの為、上記の様にCの変更履歴がBに依存する関係の場合はコンクリフトが発生する。\n（ここが「merge」コマンドとは違う点。「merge」は変更履歴を含め取り込む。詳しくは「3wayマージ」で調べてみると分かると思います。）\n\n#おまけ\n複数のファイルでコンクリフトが発生した時に便利なコマンド。\n\n```\ngit checkout --ours \u003cファイル名\u003e\n⇒マージ元（チェックアウトしているブランチ側）\ngit checkout --theirs \u003cファイル名\u003e\n⇒マージ先\n```\n\n半角スペースを空けることで複数のファイルを指定可能。\n","coediting":false,"created_at":"2017-05-17T21:57:23+09:00","group":null,"id":"737f8974c3bdd9018d58","private":false,"tags":[{"name":"Git","versions":[]},{"name":"cherry-pick","versions":[]}],"title":"cherry-pickとコンクリフトについて","updated_at":"2017-05-17T22:00:24+09:00","url":"http://qiita.com/shiren/items/737f8974c3bdd9018d58","user":{"description":"エンジニアとして勉強中","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":null,"id":"shiren","items_count":1,"linkedin_id":"","location":"東京","name":"shiren","organization":"","permanent_id":181487,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/181487/profile-images/1494773508","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\n\u003ch2\u003e\n\u003cspan id=\"自己紹介\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%B7%B1%E7%B4%B9%E4%BB%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自己紹介\u003c/h2\u003e\n\n\u003cp\u003eプログラミング初心者です。\u003cbr\u003e\n使用OSは主にをwindows、開発環境はxamppでローカルサーバーを立ち上げての作業になります。\u003cbr\u003e\nHTML少々、CSS少々、JavaScript少々、PHP少々。と、どれも少々です。\u003cbr\u003e\nそんな私ですが、とりあえずものにしたいと思い手を付けたのが\u003cstrong\u003eWordPress\u003c/strong\u003e\u003cbr\u003e\nプログラミング超初心者なのでプログラミングを理解している方たちが説明しているサイトの説明の理解に苦しむことがありますｗ\u003cbr\u003e\n僕と同じように超初心者の方が始めるときにほんの少しだけでも参考になれば幸いです。\u003cbr\u003e\nお勉強のメインはドットインストールさんの動画を基点にネット検索などで行っていこうかと思っております。\u003cbr\u003e\n超々初心者なので間違った情報等ありましたら優しく教えていただけると嬉しいです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"functionsphpの編集\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#functionsphp%E3%81%AE%E7%B7%A8%E9%9B%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efunctions.phpの編集\u003c/h2\u003e\n\n\u003cp\u003e前回お話したmenuですが、こちらは管理画面からカスタマイズできるように\u003cstrong\u003efunctions.php\u003c/strong\u003eから編集するのが良いみたいですね。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"php\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003efunctions.php\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eadd_theme_support\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'menus'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eと記述することで管理画面からメニューを編集できるようになるみたいです。\u003cbr\u003e\nそして、この一文を加えるだけで管理画面(ダッシュボード)の外観に\u003cstrong\u003eメニュー\u003c/strong\u003eというものが追加されるようですね。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/155272/87f5ec41-cd5f-5465-6d98-321ac889b0f9.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/155272/87f5ec41-cd5f-5465-6d98-321ac889b0f9.png\" alt=\"themesconfig.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eそして、ここからは管理画面から編集できるようなので実際にやってみます。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eメニュー\u003c/strong\u003eから入ると赤枠で囲っている所にメニュー名を入力できるのでそこからメニュー名を入れていきます。\u003cbr\u003e\n今回は\u003cstrong\u003euka_menu\u003c/strong\u003eという名前にします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/155272/eb4703bb-40bf-d170-a65a-99b9a6d9c4f9.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/155272/eb4703bb-40bf-d170-a65a-99b9a6d9c4f9.png\" alt=\"kotei.png\"\u003e\u003c/a\u003e\u003cbr\u003e\n更にここから固定ページを追加します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/155272/102bd1f0-03e9-7c28-f320-2dfa8460aee2.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/155272/102bd1f0-03e9-7c28-f320-2dfa8460aee2.png\" alt=\"tohome.png\"\u003e\u003c/a\u003e\u003cbr\u003e\nそしてここからホームへのリンクを追加。\u003c/p\u003e\n\n\u003cp\u003eと、ここでひとまず画面右のメニュー保存を押すと操作したものが追加されます。\u003cbr\u003e\nそしてこれをテーマに反映させるためには\u003cstrong\u003eheader.php\u003c/strong\u003eの\u003cstrong\u003emenu\u003c/strong\u003eとして記述していたhtmlを編集します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"php\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eheader.php\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;!\u003c/span\u003e\u003cspan class=\"nx\"\u003eDOCTYPE\u003c/span\u003e \u003cspan class=\"nx\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ehtml\u003c/span\u003e \u003cspan class=\"nx\"\u003elang\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"ja\"\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ehead\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003emeta\u003c/span\u003e \u003cspan class=\"nx\"\u003echarset\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"utf-8\"\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"nx\"\u003ewp_title\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'|'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'right'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"nx\"\u003ebloginfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'name'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\u0026lt;/title\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e        \u0026lt;link rel=\"stylesheet\" type=\"text/css\" href=\"http://yui.yahooapis.com/3.18.1/build/cssreset/cssreset-min.css\"\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e        \u0026lt;link rel=\"stylesheet\" type=\"text/css\" href=\"\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nx\"\u003eget_stylesheet_uri\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\"\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e        \u0026lt;link href='https://fonts.googleapis.com/css?family=Black+Ops+One' rel='stylesheet' type='text/css'\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e    \u0026lt;/head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e    \u0026lt;body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e        \u0026lt;div id=\"header\" class=\"conteiner\"\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e            \u0026lt;h1\u0026gt;\u0026lt;a href=\"\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nx\"\u003ehome_url\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\"\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\"nx\"\u003ebloginfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'name'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\u0026lt;/a\u0026gt;\u0026lt;/h1\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e            \u0026lt;ul class=\"menu\"\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e                \u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\"nx\"\u003ewp_nav_menu\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\u003c/span\u003e\n\u003cspan class=\"x\"\u003e            \u0026lt;/ul\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e        \u0026lt;/div\u0026gt;\u0026lt;!-- header --\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれで今までは\u003cstrong\u003emenu1\u003c/strong\u003eとか\u003cstrong\u003emenu2\u003c/strong\u003eとかしか表示されていなかったメニューに先程管理画面から追加したメニューが追加されているそうですね。\u003cbr\u003e\nどうでしょう？表示を確認してみます。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/155272/dd27b53f-b9ae-0691-f9f8-88d465354a4d.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/155272/dd27b53f-b9ae-0691-f9f8-88d465354a4d.png\" alt=\"menu1.png\"\u003e\u003c/a\u003e\u003cbr\u003e\nハイ。失敗してます。\u003cbr\u003e\n先程追加したメニューは\u003cstrong\u003eプロフィール\u003c/strong\u003eと\u003cstrong\u003eホーム\u003c/strong\u003eのはず…\u003cbr\u003e\nですが、表示させてみると\u003cstrong\u003eプロフィール\u003c/strong\u003eだけ。しかも\u003cstrong\u003eホーム\u003c/strong\u003eが見当たりません…\u003cbr\u003e\nどこで間違ったのか探っていきます。。。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/155272/4918bea2-63ef-2757-253c-507615486c04.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/155272/4918bea2-63ef-2757-253c-507615486c04.png\" alt=\"markup.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれを見るとどうやらマークアップが間違っているっぽいですね。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"php\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eheader.php\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;!\u003c/span\u003e\u003cspan class=\"nx\"\u003eDOCTYPE\u003c/span\u003e \u003cspan class=\"nx\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ehtml\u003c/span\u003e \u003cspan class=\"nx\"\u003elang\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"ja\"\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ehead\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003emeta\u003c/span\u003e \u003cspan class=\"nx\"\u003echarset\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"utf-8\"\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"nx\"\u003ewp_title\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'|'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'right'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"nx\"\u003ebloginfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'name'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\u0026lt;/title\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e        \u0026lt;link rel=\"stylesheet\" type=\"text/css\" href=\"http://yui.yahooapis.com/3.18.1/build/cssreset/cssreset-min.css\"\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e        \u0026lt;link rel=\"stylesheet\" type=\"text/css\" href=\"\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nx\"\u003eget_stylesheet_uri\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\"\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e        \u0026lt;link href='https://fonts.googleapis.com/css?family=Black+Ops+One' rel='stylesheet' type='text/css'\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e    \u0026lt;/head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e    \u0026lt;body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e        \u0026lt;div id=\"header\" class=\"conteiner\"\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e            \u0026lt;h1\u0026gt;\u0026lt;a href=\"\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nx\"\u003ehome_url\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\"\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\"nx\"\u003ebloginfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'name'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\u0026lt;/a\u0026gt;\u0026lt;/h1\u0026gt;\u003c/span\u003e\n\u003cspan class=\"x\"\u003e            \u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\"nx\"\u003ewp_nav_menu\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\u003c/span\u003e\n\u003cspan class=\"x\"\u003e        \u0026lt;/div\u0026gt;\u0026lt;!-- header --\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eそうですね。またやらかしていました。。。\u003cbr\u003e\nそもそも\u003cstrong\u003emenu\u003c/strong\u003e用に作ったphpだったのに\u003cstrong\u003eul\u003c/strong\u003eをそのまま残してしまっていましたね。\u003cbr\u003e\n更に先程の管理画面から追加したメニューを保存するのを忘れていました。\u003cbr\u003e\nいやはやこんなにウッカリでいいのか⁉と思ってしまうくらいウッカリしまくりで情けないです(´;ω;｀)\u003cbr\u003e\nということでひとまずメニューの追加はうまくいきました。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/155272/1b979da1-b12b-542d-72a8-3891bb87fca9.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/155272/1b979da1-b12b-542d-72a8-3891bb87fca9.png\" alt=\"menu2.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eうまくいったところでドットインストールさんによると\u003cstrong\u003eheader.php\u003c/strong\u003eには必ず\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"php\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eheader.php\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\"nx\"\u003ewp_head\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"x\"\u003e\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eと追記しましょうとありましたので追記するとします。\u003cbr\u003e\nどうやらこれがないと動かないプラグインなんかがあるみたいですね。\u003c/p\u003e\n\n\u003cp\u003eと、今日は完全に僕のウッカリによるものでしたがハマりが多かったので続きのサイドバーの編集はまた次にしようかと思います。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://qiita.com/ukkari_ukachan/items/eda37ccf5b2569f12c9f\" id=\"reference-7ed2e062e3ec4c68efef\"\u003e\u0026lt;\u0026lt;プログラミング初心者、WordPress始めます！その４\u003c/a\u003e\u003c/p\u003e\n","body":"## 自己紹介\nプログラミング初心者です。\n使用OSは主にをwindows、開発環境はxamppでローカルサーバーを立ち上げての作業になります。\nHTML少々、CSS少々、JavaScript少々、PHP少々。と、どれも少々です。\nそんな私ですが、とりあえずものにしたいと思い手を付けたのが**WordPress**\nプログラミング超初心者なのでプログラミングを理解している方たちが説明しているサイトの説明の理解に苦しむことがありますｗ\n僕と同じように超初心者の方が始めるときにほんの少しだけでも参考になれば幸いです。\nお勉強のメインはドットインストールさんの動画を基点にネット検索などで行っていこうかと思っております。\n超々初心者なので間違った情報等ありましたら優しく教えていただけると嬉しいです。\n\n## functions.phpの編集\n前回お話したmenuですが、こちらは管理画面からカスタマイズできるように**functions.php**から編集するのが良いみたいですね。\n\n```php:functions.php\n\u003c?php\n\nadd_theme_support('menus');\n```\nと記述することで管理画面からメニューを編集できるようになるみたいです。\nそして、この一文を加えるだけで管理画面(ダッシュボード)の外観に**メニュー**というものが追加されるようですね。\n![themesconfig.png](https://qiita-image-store.s3.amazonaws.com/0/155272/87f5ec41-cd5f-5465-6d98-321ac889b0f9.png)\n\n\nそして、ここからは管理画面から編集できるようなので実際にやってみます。\n\n**メニュー**から入ると赤枠で囲っている所にメニュー名を入力できるのでそこからメニュー名を入れていきます。\n今回は**uka_menu**という名前にします。\n\n\n![kotei.png](https://qiita-image-store.s3.amazonaws.com/0/155272/eb4703bb-40bf-d170-a65a-99b9a6d9c4f9.png)\n更にここから固定ページを追加します。\n\n\n![tohome.png](https://qiita-image-store.s3.amazonaws.com/0/155272/102bd1f0-03e9-7c28-f320-2dfa8460aee2.png)\nそしてここからホームへのリンクを追加。\n\nと、ここでひとまず画面右のメニュー保存を押すと操作したものが追加されます。\nそしてこれをテーマに反映させるためには**header.php**の**menu**として記述していたhtmlを編集します。\n\n```php:header.php\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"ja\"\u003e\n    \u003chead\u003e\n        \u003cmeta charset=\"utf-8\"\u003e\n        \u003ctitle\u003e\u003c?php wp_title('|', true, 'right'); bloginfo('name'); ?\u003e\u003c/title\u003e\n        \u003clink rel=\"stylesheet\" type=\"text/css\" href=\"http://yui.yahooapis.com/3.18.1/build/cssreset/cssreset-min.css\"\u003e\n        \u003clink rel=\"stylesheet\" type=\"text/css\" href=\"\u003c?php echo get_stylesheet_uri(); ?\u003e\"\u003e\n    \t\u003clink href='https://fonts.googleapis.com/css?family=Black+Ops+One' rel='stylesheet' type='text/css'\u003e\n    \u003c/head\u003e\n    \u003cbody\u003e\n        \u003cdiv id=\"header\" class=\"conteiner\"\u003e\n            \u003ch1\u003e\u003ca href=\"\u003c?php echo home_url('/'); ?\u003e\"\u003e\u003c?php bloginfo('name'); ?\u003e\u003c/a\u003e\u003c/h1\u003e\n            \u003cul class=\"menu\"\u003e\n                \u003c?php wp_nav_menu(); ?\u003e\n            \u003c/ul\u003e\n        \u003c/div\u003e\u003c!-- header --\u003e\n```\nこれで今までは**menu1**とか**menu2**とかしか表示されていなかったメニューに先程管理画面から追加したメニューが追加されているそうですね。\nどうでしょう？表示を確認してみます。\n![menu1.png](https://qiita-image-store.s3.amazonaws.com/0/155272/dd27b53f-b9ae-0691-f9f8-88d465354a4d.png)\nハイ。失敗してます。\n先程追加したメニューは**プロフィール**と**ホーム**のはず…\nですが、表示させてみると**プロフィール**だけ。しかも**ホーム**が見当たりません…\nどこで間違ったのか探っていきます。。。\n\n![markup.png](https://qiita-image-store.s3.amazonaws.com/0/155272/4918bea2-63ef-2757-253c-507615486c04.png)\n\nこれを見るとどうやらマークアップが間違っているっぽいですね。\n\n```php:header.php\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"ja\"\u003e\n    \u003chead\u003e\n        \u003cmeta charset=\"utf-8\"\u003e\n        \u003ctitle\u003e\u003c?php wp_title('|', true, 'right'); bloginfo('name'); ?\u003e\u003c/title\u003e\n        \u003clink rel=\"stylesheet\" type=\"text/css\" href=\"http://yui.yahooapis.com/3.18.1/build/cssreset/cssreset-min.css\"\u003e\n        \u003clink rel=\"stylesheet\" type=\"text/css\" href=\"\u003c?php echo get_stylesheet_uri(); ?\u003e\"\u003e\n    \t\u003clink href='https://fonts.googleapis.com/css?family=Black+Ops+One' rel='stylesheet' type='text/css'\u003e\n    \u003c/head\u003e\n    \u003cbody\u003e\n        \u003cdiv id=\"header\" class=\"conteiner\"\u003e\n            \u003ch1\u003e\u003ca href=\"\u003c?php echo home_url('/'); ?\u003e\"\u003e\u003c?php bloginfo('name'); ?\u003e\u003c/a\u003e\u003c/h1\u003e\n            \u003c?php wp_nav_menu(); ?\u003e\n        \u003c/div\u003e\u003c!-- header --\u003e\n```\nそうですね。またやらかしていました。。。\nそもそも**menu**用に作ったphpだったのに**ul**をそのまま残してしまっていましたね。\n更に先程の管理画面から追加したメニューを保存するのを忘れていました。\nいやはやこんなにウッカリでいいのか⁉と思ってしまうくらいウッカリしまくりで情けないです(´;ω;｀)\nということでひとまずメニューの追加はうまくいきました。\n![menu2.png](https://qiita-image-store.s3.amazonaws.com/0/155272/1b979da1-b12b-542d-72a8-3891bb87fca9.png)\n\n\nうまくいったところでドットインストールさんによると**header.php**には必ず\n\n```php:header.php\n\u003c?php wp_head(); ?\u003e\n```\nと追記しましょうとありましたので追記するとします。\nどうやらこれがないと動かないプラグインなんかがあるみたいですね。\n\nと、今日は完全に僕のウッカリによるものでしたがハマりが多かったので続きのサイドバーの編集はまた次にしようかと思います。\n\n\n[\u003c\u003cプログラミング初心者、WordPress始めます！その４](http://qiita.com/ukkari_ukachan/items/eda37ccf5b2569f12c9f)\n","coediting":false,"created_at":"2017-05-17T21:52:30+09:00","group":null,"id":"4f3460e7086b4011e0e4","private":false,"tags":[{"name":"PHP","versions":[]},{"name":"HTML","versions":[]},{"name":"CSS","versions":[]},{"name":"WordPress","versions":[]}],"title":"プログラミング初心者、WordPress始めます！その５","updated_at":"2017-05-17T21:52:30+09:00","url":"http://qiita.com/ukkari_ukachan/items/4f3460e7086b4011e0e4","user":{"description":"プログラミングとは全く関係無い会社で勤めております。\r\nその中で前任者が作り上げたExcelVBA、HTML、CSS、JavaScript、PHPを使用した会社のシステム運用を行っております。\r\nプログラミングは初心者。\r\n基本的に運用は一人なので情報が偏っていたり間違っていた時は優しくご教授頂けると嬉しいです。\r\nTwitter：@ukkari_ukachan","facebook_id":"","followees_count":1,"followers_count":4,"github_login_name":null,"id":"ukkari_ukachan","items_count":6,"linkedin_id":"","location":"Ibaraki, Japan","name":"ukkari-ukachan","organization":"","permanent_id":155272,"profile_image_url":"https://pbs.twimg.com/profile_images/702458998843265024/KCfuFD6S_normal.jpg","twitter_screen_name":"ukkari_ukachan","website_url":""}},{"rendered_body":"\u003cp\u003e\u003ca href=\"http://qiita.com/Tatsuki-I/items/9f416dc4edbb9161c780\" id=\"reference-afddec00cac914c78c72\"\u003e昨日の記事\u003c/a\u003eに対して\u003ca href=\"http://qiita.com/arowM\"\u003earowM\u003c/a\u003eさんから\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e実はHaskellの場合は遅延評価の影響で、末尾再帰にしても\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003efact' x y = fact' (x - 1) (x * y)\u003c/code\u003e\u003cbr\u003e\nの \u003ccode\u003e(x - 1)\u003c/code\u003e とか \u003ccode\u003e(x * y)\u003c/code\u003e とかが評価されずに残り続けてしまうので、あまりうまみがなかったりっていう話もあります。\u003cbr\u003e\n\u003ca href=\"http://d.hatena.ne.jp/kazu-yamamoto/20091122/1258899591\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://d.hatena.ne.jp/kazu-yamamoto/20091122/1258899591\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eもしかしたら最近のGHCの状況では話は別かもしれないです。\u003cbr\u003e\nそのへんはきっと誰かが教えてくれるはず。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eというコメントがありました(\u003ca href=\"http://qiita.com/arowM\"\u003earowM\u003c/a\u003eさん、ありがとうございました).\u003c/p\u003e\n\n\u003cp\u003e僕もこの記事を読んだ事がありましたが, 通常の再帰と末尾再帰で圧倒的に体感時間の差があったため, もうこの事を忘れて勢い余って投稿してしまいました. \u003c/p\u003e\n\n\u003cp\u003eもしかしたら末尾再帰を理解した事が嬉しすぎて時間が経つのが早く感じてしまったのじゃないかと思ったので, ちゃんと検証していきたいと思います.\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"検証開始\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A4%9C%E8%A8%BC%E9%96%8B%E5%A7%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e検証開始\u003c/h2\u003e\n\n\u003cp\u003eと言っても大それた事をするわけではありません. ただプログラムの実行時間を計るだけです.\u003cbr\u003e\n測定に使うのはMacの\u003ccode\u003etime\u003c/code\u003eコマンドです. \u003cbr\u003e\n引数にコマンドや実行ファイルを与えると, そのコマンドを実行して実行にかかった時間を教えてくれます.\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ソースコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソースコード\u003c/h2\u003e\n\n\u003cp\u003eでは次に比較に使うプログラムです.\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"通常再帰\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%9A%E5%B8%B8%E5%86%8D%E5%B8%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e通常再帰\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"hs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003efib1.hs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nf\"\u003efib\u003c/span\u003e \u003cspan class=\"ow\"\u003e::\u003c/span\u003e \u003cspan class=\"kt\"\u003eInteger\u003c/span\u003e \u003cspan class=\"ow\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInteger\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"ow\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"ow\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"ow\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"nf\"\u003emain\u003c/span\u003e \u003cspan class=\"ow\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eprint\u003c/span\u003e \u003cspan class=\"o\"\u003e$\u003c/span\u003e \u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e35\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"末尾再帰\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AB%E5%B0%BE%E5%86%8D%E5%B8%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e末尾再帰\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"hs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003efib2.hs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"ow\"\u003e::\u003c/span\u003e \u003cspan class=\"kt\"\u003eInteger\u003c/span\u003e \u003cspan class=\"ow\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInteger\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"ow\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efib''\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003ewhere\u003c/span\u003e\n        \u003cspan class=\"n\"\u003efib''\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"ow\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"ow\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eotherwise\u003c/span\u003e \u003cspan class=\"ow\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efib''\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"nf\"\u003emain\u003c/span\u003e \u003cspan class=\"ow\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eprint\u003c/span\u003e \u003cspan class=\"o\"\u003e$\u003c/span\u003e \u003cspan class=\"n\"\u003efib'\u003c/span\u003e \u003cspan class=\"mi\"\u003e35\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eはい, 例によってまたフィボナッチ数列です.\u003cbr\u003e\n好きなんですよ, フィボナッチ数列.\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"測定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B8%AC%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e測定\u003c/h2\u003e\n\n\u003cp\u003eではこれから測定をしていきたいと思います.\u003cbr\u003e\n測定に使ったマシンはMacBook Pro (Retina, 15-inch, Mid 2014)で, CPUは2.2 GHz Intel Core i7です.\u003c/p\u003e\n\n\u003cp\u003eまずは1回目\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e実行結果\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nb\"\u003etime\u003c/span\u003e ./fib1      \n\u003cspan class=\"m\"\u003e14930352\u003c/span\u003e\n./fib1  \u003cspan class=\"m\"\u003e1\u003c/span\u003e.81s user \u003cspan class=\"m\"\u003e0\u003c/span\u003e.02s system \u003cspan class=\"m\"\u003e98\u003c/span\u003e% cpu \u003cspan class=\"m\"\u003e1\u003c/span\u003e.845 total\n\n\u003cspan class=\"nb\"\u003etime\u003c/span\u003e ./fib2      \n\u003cspan class=\"m\"\u003e14930352\u003c/span\u003e\n./fib2  \u003cspan class=\"m\"\u003e0\u003c/span\u003e.00s user \u003cspan class=\"m\"\u003e0\u003c/span\u003e.01s system \u003cspan class=\"m\"\u003e45\u003c/span\u003e% cpu \u003cspan class=\"m\"\u003e0\u003c/span\u003e.016 total\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e......圧倒的ですね\u003c/p\u003e\n\n\u003cp\u003eもう5回ずつやった結果の表が以下の通りです.\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"測定結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B8%AC%E5%AE%9A%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e測定結果\u003c/h3\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align: right\"\u003e回数\u003c/th\u003e\n\u003cth style=\"text-align: right\"\u003e通常再帰(sec)\u003c/th\u003e\n\u003cth style=\"text-align: right\"\u003e末尾再帰(sec)\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: right\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e1.845\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.016\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: right\"\u003e2\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e1.910\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.015\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: right\"\u003e3\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e1.893\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.008\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: right\"\u003e4\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e1.842\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.009\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: right\"\u003e5\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e1.870\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.008\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: right\"\u003e6\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e1.892\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.008\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align: right\"\u003e平均\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e1.8753\u003c/td\u003e\n\u003ctd style=\"text-align: right\"\u003e0.0107\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e170倍以上の差が出ていますね.\u003cbr\u003e\n正直ここまで差が出るとは思いませんでした. \u003c/p\u003e\n\n\u003cp\u003eちなみにCPU使用率の平均は通常再帰が\u003ccode\u003e98.67%\u003c/code\u003e, 末尾再帰が\u003ccode\u003e57.33%\u003c/code\u003eでした.\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cdel\u003e結論\u003c/del\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e\u003cdel\u003e最新のGHCではどうやら末尾再帰最適化(?)が行われているっぽいですね.\u003cbr\u003e\nもう少し詳しく調べてみようと思います.\u003c/del\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"追記\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BF%BD%E8%A8%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e追記\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"http://qiita.com/SaitoAtsushi\"\u003eSaitoAtsushi\u003c/a\u003eさんから\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eこれはそもそも同じ計算量ではないです。 式変形の段階でアルゴリズムが変わっています。 以前に似たような事例を見て解説記事を書いたことがあるので参考にしてください。\u003c/p\u003e\n\n\u003cp\u003e》\u003ca href=\"http://saito.hatenablog.jp/entry/20090208/1234085992\" rel=\"nofollow noopener\" target=\"_blank\"\u003eフィボナッチ関数の計算量 - 主題のない日記\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eという指摘をいただきました.\u003cbr\u003e\n実際に実行過程を追っていきたいと思います.\u003cbr\u003e\n(申し訳ありません, 通常再帰は左側優先, 末尾再帰は右側優先で計算してしまいました. 計算結果と計算量に差はありませんので, ご了承下さい)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"hs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e通常再帰実行過程\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nf\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"n\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(((\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e引数5で22回の計算でした. \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"hs\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e末尾再帰実行過程\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nf\"\u003efib\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"nf\"\u003efib'\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\n\u003cspan class=\"err\"\u003e↓\u003c/span\u003e\n\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e同じく引数5で14回の計算でした.\u003c/p\u003e\n\n\u003cp\u003eこれは差が出て当然ですね......\u003cbr\u003e\n申し訳ありませんでした.\u003cbr\u003e\nまた近いうちに, 計算量が同じ関数を用いて試したいと思います.\u003cbr\u003e\n\u003ca href=\"https://qiita.com/SaitoAtsushi\"\u003eSaitoAtsushi\u003c/a\u003eさん, ありがとうございました.\u003c/p\u003e\n","body":"[昨日の記事](http://qiita.com/Tatsuki-I/items/9f416dc4edbb9161c780)に対して[arowM](http://qiita.com/arowM)さんから\n\n\u003e実はHaskellの場合は遅延評価の影響で、末尾再帰にしても\n\u003e\n\u003e`fact' x y = fact' (x - 1) (x * y)`\n\u003eの `(x - 1)` とか `(x * y)` とかが評価されずに残り続けてしまうので、あまりうまみがなかったりっていう話もあります。\n\u003ehttp://d.hatena.ne.jp/kazu-yamamoto/20091122/1258899591\n\u003e\n\u003eもしかしたら最近のGHCの状況では話は別かもしれないです。\n\u003eそのへんはきっと誰かが教えてくれるはず。\n\nというコメントがありました([arowM](http://qiita.com/arowM)さん、ありがとうございました).\n\n僕もこの記事を読んだ事がありましたが, 通常の再帰と末尾再帰で圧倒的に体感時間の差があったため, もうこの事を忘れて勢い余って投稿してしまいました. \n\nもしかしたら末尾再帰を理解した事が嬉しすぎて時間が経つのが早く感じてしまったのじゃないかと思ったので, \bちゃんと検証していきたいと思います.\n\n##検証開始\n\nと言っても大それた事をするわけではありません. ただプログラムの実行時間を計るだけです.\n測定に使うのはMacの`time`コマンドです. \n引数に\bコマンドや実行ファイルを与えると, そのコマンドを実行して実行にかかった時間を教えてくれます.\n\n##ソースコード\n\nでは次に比較に使うプログラムです.\n\n###通常再帰\n\n```hs:fib1.hs\nfib :: Integer -\u003e Integer\nfib 0 = 1\nfib 1 = 1\nfib n = fib (n - 1) + fib (n - 2)\n\nmain = print $ fib 35\n```\n\n###末尾再帰\n\n```hs:fib2.hs\nfib' :: Integer -\u003e Integer\nfib' n = fib'' n 1 1\n    where\n        fib'' n x y\n            | n == 0 = 1\n            | n == 1 = x\n            | otherwise = fib'' (n - 1) (x + y) (x)\n\nmain = print $ fib' 35\n```\n\nはい, 例によってまたフィボナッチ数列です.\n好きなんですよ, フィボナッチ数列.\n\n##測定\n\nではこれから測定をしていきたいと思います.\n測定に使ったマシンはMacBook Pro (Retina, 15-inch, Mid 2014)で, CPUは2.2 GHz Intel Core i7です.\n\nまずは1回目\n\n```bash:実行結果\ntime ./fib1      \n14930352\n./fib1  1.81s user 0.02s system 98% cpu 1.845 total\n\ntime ./fib2      \n14930352\n./fib2  0.00s user 0.01s system 45% cpu 0.016 total\n```\n\n......圧倒的ですね\n\nもう5回ずつやった結果の表が以下の通りです.\n\n###測定結果\n\n|回数|通常再帰(sec)|末尾再帰(sec)|\n|--:|--:|--:|\n|1|1.845|0.016|\n|2|1.910|0.015|\n|3|1.893|0.008|\n|4|1.842|0.009|\n|5|1.870|0.008|\n|6|1.892|0.008|\n|平均|1.8753|0.0107|\n\n170倍以上の差が出ていますね.\n正直ここまで差が出るとは思いませんでした. \n\nちなみにCPU使用率の平均は通常再帰が`98.67%`, 末尾再帰が`57.33%`でした.\n\n##~~結論~~\n\n~~最新のGHCではどうやら末尾再帰最適化(?)が行われているっぽいですね.\nもう少し詳しく調べてみようと思います.~~\n\n##追記\n\n[SaitoAtsushi](http://qiita.com/SaitoAtsushi)さんから\n\n\u003eこれはそもそも同じ計算量ではないです。 式変形の段階でアルゴリズムが変わっています。 以前に似たような事例を見て解説記事を書いたことがあるので参考にしてください。\n\u003e\n\u003e》[フィボナッチ関数の計算量 - 主題のない日記](http://saito.hatenablog.jp/entry/20090208/1234085992)\n\nという指摘をいただきました.\n実際に実行過程を追っていきたいと思います.\n(申し訳ありません, 通常再帰は左側優先, 末尾再帰は右側優先で計算してしまいました. 計算結果と計算量に差はありませんので, ご了承下さい)\n\n```hs:通常再帰実行過程\nfib 5\n↓\n(fib 4) + (fib 3)\n↓\n(fib 4) + ((fib 2) + (fib 1))\n↓\n(fib 4) + ((fib 2) + 1)\n↓\n(fib 4) + (((fib 1) + (fib 0)) + 1) \n↓\n(fib 4) + (((fib 1) + 1) + 1)\n↓\n(fib 4) + ((1 + 1) + 1)\n↓\n(fib 4) + (2 + 1)\n↓\n(fib 4) + 3\n↓\n((fib 3) + (fib 2)) + 3\n↓\n((fib 3) + ((fib 1) + (fib 0))) + 3\n↓\n((fib 3) + ((fib 1) + 1)) + 3\n↓\n((fib 3) + (1 + 1)) + 3\n↓\n((fib 3) + 2) + 3\n↓\n(((fib 2) + (fib 1)) + 2) + 3\n↓\n(((fib 2) + 1) + 2) + 3\n↓\n(((fib 1) + (fib 0)) + 1) + 2) + 3\n↓\n(((fib 1) + 1) + 1) + 2) + 3\n↓\n(((1 + 1) + 1) + 2) + 3\n↓\n((2 + 1) + 2) + 3\n↓\n(3 + 2) + 3\n↓\n5 + 3\n↓\n8\n```\n\n引数5で22回の計算でした. \n\n```hs:末尾再帰実行過程\nfib 5\n↓\nfib' 5 1 1\n↓\nfib' (5 - 1) (1 + 1) 1\n↓\nfib' (5 - 1) 2 1\n↓\nfib' 4 2 1\n↓\nfib' (4 - 1) (2 + 1) 2\n↓\nfib' (4 - 1) 3 2\n↓\nfib' 3 3 2\n↓\nfib' (3 - 1) (3 + 2) 3\n↓\nfib' (3 - 1) 5 3\n↓\nfib' 2 5 3\n↓\nfib' (2 - 1) (5 + 3) 3\n↓\nfib' (2 - 1) 8 3\n↓\nfib' 1 8 5\n↓\n8\n```\n\n同じく引数\b5で14回の計算でした.\n\nこれは差が出て当然ですね......\n\b申し訳ありませんでした.\nまた近いうちに, 計算量が同じ関数を用いて試したいと思います.\n[SaitoAtsushi](https://qiita.com/SaitoAtsushi)さん, ありがとうございました.\n","coediting":false,"created_at":"2017-05-17T21:51:23+09:00","group":null,"id":"2a4202bd52a0ae4418e4","private":false,"tags":[{"name":"Haskell","versions":[]},{"name":"フィボナッチ数列","versions":[]},{"name":"末尾再帰","versions":[]}],"title":"Haskellでは末尾再帰にする必要が無いのかという疑問 #Haskell","updated_at":"2017-05-17T22:57:33+09:00","url":"http://qiita.com/Tatsuki-I/items/2a4202bd52a0ae4418e4","user":{"description":"強いVimmerになりたい","facebook_id":"","followees_count":18,"followers_count":1,"github_login_name":"Tatsuki-I","id":"Tatsuki-I","items_count":4,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":144917,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/144917/profile-images/1477846039","twitter_screen_name":"ttk_vim","website_url":""}},{"rendered_body":"\u003cp\u003eハマりましたね。。初級のトラップ笑\u003cbr\u003e\nalready outputというDEBUGメッセージに。\u003c/p\u003e\n\n\u003cp\u003eコード①\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eMap\u0026lt;Integer, List\u0026lt;String\u0026gt;\u0026gt; mapA = new Map\u0026lt;Integer, List\u0026lt;String\u0026gt;\u0026gt;();\nList\u0026lt;String\u0026gt; liststr = new List\u0026lt;String\u0026gt;();\n\nliststr.add('a');\nliststr.add('b');\n\n//System.debug(liststr);\n\nmapA.put(1, liststr);\n\nliststr.clear();\n\nliststr.add('c');\nliststr.add('d');\n\nmapA.put(2, liststr);\n\nSystem.debug(liststr);\nSystem.debug(mapA);\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eコード②\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eMap\u0026lt;Integer, List\u0026lt;String\u0026gt;\u0026gt; mapA = new Map\u0026lt;Integer, List\u0026lt;String\u0026gt;\u0026gt;();\nList\u0026lt;String\u0026gt; liststr = new List\u0026lt;String\u0026gt;();\n\nfor (Integer j =0; j\u0026lt;2; j++){\nliststr.clear();\nfor (Integer i = 0; i\u0026lt;2; i++){\nliststr.add('a'+i);\n}\nmapA.put(j, liststr);\n}\n//System.debug(liststr);\nSystem.debug(liststr);\nSystem.debug(mapA);\n\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e上記の二つのコード（実際同じだけど）、をコンソール上で実行したら、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eDEBUG|(c, d)\nDEBUG|{1=(c, d), 2=(already output)}\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e'a'と'b'がなぜ入らないのかなと結構悩んでました笑\u003cbr\u003e\n毎回clearしているし。\u003c/p\u003e\n\n\u003cp\u003eで、理由は\u003cbr\u003e\nMapAにputしているのは、Listの中の値ではなくて、\u003cbr\u003e\nそう！参照しているアドレスだから！\u003cbr\u003e\n以上。笑\u003c/p\u003e\n","body":"ハマりましたね。。初級のトラップ笑\nalready outputというDEBUGメッセージに。\n\nコード①\n\n```\nMap\u003cInteger, List\u003cString\u003e\u003e mapA = new Map\u003cInteger, List\u003cString\u003e\u003e();\nList\u003cString\u003e liststr = new List\u003cString\u003e();\n\nliststr.add('a');\nliststr.add('b');\n\n//System.debug(liststr);\n\nmapA.put(1, liststr);\n\nliststr.clear();\n\nliststr.add('c');\nliststr.add('d');\n\nmapA.put(2, liststr);\n\nSystem.debug(liststr);\nSystem.debug(mapA);\n```\n\nコード②\n\n```\nMap\u003cInteger, List\u003cString\u003e\u003e mapA = new Map\u003cInteger, List\u003cString\u003e\u003e();\nList\u003cString\u003e liststr = new List\u003cString\u003e();\n\nfor (Integer j =0; j\u003c2; j++){\nliststr.clear();\nfor (Integer i = 0; i\u003c2; i++){\nliststr.add('a'+i);\n}\nmapA.put(j, liststr);\n}\n//System.debug(liststr);\nSystem.debug(liststr);\nSystem.debug(mapA);\n\n```\n\n上記の二つのコード（実際同じだけど）、をコンソール上で実行したら、\n\n```\nDEBUG|(c, d)\nDEBUG|{1=(c, d), 2=(already output)}\n```\n\n'a'と'b'がなぜ入らないのかなと結構悩んでました笑\n毎回clearしているし。\n\nで、理由は\nMapAにputしているのは、Listの中の値ではなくて、\nそう！参照しているアドレスだから！\n以上。笑\n","coediting":false,"created_at":"2017-05-17T21:50:47+09:00","group":null,"id":"ba2357eb424e98fd6dbe","private":false,"tags":[{"name":"Salesforce","versions":[]},{"name":"Apex","versions":[]}],"title":"【Salesforce初心者】Apex開発でハマった(already output)事件","updated_at":"2017-05-17T22:02:05+09:00","url":"http://qiita.com/hankboe/items/ba2357eb424e98fd6dbe","user":{"description":"","facebook_id":"","followees_count":4,"followers_count":2,"github_login_name":"hankboe","id":"hankboe","items_count":10,"linkedin_id":"","location":"","name":"Hank Boe","organization":"","permanent_id":170085,"profile_image_url":"https://avatars1.githubusercontent.com/u/8370517?v=3","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"unetwebsocket\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#unetwebsocket\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUNetWebSocket\u003c/h1\u003e\n\n\u003cp\u003eUnityのUNET勉強がてら作ったテスト用プログラム。\u003cbr\u003e\nソースコード：\u003ca href=\"https://github.com/nQuantums/UNetWebSocket\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/nQuantums/UNetWebSocket\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"説明\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AA%AC%E6%98%8E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e説明\u003c/h2\u003e\n\n\u003cp\u003eUNETを構成するクラスが多くていまいちわからなかったので勉強のために作成しました。\u003cbr\u003e\u003cbr\u003e\n- メモ代わりのプログラムのため無駄にコメントを記述してあります。\u003cbr\u003e\n- 勉強のため敢えて\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkManager.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkManager\u003c/a\u003eを使用していません。サーバー側とクライアント側でクラスを分けています。\u003cbr\u003e\n- ネットワーク越しの物理挙動の同期の確認を目的にしています。\u003cbr\u003e\n- 装甲車（？）を操作し、ミサイル＆グレネードを発射して挙動を確認できます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"デモ画面\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%A2%E7%94%BB%E9%9D%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデモ画面\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"http://www.nquantums.net/webgl/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eテスト用サイト\u003c/a\u003e ※サーバーいつ止めるかわかりません\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/175731/bae263b9-3418-2b03-903d-4b39e077959a.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/175731/bae263b9-3418-2b03-903d-4b39e077959a.png\" alt=\"fig1.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"要求環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A6%81%E6%B1%82%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e要求環境\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eUnity5.6以上\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"今回使ったunetクラス一覧概略\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E4%BD%BF%E3%81%A3%E3%81%9Funet%E3%82%AF%E3%83%A9%E3%82%B9%E4%B8%80%E8%A6%A7%E6%A6%82%E7%95%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回使ったUNETクラス一覧＆概略\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkInstanceId.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkInstanceId\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eサーバー＆クライアント上で同じ要素を認識するためのID。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.ClientScene.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eClientScene\u003c/a\u003e.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.ClientScene.FindLocalObject.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFindLocalObject\u003c/a\u003e に渡すとオブジェクト取得できる。今回のプログラムでは弾の発射主と接触判定行わないようにするために使用。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkIdentity.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkIdentity\u003c/a\u003e コンポーネント\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkInstanceId.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkInstanceId\u003c/a\u003e を保持している。\u003c/li\u003e\n\u003cli\u003eサーバー＆クライアント間で状態同期させたいならこのコンポーネントをセットする必要がある。\u003c/li\u003e\n\u003cli\u003eこのコンポーネントをセットしたオブジェクトをシーンに配置すると勝手にDeactivate状態になっているため自分で\u003ca href=\"https://docs.unity3d.com/ScriptReference/GameObject.SetActive.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSetActive\u003c/a\u003e(true)を呼び出す必要がある。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkBehaviour.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkBehaviour\u003c/a\u003e コンポーネント\n\n\u003cul\u003e\n\u003cli\u003eサーバー＆クライアント間で状態同期やら処理する自作クラスはこれを継承する。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.SyncVarAttribute.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSyncVar\u003c/a\u003e 属性を付与したフィールドを持たせたいなら継承する必要がある。ちなみにこの属性が付与されたフィールドはサーバー＆クライアント間で同期される。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkTransform.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkTransform\u003c/a\u003e コンポーネント\n\n\u003cul\u003e\n\u003cli\u003e位置と角度を同期させる。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkIdentity.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkIdentity\u003c/a\u003e.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkIdentity-localPlayerAuthority.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003elocalPlayerAuthority\u003c/a\u003e の値により、クライアントとサーバーで以下の様に挙動が異なる。\n\n\u003cul\u003e\n\u003cli\u003eクライアント側の所有オブジェクト（プレイヤーなど？）の場合はクライアント側で物理挙動等を計算し、計算結果をサーバーへ転送する。\u003c/li\u003e\n\u003cli\u003eサーバー側の所有オブジェクトの場合はサーバー側で物理挙動等を計算しクライアントにブロードキャストされる、これは敵ユニット等のクライアント側の所有オブジェクトでない場合の共通挙動らしい。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkTransform-transformSyncMode.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003etransformSyncMode\u003c/a\u003e プロパティで位置＆角度のみ同期か、Rigidbody2D/Rigidbody3Dでの物理演算も含めた同期か決定するみたい。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkServer.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkServer\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eサーバー側での接続待ち受け＆接続管理クラス、シングルトン。\u003c/li\u003e\n\u003cli\u003e使い方、今回のプログラムでは Awake() 内で以下の様にやっている・・・\n\n\u003col\u003e\n\u003cli\u003eNetworkServer.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkServer-useWebSockets.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003euseWebSockets\u003c/a\u003e = true によりWebSocketを使う設定にする。\u003c/li\u003e\n\u003cli\u003eNetworkServer.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkServer.RegisterHandler.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRegisterHandler\u003c/a\u003e(MsgType.Connect, OnConnect) を呼び出してクライアントから接続された際のイベントハンドラ登録。\u003c/li\u003e\n\u003cli\u003eNetworkServer.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkServer.RegisterHandler.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRegisterHandler\u003c/a\u003e(MsgType.AddPlayer, OnAddPlayer) を呼び出してプレイヤーオブジェクトを生成するハンドラ登録。\u003c/li\u003e\n\u003cli\u003eNetworkServer.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkServer.RegisterHandler.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRegisterHandler\u003c/a\u003e(MsgType.Disconnect, OnPlayerDisconnect) を呼び出してクライアント切断時のイベントハンドラ登録。\u003c/li\u003e\n\u003cli\u003eNetworkServer.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkServer.Listen.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eListen\u003c/a\u003e(port) を呼び出して接続受付開始。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkClient.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkClient\u003c/a\u003e クラス\n\n\u003cul\u003e\n\u003cli\u003eクライアント側からサーバーへ接続するためのクラス。\u003c/li\u003e\n\u003cli\u003e使い方、とりあえず Start() 内で以下の様にする・・・\n\n\u003col\u003e\n\u003cli\u003e_client = new \u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkClient.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkClient\u003c/a\u003e() でオブジェクト作成。\u003c/li\u003e\n\u003cli\u003e_client.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkClient.Connect.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eConnect\u003c/a\u003e(address, port) でサーバーに接続。\u003c/li\u003e\n\u003cli\u003e_client.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkClient.RegisterHandler.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRegisterHandler\u003c/a\u003e(MsgType.Connect, OnClientConnected) で接続できた際のイベントハンドラ登録。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.ClientScene.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eClientScene\u003c/a\u003e クラス\n\n\u003cul\u003e\n\u003cli\u003eクライアント側でのシーンに関する情報を保持するシングルトン。\u003c/li\u003e\n\u003cli\u003e今回プログラムでの使い方・・・\n\n\u003col\u003e\n\u003cli\u003eStart() 内で \u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.ClientScene.RegisterSpawnHandler.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRegisterSpawnHandler\u003c/a\u003e 呼び出して \u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkIdentity.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNetworkIdentity\u003c/a\u003e コンポーネントセットされたオブジェクトの生成、破棄ハンドラを登録する。※これはオブジェクト生成時に何か処理したい場合に使うが、普通は \u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.ClientScene.RegisterPrefab.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRegisterPrefab\u003c/a\u003e の方を使うらしい。\u003c/li\u003e\n\u003cli\u003e上記の _client.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.NetworkClient.RegisterHandler.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRegisterHandler\u003c/a\u003e で登録した OnClientConnected 内で \u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.ClientScene.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eClientScene\u003c/a\u003e.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.ClientScene.Ready.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eReady\u003c/a\u003e(netMsg.conn) 呼び出してサーバーにクライアント側の準備ができたことを通知。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.ClientScene.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eClientScene\u003c/a\u003e.\u003ca href=\"https://docs.unity3d.com/ScriptReference/Networking.ClientScene.AddPlayer.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAddPlayer\u003c/a\u003e(0) を呼び出してクライアント接続毎のID登録。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い方\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"linuxでのサーバー起動例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#linux%E3%81%A7%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E8%B5%B7%E5%8B%95%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLinuxでのサーバー起動例\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003esudo nohup ./UNetWebSocket.x86_64 -server -batchmode -nographics -logfile ulog.txt \u0026gt; out.log 2\u0026gt; err.log \u0026lt; /dev/null \u0026amp;\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ソースコード説明\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E8%AA%AC%E6%98%8E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソースコード説明\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/nQuantums/UNetWebSocket/blob/master/Assets/scripts/Global.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGlobal\u003c/a\u003e クラス： プログラム全体からアクセスするようなものをまとめた。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/nQuantums/UNetWebSocket/blob/master/Assets/scripts/Server.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eServer\u003c/a\u003e クラス： サーバーとしての接続待ち受け処理など。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/nQuantums/UNetWebSocket/blob/master/Assets/scripts/Client.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eClient\u003c/a\u003e クラス： サーバーへ接続する処理＆サーバーからのメッセージ処理。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/nQuantums/UNetWebSocket/blob/master/Assets/scripts/Player.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePlayer\u003c/a\u003e クラス： 自機の操作など。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/nQuantums/UNetWebSocket/blob/master/Assets/scripts/Gimmick.cs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGimmick\u003c/a\u003e クラス： ギミックの初期位置の記憶処理など。\u003c/li\u003e\n\u003c/ul\u003e\n","body":"UNetWebSocket\n===\nUnityのUNET勉強がてら作ったテスト用プログラム。\nソースコード：[https://github.com/nQuantums/UNetWebSocket](https://github.com/nQuantums/UNetWebSocket)\n\n## 説明\nUNETを構成するクラスが多くていまいちわからなかったので勉強のために作成しました。  \n- メモ代わりのプログラムのため無駄にコメントを記述してあります。\n- 勉強のため敢えて[NetworkManager](https://docs.unity3d.com/ScriptReference/Networking.NetworkManager.html)を使用していません。サーバー側とクライアント側でクラスを分けています。\n- ネットワーク越しの物理挙動の同期の確認を目的にしています。\n- 装甲車（？）を操作し、ミサイル＆グレネードを発射して挙動を確認できます。\n\n## デモ画面\n[テスト用サイト](http://www.nquantums.net/webgl/) ※サーバーいつ止めるかわかりません\n\n![fig1.png](https://qiita-image-store.s3.amazonaws.com/0/175731/bae263b9-3418-2b03-903d-4b39e077959a.png)\n\n\n## 要求環境\n- Unity5.6以上\n\n## 今回使ったUNETクラス一覧＆概略\n- [NetworkInstanceId](https://docs.unity3d.com/ScriptReference/Networking.NetworkInstanceId.html)\n\t- サーバー＆クライアント上で同じ要素を認識するためのID。\n\t- [ClientScene](https://docs.unity3d.com/ScriptReference/Networking.ClientScene.html).[FindLocalObject](https://docs.unity3d.com/ScriptReference/Networking.ClientScene.FindLocalObject.html) に渡すとオブジェクト取得できる。今回のプログラムでは弾の発射主と接触判定行わないようにするために使用。\n- [NetworkIdentity](https://docs.unity3d.com/ScriptReference/Networking.NetworkIdentity.html) コンポーネント\n\t- [NetworkInstanceId](https://docs.unity3d.com/ScriptReference/Networking.NetworkInstanceId.html) を保持している。\n\t- サーバー＆クライアント間で状態同期させたいならこのコンポーネントをセットする必要がある。\n\t- このコンポーネントをセットしたオブジェクトをシーンに配置すると勝手にDeactivate状態になっているため自分で[SetActive](https://docs.unity3d.com/ScriptReference/GameObject.SetActive.html)(true)を呼び出す必要がある。\n- [NetworkBehaviour](https://docs.unity3d.com/ScriptReference/Networking.NetworkBehaviour.html) コンポーネント\n\t- サーバー＆クライアント間で状態同期やら処理する自作クラスはこれを継承する。\n\t- [SyncVar](https://docs.unity3d.com/ScriptReference/Networking.SyncVarAttribute.html) 属性を付与したフィールドを持たせたいなら継承する必要がある。ちなみにこの属性が付与されたフィールドはサーバー＆クライアント間で同期される。\n- [NetworkTransform](https://docs.unity3d.com/ScriptReference/Networking.NetworkTransform.html) コンポーネント\n\t- 位置と角度を同期させる。\n\t- [NetworkIdentity](https://docs.unity3d.com/ScriptReference/Networking.NetworkIdentity.html).[localPlayerAuthority](https://docs.unity3d.com/ScriptReference/Networking.NetworkIdentity-localPlayerAuthority.html) の値により、クライアントとサーバーで以下の様に挙動が異なる。\n\t\t- クライアント側の所有オブジェクト（プレイヤーなど？）の場合はクライアント側で物理挙動等を計算し、計算結果をサーバーへ転送する。\n\t\t- サーバー側の所有オブジェクトの場合はサーバー側で物理挙動等を計算しクライアントにブロードキャストされる、これは敵ユニット等のクライアント側の所有オブジェクトでない場合の共通挙動らしい。\n\t- [transformSyncMode](https://docs.unity3d.com/ScriptReference/Networking.NetworkTransform-transformSyncMode.html) プロパティで位置＆角度のみ同期か、Rigidbody2D/Rigidbody3Dでの物理演算も含めた同期か決定するみたい。\n- [NetworkServer](https://docs.unity3d.com/ScriptReference/Networking.NetworkServer.html)\n\t- サーバー側での接続待ち受け＆接続管理クラス、シングルトン。\n\t- 使い方、今回のプログラムでは Awake() 内で以下の様にやっている・・・\n\t\t1. NetworkServer.[useWebSockets](https://docs.unity3d.com/ScriptReference/Networking.NetworkServer-useWebSockets.html) = true によりWebSocketを使う設定にする。\n\t\t2. NetworkServer.[RegisterHandler](https://docs.unity3d.com/ScriptReference/Networking.NetworkServer.RegisterHandler.html)(MsgType.Connect, OnConnect) を呼び出してクライアントから接続された際のイベントハンドラ登録。\n\t\t3. NetworkServer.[RegisterHandler](https://docs.unity3d.com/ScriptReference/Networking.NetworkServer.RegisterHandler.html)(MsgType.AddPlayer, OnAddPlayer) を呼び出してプレイヤーオブジェクトを生成するハンドラ登録。\n\t\t4. NetworkServer.[RegisterHandler](https://docs.unity3d.com/ScriptReference/Networking.NetworkServer.RegisterHandler.html)(MsgType.Disconnect, OnPlayerDisconnect) を呼び出してクライアント切断時のイベントハンドラ登録。\n\t\t5. NetworkServer.[Listen](https://docs.unity3d.com/ScriptReference/Networking.NetworkServer.Listen.html)(port) を呼び出して接続受付開始。\n- [NetworkClient](https://docs.unity3d.com/ScriptReference/Networking.NetworkClient.html) クラス\n\t- クライアント側からサーバーへ接続するためのクラス。\n\t- 使い方、とりあえず Start() 内で以下の様にする・・・\n\t\t1. _client = new [NetworkClient](https://docs.unity3d.com/ScriptReference/Networking.NetworkClient.html)() でオブジェクト作成。\n\t\t2. _client.[Connect](https://docs.unity3d.com/ScriptReference/Networking.NetworkClient.Connect.html)(address, port) でサーバーに接続。\n\t\t3. _client.[RegisterHandler](https://docs.unity3d.com/ScriptReference/Networking.NetworkClient.RegisterHandler.html)(MsgType.Connect, OnClientConnected) で接続できた際のイベントハンドラ登録。\n- [ClientScene](https://docs.unity3d.com/ScriptReference/Networking.ClientScene.html) クラス\n\t- クライアント側でのシーンに関する情報を保持するシングルトン。\n\t- 今回プログラムでの使い方・・・\n\t\t1. Start() 内で [RegisterSpawnHandler](https://docs.unity3d.com/ScriptReference/Networking.ClientScene.RegisterSpawnHandler.html) 呼び出して [NetworkIdentity](https://docs.unity3d.com/ScriptReference/Networking.NetworkIdentity.html) コンポーネントセットされたオブジェクトの生成、破棄ハンドラを登録する。※これはオブジェクト生成時に何か処理したい場合に使うが、普通は [RegisterPrefab](https://docs.unity3d.com/ScriptReference/Networking.ClientScene.RegisterPrefab.html) の方を使うらしい。\n\t\t2. 上記の _client.[RegisterHandler](https://docs.unity3d.com/ScriptReference/Networking.NetworkClient.RegisterHandler.html) で登録した OnClientConnected 内で [ClientScene](https://docs.unity3d.com/ScriptReference/Networking.ClientScene.html).[Ready](https://docs.unity3d.com/ScriptReference/Networking.ClientScene.Ready.html)(netMsg.conn) 呼び出してサーバーにクライアント側の準備ができたことを通知。\n\t\t3. [ClientScene](https://docs.unity3d.com/ScriptReference/Networking.ClientScene.html).[AddPlayer](https://docs.unity3d.com/ScriptReference/Networking.ClientScene.AddPlayer.html)(0) を呼び出してクライアント接続毎のID登録。\n\n## 使い方\n\n### Linuxでのサーバー起動例\n\n\tsudo nohup ./UNetWebSocket.x86_64 -server -batchmode -nographics -logfile ulog.txt \u003e out.log 2\u003e err.log \u003c /dev/null \u0026\n\n## ソースコード説明\n- [Global](https://github.com/nQuantums/UNetWebSocket/blob/master/Assets/scripts/Global.cs) クラス： プログラム全体からアクセスするようなものをまとめた。\n- [Server](https://github.com/nQuantums/UNetWebSocket/blob/master/Assets/scripts/Server.cs) クラス： サーバーとしての接続待ち受け処理など。\n- [Client](https://github.com/nQuantums/UNetWebSocket/blob/master/Assets/scripts/Client.cs) クラス： サーバーへ接続する処理＆サーバーからのメッセージ処理。\n- [Player](https://github.com/nQuantums/UNetWebSocket/blob/master/Assets/scripts/Player.cs) クラス： 自機の操作など。\n- [Gimmick](https://github.com/nQuantums/UNetWebSocket/blob/master/Assets/scripts/Gimmick.cs) クラス： ギミックの初期位置の記憶処理など。\n","coediting":false,"created_at":"2017-05-17T21:48:24+09:00","group":null,"id":"8c5c7e8e7366f0965f2e","private":false,"tags":[{"name":"Unity","versions":[]},{"name":"websocket","versions":[]},{"name":"Unet","versions":[]},{"name":"物理挙動","versions":[]},{"name":"NetworkManagerなし","versions":[]}],"title":"Unity UNETで物理挙動のテスト","updated_at":"2017-05-17T21:48:24+09:00","url":"http://qiita.com/nQuantums/items/8c5c7e8e7366f0965f2e","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":null,"id":"nQuantums","items_count":1,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":175731,"profile_image_url":"https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png","twitter_screen_name":"NQuantums","website_url":null}},{"rendered_body":"\u003cp\u003eちょっとした量のCSVなどのデータを加工して使用したいときに、ローカルDBでさくっとやりたい場合がある。やり方はすごく簡単\u003c/p\u003e\n\n\u003cp\u003e１．cmdで「sqllocaldb info」と叩いてローカルサーバ名を確認\u003c/p\u003e\n\n\u003cp\u003e２．SQL Server Management Studioで「(localdb)\\取得したローカルサーバ名」で接続完了（認証は「Windows認証」を選択）\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/41877/c896a98e-6fca-2b79-81a7-a6c5ff6d0f8d.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/41877/c896a98e-6fca-2b79-81a7-a6c5ff6d0f8d.png\" alt=\"image\"\u003e\u003c/a\u003e\u003c/p\u003e\n","body":"\nちょっとした量のCSVなどのデータを加工して使用したいときに、ローカルDBでさくっとやりたい場合がある。やり方はすごく簡単\n\n１．cmdで「sqllocaldb info」と叩いてローカルサーバ名を確認\n\n２．SQL Server Management Studioで「(localdb)\\取得したローカルサーバ名」で接続完了（認証は「Windows認証」を選択）\n![image](https://qiita-image-store.s3.amazonaws.com/0/41877/c896a98e-6fca-2b79-81a7-a6c5ff6d0f8d.png)\n","coediting":false,"created_at":"2017-05-17T21:48:06+09:00","group":null,"id":"c12b355244301d643664","private":false,"tags":[{"name":"server","versions":[]},{"name":"SQL","versions":[]},{"name":"SSMS","versions":[]},{"name":"ローカル","versions":[]}],"title":"SQL Server Management StudioでSQL SeverのローカルDBへ接続","updated_at":"2017-05-17T21:49:18+09:00","url":"http://qiita.com/hiro-abe/items/c12b355244301d643664","user":{"description":null,"facebook_id":null,"followees_count":3,"followers_count":2,"github_login_name":"hiro-abe","id":"hiro-abe","items_count":16,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":41877,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/41877/profile-images/1473688955","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch2\u003e\n\u003cspan id=\"そもそもインクリメンタルサーチとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E3%82%A4%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%A1%E3%83%B3%E3%82%BF%E3%83%AB%E3%82%B5%E3%83%BC%E3%83%81%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eそもそもインクリメンタルサーチとは\u003c/h2\u003e\n\n\u003cp\u003e検索窓に文字を入力すると、入力ごとに候補を表示させる検索方法です。\u003cbr\u003e\nGoogleで何か文字を打つと、検索窓の下に、ピョコンと検索候補が出てきますよね。\u003cbr\u003e\nあれです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"対象読者\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AF%BE%E8%B1%A1%E8%AA%AD%E8%80%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e対象読者\u003c/h2\u003e\n\n\u003cp\u003eインクリメンタルサーチに恐怖を覚えている人。\u003cbr\u003e\nrails、jqueryの基礎はある程度理解している人。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e準備\u003c/h2\u003e\n\n\u003cp\u003eまず、サンプルとなるアプリケーションを作っていきましょう。\u003cbr\u003e\n今回は、scaffoldを使用して進めていきます。\u003cbr\u003e\nユーザーの名前と年齢を登録できるアプリケーションを作成してみます。\u003cbr\u003e\nターミナルで、以下のコマンドを打ち込みます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"terminal\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eターミナル\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003erails new scaffold_sample\nrails g scaffold user name:string age:integer\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eすると、MVCで必要なファイルを一気に作成し、ルーティングまで設定してくれます。さらにbundle installまで行ってくれます。\u003cbr\u003e\nマイグレーションファイルを確認して、データベースを作成しましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edb/migrate/0000000000_create_users.rb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCreateUsers\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"no\"\u003eActiveRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eMigration\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003echange\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecreate_table\u003c/span\u003e \u003cspan class=\"ss\"\u003e:users\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n      \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"ss\"\u003e:name\u003c/span\u003e\n      \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einteger\u003c/span\u003e \u003cspan class=\"ss\"\u003e:age\u003c/span\u003e\n\n      \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimestamps\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"terminal\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eターミナル\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003erake db:migrate\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれでデータベースも作成され、準備が整いました。\u003cbr\u003e\nサーバーを立ち上げ、\u003ca href=\"http://localhost:3000/users\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://localhost:3000/users\u003c/a\u003e に接続し、正しく表示がされているか確認してみましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"terminal\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eターミナル\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003erails s\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/177591/82e7d39e-bcf4-431e-472f-ba95c11c9822.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/177591/82e7d39e-bcf4-431e-472f-ba95c11c9822.png\" alt=\"スクリーンショット 2017-05-17 19.52.48.png\" title=\"スクリーンショット 2017-05-17 19.52.48.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e画像のように表示されていれば成功です。\u003cbr\u003e\nでは、試しにユーザー登録をしてみます。\u003cbr\u003e\nユーザー情報がデータベースにしっかりと登録ができていれば、下の画像のように表示されます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/177591/0c86898a-ff47-10bb-2268-a925b76e4641.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/177591/0c86898a-ff47-10bb-2268-a925b76e4641.png\" alt=\"スクリーンショット 2017-05-17 19.54.23.png\" title=\"スクリーンショット 2017-05-17 19.54.23.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"インクリメンタルサーチを実装する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%A1%E3%83%B3%E3%82%BF%E3%83%AB%E3%82%B5%E3%83%BC%E3%83%81%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eインクリメンタルサーチを実装する\u003c/h2\u003e\n\n\u003cp\u003eさて、ここからいよいよインクリメンタルサーチを実装していきます。\u003cbr\u003e\n検索語句を入力したら、その度にユーザー名が表示されるようなものを作っていきます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ビューを編集する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%93%E3%83%A5%E3%83%BC%E3%82%92%E7%B7%A8%E9%9B%86%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eビューを編集する\u003c/h3\u003e\n\n\u003cp\u003eまずは、検索窓をビューに作りましょう。\u003cbr\u003e\ninputタグを使い、フォームを作ります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp/views/index.html.erb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eh1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003eUsers\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eh1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c\"\u003e\u0026lt;!-- ここから追記 --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003einput\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eform\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"form\"\u003c/span\u003e \u003cspan class=\"na\"\u003eplaceholder\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ユーザー名を入力してください\"\u003c/span\u003e \u003cspan class=\"na\"\u003estyle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"width: 250px;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003ejsファイルでは、id（もしくはクラス）を指定して実装を進めるので、必ずidを付与しておきます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"jsファイルで検索語句を取得する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#js%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7%E6%A4%9C%E7%B4%A2%E8%AA%9E%E5%8F%A5%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ejsファイルで、検索語句を取得する\u003c/h3\u003e\n\n\u003cp\u003eさて、これだけでは何も意味を持たないフォームができただけですね。\u003cbr\u003e\nこのフォームの情報をjsファイルで取得できるようにしましょう。\u003cbr\u003e\napp/assets/javascriptに、user.js（名前は任意）というファイルを作成します。\u003cbr\u003e\nその中に、以下のような記述を加えます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp/assets/javascript/user.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'turbolinks:load'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e \u003cspan class=\"c1\"\u003e//リロードしなくてもjsが動くようにする\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'keyup'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'#form'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e \u003cspan class=\"c1\"\u003e//このアプリケーション(document)の、formというid('#form')で、キーボードが押され指が離れた瞬間(.on('keyup'...)、eという引数を取って以下のことをしなさい(function(e))\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epreventDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//キャンセル可能なイベントをキャンセル\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003einput\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrim\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e \u003cspan class=\"c1\"\u003e//inputという変数に(var input =)、この要素に入力された語句を取得し($(this).val())、前後の不要な空白を取り除いた上で代入($.trim(...);)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれでユーザーが入力した検索語句を取得することができました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ajaxを用いてデータを渡す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ajax%E3%82%92%E7%94%A8%E3%81%84%E3%81%A6%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%B8%A1%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eajaxを用いてデータを渡す\u003c/h3\u003e\n\n\u003cp\u003eこのデータを、ajax通信を用いて、json形式でコントローラーに渡します。\u003cbr\u003e\n下記のように追記しましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp/assets/javascript/user.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'turbolinks:load'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'keyup'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'#form'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epreventDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003einput\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrim\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//ここから追記\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eajax\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ajax通信で以下のことを行います\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/users/search'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e//urlを指定\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'GET'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e//メソッドを指定\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'keyword='\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"c1\"\u003e//コントローラーに渡すデータを'keyword=input(入力された文字のことですね)'にするように指定\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eprocessData\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e//おまじない\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econtentType\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e//おまじない\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003edataType\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'json'\u003c/span\u003e \u003cspan class=\"c1\"\u003e//データ形式を指定\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれで、ajax通信でデータをコントローラーに渡すことができました。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"コントローラーを編集する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E3%82%92%E7%B7%A8%E9%9B%86%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコントローラーを編集する\u003c/h3\u003e\n\n\u003cp\u003eさて、ajaxにてURLは'/users/search'に、メソッドは'GET'を指定しました。\u003cbr\u003e\nこれの通り、ルーティングとコントローラーを設定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003econfig/routes.rb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"no\"\u003eRails\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroutes\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edraw\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eresources\u003c/span\u003e \u003cspan class=\"ss\"\u003e:users\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecollection\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eget\u003c/span\u003e \u003cspan class=\"s1\"\u003e'search'\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp/controllers/users_controller.rb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003esearch\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# privateの前に追記\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこのsearchアクションの中でデータを受け取り、検索をかけたいですね。\u003cbr\u003e\nまた、新たにsearchというビューをつくるのではなく、検索した名前はindexに表示させたいので、そのような処理もここに書きましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp/controllers/users_controller.rb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003esearch\u003c/span\u003e\n  \u003cspan class=\"vi\"\u003e@users\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eUser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'name LIKE(?)'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"%\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"ss\"\u003e:keyword\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e%\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e#paramsとして送られてきたkeyword（入力された語句）で、Userモデルのnameカラムを検索し、その結果を@usersに代入する\u003c/span\u003e\n  \u003cspan class=\"n\"\u003erespond_to\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"nb\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e \n    \u003cspan class=\"nb\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003erender\u003c/span\u003e \u003cspan class=\"s1\"\u003e'index'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"vi\"\u003e@users\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e \u003cspan class=\"c1\"\u003e#json形式のデータが返ってきたら、@usersをデータとして渡しながら、indexをrenderで表示する\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e以下のように書くとよりすっきりします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp/controllers/users_controller.rb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003esearch\u003c/span\u003e\n  \u003cspan class=\"vi\"\u003e@users\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eUser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'name LIKE(?)'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"%\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"ss\"\u003e:keyword\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e%\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003erender\u003c/span\u003e \u003cspan class=\"ss\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"vi\"\u003e@users\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コントローラーで検索された内容をjsで表示できるようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E3%81%A7%E6%A4%9C%E7%B4%A2%E3%81%95%E3%82%8C%E3%81%9F%E5%86%85%E5%AE%B9%E3%82%92js%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコントローラーで検索された内容をjsで表示できるようにする\u003c/h2\u003e\n\n\u003cp\u003eさて、今\u003ca href=\"/users\" class=\"user-mention js-hovercard\" title=\"users\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"users\"\u003e@users\u003c/a\u003eにはフォームに入力された語句と部分一致したユーザーの名前の情報が入っています。\u003cbr\u003e\nこれを、一人ずつ名前を表示できるようにしたいですね。\u003cbr\u003e\nここから、一気に書いていきます。\u003c/p\u003e\n\n\u003cp\u003eまずは、ビューに検索結果を表示させる場所を作りましょう。\u003cbr\u003e\nリストとして表示させたいので、ulタグを用意しておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp/views/index.html.erb\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003einput\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eform\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"form\"\u003c/span\u003e \u003cspan class=\"na\"\u003eplaceholder\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ユーザー名を入力してください\"\u003c/span\u003e \u003cspan class=\"na\"\u003estyle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"width: 250px;\"\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c\"\u003e\u0026lt;!-- ここから追記 --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eul\u003c/span\u003e \u003cspan class=\"na\"\u003eid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"result\"\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"c\"\u003e\u0026lt;!-- この中に\u0026lt;li id=\"user_result\"\u0026gt;デデデ大王\u0026lt;/li\u0026gt;みたいに検索候補を追加していきます --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eul\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e次に、ulタグの中に検索結果を表示させるコードを書いていきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp/assets/javascript/user.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'turbolinks:load'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'keyup'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'#form'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epreventDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003einput\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrim\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eval\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eajax\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/users/search'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'GET'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'keyword='\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eprocessData\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econtentType\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003edataType\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'json'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//ここから追記\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e \u003cspan class=\"c1\"\u003e//データを受け取ることに成功したら、dataを引数に取って以下のことする(dataには@usersが入っている状態ですね)\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'#result'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'li'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eremove\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e  \u003cspan class=\"c1\"\u003e//idがresultの子要素のliを削除する\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eeach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e \u003cspan class=\"c1\"\u003e//dataをuserという変数に代入して、以下のことを行う(単純なeach文ですね)\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'#result'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u0026lt;li\u0026gt;'\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u0026lt;/li\u0026gt;'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e//resultというidの要素に対して、\u0026lt;li\u0026gt;ユーザーの名前\u0026lt;/li\u0026gt;を追加する。\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれで全ての実装が終わりました！\u003cbr\u003e\n見た目はしょぼいですが、以下のように表示されていれば成功です！\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/177591/cd61bc31-9084-729d-42cd-1614419e8f9d.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/177591/cd61bc31-9084-729d-42cd-1614419e8f9d.png\" alt=\"スクリーンショット 2017-05-17 21.27.01.png\" title=\"スクリーンショット 2017-05-17 21.27.01.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e('#result').find('#user_result').remove();\u003c/code\u003eという記述をしているのは、同じユーザーネームでも、文字を打つたびに検索結果が追加されていってしまうからです。\u003cbr\u003e\n例えば、'aaaaa'という名前のユーザーがいるとします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eaと入力→\naaaaa\nと表示される\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eaaと入力→\naaaaa\naaaaa\nと表示される\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eaaaと入力→\naaaaa\naaaaa\naaaaa\nと表示される\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実際に試してみると、そのような挙動をするはずです。\u003cbr\u003e\nこれを回避するために、このような記述が必要なのです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h2\u003e\n\n\u003cp\u003e最後まで読んでくださってありがとうございます！\u003cbr\u003e\nインクリメンタルサーチと聞くと、それだけで難しい気がしてしまいますが、実際に行っていることを一つずつ追ってみると、以外と単純だったりします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e文字が入力される\n↓\njsで読み取る\n↓\nコントローラーにjson形式でajax通信でデータを渡す\n↓\nそのデータを元に、like句を使って検索\n↓\n検索結果をjsに返す\n↓\n受け取ったデータをappendで表示する\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e私自身初心者ですが、わからないときは1から順に片付けていくと良いみたいですね！\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"参考資料\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考資料\u003c/h2\u003e\n\n\u003cp\u003e記事中では全く解説しなかったものについて、解説してくれているサイトたちです。\u003c/p\u003e\n\n\u003cp\u003escaffold(スキャフォールド)について\u003cbr\u003e\n\u003ca href=\"https://techacademy.jp/magazine/7204\" rel=\"nofollow noopener\" target=\"_blank\"\u003e覚えておくと超便利！Ruby on Railsのscaffoldの使い方【初心者向け】\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eTurbolinksについて\u003cbr\u003e\n\u003ca href=\"http://qiita.com/jkr_2255/items/fe1e69e043c94a5c0a79\" id=\"reference-006cabd28b45457f6c8c\"\u003eTurbolinks 5とTurbolinks Classic（2.x）の比較\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003epreventDefault()について\u003cbr\u003e\n\u003ca href=\"http://www.koikikukan.com/archives/2013/11/21-023333.php\" rel=\"nofollow noopener\" target=\"_blank\"\u003epreventDefault()について\u003cbr\u003e\n\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eajaxについて\u003cbr\u003e\n\u003ca href=\"http://qiita.com/nekoneko-wanwan/items/bedc0e826c0842ca0b11\" id=\"reference-43b1a50f38f855ed4119\"\u003eはじめてajaxを使うときに知りたかったこと\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ejsonとは\u003cbr\u003e\n\u003ca href=\"http://qiita.com/nishina555/items/bee6dac44ce0ffaf3b93\" id=\"reference-83ac7f329b04d0918acd\"\u003eRailsでJSON形式のデータを取得し、結果を画面に表示させる\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ecollection doについて\u003cbr\u003e\n\u003ca href=\"https://railsguides.jp/routing.html#%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRails のルーティング\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eLIKE句について\u003cbr\u003e\n\u003ca href=\"http://blog.codebook-10000.com/entry/20140413/1397363850\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRailsであいまい検索(LIKE)やAND検索を行う\u003c/a\u003e\u003c/p\u003e\n","body":"\n## そもそもインクリメンタルサーチとは\n検索窓に文字を入力すると、入力ごとに候補を表示させる検索方法です。\nGoogleで何か文字を打つと、検索窓の下に、ピョコンと検索候補が出てきますよね。\nあれです。\n\n## 対象読者\nインクリメンタルサーチに恐怖を覚えている人。\nrails、jqueryの基礎はある程度理解している人。\n\n## 準備\nまず、サンプルとなるアプリケーションを作っていきましょう。\n今回は、scaffoldを使用して進めていきます。\nユーザーの名前と年齢を登録できるアプリケーションを作成してみます。\nターミナルで、以下のコマンドを打ち込みます。\n\n```terminal:ターミナル\nrails new scaffold_sample\nrails g scaffold user name:string age:integer\n\n```\n\n\nすると、MVCで必要なファイルを一気に作成し、ルーティングまで設定してくれます。さらにbundle installまで行ってくれます。\nマイグレーションファイルを確認して、データベースを作成しましょう。\n\n```ruby:db/migrate/0000000000_create_users.rb\nclass CreateUsers \u003c ActiveRecord::Migration[5.0]\n  def change\n    create_table :users do |t|\n      t.string :name\n      t.integer :age\n\n      t.timestamps\n    end\n  end\nend\n```\n\n```terminal:ターミナル\nrake db:migrate\n```\n\nこれでデータベースも作成され、準備が整いました。\nサーバーを立ち上げ、http://localhost:3000/users に接続し、正しく表示がされているか確認してみましょう。\n\n```terminal:ターミナル\nrails s\n```\n\n![スクリーンショット 2017-05-17 19.52.48.png](https://qiita-image-store.s3.amazonaws.com/0/177591/82e7d39e-bcf4-431e-472f-ba95c11c9822.png \"スクリーンショット 2017-05-17 19.52.48.png\")\n\n画像のように表示されていれば成功です。\nでは、試しにユーザー登録をしてみます。\nユーザー情報がデータベースにしっかりと登録ができていれば、下の画像のように表示されます。\n\n![スクリーンショット 2017-05-17 19.54.23.png](https://qiita-image-store.s3.amazonaws.com/0/177591/0c86898a-ff47-10bb-2268-a925b76e4641.png \"スクリーンショット 2017-05-17 19.54.23.png\")\n\n## インクリメンタルサーチを実装する\nさて、ここからいよいよインクリメンタルサーチを実装していきます。\n検索語句を入力したら、その度にユーザー名が表示されるようなものを作っていきます。\n\n### ビューを編集する\nまずは、検索窓をビューに作りましょう。\ninputタグを使い、フォームを作ります。\n\n```html:app/views/index.html.erb\n\u003ch1\u003eUsers\u003c/h1\u003e\n\u003c!-- ここから追記 --\u003e\n\u003cinput type=form id=\"form\" placeholder=\"ユーザー名を入力してください\" style=\"width: 250px;\"/\u003e\n```\n\njsファイルでは、id（もしくはクラス）を指定して実装を進めるので、必ずidを付与しておきます。\n\n### jsファイルで、検索語句を取得する\nさて、これだけでは何も意味を持たないフォームができただけですね。\nこのフォームの情報をjsファイルで取得できるようにしましょう。\napp/assets/javascriptに、user.js（名前は任意）というファイルを作成します。\nその中に、以下のような記述を加えます。\n\n```javascript:app/assets/javascript/user.js\n$(document).on('turbolinks:load', function(){ //リロードしなくてもjsが動くようにする\n  $(document).on('keyup', '#form', function(e){ //このアプリケーション(document)の、formというid('#form')で、キーボードが押され指が離れた瞬間(.on('keyup'...)、eという引数を取って以下のことをしなさい(function(e))\n    e.preventDefault(); //キャンセル可能なイベントをキャンセル\n    var input = $.trim($(this).val()); //inputという変数に(var input =)、この要素に入力された語句を取得し($(this).val())、前後の不要な空白を取り除いた上で代入($.trim(...);)\n  });\n});\n```\nこれでユーザーが入力した検索語句を取得することができました。\n\n### ajaxを用いてデータを渡す\nこのデータを、ajax通信を用いて、json形式でコントローラーに渡します。\n下記のように追記しましょう。\n\n```javascript:app/assets/javascript/user.js\n$(document).on('turbolinks:load', function(){\n    $(document).on('keyup', '#form', function(e){\n    e.preventDefault();\n    var input = $.trim($(this).val());\n    //ここから追記\n    $.ajax({ //ajax通信で以下のことを行います\n      url: '/users/search', //urlを指定\n      type: 'GET', //メソッドを指定\n      data: ('keyword=' + input), //コントローラーに渡すデータを'keyword=input(入力された文字のことですね)'にするように指定\n      processData: false, //おまじない\n      contentType: false, //おまじない\n      dataType: 'json' //データ形式を指定\n    })\n  });\n});\n```\n\nこれで、ajax通信でデータをコントローラーに渡すことができました。\n\n### コントローラーを編集する\nさて、ajaxにてURLは'/users/search'に、メソッドは'GET'を指定しました。\nこれの通り、ルーティングとコントローラーを設定します。\n\n```ruby:config/routes.rb\nRails.application.routes.draw do\n  resources :users do\n    collection do\n      get 'search'\n    end\n  end\n  # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\nend\n```\n\n```ruby:app/controllers/users_controller.rb\ndef search\nend\n# privateの前に追記\n```\n\nこのsearchアクションの中でデータを受け取り、検索をかけたいですね。\nまた、新たにsearchというビューをつくるのではなく、検索した名前はindexに表示させたいので、そのような処理もここに書きましょう。\n\n```ruby:app/controllers/users_controller.rb\ndef search\n  @users = User.where('name LIKE(?)', \"%#{params[:keyword]}%\") #paramsとして送られてきたkeyword（入力された語句）で、Userモデルのnameカラムを検索し、その結果を@usersに代入する\n  respond_to do |format| \n    format.json { render 'index', json: @users }\n  end #json形式のデータが返ってきたら、@usersをデータとして渡しながら、indexをrenderで表示する\nend\n```\n\n以下のように書くとよりすっきりします。\n\n```ruby:app/controllers/users_controller.rb\ndef search\n  @users = User.where('name LIKE(?)', \"%#{params[:keyword]}%\")\n  render json: @users\nend\n```\n\n## コントローラーで検索された内容をjsで表示できるようにする\nさて、今@usersにはフォームに入力された語句と部分一致したユーザーの名前の情報が入っています。\nこれを、一人ずつ名前を表示できるようにしたいですね。\nここから、一気に書いていきます。\n\nまずは、ビューに検索結果を表示させる場所を作りましょう。\nリストとして表示させたいので、ulタグを用意しておきます。\n\n```html:app/views/index.html.erb\n\u003cinput type=form id=\"form\" placeholder=\"ユーザー名を入力してください\" style=\"width: 250px;\"/\u003e\n\u003c!-- ここから追記 --\u003e\n\u003cul id=\"result\"\u003e\n\u003c!-- この中に\u003cli id=\"user_result\"\u003eデデデ大王\u003c/li\u003eみたいに検索候補を追加していきます --\u003e\n\u003c/ul\u003e\n```\n\n次に、ulタグの中に検索結果を表示させるコードを書いていきます。\n\n```javascript:app/assets/javascript/user.js\n$(document).on('turbolinks:load', function(){\n    $(document).on('keyup', '#form', function(e){\n    e.preventDefault();\n    var input = $.trim($(this).val());\n    $.ajax({\n      url: '/users/search',\n      type: 'GET',\n      data: ('keyword=' + input),\n      processData: false,\n      contentType: false,\n      dataType: 'json'\n    })\n    //ここから追記\n    .done(function(data){ //データを受け取ることに成功したら、dataを引数に取って以下のことする(dataには@usersが入っている状態ですね)\n      $('#result').find('li').remove();  //idがresultの子要素のliを削除する\n      $(data).each(function(i, user){ //dataをuserという変数に代入して、以下のことを行う(単純なeach文ですね)\n        $('#result').append('\u003cli\u003e' + user.name + '\u003c/li\u003e') //resultというidの要素に対して、\u003cli\u003eユーザーの名前\u003c/li\u003eを追加する。\n      });\n    })\n  });\n});\n```\n\nこれで全ての実装が終わりました！\n見た目はしょぼいですが、以下のように表示されていれば成功です！\n![スクリーンショット 2017-05-17 21.27.01.png](https://qiita-image-store.s3.amazonaws.com/0/177591/cd61bc31-9084-729d-42cd-1614419e8f9d.png \"スクリーンショット 2017-05-17 21.27.01.png\")\n\n\n`('#result').find('#user_result').remove();`という記述をしているのは、同じユーザーネームでも、文字を打つたびに検索結果が追加されていってしまうからです。\n例えば、'aaaaa'という名前のユーザーがいるとします。\n\n```\naと入力→\naaaaa\nと表示される\n```\n\n```\naaと入力→\naaaaa\naaaaa\nと表示される\n```\n\n```\naaaと入力→\naaaaa\naaaaa\naaaaa\nと表示される\n```\n\n実際に試してみると、そのような挙動をするはずです。\nこれを回避するために、このような記述が必要なのです。\n\n## 最後に\n最後まで読んでくださってありがとうございます！\nインクリメンタルサーチと聞くと、それだけで難しい気がしてしまいますが、実際に行っていることを一つずつ追ってみると、以外と単純だったりします。\n\n```\n文字が入力される\n↓\njsで読み取る\n↓\nコントローラーにjson形式でajax通信でデータを渡す\n↓\nそのデータを元に、like句を使って検索\n↓\n検索結果をjsに返す\n↓\n受け取ったデータをappendで表示する\n```\n\n私自身初心者ですが、わからないときは1から順に片付けていくと良いみたいですね！\n\n## 参考資料\n記事中では全く解説しなかったものについて、解説してくれているサイトたちです。\n\nscaffold(スキャフォールド)について\n[覚えておくと超便利！Ruby on Railsのscaffoldの使い方【初心者向け】](https://techacademy.jp/magazine/7204)\n\nTurbolinksについて\n[Turbolinks 5とTurbolinks Classic（2.x）の比較](http://qiita.com/jkr_2255/items/fe1e69e043c94a5c0a79)\n\npreventDefault()について\n[preventDefault()について\n](http://www.koikikukan.com/archives/2013/11/21-023333.php)\n\najaxについて\n[はじめてajaxを使うときに知りたかったこと](http://qiita.com/nekoneko-wanwan/items/bedc0e826c0842ca0b11)\n\njsonとは\n[RailsでJSON形式のデータを取得し、結果を画面に表示させる](http://qiita.com/nishina555/items/bee6dac44ce0ffaf3b93)\n\ncollection doについて\n[Rails のルーティング](https://railsguides.jp/routing.html#%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B)\n\nLIKE句について\n[Railsであいまい検索(LIKE)やAND検索を行う](http://blog.codebook-10000.com/entry/20140413/1397363850)\n","coediting":false,"created_at":"2017-05-17T21:41:19+09:00","group":null,"id":"fdc5f7d5ac2f128221d1","private":false,"tags":[{"name":"Ruby","versions":[]},{"name":"Rails","versions":[]},{"name":"JSON","versions":[]},{"name":"Ajax","versions":[]}],"title":"Railsでajaxを用いた簡単なインクリメンタルサーチを実装する","updated_at":"2017-05-17T21:55:44+09:00","url":"http://qiita.com/yuki-n/items/fdc5f7d5ac2f128221d1","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":2,"github_login_name":null,"id":"yuki-n","items_count":3,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":177591,"profile_image_url":"https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=50","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003eCollection(model)やmodelをrenderするとき、partialを明確に指定した方がいい。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://stackoverflow.com/questions/22870738/rails-conventional-render-partial-with-objects-within-a-namespace\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://stackoverflow.com/questions/22870738/rails-conventional-render-partial-with-objects-within-a-namespace\u003c/a\u003e\u003c/p\u003e\n","body":"Collection(model)やmodelをrenderするとき、partialを明確に指定した方がいい。\n\nhttp://stackoverflow.com/questions/22870738/rails-conventional-render-partial-with-objects-within-a-namespace\n\n","coediting":false,"created_at":"2017-05-17T21:23:39+09:00","group":null,"id":"d279693635631c296741","private":false,"tags":[{"name":"Rails","versions":[]},{"name":"partial","versions":[]}],"title":"Rails conventional render partial with collection within a namespace","updated_at":"2017-05-17T21:23:39+09:00","url":"http://qiita.com/qiuyin/items/d279693635631c296741","user":{"description":null,"facebook_id":null,"followees_count":2,"followers_count":1,"github_login_name":"qiuyin","id":"qiuyin","items_count":40,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":114912,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/114912/profile-images/1484528293","twitter_screen_name":"JihuaY","website_url":null}},{"rendered_body":"\u003cp\u003ePythonにおける数値の取扱いについて気になるポイントをまとめました。\u003cbr\u003e\n確認したバージョンはPython3.5.1です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"数値の種類\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%95%B0%E5%80%A4%E3%81%AE%E7%A8%AE%E9%A1%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e数値の種類\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# typeで型を調べられる\u003c/span\u003e\n\u003cspan class=\"nb\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eint\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nb\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003efloat\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nb\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003efloat\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://docs.python.jp/3/library/stdtypes.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.python.jp/3/library/stdtypes.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e数値型には 3 種類あります: 整数 、 浮動小数点数 、 複素数 です。さらに、ブール型は整数のサブタイプです。整数には精度の制限がありません。浮動小数点型はたいていは C の double を使って実装されています; あなたのプログラムが動作するマシンでの浮動小数点型の精度と内部表現は、 sys.float_info から利用できます。複素数は実部と虚部を持ち、それぞれ浮動小数点数です。複素数 z から実部および虚部を取り出すには、 z.real および z.imag を使ってください。 (標準ライブラリには、その他の数値型、分数を保持する fractions や、ユーザ定義の精度の浮動小数点数を保持する decimal があります。)\u003c/p\u003e\n\n\u003cp\u003e数値は、数値リテラルによって、あるいは組み込み関数や演算子の戻り値として生成されます。 (十六進、八進、二進数を含む) 修飾のない整数リテラルは、整数を与えます。小数点または指数表記を含む数値リテラルは浮動小数点数を与えます。数値リテラルに 'j' または 'J' をつけると虚数 (実部がゼロの複素数) を与え、それに整数や浮動小数点数を加えて実部と虚部を持つ複素数を得られます。\u003c/p\u003e\n\n\u003cp\u003ePython は型混合の算術演算に完全に対応しています: ある二項算術演算子の被演算子の数値型が互いに異なるとき、より “制限された” 型の被演算子は他方の型に合わせて広げられます。ここで整数は浮動小数点数より制限されており、浮動小数点数は複素数より制限されています。型混合の数値間での比較も同じ規則に従います。 [2] コンストラクタ int() 、 float() 、 complex() で、特定の型の数を生成できます。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eつまり、浮動小数点数の精度違いはない。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# 複素数も浮動小数点に対応\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ecomplex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e(1.5+3j)\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://docs.python.org/3.1/whatsnew/3.0.html#integers\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.python.org/3.1/whatsnew/3.0.html#integers\u003c/a\u003e\u003cbr\u003e\nEssentially, long renamed to int. That is, there is only one built-in integral type, named int; but it behaves mostly like the old long type.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003ePython2-\u0026gt;3で、python2のintが廃止され、python2のlongをrenameして\"int\"にしたらしい\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"decimalを利用する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#decimal%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edecimalを利用する\u003c/h2\u003e\n\n\u003cp\u003eモジュールが必要 \u003ca href=\"https://docs.python.jp/3/library/decimal.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003ereference\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003edecimal\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\n\u003cspan class=\"n\"\u003egetcontext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003egetcontext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e28\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e0.142857\n0.1428571428571428571428571429\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# int型との演算は可能\u003c/span\u003e\n\u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u0026lt;class 'decimal.Decimal'\u0026gt; 0.2857142857142857142857142858\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eDecimal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u0026lt;class 'decimal.Decimal'\u0026gt; 0.2857142857142857142857142858\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"文字列から数値に変換する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%87%E5%AD%97%E5%88%97%E3%81%8B%E3%82%89%E6%95%B0%E5%80%A4%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e文字列から数値に変換する\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003es1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"100\"\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e100\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e100.0\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003es2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"10.5\"\u003c/span\u003e\n\u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e10.5\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"文字列が数値に変換可能かどうか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%87%E5%AD%97%E5%88%97%E3%81%8C%E6%95%B0%E5%80%A4%E3%81%AB%E5%A4%89%E6%8F%9B%E5%8F%AF%E8%83%BD%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e文字列が数値に変換可能かどうか？\u003c/h2\u003e\n\n\u003cp\u003e大まかに３つのアプローチがあり、できることがそれぞれ異なるので、用途によって使い分けるとよさそう。\u003cbr\u003e\n- try-exceptを使う\u003cbr\u003e\n- .isdigit()を使う\u003cbr\u003e\n- regexを使う\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"try-exceptを使う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#try-except%E3%82%92%E4%BD%BF%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etry-exceptを使う\u003c/h3\u003e\n\n\u003cp\u003efloatにcast可能なものが全てTrueとなります。指数表記やNanやInfもTrueとなるので、そこを意図しない場合は注意。\u003cbr\u003e\n \u003ca href=\"http://stackoverflow.com/questions/354038/how-do-i-check-if-a-string-is-a-number-float-in-python\" rel=\"nofollow noopener\" target=\"_blank\"\u003ereference\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# 文字列から数値（float）への変換\u003c/span\u003e\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eval\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e \u003cspan class=\"ne\"\u003eValueError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# True\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"100\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#True\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"10.5\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#True\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\".5\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#True\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"10.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#True\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"10e2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#True\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"NaN\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#True\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Inf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#True\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#False\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"isdigitを使う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#isdigit%E3%82%92%E4%BD%BF%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eisdigitを使う\u003c/h3\u003e\n\n\u003cp\u003e数字か否かを判定する。少数は判定できないので注意。\u003cbr\u003e\n\u003ca href=\"https://docs.python.org/3.6/library/stdtypes.html#str.isdigit\" rel=\"nofollow noopener\" target=\"_blank\"\u003ereference\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# 0-9の数値表現か否か\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"100\"\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisdigit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eTrue\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# 少数は判定できない\u003c/span\u003e\n\u003cspan class=\"s2\"\u003e\"10.1\"\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisdigit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eFalse\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"正規表現を使う\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE%E3%82%92%E4%BD%BF%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e正規表現を使う\u003c/h3\u003e\n\n\u003cp\u003e数値のフォーマットを正規表現で定義して、合致するかどうかを判定する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ere\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^-?\\d+?\\.\\d+?$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eis\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"10.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eTrue\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eis_float_expression\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"-10.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eTrue\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"数値のフォーマット出力\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%95%B0%E5%80%A4%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88%E5%87%BA%E5%8A%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e数値のフォーマット出力\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://docs.python.jp/3/library/stdtypes.html#str.format\" rel=\"nofollow noopener\" target=\"_blank\"\u003ereference\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"The sum of 1 + 2 is {0} ...({1})\"\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e'The sum of 1 + 2 is 3 ...(5)'\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"古いフォーマット指定方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%A4%E3%81%84%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88%E6%8C%87%E5%AE%9A%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e古いフォーマット指定方法\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://docs.python.jp/3/library/stdtypes.html#old-string-formatting\" rel=\"nofollow noopener\" target=\"_blank\"\u003ereference\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"整数：\u003c/span\u003e\u003cspan class=\"si\"\u003e%d\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"少数：\u003c/span\u003e\u003cspan class=\"si\"\u003e%f\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"少数（桁数）：\u003c/span\u003e\u003cspan class=\"si\"\u003e%.02f\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"少数（指数）：\u003c/span\u003e\u003cspan class=\"si\"\u003e%.01e\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.0015\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e整数：1\n少数：1.500000\n少数（桁数）：1.50\n少数（指数）：1.5e-03\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"Pythonにおける数値の取扱いについて気になるポイントをまとめました。\n確認したバージョンはPython3.5.1です。\n\n## 数値の種類\n\n\n```python\n# typeで型を調べられる\ntype(1)\n```\n\n\n\n\n    int\n\n\n\n\n```python\ntype(1.5)\n```\n\n\n\n\n    float\n\n\n\n\n```python\ntype(1.0)\n```\n\n\n\n\n    float\n\n\n\n\u003e https://docs.python.jp/3/library/stdtypes.html\n\n\u003e 数値型には 3 種類あります: 整数 、 浮動小数点数 、 複素数 です。さらに、ブール型は整数のサブタイプです。整数には精度の制限がありません。浮動小数点型はたいていは C の double を使って実装されています; あなたのプログラムが動作するマシンでの浮動小数点型の精度と内部表現は、 sys.float_info から利用できます。複素数は実部と虚部を持ち、それぞれ浮動小数点数です。複素数 z から実部および虚部を取り出すには、 z.real および z.imag を使ってください。 (標準ライブラリには、その他の数値型、分数を保持する fractions や、ユーザ定義の精度の浮動小数点数を保持する decimal があります。)\n\n\u003e 数値は、数値リテラルによって、あるいは組み込み関数や演算子の戻り値として生成されます。 (十六進、八進、二進数を含む) 修飾のない整数リテラルは、整数を与えます。小数点または指数表記を含む数値リテラルは浮動小数点数を与えます。数値リテラルに 'j' または 'J' をつけると虚数 (実部がゼロの複素数) を与え、それに整数や浮動小数点数を加えて実部と虚部を持つ複素数を得られます。\n\n\u003e Python は型混合の算術演算に完全に対応しています: ある二項算術演算子の被演算子の数値型が互いに異なるとき、より “制限された” 型の被演算子は他方の型に合わせて広げられます。ここで整数は浮動小数点数より制限されており、浮動小数点数は複素数より制限されています。型混合の数値間での比較も同じ規則に従います。 [2] コンストラクタ int() 、 float() 、 complex() で、特定の型の数を生成できます。\n\nつまり、浮動小数点数の精度違いはない。\n\n\n```python\n# 複素数も浮動小数点に対応\ncomplex(1.5, 3)\n```\n\n\n\n\n    (1.5+3j)\n\n\n\n\u003e https://docs.python.org/3.1/whatsnew/3.0.html#integers\n\u003e Essentially, long renamed to int. That is, there is only one built-in integral type, named int; but it behaves mostly like the old long type.\n\nPython2-\u003e3で、python2のintが廃止され、python2のlongをrenameして\"int\"にしたらしい\n\n## decimalを利用する\nモジュールが必要 [reference](https://docs.python.jp/3/library/decimal.html)\n\n\n\n```python\nfrom decimal import *\ngetcontext().prec = 6\nprint(Decimal(1) / Decimal(7))\n\ngetcontext().prec = 28\nprint(Decimal(1) / Decimal(7))\n```\n\n    0.142857\n    0.1428571428571428571428571429\n\n\n\n```python\n# int型との演算は可能\nd = (Decimal(1) / Decimal(7)) * 2\nprint(type(d), d)\n```\n\n    \u003cclass 'decimal.Decimal'\u003e 0.2857142857142857142857142858\n\n\n\n```python\nd = 2 * (Decimal(1) / Decimal(7))\nprint(type(d), d)\n```\n\n    \u003cclass 'decimal.Decimal'\u003e 0.2857142857142857142857142858\n\n\n## 文字列から数値に変換する\n\n\n```python\ns1 = \"100\"\nint(s1)\n```\n\n\n\n\n    100\n\n\n\n\n```python\nfloat(s1)\n```\n\n\n\n\n    100.0\n\n\n\n\n```python\ns2 = \"10.5\"\nfloat(s2)\n```\n\n\n\n\n    10.5\n\n\n\n## 文字列が数値に変換可能かどうか？\n大まかに３つのアプローチがあり、できることがそれぞれ異なるので、用途によって使い分けるとよさそう。\n- try-exceptを使う\n- .isdigit()を使う\n- regexを使う\n\n\n### try-exceptを使う\n\nfloatにcast可能なものが全てTrueとなります。指数表記やNanやInfもTrueとなるので、そこを意図しない場合は注意。\n [reference](http://stackoverflow.com/questions/354038/how-do-i-check-if-a-string-is-a-number-float-in-python)\n\n\n```python\n# 文字列から数値（float）への変換\ndef is_float_expression(s):\n    try:\n        val = float(s)\n        return True\n    except ValueError:\n        return False\n\nprint(is_float_expression(100))  # True\nprint(is_float_expression(\"100\")) #True\nprint(is_float_expression(\"10.5\")) #True\nprint(is_float_expression(\".5\")) #True\nprint(is_float_expression(\"10.\")) #True\nprint(is_float_expression(\"10e2\")) #True\nprint(is_float_expression(\"NaN\"))  #True\nprint(is_float_expression(\"Inf\")) #True\nprint(is_float_expression(\"a\")) #False\n```\n\n\n### isdigitを使う\n数字か否かを判定する。少数は判定できないので注意。\n[reference](https://docs.python.org/3.6/library/stdtypes.html#str.isdigit)\n\n\n```python\n# 0-9の数値表現か否か\n\"100\".isdigit()\n```\n\n\n\n\n    True\n\n\n\n\n```python\n# 少数は判定できない\n\"10.1\".isdigit()\n```\n\n\n\n\n    False\n\n\n\n### 正規表現を使う\n数値のフォーマットを正規表現で定義して、合致するかどうかを判定する。\n\n\n```python\nimport re\n\ndef is_float_expression(s):\n    if re.match(\"^-?\\d+?\\.\\d+?$\", s) is None:\n        return False\n    else:\n        return True\n\nis_float_expression(\"10.1\")\n```\n\n\n\n\n    True\n\n\n\n\n```python\nis_float_expression(\"-10.1\")\n```\n\n\n\n\n    True\n\n\n\n## 数値のフォーマット出力\n[reference](https://docs.python.jp/3/library/stdtypes.html#str.format)\n\n\n```python\n\"The sum of 1 + 2 is {0} ...({1})\".format(1+2, 5)\n```\n\n\n\n\n    'The sum of 1 + 2 is 3 ...(5)'\n\n\n\n### 古いフォーマット指定方法\n[reference](https://docs.python.jp/3/library/stdtypes.html#old-string-formatting)\n\n\n```python\nprint(\"整数：%d\" % 1)\nprint(\"少数：%f\" % 1.5)\nprint(\"少数（桁数）：%.02f\" % 1.5)\nprint(\"少数（指数）：%.01e\" % 0.0015)\n```\n\n    整数：1\n    少数：1.500000\n    少数（桁数）：1.50\n    少数（指数）：1.5e-03\n\n\n\n```python\n\n```\n","coediting":false,"created_at":"2017-05-17T21:19:59+09:00","group":null,"id":"137cbc8651ff4931258f","private":false,"tags":[{"name":"Python","versions":[]}],"title":"Python 数値まとめ","updated_at":"2017-05-17T21:19:59+09:00","url":"http://qiita.com/agnelloxy/items/137cbc8651ff4931258f","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":"agnelloxy","id":"agnelloxy","items_count":4,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":142465,"profile_image_url":"https://avatars.githubusercontent.com/u/22500056?v=3","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003eメインスレッド\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003enew Handler(Looper.getMainLooper()).postDelayed(() -\u0026gt; {\n        // do something\n\n}, 5000);\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eサブスレッド\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eHandlerThread handlerThread = new HandlerThread(\"hoge\");\nhandlerThread.start();\nnew Handler(handlerThread.getLooper()).postDelayed(() -\u0026gt; {\n        // do something\n\n}, 5000);\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"\nメインスレッド\n\n```\nnew Handler(Looper.getMainLooper()).postDelayed(() -\u003e {\n        // do something\n        \n}, 5000);\n```\n\nサブスレッド\n\n```\nHandlerThread handlerThread = new HandlerThread(\"hoge\");\nhandlerThread.start();\nnew Handler(handlerThread.getLooper()).postDelayed(() -\u003e {\n        // do something\n\n}, 5000);\n```\n","coediting":false,"created_at":"2017-05-17T21:08:13+09:00","group":null,"id":"d151bb77b072630160e9","private":false,"tags":[{"name":"Android","versions":[]}],"title":"Android 処理をサクッとDelayしたい時","updated_at":"2017-05-17T21:08:13+09:00","url":"http://qiita.com/MuuKojima/items/d151bb77b072630160e9","user":{"description":"東京芸術大学を卒業し、なぜかエンジニアになりました。\r\n日々生きるのに精一杯です...","facebook_id":"muukojima","followees_count":7,"followers_count":7,"github_login_name":"MuuKojima","id":"MuuKojima","items_count":19,"linkedin_id":"","location":"渋谷区","name":"Muu Kojima","organization":"CyberAgent,Inc","permanent_id":33553,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/33553/profile-images/1473686150","twitter_screen_name":"muukojima","website_url":""}},{"rendered_body":"\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/morrr/items/271548776938e7ddc0ec\" id=\"reference-c528cf40a708704cc22c\"\u003e1. 導入編\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/morrr/items/3639f549dcf33992c851\" id=\"reference-6773bdec178091d8f7d8\"\u003e2. コマンド編\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e3. 設定編\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h2\u003e\n\n\u003cp\u003eRedisの設定方法について抜粋した。\u003cbr\u003e\nまたセキュリティ対応、レプリケーション、永続化といった応用項目ごとに、その設定方法をまとめた。\u003c/p\u003e\n\n\u003cp\u003eなおDockerや仮想マシン等の環境に対応するための設定方針については含めていない。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"主要な設定項目\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%BB%E8%A6%81%E3%81%AA%E8%A8%AD%E5%AE%9A%E9%A0%85%E7%9B%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e主要な設定項目\u003c/h2\u003e\n\n\u003cp\u003e各バージョンのソース内に設定ファイルのサンプルがあるので、これをベースに作るといい(\u003ca href=\"https://raw.githubusercontent.com/antirez/redis/3.0/redis.conf\" rel=\"nofollow noopener\" target=\"_blank\"\u003eex. 3.0 redis.conf\u003c/a\u003e)。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e設定ファイルは通常\u003ccode\u003eredis.conf\u003c/code\u003e などと命名する\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e設定ファイル内は、 \u003ccode\u003e\u0026lt;キーワード\u0026gt; \u0026lt;引数1\u0026gt;, \u0026lt;引数2\u0026gt;, ...\u003c/code\u003e の形式で書いていく\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eコメントは他のconfと同様に\u003ccode\u003e#\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"conf以外の設定の指定変更方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#conf%E4%BB%A5%E5%A4%96%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%AE%E6%8C%87%E5%AE%9A%E5%A4%89%E6%9B%B4%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e.conf以外の設定の指定・変更方法\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"サーバの起動時に設定する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AE%E8%B5%B7%E5%8B%95%E6%99%82%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサーバの起動時に設定する\u003c/h4\u003e\n\n\u003cp\u003e設定は、サーバの起動時に直接指定することもできる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e# 設定ファイルに 「port 6380」 と書くのと同じ\n$ redis-server --port 6380\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"クライアントから設定する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%8B%E3%82%89%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eクライアントから設定する\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eCONFIG SET\u003c/code\u003e, \u003ccode\u003eCONFIG GET\u003c/code\u003e, \u003ccode\u003eCONFIG REWRITE\u003c/code\u003e コマンドを使うことで、クライアントから設定を変更できる。\u003cbr\u003e\nサーバを起動したまま設定変更できるが、設定項目には制限がある。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"主要な設定項目-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%BB%E8%A6%81%E3%81%AA%E8%A8%AD%E5%AE%9A%E9%A0%85%E7%9B%AE-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e主要な設定項目\u003c/h3\u003e\n\n\u003cp\u003eよく使いそうな設定項目を抜粋する。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"起動条件\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%B5%B7%E5%8B%95%E6%9D%A1%E4%BB%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e起動条件\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e# 他のconfigファイルを読み込む\ninclude path/to/other_config.conf\n\n# デーモン化 yes/no\ndaemonize no\n\n# デーモン化する場合のPIDファイルのパスを指定\npidfile /var/run/redis.pid\n\n# DB数を設定する\ndatabases 2\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"接続設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8E%A5%E7%B6%9A%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e接続設定\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e# ポートを指定\nport 6379\n\n# クライアントを限定する\nbind 127.0.0.1\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"タイムアウト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%A2%E3%82%A6%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eタイムアウト\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e# タイムアウトを設定する(sec, 0の場合無効)\ntimeout 0\n\n# TCPのKeepAlive機能を設定する(sec)\ntcp-keepalive 0\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"ログ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eログ\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e# ログレベルを設定する(debug \u0026lt; verbose \u0026lt; notice \u0026lt; warning)\nloglevel notice\n\n# ログファイルを指定する(未設定時はSTDOUT)\nlogfile ''\n\n# syslogを使う\nsyslog-enabled no\n\n# syslogのIDを設定する\nsyslog-ident redis\n\n# syslogのファシリティ(分類)を設定する(local0~local7)\nsyslog-facility local0\n\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"スナップショット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスナップショット\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n# ディスクへの保存条件\n# ex. 900秒のうち、1つでもキーが更新されたら保存する\n# saveは時間別に復数設定できる\nsave 900 1\n\n# .rdbファイルの名前を指定する\ndbfilename dump.rdb\n\n# .rdbを圧縮する\nrdbcompression yes\n\n# .rdbにチェックサムを付ける\nrdbchecksum yes\n\n# .rdbを書き込むディレクトリを指定する\ndir ./\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"制限\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%B6%E9%99%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e制限\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e# 最大接続数を設定(10000はデフォルト)\nmaxclients 10000\n\n# メモリの利用可能容量を設定\n# 1k =\u0026gt; 1000 bytes\n# 1kb =\u0026gt; 1024 bytes\n# 1m =\u0026gt; 1000000 bytes\n# 1mb =\u0026gt; 1024*1024 bytes\n# 1g =\u0026gt; 1000000000 bytes\n# 1gb =\u0026gt; 1024*1024*1024 bytes\nmaxmemory 4g\n\n\n# メモリポリシを設定\n# Redisがメモリを使い果たした際の挙動を設定する\n#   volatile-lru      -\u0026gt; 期限切れのキーを、LRUに基づいて削除する\n#   allkeys-lru       -\u0026gt; 全てのキーを、LRUに基づいて削除する\n#   volatile-random   -\u0026gt; 期限切れのキーを、ランダムに削除する\n#   allkeys-random    -\u0026gt; 全てのキーを、ランダムに削除する\n#   volatile-ttl      -\u0026gt; TTLの小さい順にキーを削除する\n#   noeviction        -\u0026gt; 書き込み時にエラーを返すようにする\nmaxmemory-policy noeviction\n\n\n# volatile-ttlの場合のサンプリング頻度を設定する\n# 小さいほど負荷は増すが厳密になる\nmaxmemory-samples 5\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"セキュリティ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eセキュリティ\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"接続を制限する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8E%A5%E7%B6%9A%E3%82%92%E5%88%B6%E9%99%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e接続を制限する\u003c/h3\u003e\n\n\u003cp\u003e外部の不特定多数から、TCP/ソケットでRedisに直接通信できるような状態にすべきではない。\u003cbr\u003e\n設定ファイルによって接続元のIPや、接続数を制限すること。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ebind 127.0.0.1\nmaxclients 3\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"プロテクトモード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%83%86%E3%82%AF%E3%83%88%E3%83%A2%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロテクトモード\u003c/h3\u003e\n\n\u003cp\u003eバージョン3.2.0以降において、以下の場合はプロテクトモード(protected mode)となる。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ebind設定がデフォルトのまま(制限なし)\u003c/li\u003e\n\u003cli\u003e認証系が未設定\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eプロテクトモードの場合は、ローカルホスト(loopback)の場合のみ正常に返答し、それ以外の場合はエラーを返すようになる。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"認証を要求する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AA%8D%E8%A8%BC%E3%82%92%E8%A6%81%E6%B1%82%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e認証を要求する\u003c/h3\u003e\n\n\u003cp\u003e設定ファイルによって認証機能をONにすることができる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"conf\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eredis.conf\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003erequirepass \u0026lt;パスワード平文\u0026gt;\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e認証をONにすると、\u003ccode\u003eAUTH\u003c/code\u003eコマンドによって認証されない限り、Redisはあらゆるコマンドを拒否する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u0026gt; GET 'foo'\n=\u0026gt; (error) NOAUTH Authentication required.\n\n\u0026gt; auth bad_password\n=\u0026gt; (error) ERR invalid password\n\n\u0026gt; auth good_password\n=\u0026gt; OK\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなおAUTHコマンドを含めたすべてのRedisコマンドは平文で送受されるとのこと。\u003cbr\u003e\n不特定多数がアクセスできる状態で運用したい場合はSSLプロキシなどを組み合わせて運用すべし、とのこと。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"コマンドを制限する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%88%B6%E9%99%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコマンドを制限する\u003c/h3\u003e\n\n\u003cp\u003e設定によってコマンドを改変することで、その利用を制限したり、使えなくすることができる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"conf\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eredis.conf\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n# CONFIGコマンドを使えなくする\nrename-command CONFIG ''\n\n# CONFIGコマンドを、知っていないと使えない名前にする\nrename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"その他\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他\u003c/h3\u003e\n\n\u003cp\u003eRedisはインジェクションに対してはライブラリレベルで対応済とのこと(EVALによるLua実行含む)。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"永続化aof\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B0%B8%E7%B6%9A%E5%8C%96aof\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e永続化(AOF)\u003c/h2\u003e\n\n\u003cp\u003eRedisは二種類の方法で、DBを永続化(ファイル保存)できる。\u003cbr\u003e\nどちらも使わずに、完全揮発性のDBとして運用することも可能。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eRDB = 一定時間におけるDBのフルデータ\u003c/li\u003e\n\u003cli\u003eAOF = Append Only File. 書き込み操作のたびに、その操作をロギングする\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eRDBファイルについては導入編、コマンド編を参照のこと。\u003cbr\u003e\nAOFを利用する場合は、設定ファイルで有効化する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"conf\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eredis.conf\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e# AOF有効\nappendonly yes\n\n# AOFファイル名を指定\nappendfilename \"appendonly.aof\"\n\n# AOF追加時のflah()システムコールの利用可否を設定する\n# no        : fsyncしない。速い\n# always    : AOFの書き込みごとに毎回fsyncする。遅いが安全\n# everysec  : 1秒ごとにfsyncする。妥協\n# よくわからない場合はeverysecにしておけ、とのこと\n#\nappendfsync everysec\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eRDBファイルと同様に、設定したパスにAOFファイルがあれば、起動時に読み込まれる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"レプリケーション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AC%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eレプリケーション\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eRedisは、マスタ/スレーブ方式でレプリケーションできる\u003c/li\u003e\n\u003cli\u003eマスタは復数のスレーブを持てる\u003c/li\u003e\n\u003cli\u003eスレーブ同士によるレプリケーションが可能\u003c/li\u003e\n\u003cli\u003eレプリケーション処理はブロッキングが発生しない\u003c/li\u003e\n\u003cli\u003eスレーブは基本的にRead-onlyだが、変更可能\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eまず、マスタに加えてスレーブとなるRedisを復数立ち上げる。\u003cbr\u003e\nスレーブ側のRedisは、設定によってマスタを明示する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"config\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eredis.conf(slave)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n# マスタを指定\n# SLAVEOFコマンドで代替可能\nslaveof 127.0.0.1 6379\n\n# Read-only状態を指定\nslave-read-only yes\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eマスタ側はスレーブの正当性を認証できる\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"config\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eredis.conf(master)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003emasterauth some_plain_password\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eレプリケーション状態は\u003ccode\u003eINFO\u003c/code\u003eコマンドで確認できる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"sentinel\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sentinel\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSentinel\u003c/h2\u003e\n\n\u003cp\u003eRedis Sentinel = 状態監視システム。\u003cbr\u003e\nセンチネルはRedisとは別のバージョン体系が存在し、Redis2.8で正式導入された。\u003c/p\u003e\n\n\u003cp\u003e以下の機能を提供する:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e監視\u003c/li\u003e\n\u003cli\u003e通知\u003c/li\u003e\n\u003cli\u003e自動フェールオーバー\u003c/li\u003e\n\u003cli\u003e接続先サーバの振り分け\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eまた公式による注意点、基本方針として以下が示されている:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eセンチネルはデフォルトではTCP26379ポートをリスンする\u003c/li\u003e\n\u003cli\u003eセンチネル自身も冗長化する必要があるため、通常復数のインスタンスで運用される\u003c/li\u003e\n\u003cli\u003e最低でも3台のセンチネルインスタンスを起動すること\u003c/li\u003e\n\u003cli\u003eそれぞれが独立した環境にデプロイされること\u003c/li\u003e\n\u003cli\u003eセンチネルによる分散システムは、レプリケーションによる同期の成否を保証しないこと\u003c/li\u003e\n\u003cli\u003eクライアントがセンチネルをサポートしているか確認のこと\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"導入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%B0%8E%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e導入\u003c/h3\u003e\n\n\u003cp\u003eセンチネルは\u003ccode\u003eredis-sentinel\u003c/code\u003eコマンドに対して、それ用の設定ファイルを指定して起動する。\u003cbr\u003e\n(設定ファイルは必須)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ redis-sentinel path/to/redis-sentinel.conf\n\n\u003cspan class=\"c1\"\u003e# あるいはredis-serverのオプションで指定する\u003c/span\u003e\n$ redis-server path/to/redis-sentinel.conf --sentinel\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定\u003c/h3\u003e\n\n\u003cp\u003eRedis自体の設定と同様に、ソースに設定のサンプルが含まれるため、これをベースに作るといい。\u003cbr\u003e\n(\u003ca href=\"https://raw.githubusercontent.com/antirez/redis/3.0/sentinel.conf\" rel=\"nofollow noopener\" target=\"_blank\"\u003eex. 3.0 sentinel.conf\u003c/a\u003e)\u003c/p\u003e\n\n\u003cp\u003eセンチネル関連の設定は、\u003ccode\u003esentinel\u003c/code\u003eディレクティブを用いる。\u003cbr\u003e\n方針としては、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e監視対象のマスターごとに、そのグループ名を含む設定を定義していく\u003c/li\u003e\n\u003cli\u003eスレーブに関する情報は自動検出されるため、設定しなくていい\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e設定には、\u003cstrong\u003equorum\u003c/strong\u003eという概念が出て来る。\u003cbr\u003e\nquorumは、\u003cstrong\u003eいくつのセンチネルが異常を発見したら、障害発生とみなすのか\u003c/strong\u003e、その数を意味する。\u003c/p\u003e\n\n\u003cp\u003e以下、主要な設定項目を抜粋:\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"conf\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esentinel.conf\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n# ポートを指定\nport 26379\n\n# グループAを定義\n# 指定のIP/ポートで接続し、2台のセンチネルが障害を観測した時点でフェールオーバする\nsentinel monitor groupA 192.168.0.10 6379 2\n\n# sentinelへの接続用のパスを設定\n# requirepassの設定が優先される様子\nsentinel auth-pass groupA some_password\n\n# 障害発生とみなすためのタイムアウト時間を60,000msecに設定\nsentinel down-after-milliseconds groupA 60000\n\n# フェイルオーバー失敗時の再試行までの時間を180,000msecに設定\nsentinel failover-timeout groupA 180000\n\n# フェイルオーバー時に接続するスレーブの数\n# この数は少ないほど、フェイルオーバーに時間がかかる\nsentinel parallel-syncs groupA 1\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"接続\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8E%A5%E7%B6%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e接続\u003c/h3\u003e\n\n\u003cp\u003eセンチネルへの接続は、Redisと同様に\u003ccode\u003eredis-cli\u003c/code\u003eを使って行う。\u003cbr\u003e\n(あるいはセンチネルに対応したバインディングAPIを用いる)\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# センチネルに接続する\u003c/span\u003e\n$ redis-cli -p \u003cspan class=\"m\"\u003e26379\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e接続後、\u003ccode\u003eSENTINEL\u003c/code\u003eコマンドによって接続先を指定できる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e# groupAのマスタの情報を問い合せ\n\u0026gt; SENTINEL master groupA\n=\u0026gt; 1) \"name\"\n=\u0026gt; 2) \"groupA\"\n=\u0026gt; 3) \"ip\"\n=\u0026gt; 4) \"127.0.0.1\"\n=\u0026gt; 5) \"port\"\n=\u0026gt; 6) \"6379\"\n=\u0026gt; ...\n\n# IPとポートのみ問い合わせ\n\u0026gt; SENTINEL get-master-addr-by-name groupA\n=\u0026gt; 1) \"127.0.0.1\"\n=\u0026gt; 2) \"6379\"\n\n# 同様にスレーブの一覧を問い合せ\n\u0026gt; SENTINEL slaves groupA\n\n# 監視しているセンチネルの一覧を問い合わせ\n\u0026gt; SENTINEL sentinels groupA\n\n\n# フェールオーバーをテストしたい場合はDEBUGを使う\n\u0026gt; DEBUG sleep 30\n\n# 強制フェールオーバーもできる\n\u0026gt; SENTINEL failover groupA\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"未調査項目\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AA%E8%AA%BF%E6%9F%BB%E9%A0%85%E7%9B%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e未調査項目\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e通知とイベントハンドリング\u003c/li\u003e\n\u003cli\u003eDocker, 仮想マシン等のNAT環境下での設定\u003c/li\u003e\n\u003cli\u003eLUAスクリプト\u003c/li\u003e\n\u003cli\u003e監視と計測、パフォーマンスチューン\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://redis.io/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRedis(公式)\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://redis.io/commands\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCommands\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://redis.io/topics/config\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRedis configuration\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://redis.io/topics/security\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRedis Security\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://redis.io/topics/encryption\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRedis Encryption\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://redis.io/topics/persistence\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRedis Persistence\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://redis.io/topics/replication\" rel=\"nofollow noopener\" target=\"_blank\"\u003eReplication\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://redis.io/topics/sentinel\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRedis Sentinel Documentation\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","body":"- [1. 導入編](http://qiita.com/morrr/items/271548776938e7ddc0ec)\n- [2. コマンド編](http://qiita.com/morrr/items/3639f549dcf33992c851)\n- 3. 設定編\n\n## 概要\n\nRedisの設定方法について抜粋した。\nまたセキュリティ対応、レプリケーション、永続化といった応用項目ごとに、その設定方法をまとめた。\n\nなおDockerや仮想マシン等の環境に対応するための設定方針については含めていない。\n\n\n## 主要な設定項目\n\n各バージョンのソース内に設定ファイルのサンプルがあるので、これをベースに作るといい([ex. 3.0 redis.conf](https://raw.githubusercontent.com/antirez/redis/3.0/redis.conf))。\n\n\n\n- 設定ファイルは通常`redis.conf` などと命名する\n\n\n- 設定ファイル内は、 `\u003cキーワード\u003e \u003c引数1\u003e, \u003c引数2\u003e, ...` の形式で書いていく\n    - コメントは他のconfと同様に`#`\n\n\n### .conf以外の設定の指定・変更方法\n\n#### サーバの起動時に設定する\n設定は、サーバの起動時に直接指定することもできる。\n\n```\n# 設定ファイルに 「port 6380」 と書くのと同じ\n$ redis-server --port 6380\n```\n\n#### クライアントから設定する\n\n`CONFIG SET`, `CONFIG GET`, ` CONFIG REWRITE` コマンドを使うことで、クライアントから設定を変更できる。\nサーバを起動したまま設定変更できるが、設定項目には制限がある。\n\n\n### 主要な設定項目\n\nよく使いそうな設定項目を抜粋する。\n\n\n\n#### 起動条件\n\n```\n# 他のconfigファイルを読み込む\ninclude path/to/other_config.conf\n\n# デーモン化 yes/no\ndaemonize no\n\n# デーモン化する場合のPIDファイルのパスを指定\npidfile /var/run/redis.pid\n\n# DB数を設定する\ndatabases 2\n```\n\n#### 接続設定\n\n```\n# ポートを指定\nport 6379\n\n# クライアントを限定する\nbind 127.0.0.1\n```\n\n\n#### タイムアウト\n```\n# タイムアウトを設定する(sec, 0の場合無効)\ntimeout 0\n\n# TCPのKeepAlive機能を設定する(sec)\ntcp-keepalive 0\n```\n\n\n#### ログ\n\n```\n# ログレベルを設定する(debug \u003c verbose \u003c notice \u003c warning)\nloglevel notice\n\n# ログファイルを指定する(未設定時はSTDOUT)\nlogfile ''\n\n# syslogを使う\nsyslog-enabled no\n\n# syslogのIDを設定する\nsyslog-ident redis\n\n# syslogのファシリティ(分類)を設定する(local0~local7)\nsyslog-facility local0\n\n```\n\n#### スナップショット\n\n```\n\n# ディスクへの保存条件\n# ex. 900秒のうち、1つでもキーが更新されたら保存する\n# saveは時間別に復数設定できる\nsave 900 1\n\n# .rdbファイルの名前を指定する\ndbfilename dump.rdb\n\n# .rdbを圧縮する\nrdbcompression yes\n\n# .rdbにチェックサムを付ける\nrdbchecksum yes\n\n# .rdbを書き込むディレクトリを指定する\ndir ./\n```\n\n\n#### 制限\n\n```\n# 最大接続数を設定(10000はデフォルト)\nmaxclients 10000\n\n# メモリの利用可能容量を設定\n# 1k =\u003e 1000 bytes\n# 1kb =\u003e 1024 bytes\n# 1m =\u003e 1000000 bytes\n# 1mb =\u003e 1024*1024 bytes\n# 1g =\u003e 1000000000 bytes\n# 1gb =\u003e 1024*1024*1024 bytes\nmaxmemory 4g\n\n\n# メモリポリシを設定\n# Redisがメモリを使い果たした際の挙動を設定する\n#   volatile-lru      -\u003e 期限切れのキーを、LRUに基づいて削除する\n#   allkeys-lru       -\u003e 全てのキーを、LRUに基づいて削除する\n#   volatile-random   -\u003e 期限切れのキーを、ランダムに削除する\n#   allkeys-random    -\u003e 全てのキーを、ランダムに削除する\n#   volatile-ttl      -\u003e TTLの小さい順にキーを削除する\n#   noeviction        -\u003e 書き込み時にエラーを返すようにする\nmaxmemory-policy noeviction\n\n\n# volatile-ttlの場合のサンプリング頻度を設定する\n# 小さいほど負荷は増すが厳密になる\nmaxmemory-samples 5\n```\nセキュリティ\n------------------------------------------------------------\n\n### 接続を制限する\n外部の不特定多数から、TCP/ソケットでRedisに直接通信できるような状態にすべきではない。\n設定ファイルによって接続元のIPや、接続数を制限すること。\n\n```\nbind 127.0.0.1\nmaxclients 3\n```\n\n### プロテクトモード\n\nバージョン3.2.0以降において、以下の場合はプロテクトモード(protected mode)となる。\n\n- bind設定がデフォルトのまま(制限なし)\n- 認証系が未設定\n\nプロテクトモードの場合は、ローカルホスト(loopback)の場合のみ正常に返答し、それ以外の場合はエラーを返すようになる。\n\n\n### 認証を要求する\n\n設定ファイルによって認証機能をONにすることができる。\n\n```conf:redis.conf\nrequirepass \u003cパスワード平文\u003e\n```\n\n認証をONにすると、`AUTH`コマンドによって認証されない限り、Redisはあらゆるコマンドを拒否する。\n\n\n```\n\u003e GET 'foo'\n=\u003e (error) NOAUTH Authentication required.\n\n\u003e auth bad_password\n=\u003e (error) ERR invalid password\n\n\u003e auth good_password\n=\u003e OK\n```\n\nなおAUTHコマンドを含めたすべてのRedisコマンドは平文で送受されるとのこと。\n不特定多数がアクセスできる状態で運用したい場合はSSLプロキシなどを組み合わせて運用すべし、とのこと。\n\n\n### コマンドを制限する\n\n設定によってコマンドを改変することで、その利用を制限したり、使えなくすることができる。\n\n\n```conf:redis.conf\n\n# CONFIGコマンドを使えなくする\nrename-command CONFIG ''\n\n# CONFIGコマンドを、知っていないと使えない名前にする\nrename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52\n```\n\n### その他\nRedisはインジェクションに対してはライブラリレベルで対応済とのこと(EVALによるLua実行含む)。\n\n\n\n永続化(AOF)\n------------------------------------------------------------\n\nRedisは二種類の方法で、DBを永続化(ファイル保存)できる。\nどちらも使わずに、完全揮発性のDBとして運用することも可能。\n\n- RDB = 一定時間におけるDBのフルデータ\n- AOF = Append Only File. 書き込み操作のたびに、その操作をロギングする\n\n\nRDBファイルについては導入編、コマンド編を参照のこと。\nAOFを利用する場合は、設定ファイルで有効化する。\n\n```conf:redis.conf\n# AOF有効\nappendonly yes\n\n# AOFファイル名を指定\nappendfilename \"appendonly.aof\"\n\n# AOF追加時のflah()システムコールの利用可否を設定する\n# no        : fsyncしない。速い\n# always    : AOFの書き込みごとに毎回fsyncする。遅いが安全\n# everysec  : 1秒ごとにfsyncする。妥協\n# よくわからない場合はeverysecにしておけ、とのこと\n#\nappendfsync everysec\n```\n\nRDBファイルと同様に、設定したパスにAOFファイルがあれば、起動時に読み込まれる。\n\n\nレプリケーション\n------------------------------------------------------------\n- Redisは、マスタ/スレーブ方式でレプリケーションできる\n- マスタは復数のスレーブを持てる\n- スレーブ同士によるレプリケーションが可能\n- レプリケーション処理はブロッキングが発生しない\n- スレーブは基本的にRead-onlyだが、変更可能\n\n\nまず、マスタに加えてスレーブとなるRedisを復数立ち上げる。\nスレーブ側のRedisは、設定によってマスタを明示する。\n\n```config:redis.conf(slave)\n\n# マスタを指定\n# SLAVEOFコマンドで代替可能\nslaveof 127.0.0.1 6379\n\n# Read-only状態を指定\nslave-read-only yes\n```\n\nマスタ側はスレーブの正当性を認証できる\n\n```config:redis.conf(master)\nmasterauth some_plain_password\n```\n\nレプリケーション状態は`INFO`コマンドで確認できる。\n\n\n\nSentinel\n------------------------------------------------------------\n\nRedis Sentinel = 状態監視システム。\nセンチネルはRedisとは別のバージョン体系が存在し、Redis2.8で正式導入された。\n\n以下の機能を提供する:\n\n- 監視\n- 通知\n- 自動フェールオーバー\n- 接続先サーバの振り分け\n\nまた公式による注意点、基本方針として以下が示されている:\n\n- センチネルはデフォルトではTCP26379ポートをリスンする\n- センチネル自身も冗長化する必要があるため、通常復数のインスタンスで運用される\n- 最低でも3台のセンチネルインスタンスを起動すること\n- それぞれが独立した環境にデプロイされること\n- センチネルによる分散システムは、レプリケーションによる同期の成否を保証しないこと\n- クライアントがセンチネルをサポートしているか確認のこと\n\n\n\n### 導入\n\nセンチネルは`redis-sentinel`コマンドに対して、それ用の設定ファイルを指定して起動する。\n(設定ファイルは必須)\n\n```bash\n$ redis-sentinel path/to/redis-sentinel.conf\n\n# あるいはredis-serverのオプションで指定する\n$ redis-server path/to/redis-sentinel.conf --sentinel\n```\n\n### 設定\n\nRedis自体の設定と同様に、ソースに設定のサンプルが含まれるため、これをベースに作るといい。\n([ex. 3.0 sentinel.conf](https://raw.githubusercontent.com/antirez/redis/3.0/sentinel.conf))\n\nセンチネル関連の設定は、`sentinel`ディレクティブを用いる。\n方針としては、\n\n- 監視対象のマスターごとに、そのグループ名を含む設定を定義していく\n- スレーブに関する情報は自動検出されるため、設定しなくていい\n\n設定には、__quorum__という概念が出て来る。\nquorumは、__いくつのセンチネルが異常を発見したら、障害発生とみなすのか__、その数を意味する。\n\n以下、主要な設定項目を抜粋:\n\n\n```conf:sentinel.conf\n\n# ポートを指定\nport 26379\n\n# グループAを定義\n# 指定のIP/ポートで接続し、2台のセンチネルが障害を観測した時点でフェールオーバする\nsentinel monitor groupA 192.168.0.10 6379 2\n\n# sentinelへの接続用のパスを設定\n# requirepassの設定が優先される様子\nsentinel auth-pass groupA some_password\n\n# 障害発生とみなすためのタイムアウト時間を60,000msecに設定\nsentinel down-after-milliseconds groupA 60000\n\n# フェイルオーバー失敗時の再試行までの時間を180,000msecに設定\nsentinel failover-timeout groupA 180000\n\n# フェイルオーバー時に接続するスレーブの数\n# この数は少ないほど、フェイルオーバーに時間がかかる\nsentinel parallel-syncs groupA 1\n```\n\n### 接続\n\nセンチネルへの接続は、Redisと同様に`redis-cli`を使って行う。\n(あるいはセンチネルに対応したバインディングAPIを用いる)\n\n\n```bash\n# センチネルに接続する\n$ redis-cli -p 26379\n```\n\n接続後、`SENTINEL`コマンドによって接続先を指定できる。\n\n```\n# groupAのマスタの情報を問い合せ\n\u003e SENTINEL master groupA\n=\u003e 1) \"name\"\n=\u003e 2) \"groupA\"\n=\u003e 3) \"ip\"\n=\u003e 4) \"127.0.0.1\"\n=\u003e 5) \"port\"\n=\u003e 6) \"6379\"\n=\u003e ...\n\n# IPとポートのみ問い合わせ\n\u003e SENTINEL get-master-addr-by-name groupA\n=\u003e 1) \"127.0.0.1\"\n=\u003e 2) \"6379\"\n\n# 同様にスレーブの一覧を問い合せ\n\u003e SENTINEL slaves groupA\n\n# 監視しているセンチネルの一覧を問い合わせ\n\u003e SENTINEL sentinels groupA\n\n\n# フェールオーバーをテストしたい場合はDEBUGを使う\n\u003e DEBUG sleep 30\n\n# 強制フェールオーバーもできる\n\u003e SENTINEL failover groupA\n```\n\n\n未調査項目\n------------------------------------------------------------\n- 通知とイベントハンドリング\n- Docker, 仮想マシン等のNAT環境下での設定\n- LUAスクリプト\n- 監視と計測、パフォーマンスチューン\n\n\n## 参考\n- [Redis(公式)](https://redis.io/)\n    - [Commands](https://redis.io/commands)\n    - [Redis configuration](https://redis.io/topics/config)\n    - [Redis Security](https://redis.io/topics/security)\n    - [Redis Encryption](https://redis.io/topics/encryption)\n    - [Redis Persistence](https://redis.io/topics/persistence)\n    - [Replication](https://redis.io/topics/replication)\n    - [Redis Sentinel Documentation](https://redis.io/topics/sentinel)\n\n\n","coediting":false,"created_at":"2017-05-17T21:01:18+09:00","group":null,"id":"26dbdd87df03315fa680","private":false,"tags":[{"name":"Redis","versions":[]}],"title":"Redisチートシート(設定編)","updated_at":"2017-05-17T21:01:18+09:00","url":"http://qiita.com/morrr/items/26dbdd87df03315fa680","user":{"description":"モバイル/webプログラマ。\r\n- iOS/Android/Webアプリの設計・実装\r\n- Web/DBサーバの設計・構築・保守\r\n\r\nなどを主な仕事にしています。","facebook_id":"","followees_count":6,"followers_count":1,"github_login_name":"morrr","id":"morrr","items_count":26,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":66479,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/66479/profile-images/1473697222","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003ePerlの調べ物をしているとしばしばpureperl、ピュアPerlなどという謎単語が出てきます。\u003cbr\u003e\nそれについてのまとめ。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://wiki.suikawiki.org/n/PurePerl\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePurePerl\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e[1]XS を使わず純粋に Perl だけで書かれていることを、 pure perl といいます。\u003cbr\u003e\n[2]XS 版と pure perl 版があるとき、前者を Hoge::XS、後者を Hoge::PP のように命名する慣習があります。\u003cbr\u003e\n[3] PP 版は XS 版より動作速度で劣ることもありますが、 可搬性に優れ扱いやすいため好まれることがよくあります。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003ca href=\"http://www.perlmonks.org/?node_id=709757\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWhat defines \"Pure Perl\"?\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://metacpan.org/pod/Unicode::Japanese\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUnicode::Japanese - Convert encoding of japanese text - metacpan.org\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003euse Unicode::Japanese qw(PurePerl);\u003cbr\u003e\nIf you want to explicitly take the pure perl implementation, pass 'PurePerl' to the argument of the use statement.\u003c/p\u003e\n\u003c/blockquote\u003e\n","body":"Perlの調べ物をしているとしばしばpureperl、ピュアPerlなどという謎単語が出てきます。\nそれについてのまとめ。\n\n[PurePerl](https://wiki.suikawiki.org/n/PurePerl)\n\u003e\n[1]XS を使わず純粋に Perl だけで書かれていることを、 pure perl といいます。\n[2]XS 版と pure perl 版があるとき、前者を Hoge::XS、後者を Hoge::PP のように命名する慣習があります。\n[3] PP 版は XS 版より動作速度で劣ることもありますが、 可搬性に優れ扱いやすいため好まれることがよくあります。\n\n[What defines \"Pure Perl\"?](http://www.perlmonks.org/?node_id=709757)\n\n\n[Unicode::Japanese \\- Convert encoding of japanese text \\- metacpan\\.org](https://metacpan.org/pod/Unicode::Japanese)\n\n\u003e\nuse Unicode::Japanese qw(PurePerl);\nIf you want to explicitly take the pure perl implementation, pass 'PurePerl' to the argument of the use statement.\n","coediting":false,"created_at":"2017-05-17T20:58:10+09:00","group":null,"id":"c042a183ff4da5ef0f57","private":false,"tags":[{"name":"Perl","versions":[]}],"title":"PurePerlとは何を意味するのか？","updated_at":"2017-05-17T20:58:10+09:00","url":"http://qiita.com/ymko/items/c042a183ff4da5ef0f57","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":18,"github_login_name":"ymko","id":"ymko","items_count":114,"linkedin_id":"","location":"","name":"ymko diary","organization":"","permanent_id":33674,"profile_image_url":"https://1.gravatar.com/avatar/acde83b69cbac8d8fbdfdedf081e4212?d=https%3A%2F%2Fidenticons.github.com%2F59106af7b85a3358ef9971394a8fabb6.png\u0026r=x","twitter_screen_name":null,"website_url":"http://d.hatena.ne.jp/ymko/"}},{"rendered_body":"\n\u003ch2\u003e\n\u003cspan id=\"rkwardについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rkward%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRKWardについて\u003c/h2\u003e\n\n\u003cp\u003e「RKWard」は、GUIでRを使った分析ができる統計ソフトで、SPSSのようにスプレッドシート形式のインターフェイスで直接データの入力や編集も可能です。しかも出力はHTMLであり、画像はSVGで自動保存されるという優れものです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"本体のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E4%BD%93%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本体のインストール\u003c/h2\u003e\n\n\u003cp\u003e「RKWard」は、ubuntuの標準リポジトリに登録されているので、\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eapt install rkward\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eでインストールすることができます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プラグインのインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプラグインのインストール\u003c/h2\u003e\n\n\u003cp\u003e優れたソフトフェアではあるものの、現在、いくつかの分析は実装されていません。Rのスクリプト自体を走らせることもできるので、いくらでも新しい分析手法が使えるのですが、せっかくGUIで分析ができるので、同じ操作で分析できた方がいいです。\u003cbr\u003e\n幸い、分散分析（anova）とペアワイズのｔ検定に関しては、プラグインがありますので、これを追加しておきます。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://rkward.sourceforge.net/R/pckg/rk.ANOVA/deb_repo.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://rkward.sourceforge.net/R/pckg/rk.ANOVA/deb_repo.html\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eにdebパッケージがあるので、これをダウンロードしてきて、インストールします。\u003c/p\u003e\n\n\u003cp\u003eここで「RKWard」を起動します。すると、先ほどのプラグインが自動的に検出されるので、ダイアログの指示通りに登録します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"リポジトリの登録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%AE%E7%99%BB%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリポジトリの登録\u003c/h2\u003e\n\n\u003cp\u003eさて、この段階でインストールされている「RKWard」は最新版でないこともあります。2017年5月16日段階では、0.6.4.1でした。しかし、この時点での最新版は、0.6.5です。\u003c/p\u003e\n\n\u003cp\u003eそこで、「RKWard Official Stable Releases」をリポジトリに登録し更新します。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003esudo add-apt-repository ppa:rkward-devel/rkward-stable\u003cbr\u003e\nsudo apt update\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e更新ファイルがあれば、通常の手続きで、\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003esudo apt upgrade -y\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eを実行します。そうすると、すべての更新がインストールされます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h2\u003e\n\n\u003cp\u003eリポジトリを更新してからインストールすればよさそうなものなのですが、そうした場合、「RKWard」を起動した際に、肝心のRが読み込めず、分析が行えないというエラーが発生してしまいました。\u003cbr\u003e\nそういうわけですので、この手順がよさそうです。\u003c/p\u003e\n","body":"## RKWardについて\n\n「RKWard」は、GUIでRを使った分析ができる統計ソフトで、SPSSのようにスプレッドシート形式のインターフェイスで直接データの入力や編集も可能です。しかも出力はHTMLであり、画像はSVGで自動保存されるという優れものです。\n\n## 本体のインストール\n「RKWard」は、ubuntuの標準リポジトリに登録されているので、\n\n\u003e apt install rkward\n\nでインストールすることができます。\n\n## プラグインのインストール\n優れたソフトフェアではあるものの、現在、いくつかの分析は実装されていません。Rのスクリプト自体を走らせることもできるので、いくらでも新しい分析手法が使えるのですが、せっかくGUIで分析ができるので、同じ操作で分析できた方がいいです。\n幸い、分散分析（anova）とペアワイズのｔ検定に関しては、プラグインがありますので、これを追加しておきます。\n\n\u003e http://rkward.sourceforge.net/R/pckg/rk.ANOVA/deb_repo.html\n\nにdebパッケージがあるので、これをダウンロードしてきて、インストールします。\n\nここで「RKWard」を起動します。すると、先ほどのプラグインが自動的に検出されるので、ダイアログの指示通りに登録します。\n\n## リポジトリの登録\n\nさて、この段階でインストールされている「RKWard」は最新版でないこともあります。2017年5月16日段階では、0.6.4.1でした。しかし、この時点での最新版は、0.6.5です。\n\nそこで、「RKWard Official Stable Releases」をリポジトリに登録し更新します。\n\n\u003e sudo add-apt-repository ppa:rkward-devel/rkward-stable\n\u003e sudo apt update\n\n更新ファイルがあれば、通常の手続きで、\n\n\u003e sudo apt upgrade -y\n\nを実行します。そうすると、すべての更新がインストールされます。\n\n## 最後に\nリポジトリを更新してからインストールすればよさそうなものなのですが、そうした場合、「RKWard」を起動した際に、肝心のRが読み込めず、分析が行えないというエラーが発生してしまいました。\nそういうわけですので、この手順がよさそうです。\n","coediting":false,"created_at":"2017-05-17T20:57:51+09:00","group":null,"id":"88bd984485acdc779943","private":false,"tags":[{"name":"R","versions":[]}],"title":"【メモ】「Ｒ」をGUIで扱う統計ソフト「RKWard」をUbuntuで使う準備。","updated_at":"2017-05-17T20:57:51+09:00","url":"http://qiita.com/xin1zu2zhai1/items/88bd984485acdc779943","user":{"description":"","facebook_id":"xiushu.chuankou","followees_count":11,"followers_count":1,"github_login_name":null,"id":"xin1zu2zhai1","items_count":1,"linkedin_id":"xiushuchuankou","location":"Osaka,JAPAN","name":"xiushu chuankou","organization":"WAO corporation","permanent_id":154268,"profile_image_url":"https://pbs.twimg.com/profile_images/529961789048385538/afx3QV3R_normal.png","twitter_screen_name":"xin1zu2zhai1","website_url":"https://note.mu/xinzuzhai"}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"こんな環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%82%93%E3%81%AA%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこんな環境\u003c/h1\u003e\n\n\u003cp\u003eApache web server\u003cbr\u003e\nTomcat\u003cbr\u003e\nhoge-hoge.war (SpringBoot 1.5)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"原因\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8E%9F%E5%9B%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e原因\u003c/h1\u003e\n\n\u003cp\u003ehttpd-proxy.conf で　\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u0026lt;Location /hoge/\u0026gt;\n  省略\n\u0026lt;/Location\u0026gt;\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eというふうに、deployしてるアプリ名とURLがアンマッチだから。\u003cbr\u003e\n何、URLって変更できんの。リダイレクトとか無しで。\u003cbr\u003e\nProxyPassReverseCookiePath チョメチョメ\u003cbr\u003e\nって書けばSeesion使えるようになるみたいだけど、よーわからんので\u003cbr\u003e\napplication名とurl同じ（hoge.war）にしますた。\u003c/p\u003e\n\n\u003cp\u003eしたら\u003ca href=\"/sessionScope\" class=\"user-mention js-hovercard\" title=\"sessionScope\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"sessionScope\"\u003e@sessionScope\u003c/a\u003eききますた。\u003c/p\u003e\n","body":"#こんな環境\nApache web server\nTomcat\nhoge-hoge.war (SpringBoot 1.5)\n\n#原因\nhttpd-proxy.conf で　\n\n```\n\u003cLocation /hoge/\u003e\n  省略\n\u003c/Location\u003e\n```\n\nというふうに、deployしてるアプリ名とURLがアンマッチだから。\n何、URLって変更できんの。リダイレクトとか無しで。\nProxyPassReverseCookiePath チョメチョメ\nって書けばSeesion使えるようになるみたいだけど、よーわからんので\napplication名とurl同じ（hoge.war）にしますた。\n\nしたら@sessionScopeききますた。\n","coediting":false,"created_at":"2017-05-17T20:57:00+09:00","group":null,"id":"ee1c180ac72f9df3ecbe","private":false,"tags":[{"name":"Apache","versions":[]},{"name":"Tomcat","versions":[]},{"name":"spring-boot","versions":[]}],"title":"Springで@SessionScopeが効かねぇ！","updated_at":"2017-05-17T20:58:47+09:00","url":"http://qiita.com/tabataba20/items/ee1c180ac72f9df3ecbe","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":null,"id":"tabataba20","items_count":1,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":182033,"profile_image_url":"https://pbs.twimg.com/profile_images/864803704125308928/-gl2TEA9_normal.jpg","twitter_screen_name":"tabataba20","website_url":null}},{"rendered_body":"\n\u003ch2\u003e\n\u003cspan id=\"通知アイコンを作成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%9A%E7%9F%A5%E3%82%A2%E3%82%A4%E3%82%B3%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e通知アイコンを作成する\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"http://components.onsen.io/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnsen UIテーマローラ\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://hatopp.wpblog.jp/archives/385\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【Monaca】Onsen UIのツールバーのメニューアイコンにバッジを表示する\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/25110895/onsenui-tabbar-with-badger-notification\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOnsenUI : Tabbar with badger notification\u003c/a\u003e\u003c/p\u003e\n","body":"\n## 通知アイコンを作成する\n\n[Onsen UIテーマローラ](http://components.onsen.io/)\n[【Monaca】Onsen UIのツールバーのメニューアイコンにバッジを表示する](http://hatopp.wpblog.jp/archives/385)\n[OnsenUI : Tabbar with badger notification](http://stackoverflow.com/questions/25110895/onsenui-tabbar-with-badger-notification)\n","coediting":false,"created_at":"2017-05-17T20:52:11+09:00","group":null,"id":"a540c9af038e971f3e80","private":false,"tags":[{"name":"onsenui","versions":[]}],"title":"OnsenUIをつかってアプリを作る","updated_at":"2017-05-17T20:52:11+09:00","url":"http://qiita.com/zakki/items/a540c9af038e971f3e80","user":{"description":"","facebook_id":"","followees_count":1,"followers_count":1,"github_login_name":"1206yaya","id":"zakki","items_count":20,"linkedin_id":"","location":"Tokyo, Japan","name":"Aya Yamazaki","organization":"","permanent_id":33237,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/33237/profile-images/1473686078","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eiOSと違ってmacOSの標準コントロールはXcode上（Interface Builder）で自由に色等の外観のカスタマイズができませんが、NSAppearanceをいじることで外観を変えることができます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"nsappearanceをいじって標準のdarklightテーマをかけてみた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nsappearance%E3%82%92%E3%81%84%E3%81%98%E3%81%A3%E3%81%A6%E6%A8%99%E6%BA%96%E3%81%AEdarklight%E3%83%86%E3%83%BC%E3%83%9E%E3%82%92%E3%81%8B%E3%81%91%E3%81%A6%E3%81%BF%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eNSAppearanceをいじって標準のDark/Lightテーマをかけてみた\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"作ったもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e作ったもの\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/61792/f28d9cf1-3e77-a6c7-89d2-6aa477faa9c3.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/61792/f28d9cf1-3e77-a6c7-89d2-6aa477faa9c3.png\" alt=\"スクリーンショット 2017-05-17 19.51.02.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e左がdark、右がLightです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSample.swift\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003edarkView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappearance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNSAppearance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enamed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNSAppearanceNameVibrantDark\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003elightView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappearance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNSAppearance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enamed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNSAppearanceNameVibrantLight\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eViewにAppearanceを設定するだけです。それぞれのViewに所属するControlたちの外観が変わります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"じゃあなんかカスタマイズしてみたい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%98%E3%82%83%E3%81%82%E3%81%AA%E3%82%93%E3%81%8B%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eじゃあ、なんかカスタマイズしてみたい\u003c/h2\u003e\n\n\u003cp\u003eNSAppearanceのイニシャライザを見てみます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNSAppearance\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e?(\u003c/span\u003e\u003cspan class=\"n\"\u003enamed\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e?(\u003c/span\u003e\u003cspan class=\"n\"\u003eappearanceNamed\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebundle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eBundle\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e上は、上記サンプルで使ったイニシャライザですが、darkかlightしか選べません。\u003cbr\u003e\n下は、なんかファイル読み込んでAppearanceを作る感じに見えますが、具体的にどうすれば良いかはリファレンスに記載されていませんでした。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"appearance-maker\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#appearance-maker\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAppearance Maker\u003c/h1\u003e\n\n\u003cp\u003eAppearance Maker を使うと、Appearanceのカスタマイズに必要なファイルを生成することができます。\u003c/p\u003e\n\n\u003cp\u003e以下が今回作ったサンプルです。ボタンが無駄にオレンジです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/61792/956cff98-141c-eeed-617f-46268c411e1e.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/61792/956cff98-141c-eeed-617f-46268c411e1e.png\" alt=\"スクリーンショット 2017-05-17 19.35.39.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eボタンの他にも各種ControlやWindowなど色々いじれる他、Disabledや非アクティブ時の外観もカスタマイズすることができます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/61792/2db1e270-d461-0e2c-4400-87163b8a1fee.gif\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/61792/2db1e270-d461-0e2c-4400-87163b8a1fee.gif\" alt=\"3cd4c685d553117a891384ad5e2df16e.gif\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eIndicatorのアニメーションもこの通り無駄にカスタマイズできます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"mac標準uiをカスタマイズしてみた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#mac%E6%A8%99%E6%BA%96ui%E3%82%92%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMac標準UIをカスタマイズしてみた\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e準備\u003c/h2\u003e\n\n\u003cp\u003e以下からプロジェクトを落として、Appearance Makerをビルドします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/insidegui/AppearanceMaker\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/insidegui/AppearanceMaker\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eアプリが起動したらプロジェクトの保存先を選択します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"カスタマイズするコントロールを選択\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%92%E9%81%B8%E6%8A%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eカスタマイズするコントロールを選択\u003c/h2\u003e\n\n\u003cp\u003e画面上の方にあるCategory / ElementからいじりたいControlを選択します。\u003cbr\u003e\n選択したらCustomizeをクリックします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/61792/efcb0913-b0a5-600f-6222-6813d8484f75.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/61792/efcb0913-b0a5-600f-6222-6813d8484f75.png\" alt=\"スクリーンショット 2017-05-17 19.13.27.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eすると、作業フォルダ（xx-Artworkフォルダ）にpsdファイルが作成されます。\u003cbr\u003e\nこのPSDファイルをいじります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"psdファイルいじり\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#psd%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%84%E3%81%98%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePSDファイルいじり\u003c/h2\u003e\n\n\u003cp\u003ePSDファイルを開くとこんな感じ。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/61792/74ade96d-af4c-2a20-78d6-c77d668208aa.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/61792/74ade96d-af4c-2a20-78d6-c77d668208aa.png\" alt=\"スクリーンショット 2017-05-17 19.15.17.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e各レイヤーにControlの状態が描かれていますので、カスタマイズしたいレイヤーを好きにいじります。\u003cbr\u003e\n今回はボタンをオレンジに変更します。\u003c/p\u003e\n\n\u003cp\u003e変更したらPSDファイルを保存してAppearance Makerに戻ります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プレビュー\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプレビュー\u003c/h2\u003e\n\n\u003cp\u003e編集が終わったら、プレビューが更新されているかと思います。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/61792/a33ce03b-1b74-2ce1-d710-090b8ec4d323.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/61792/a33ce03b-1b74-2ce1-d710-090b8ec4d323.png\" alt=\"スクリーンショット 2017-05-17 20.29.09.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eさらにpreviewタブをクリックすると作ったボタンをプレビューすることができます。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/61792/c45950f3-46ee-4e47-4ec9-a8a31bfc898f.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/61792/c45950f3-46ee-4e47-4ec9-a8a31bfc898f.png\" alt=\"スクリーンショット 2017-05-17 19.35.03.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなんかうまくできてそう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ファイル書き出し\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eファイル書き出し\u003c/h2\u003e\n\n\u003cp\u003eAppearanceを作るために必要なファイルを書き出します。\u003cbr\u003e\nMenu → File → ExportAppearanceでファイルを書き出します。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003exx.car\u003c/code\u003eというファイルができているかと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"xcodeでプロジェクトを作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#xcode%E3%81%A7%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eXcodeでプロジェクトを作成\u003c/h2\u003e\n\n\u003cp\u003e適当にmacOSプロジェクトを作成し、先ほど作った.carファイルをプロジェクトに追加します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"viewを作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#view%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eViewを作る\u003c/h2\u003e\n\n\u003cp\u003eViewにボタンを追加します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/61792/6dd01ada-aa83-8f08-b21d-7eaafe7270d6.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"1278\" alt=\"スクリーンショット 2017-05-17 19.35.58.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/61792/6dd01ada-aa83-8f08-b21d-7eaafe7270d6.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"appearanceの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#appearance%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAppearanceの設定\u003c/h2\u003e\n\n\u003cp\u003eViewにAppearanceの設定をします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eViewController.swift\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eCocoa\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNSViewController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"kr\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eviewDidLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kc\"\u003esuper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eviewDidLoad\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappearance\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNSAppearance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eappearanceNamed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"sample\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebundle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// .carファイル名\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれでビルドするとAppearanceが当たるようになるかと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"補足appstoreでの配布について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A3%9C%E8%B6%B3appstore%E3%81%A7%E3%81%AE%E9%85%8D%E5%B8%83%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e補足（AppStoreでの配布について）\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e.carファイルをつくためにPrivate APIを使用しているそうです\u003c/li\u003e\n\u003cli\u003eしかし、NSAppearance自体はPublicなのでまあAppStoreに出しても大丈夫じゃね？とのこと(\u003ca href=\"https://github.com/emiscience/AppearanceMaker\" rel=\"nofollow noopener\" target=\"_blank\"\u003eReadme\u003c/a\u003eより)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://developer.apple.com/reference/appkit/nsappearance\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://developer.apple.com/reference/appkit/nsappearance\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/insidegui/AppearanceMaker\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/insidegui/AppearanceMaker\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/emiscience/AppearanceMaker\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/emiscience/AppearanceMaker\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# はじめに\n\niOSと違ってmacOSの標準コントロールはXcode上（Interface Builder）で自由に色等の外観のカスタマイズができませんが、NSAppearanceをいじることで外観を変えることができます。\n\n# NSAppearanceをいじって標準のDark/Lightテーマをかけてみた\n\n## 作ったもの\n![スクリーンショット 2017-05-17 19.51.02.png](https://qiita-image-store.s3.amazonaws.com/0/61792/f28d9cf1-3e77-a6c7-89d2-6aa477faa9c3.png)\n\n左がdark、右がLightです。\n\n## コード\n\n```swift:Sample.swift\ndarkView.appearance = NSAppearance(named: NSAppearanceNameVibrantDark)\nlightView.appearance = NSAppearance(named: NSAppearanceNameVibrantLight)\n```\n\nViewにAppearanceを設定するだけです。それぞれのViewに所属するControlたちの外観が変わります。\n\n## じゃあ、なんかカスタマイズしてみたい\n\nNSAppearanceのイニシャライザを見てみます\n\n```swift:NSAppearance\ninit?(named name: String)\ninit?(appearanceNamed name: String, bundle: Bundle?)\n```\n上は、上記サンプルで使ったイニシャライザですが、darkかlightしか選べません。\n下は、なんかファイル読み込んでAppearanceを作る感じに見えますが、具体的にどうすれば良いかはリファレンスに記載されていませんでした。\n\n# Appearance Maker\n\nAppearance Maker を使うと、Appearanceのカスタマイズに必要なファイルを生成することができます。\n\n以下が今回作ったサンプルです。ボタンが無駄にオレンジです。\n\n![スクリーンショット 2017-05-17 19.35.39.png](https://qiita-image-store.s3.amazonaws.com/0/61792/956cff98-141c-eeed-617f-46268c411e1e.png)\n\nボタンの他にも各種ControlやWindowなど色々いじれる他、Disabledや非アクティブ時の外観もカスタマイズすることができます。\n\n![3cd4c685d553117a891384ad5e2df16e.gif](https://qiita-image-store.s3.amazonaws.com/0/61792/2db1e270-d461-0e2c-4400-87163b8a1fee.gif)\n\nIndicatorのアニメーションもこの通り無駄にカスタマイズできます。\n\n# Mac標準UIをカスタマイズしてみた\n## 準備\n以下からプロジェクトを落として、Appearance Makerをビルドします。\n\nhttps://github.com/insidegui/AppearanceMaker\n\nアプリが起動したらプロジェクトの保存先を選択します。\n\n## カスタマイズするコントロールを選択\n\n画面上の方にあるCategory / ElementからいじりたいControlを選択します。\n選択したらCustomizeをクリックします。\n\n![スクリーンショット 2017-05-17 19.13.27.png](https://qiita-image-store.s3.amazonaws.com/0/61792/efcb0913-b0a5-600f-6222-6813d8484f75.png)\n\nすると、作業フォルダ（xx-Artworkフォルダ）にpsdファイルが作成されます。\nこのPSDファイルをいじります。\n\n## PSDファイルいじり\nPSDファイルを開くとこんな感じ。\n\n![スクリーンショット 2017-05-17 19.15.17.png](https://qiita-image-store.s3.amazonaws.com/0/61792/74ade96d-af4c-2a20-78d6-c77d668208aa.png)\n\n各レイヤーにControlの状態が描かれていますので、カスタマイズしたいレイヤーを好きにいじります。\n今回はボタンをオレンジに変更します。\n\n変更したらPSDファイルを保存してAppearance Makerに戻ります。\n\n## プレビュー\n\n編集が終わったら、プレビューが更新されているかと思います。\n\n![スクリーンショット 2017-05-17 20.29.09.png](https://qiita-image-store.s3.amazonaws.com/0/61792/a33ce03b-1b74-2ce1-d710-090b8ec4d323.png)\n\nさらにpreviewタブをクリックすると作ったボタンをプレビューすることができます。\n![スクリーンショット 2017-05-17 19.35.03.png](https://qiita-image-store.s3.amazonaws.com/0/61792/c45950f3-46ee-4e47-4ec9-a8a31bfc898f.png)\n\nなんかうまくできてそう。\n\n## ファイル書き出し\nAppearanceを作るために必要なファイルを書き出します。\nMenu → File → ExportAppearanceでファイルを書き出します。\n\n`xx.car`というファイルができているかと思います。\n\n## Xcodeでプロジェクトを作成\n適当にmacOSプロジェクトを作成し、先ほど作った.carファイルをプロジェクトに追加します。\n\n## Viewを作る\n\nViewにボタンを追加します。\n\n\u003cimg width=\"1278\" alt=\"スクリーンショット 2017-05-17 19.35.58.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/61792/6dd01ada-aa83-8f08-b21d-7eaafe7270d6.png\"\u003e\n\n## Appearanceの設定\nViewにAppearanceの設定をします。\n\n```swift:ViewController.swift\n\nimport Cocoa\n\nclass ViewController: NSViewController {\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n        self.view.appearance = NSAppearance(appearanceNamed: \"sample\", bundle: nil) // .carファイル名\n    }\n}\n\n```\n\nこれでビルドするとAppearanceが当たるようになるかと思います。\n\n## 補足（AppStoreでの配布について）\n* .carファイルをつくためにPrivate APIを使用しているそうです\n* しかし、NSAppearance自体はPublicなのでまあAppStoreに出しても大丈夫じゃね？とのこと([Readme](https://github.com/emiscience/AppearanceMaker)より)\n\n\n## 参考\n* https://developer.apple.com/reference/appkit/nsappearance\n* https://github.com/insidegui/AppearanceMaker\n* https://github.com/emiscience/AppearanceMaker\n\n","coediting":false,"created_at":"2017-05-17T20:50:01+09:00","group":null,"id":"7227476e3d8efeb9faec","private":false,"tags":[{"name":"macos","versions":[]},{"name":"Swift","versions":[]},{"name":"AppKit","versions":[]}],"title":"Appearance Makerを使ってMac標準UIをカスタマイズする","updated_at":"2017-05-17T21:07:05+09:00","url":"http://qiita.com/hanamiju/items/7227476e3d8efeb9faec","user":{"description":null,"facebook_id":null,"followees_count":8,"followers_count":11,"github_login_name":null,"id":"hanamiju","items_count":16,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":61792,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/61792/profile-images/1473695762","twitter_screen_name":"hanamiju","website_url":null}},{"rendered_body":"\n\u003ch2\u003e\n\u003cspan id=\"手軽ににゃーんってツイートしたい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%8B%E8%BB%BD%E3%81%AB%E3%81%AB%E3%82%83%E3%83%BC%E3%82%93%E3%81%A3%E3%81%A6%E3%83%84%E3%82%A4%E3%83%BC%E3%83%88%E3%81%97%E3%81%9F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e手軽に\u003cstrong\u003eにゃーん\u003c/strong\u003eってツイートしたい\u003c/h2\u003e\n\n\u003cp\u003e勉強とかプログラムとかしてて、行き詰まった時に、なにか一言つぶやきたいことがある。\u003cbr\u003e\nこんなとき、いちいちクライアントを起動してツイートするのはアホくさい\u003cbr\u003e\nそれならショートカットキーに割り当てればいいのでは？って思った。\u003cbr\u003e\n僕が実際にやったのを頑張ってまとめますね。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e環境\n\n\u003cul\u003e\n\u003cli\u003ezorin os 12(debian)\u003c/li\u003e\n\u003cli\u003epython3\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"トークンの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eトークンの取得\u003c/h2\u003e\n\n\u003cp\u003eツイートをpythonからするにはtwitterAPIで、トークンを取得しなくちゃいけないです。\u003cbr\u003e\n\u003ca href=\"https://dev.twitter.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://dev.twitter.com/\u003c/a\u003e\u003cbr\u003e\nここのURLに飛んで、\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/dbf9a587-36b3-a94f-3339-1460e1ea496d.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/dbf9a587-36b3-a94f-3339-1460e1ea496d.png\" alt=\"Screenshot from 2017-05-05 01-30-05.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e画面上部の右側にある\u003cstrong\u003eMy apps\u003c/strong\u003eを押してください。\u003cbr\u003e\nログインが要求されたらログインしてください。\u003cbr\u003e\n無駄な抵抗はやめましょう。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/c9e0581b-44c6-4367-19f4-3137e95418bb.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/c9e0581b-44c6-4367-19f4-3137e95418bb.png\" alt=\"Screenshot from 2017-05-05 01-32-37.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこんな感じで自分のアプリが出てきます。\u003cbr\u003e\n新しく作る人は画面右上の\u003cstrong\u003eCreate New App\u003c/strong\u003eを押してください。\u003cbr\u003e\n今回はアプリがない場合で進めます。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eCreate New App\u003c/strong\u003eを押すとこんな画面になります。\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/62478dbf-5360-3d3c-ccd8-aaa45fa3e496.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/62478dbf-5360-3d3c-ccd8-aaa45fa3e496.png\" alt=\"Screenshot from 2017-05-05 01-37-32.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e各入力欄には以下のことを記入してください。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e　\u003cstrong\u003eName\u003c/strong\u003e\u003cbr\u003e\n　アプリケーションの名前（適当につけた）\u003c/p\u003e\n\n\u003cp\u003e　\u003cstrong\u003eDescription\u003c/strong\u003e\u003cbr\u003e\n　アプリケーションの説明\u003c/p\u003e\n\n\u003cp\u003e　\u003cstrong\u003eWebsite\u003c/strong\u003e\u003cbr\u003e\n　自身のWebsiteのURL（必須項目なので、ない人は頑張って取得してください）\u003c/p\u003e\n\n\u003cp\u003e　\u003cstrong\u003eCallback URL\u003c/strong\u003e\u003cbr\u003e\n  　今回はツイートするだけなので、なくても構いません。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e無事に最後まで入力したら、チェックボックスを押して画面下にある\u003cbr\u003e\n\u003cstrong\u003eCreate Your Twitter Application\u003c/strong\u003eを押してください。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/2574c5c3-9f4b-ce6f-d377-894f17f2481b.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/2574c5c3-9f4b-ce6f-d377-894f17f2481b.png\" alt=\"Screenshot from 2017-05-05 08-08-41.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次に、App名の上にある\u003cstrong\u003eKeys and Access Token\u003c/strong\u003eを押してください。\u003cbr\u003e\n押したら、下までスクロールして、\u003cstrong\u003eCreate my access token\u003c/strong\u003eを押してください。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/c03e773c-9818-1ba5-0f48-128602859883.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/c03e773c-9818-1ba5-0f48-128602859883.png\" alt=\"Screenshot from 2017-05-05 08-12-59.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e押したら勝手にtokenが生成されます。\u003cbr\u003e\nきっとこんな画面になる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/d12bede2-2c2b-70f0-ad14-6e3596ecc620.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/d12bede2-2c2b-70f0-ad14-6e3596ecc620.png\" alt=\"Screenshot from 2017-05-05 08-14-29.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eここで僕が塗りつぶした、\"\u003cstrong\u003eConsumer Key\u003c/strong\u003e\",\"\u003cstrong\u003eConsumer Secret\u003c/strong\u003e\",\"\u003cstrong\u003eAccess Token\u003c/strong\u003e\",\"\u003cstrong\u003eAccess Token Secret\u003c/strong\u003e\"がプログラムで書くときに必要になります。\u003cbr\u003e\n他の人には教えたりしないでください。\u003cbr\u003e\nAccess Tokenが発行できたら、APIの設定は終わりです。\u003cbr\u003e\nあとでトークンを使うので、ページは開いたままにしてください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"python側の処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#python%E5%81%B4%E3%81%AE%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePython側の処理\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003etweepy\u003c/strong\u003eが入ってない人はコンソールで\u003ccode\u003epip install tweepy\u003c/code\u003eと入力してください\u003cbr\u003e\n無事にインストールできたら、適当なところに\"\u003cstrong\u003e---.py\u003c/strong\u003e\"というドキュメントを作成してください。\u003cbr\u003e\n基本的にわかりやすい場所がいいです。\u003cbr\u003e\nそしたら、そのテキストに、\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e//\u003c/span\u003e\u003cspan class=\"n\"\u003epython3\u003c/span\u003e \u003cspan class=\"n\"\u003eでかいてます\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#!/usr/bin/env python\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# -*- coding: utf-8 -*-\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etweepy\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eCONSUMER_KEY\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'CONSUMER_KEYを入力してね'\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCONSUMER_SECRET\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'CONSUMER_SECRETを入力してね'\u003c/span\u003e\n\u003cspan class=\"n\"\u003eauth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etweepy\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eOAuthHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCONSUMER_KEY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCONSUMER_SECRET\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eACCESS_TOKEN\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'ACCESS_TOKENを入力してね'\u003c/span\u003e\n\u003cspan class=\"n\"\u003eACCESS_SECRET\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'ACCESS_SECRETを入力してね'\u003c/span\u003e\n\u003cspan class=\"n\"\u003eauth\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eset_access_token\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eACCESS_TOKEN\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eACCESS_SECRET\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eapi\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etweepy\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAPI\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eauth\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eapi\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdate_status\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estatus\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'にゃーん'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e//\u003c/span\u003e\u003cspan class=\"n\"\u003eにゃーんの部分をお好きな文章に\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eこんな感じで書いてください。\u003cbr\u003e\n細かい仕様とかは\u003ca href=\"http://docs.tweepy.org/en/v3.5.0/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://docs.tweepy.org/en/v3.5.0/\u003c/a\u003e で確認してください。\u003cbr\u003e\nこれでpython側は終わりです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ショートカットキーで実行できるようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%AD%E3%83%BC%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eショートカットキーで実行できるようにする\u003c/h2\u003e\n\n\u003cp\u003eショートカットキーで実行できるようにするには、コマンド化する必要があります。\u003cbr\u003e\nなので今回は、”pythonで書いたツイートのプログラムをshellで実行する。”というのをコマンド化しましょう。\u003cbr\u003e\nまずはじめにshellでスクリプトを書きます。\u003cbr\u003e\nデスクトップにテキストを作って名前はわかりやすいものにしましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shellscript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e#!/bin/sh\ncommand=\"python /Desktop/python/tweet.py\"#pythonのプログラムが置いてある絶対パス\neval $command\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを、/usr/local/binに移動しなければいけないので、\u003ccode\u003esudo nautilus\u003c/code\u003eでファイルマネージャーを起動します。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/4e7d20d8-d385-0aab-bd6c-1b26fcaad7be.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/4e7d20d8-d385-0aab-bd6c-1b26fcaad7be.png\" alt=\"Screenshot from 2017-05-17 13-02-36.png\"\u003e\u003c/a\u003e\u003cbr\u003e\nこんな感じのが出てくるはず。\u003cbr\u003e\n他の場所からコンピューター、その後は/usr/local/binまで行きましょう。\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/4ea8a61e-6b38-c4ce-eb00-58abd8f87512.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/4ea8a61e-6b38-c4ce-eb00-58abd8f87512.png\" alt=\"Screenshot from 2017-05-17 13-06-19.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e次に、/usr/local/binに先ほどshellで書いたスクリプトをコピーしましょう。\u003cbr\u003e\nその時に~~~.txtから、拡張子(.txtの部分)を消して、名前をわかりやすく、被らないものにしましょう。\u003cbr\u003e\nこれでツイートがコマンドになりました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"キーを割り当てる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AD%E3%83%BC%E3%82%92%E5%89%B2%E3%82%8A%E5%BD%93%E3%81%A6%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eキーを割り当てる\u003c/h2\u003e\n\n\u003cp\u003eこれで最後です、わかる人は飛ばしちゃってください。\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/e6d79bcc-9129-0536-5499-4ae2449360a8.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/e6d79bcc-9129-0536-5499-4ae2449360a8.png\" alt=\"Screenshot from 2017-05-16 13-10-09.png\"\u003e\u003c/a\u003e\u003cbr\u003e\n最初に、設定を開いて\u003cstrong\u003eキーボード\u003c/strong\u003eを選択しましょう。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/6ca8dd64-efb9-e7c2-0a19-99a9e77c7c95.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/6ca8dd64-efb9-e7c2-0a19-99a9e77c7c95.png\" alt=\"Screenshot from 2017-05-16 13-10-22.png\"\u003e\u003c/a\u003e\u003cbr\u003e\nこんな感じの画面になると思うので、ショートカットを選択して、\u003cstrong\u003e独自のショートカット\u003c/strong\u003eを選択しましょう。\u003cbr\u003e\n次に、画面左下の\u003cstrong\u003e+\u003c/strong\u003eボタンを押して、新しいショートカットを追加します。\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/2037340d-2df8-5560-1bd4-8fed0721dfc7.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/2037340d-2df8-5560-1bd4-8fed0721dfc7.png\" alt=\"Screenshot from 2017-05-16 13-12-09.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e実際に押すとこんな感じで追加できます。\u003cbr\u003e\nショートカットの名前は自分のわかりやすいものに、コマンドは/usr/local/binに置いたスクリプトの名前です。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/179700/13c69379-11dd-84ef-9504-057cfa60dc8e.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/179700/13c69379-11dd-84ef-9504-057cfa60dc8e.png\" alt=\"Screenshot from 2017-05-17 13-15-10.png\"\u003e\u003c/a\u003e\u003cbr\u003e\n追加が確認できたら、自分の好きなキーに設定してください。\u003cbr\u003e\nこれでショートカットキーからツイートできます。\u003cbr\u003e\nあ、でも同じ単語を連続でツイートすると、API規制がかかってツイートできません。１日に一回程度かな？\u003cbr\u003e\nとまあ、雑な感じで説明してきましたがこれで終わりです。\u003cbr\u003e\nみなさんも良きツイッターライフをお送りください。\u003c/p\u003e\n","body":"##手軽に__にゃーん__ってツイートしたい\n勉強とかプログラムとかしてて、行き詰まった時に、なにか一言つぶやきたいことがある。\nこんなとき、いちいちクライアントを起動してツイートするのはアホくさい\nそれならショートカットキーに割り当てればいいのでは？って思った。\n僕が実際にやったのを頑張ってまとめますね。\n\n- 環境\n    - zorin os 12(debian)\n    - python3\n\n##トークンの取得\nツイートをpythonからするにはtwitterAPIで、トークンを取得しなくちゃいけないです。\nhttps://dev.twitter.com/\nここのURLに飛んで、\n![Screenshot from 2017-05-05 01-30-05.png](https://qiita-image-store.s3.amazonaws.com/0/179700/dbf9a587-36b3-a94f-3339-1460e1ea496d.png)\n\n画面上部の右側にある__My apps__を押してください。\nログインが要求されたらログインしてください。\n無駄な抵抗はやめましょう。\n\n![Screenshot from 2017-05-05 01-32-37.png](https://qiita-image-store.s3.amazonaws.com/0/179700/c9e0581b-44c6-4367-19f4-3137e95418bb.png)\n\nこんな感じで自分のアプリが出てきます。\n新しく作る人は画面右上の__Create New App__を押してください。\n今回はアプリがない場合で進めます。\n\n\n__Create New App__を押すとこんな画面になります。![Screenshot from 2017-05-05 01-37-32.png](https://qiita-image-store.s3.amazonaws.com/0/179700/62478dbf-5360-3d3c-ccd8-aaa45fa3e496.png)\n\n各入力欄には以下のことを記入してください。\n\n---\n　__Name__\n　アプリケーションの名前（適当につけた）\n\n　__Description__\n　アプリケーションの説明\n\n　__Website__\n　自身のWebsiteのURL（必須項目なので、ない人は頑張って取得してください）\n\n　__Callback URL__\n  　今回はツイートするだけなので、なくても構いません。\n\n---\n無事に最後まで入力したら、チェックボックスを押して画面下にある\n__Create Your Twitter Application__を押してください。\n![Screenshot from 2017-05-05 08-08-41.png](https://qiita-image-store.s3.amazonaws.com/0/179700/2574c5c3-9f4b-ce6f-d377-894f17f2481b.png)\n\n\n次に、App名の上にある__Keys and Access Token__を押してください。\n押したら、下までスクロールして、__Create my access token__を押してください。\n\n![Screenshot from 2017-05-05 08-12-59.png](https://qiita-image-store.s3.amazonaws.com/0/179700/c03e773c-9818-1ba5-0f48-128602859883.png)\n\n押したら勝手にtokenが生成されます。\nきっとこんな画面になる。\n\n![Screenshot from 2017-05-05 08-14-29.png](https://qiita-image-store.s3.amazonaws.com/0/179700/d12bede2-2c2b-70f0-ad14-6e3596ecc620.png)\n\nここで僕が塗りつぶした、\"__Consumer Key__\",\"__Consumer Secret__\",\"__Access Token__\",\"__Access Token Secret__\"がプログラムで書くときに必要になります。\n他の人には教えたりしないでください。\nAccess Tokenが発行できたら、APIの設定は終わりです。\nあとでトークンを使うので、ページは開いたままにしてください。\n\n##Python側の処理\n__tweepy__が入ってない人はコンソールで`pip install tweepy`と入力してください\n無事にインストールできたら、適当なところに\"__---.py__\"というドキュメントを作成してください。\n基本的にわかりやすい場所がいいです。\nそしたら、そのテキストに、\n\n----\n\n```python3\n//python3 でかいてます\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\nimport tweepy\n\nCONSUMER_KEY = 'CONSUMER_KEYを入力してね'\nCONSUMER_SECRET = 'CONSUMER_SECRETを入力してね'\nauth = tweepy.OAuthHandler(CONSUMER_KEY, CONSUMER_SECRET)\nACCESS_TOKEN = 'ACCESS_TOKENを入力してね'\nACCESS_SECRET = 'ACCESS_SECRETを入力してね'\nauth.set_access_token(ACCESS_TOKEN, ACCESS_SECRET)\n\napi = tweepy.API(auth)\napi.update_status(status='にゃーん')//にゃーんの部分をお好きな文章に\n```\n----\nこんな感じで書いてください。\n細かい仕様とかはhttp://docs.tweepy.org/en/v3.5.0/ で確認してください。\nこれでpython側は終わりです。\n\n##ショートカットキーで実行できるようにする\nショートカットキーで実行できるようにするには、コマンド化する必要があります。\nなので今回は、”pythonで書いたツイートのプログラムをshellで実行する。”というのをコマンド化しましょう。\nまずはじめにshellでスクリプトを書きます。\nデスクトップにテキストを作って名前はわかりやすいものにしましょう。\n\n```shellscript\n#!/bin/sh\ncommand=\"python /Desktop/python/tweet.py\"#pythonのプログラムが置いてある絶対パス\neval $command\n```\nこれを、/usr/local/binに移動しなければいけないので、`sudo nautilus`でファイルマネージャーを起動します。\n![Screenshot from 2017-05-17 13-02-36.png](https://qiita-image-store.s3.amazonaws.com/0/179700/4e7d20d8-d385-0aab-bd6c-1b26fcaad7be.png)\nこんな感じのが出てくるはず。\n他の場所からコンピューター、その後は/usr/local/binまで行きましょう。![Screenshot from 2017-05-17 13-06-19.png](https://qiita-image-store.s3.amazonaws.com/0/179700/4ea8a61e-6b38-c4ce-eb00-58abd8f87512.png)\n\n次に、/usr/local/binに先ほどshellで書いたスクリプトをコピーしましょう。\nその時に~~~.txtから、拡張子(.txtの部分)を消して、名前をわかりやすく、被らないものにしましょう。\nこれでツイートがコマンドになりました。\n\n##キーを割り当てる\nこれで最後です、わかる人は飛ばしちゃってください。![Screenshot from 2017-05-16 13-10-09.png](https://qiita-image-store.s3.amazonaws.com/0/179700/e6d79bcc-9129-0536-5499-4ae2449360a8.png)\n最初に、設定を開いて__キーボード__を選択しましょう。\n![Screenshot from 2017-05-16 13-10-22.png](https://qiita-image-store.s3.amazonaws.com/0/179700/6ca8dd64-efb9-e7c2-0a19-99a9e77c7c95.png)\nこんな感じの画面になると思うので、ショートカットを選択して、__独自のショートカット__を選択しましょう。\n次に、画面左下の__+__ボタンを押して、新しいショートカットを追加します。![Screenshot from 2017-05-16 13-12-09.png](https://qiita-image-store.s3.amazonaws.com/0/179700/2037340d-2df8-5560-1bd4-8fed0721dfc7.png)\n\n実際に押すとこんな感じで追加できます。\nショートカットの名前は自分のわかりやすいものに、コマンドは/usr/local/binに置いたスクリプトの名前です。\n![Screenshot from 2017-05-17 13-15-10.png](https://qiita-image-store.s3.amazonaws.com/0/179700/13c69379-11dd-84ef-9504-057cfa60dc8e.png)\n追加が確認できたら、自分の好きなキーに設定してください。\nこれでショートカットキーからツイートできます。\nあ、でも同じ単語を連続でツイートすると、API規制がかかってツイートできません。１日に一回程度かな？\nとまあ、雑な感じで説明してきましたがこれで終わりです。\nみなさんも良きツイッターライフをお送りください。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","coediting":false,"created_at":"2017-05-17T20:49:16+09:00","group":null,"id":"bf9f79b2b1e388a9a3dc","private":false,"tags":[{"name":"Python","versions":[]},{"name":"Debian","versions":[]},{"name":"Ubuntu","versions":[]},{"name":"TwitterAPI","versions":[]}],"title":"ツイートをショートカットキーに割り当てる","updated_at":"2017-05-17T20:49:16+09:00","url":"http://qiita.com/materialofmouse/items/bf9f79b2b1e388a9a3dc","user":{"description":"C#/pythonを少し嗜んでいます。\r\nKinect/RaspberryPi/ubuntuあたりをやってきた。\r\nたまにやる変なことをブログにまとめます。\r\nブログとか書いたことないんで優しくしてください。","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":null,"id":"materialofmouse","items_count":2,"linkedin_id":"","location":"Hokkaido","name":"mouse material","organization":"","permanent_id":179700,"profile_image_url":"https://pbs.twimg.com/profile_images/758987619816529927/Fg2M0cz1_normal.jpg","twitter_screen_name":"materialofmouse","website_url":""}},{"rendered_body":"\u003cp\u003eAndroidでArrayListを保存する際、SQLiteを使うほどでもない単純な場合は、\u003cbr\u003e\nJSONにしてPreferenceに保存すると便利です。\u003c/p\u003e\n\n\u003cp\u003eまた、JSONへ変換する際にはGSON(Google製ライブラリ)を使うとさらに楽になると思います。\u003cbr\u003e\n\u003ca href=\"https://github.com/google/gson\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/google/gson\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e今回は\u003ccode\u003eArrayList\u0026lt;String\u0026gt;\u003c/code\u003e型を変換して保存します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"gsonの導入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gson%E3%81%AE%E5%B0%8E%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGSONの導入\u003c/h3\u003e\n\n\u003cp\u003eAndroid Studioにて、gsonライブラリをgradleで導入。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"java\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003edependencies\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ecompile\u003c/span\u003e \u003cspan class=\"err\"\u003e'\u003c/span\u003e\u003cspan class=\"n\"\u003ecom\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egoogle\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ecode\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egson\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003egson\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"mf\"\u003e2.7\u003c/span\u003e\u003cspan class=\"err\"\u003e'\u003c/span\u003e \u003cspan class=\"c1\"\u003e//少し古いかも\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"読み込み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e読み込み\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"java\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eArrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003earrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eSharedPreferences\u003c/span\u003e \u003cspan class=\"n\"\u003epref\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetSharedPreferences\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"pref\"\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMODE_PRIVATE\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eGson\u003c/span\u003e \u003cspan class=\"n\"\u003egson\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eGson\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003earrayList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egson\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003efromJson\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epref\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetString\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSAVE_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeToken\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;(){}.\u003c/span\u003e\u003cspan class=\"na\"\u003egetType\u003c/span\u003e\u003cspan class=\"o\"\u003e());\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eもしpreferenceに未保存の状態の処理も分岐させたいならこんな感じに\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"java\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eArrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003earrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eSharedPreferences\u003c/span\u003e \u003cspan class=\"n\"\u003epref\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetSharedPreferences\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"pref\"\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMODE_PRIVATE\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eGson\u003c/span\u003e \u003cspan class=\"n\"\u003egson\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eGson\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ejson\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epref\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003egetString\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSAVE_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eequals\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"[]\"\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003earrayList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eArrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;();\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003earrayList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egson\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003efromJson\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeToken\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;(){}.\u003c/span\u003e\u003cspan class=\"na\"\u003egetType\u003c/span\u003e\u003cspan class=\"o\"\u003e());\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"書き込み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e書き込み\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"java\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eSharedPreferences\u003c/span\u003e \u003cspan class=\"n\"\u003epref\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetSharedPreferences\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"pref\"\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMODE_PRIVATE\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eGson\u003c/span\u003e \u003cspan class=\"n\"\u003egson\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eGson\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\n\u003cspan class=\"n\"\u003epref\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eedit\u003c/span\u003e\u003cspan class=\"o\"\u003e().\u003c/span\u003e\u003cspan class=\"na\"\u003eputString\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSAVE_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egson\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003etoJson\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e)).\u003c/span\u003e\u003cspan class=\"na\"\u003eapply\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"AndroidでArrayListを保存する際、SQLiteを使うほどでもない単純な場合は、\nJSONにしてPreferenceに保存すると便利です。\n\nまた、JSONへ変換する際にはGSON(Google製ライブラリ)を使うとさらに楽になると思います。\nhttps://github.com/google/gson\n\n今回は`ArrayList\u003cString\u003e`型を変換して保存します。\n\n### GSONの導入\n\nAndroid Studioにて、gsonライブラリをgradleで導入。\n\n```java\ndependencies{\n      ...\n      ...\n      compile 'com.google.code.gson:gson:2.7' //少し古いかも\n}\n```\n\n### 読み込み\n\n```java\nprivate ArrayList\u003cString\u003e arrayList;\nSharedPreferences pref = getSharedPreferences(\"pref\", MODE_PRIVATE);\nGson gson = new Gson();\narrayList = gson.fromJson(pref.getString(SAVE_KEY, \"\"), new TypeToken\u003cArrayList\u003cString\u003e\u003e(){}.getType());\n```\n\nもしpreferenceに未保存の状態の処理も分岐させたいならこんな感じに\n\n```java\nprivate ArrayList\u003cString\u003e arrayList;\nSharedPreferences pref = getSharedPreferences(\"pref\", MODE_PRIVATE);\nGson gson = new Gson();\nString json = pref.getString(SAVE_KEY, \"\");\nif(json.equals(\"[]\"))\n{\n    arrayList = new ArrayList\u003c\u003e();\n}\nelse\n{\n    arrayList = gson.fromJson(json, new TypeToken\u003cArrayList\u003cString\u003e\u003e(){}.getType());\n}\n```\n\n### 書き込み\n\n```java\nSharedPreferences pref = getSharedPreferences(\"pref\", MODE_PRIVATE);\nGson gson = new Gson();\npref.edit().putString(SAVE_KEY, gson.toJson(arrayList)).apply();\n```\n","coediting":false,"created_at":"2017-05-17T20:47:08+09:00","group":null,"id":"a02436e03ea2aba6c6db","private":false,"tags":[{"name":"Java","versions":[]},{"name":"Android","versions":[]},{"name":"JSON","versions":[]},{"name":"GSON","versions":[]}],"title":"AndroidでGSONを利用してArrayListを保存する","updated_at":"2017-05-17T20:47:08+09:00","url":"http://qiita.com/hisurga/items/a02436e03ea2aba6c6db","user":{"description":"営業マン","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":"hisurga","id":"hisurga","items_count":3,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":181869,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/181869/profile-images/1494948654","twitter_screen_name":"hisurga","website_url":"http://blog.hisurga.com"}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"起こった現象\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%B5%B7%E3%81%93%E3%81%A3%E3%81%9F%E7%8F%BE%E8%B1%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e起こった現象\u003c/h1\u003e\n\n\u003cp\u003exib ファイルからインスタンス化したカスタムな UITableViewHeaderFooterView を表示すると下記のログが出力される。表示に影響はない。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eSetting the background color on UITableViewHeaderFooterView has been deprecated. Please use contentView.backgroundColor instead.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"解決方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決方法\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003exib 上で UITableViewHeaderFooterView のサブクラスを作成したときに backgroundColor が White Color に設定されているので、 default に変更する\u003c/li\u003e\n\u003cli\u003eコード上での backgroundColor の設定をやめる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/92385/0076b895-7fbc-f44c-50c2-a89598fb495c.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/92385/0076b895-7fbc-f44c-50c2-a89598fb495c.png\" alt=\"スクリーンショット 2017-05-17 20.34.20.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://ringosoftware.wordpress.com/2014/05/13/%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%98%E3%83%83%E3%83%80%E3%83%BC%E3%83%93%E3%83%A5%E3%83%BC%E3%81%A7%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%80%8Cbackgroundcolor%E3%80%8D%E3%81%8C%E3%81%AA/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://ringosoftware.wordpress.com/2014/05/13/%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%98%E3%83%83%E3%83%80%E3%83%BC%E3%83%93%E3%83%A5%E3%83%BC%E3%81%A7%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%80%8Cbackgroundcolor%E3%80%8D%E3%81%8C%E3%81%AA/\u003c/a\u003e\u003c/p\u003e\n","body":"# 起こった現象\n\nxib ファイルからインスタンス化したカスタムな UITableViewHeaderFooterView を表示すると下記のログが出力される。表示に影響はない。\n\n\u003eSetting the background color on UITableViewHeaderFooterView has been deprecated. Please use contentView.backgroundColor instead.\n\n# 解決方法\n\n* xib 上で UITableViewHeaderFooterView のサブクラスを作成したときに backgroundColor が White Color に設定されているので、 default に変更する\n* コード上での backgroundColor の設定をやめる\n\n![スクリーンショット 2017-05-17 20.34.20.png](https://qiita-image-store.s3.amazonaws.com/0/92385/0076b895-7fbc-f44c-50c2-a89598fb495c.png)\n\n# 参考\nhttps://ringosoftware.wordpress.com/2014/05/13/%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%98%E3%83%83%E3%83%80%E3%83%BC%E3%83%93%E3%83%A5%E3%83%BC%E3%81%A7%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%80%8Cbackgroundcolor%E3%80%8D%E3%81%8C%E3%81%AA/\n","coediting":false,"created_at":"2017-05-17T20:43:40+09:00","group":null,"id":"e715475856cbc3106e93","private":false,"tags":[{"name":"Xcode","versions":[]},{"name":"iOS","versions":[]},{"name":"UITableViewHeaderFooterView","versions":[]}],"title":"ログ \"Setting the background color on UITableViewHeaderFooterView has been deprecated.\" を消す","updated_at":"2017-05-17T20:43:40+09:00","url":"http://qiita.com/KosukeOhmura/items/e715475856cbc3106e93","user":{"description":"Swift, Ruby on Rails とかやってます。","facebook_id":"bnpb81","followees_count":1,"followers_count":0,"github_login_name":"KosukeOhmura","id":"KosukeOhmura","items_count":6,"linkedin_id":"","location":"Shinjuku, Tokyo, Japan","name":"Kosuke Ohmura","organization":"Unique Vision Company, Japan.","permanent_id":92385,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/92385/profile-images/1473705613","twitter_screen_name":"insideBANA","website_url":""}},{"rendered_body":"\u003cp\u003eVuforia\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" rel=\"footnote\" title=\"https://developer.vuforia.com/\"\u003e1\u003c/a\u003e\u003c/sup\u003e にはCardboardをはじめとした２眼用のプリセットがいくつか用意されている．\u003cbr\u003e\nまぁざっくりとTangoでそういう感じのことをしたい．\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"カメラを２個用意する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AB%E3%83%A1%E3%83%A9%E3%82%92%EF%BC%92%E5%80%8B%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eカメラを２個用意する\u003c/h1\u003e\n\n\u003cp\u003e２眼のためにはカメラが２つ必要， まずは \u003ccode\u003eTango Camera\u003c/code\u003e を２つ置く．\u003cbr\u003e\nさらに名前をよしなに変えておく．今回は \u003ccode\u003eStereoCameraLeft\u003c/code\u003e と \u003ccode\u003eStereoCameraRight\u003c/code\u003e にした．\u003cbr\u003e\nあとは（気分的な問題で）親を作っておく．\u003c/p\u003e\n\n\u003cp\u003eHierarchy は次のようになった．\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/178486/f9fc78eb-3a5b-c679-7332-6a7140717720.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/178486/f9fc78eb-3a5b-c679-7332-6a7140717720.png\" alt=\"スクリーンショット 2017-05-17 19.58.21.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"各カメラのviewport-rectを設定する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%90%84%E3%82%AB%E3%83%A1%E3%83%A9%E3%81%AEviewport-rect%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e各カメラのViewport Rectを設定する\u003c/h1\u003e\n\n\u003cp\u003e以下に \u003ccode\u003eStereoCameraLeft\u003c/code\u003e と \u003ccode\u003eStereoCameraRight\u003c/code\u003e の設定を置いておく．\u003cbr\u003e\n基本的に同じだが，特筆すべき点は \u003ccode\u003eViewport Rect\u003c/code\u003e の値．\u003cbr\u003e\n縦横サイズ（W,H）を半分にして，Y+（上）に\u003ccode\u003e0.25\u003c/code\u003eだけずらしている．\u003cbr\u003e\n\u003ccode\u003eStereoCameraRight\u003c/code\u003e においては，画面の右側になるようにX+に\u003ccode\u003e0.5\u003c/code\u003eしている．\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/178486/72acf1d4-f9a8-ea2d-fe85-75a0908f7a62.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/178486/72acf1d4-f9a8-ea2d-fe85-75a0908f7a62.png\" width=\"400\"\u003e\u003c/a\u003e \u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/178486/8a3d952d-ff73-2c23-7e0e-f7dac3e31c04.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/178486/8a3d952d-ff73-2c23-7e0e-f7dac3e31c04.png\" width=\"400\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"２眼になる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%92%E7%9C%BC%E3%81%AB%E3%81%AA%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e２眼になる\u003c/h1\u003e\n\n\u003cp\u003eこれで視差なし２眼になる．\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/178486/4eed23cd-8186-0dd3-e821-2a31be47f323.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/178486/4eed23cd-8186-0dd3-e821-2a31be47f323.jpeg\" width=\"600\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"視差\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A6%96%E5%B7%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e視差\u003c/h1\u003e\n\n\u003cp\u003eまた，両カメラの位置を現実世界換算で6.41cmくらい\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" rel=\"footnote\" title=\"https://www.dh.aist.go.jp/database/head/index.html 瞳孔間幅\"\u003e2\u003c/a\u003e\u003c/sup\u003eずらしておくと視差あり２眼になるが，\u003cbr\u003e\nIPD警察の警邏に対応するための調整機能の搭載をお勧めする．\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/178486/94b515d0-c0f9-5464-7d68-9df20d2c8e5b.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/178486/94b515d0-c0f9-5464-7d68-9df20d2c8e5b.png\" width=\"600\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\n\n\u003cp\u003e余談だが，２眼を作ったところで上手く填まるARグラスを持ち合わせていないので，\u003cbr\u003e\n有識者がおられたらご教授願いたい．\u003c/p\u003e\n\n\u003cp\u003ePhab 2 Pro\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\n\u003cp lang=\"ja\"\u003ePhab 2 ProでHADOをTangoに移植しようとしてみたものの，6.4インチディスプレイを2眼にしても人間の瞳孔間距離より長いので，全く見えないということがわかった．大は小を兼ねない． \u003ca href=\"https://t.co/aaw83NXULb\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/aaw83NXULb\u003c/a\u003e\u003c/p\u003e— Izumi Shirosaki (@izugch4423) \u003ca href=\"https://twitter.com/izugch4423/status/863956224546447364\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2017年5月15日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\n\n\u003cp\u003eZenfone AR\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\n\u003cp lang=\"ja\"\u003eハマらなかったり，デカすぎたり，ピッタリ合わんなあ． \u003ca href=\"https://t.co/DZoCDgwe9c\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/DZoCDgwe9c\u003c/a\u003e\u003c/p\u003e— Izumi Shirosaki (@izugch4423) \u003ca href=\"https://twitter.com/izugch4423/status/864806238659399680\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2017年5月17日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\n\n\u003cp\u003e\u003cbr\u003e\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003e\u003ca href=\"https://developer.vuforia.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://developer.vuforia.com/\u003c/a\u003e \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003e\u003ca href=\"https://www.dh.aist.go.jp/database/head/index.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.dh.aist.go.jp/database/head/index.html\u003c/a\u003e 瞳孔間幅 \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","body":"\nVuforia[^1] にはCardboardをはじめとした２眼用のプリセットがいくつか用意されている．\nまぁざっくりとTangoでそういう感じのことをしたい．\n\n\n# カメラを２個用意する\n\n２眼のためにはカメラが２つ必要， まずは `Tango Camera` を２つ置く．\nさらに名前をよしなに変えておく．今回は `StereoCameraLeft` と `StereoCameraRight` にした．\nあとは（気分的な問題で）親を作っておく．\n\nHierarchy は次のようになった．\n![スクリーンショット 2017-05-17 19.58.21.png](https://qiita-image-store.s3.amazonaws.com/0/178486/f9fc78eb-3a5b-c679-7332-6a7140717720.png)\n\n\n# 各カメラのViewport Rectを設定する\n\n以下に `StereoCameraLeft` と `StereoCameraRight` の設定を置いておく．\n基本的に同じだが，特筆すべき点は `Viewport Rect` の値．\n縦横サイズ（W,H）を半分にして，Y+（上）に`0.25`だけずらしている．\n`StereoCameraRight` においては，画面の右側になるようにX+に`0.5`している．\n\n\u003cimg src=https://qiita-image-store.s3.amazonaws.com/0/178486/72acf1d4-f9a8-ea2d-fe85-75a0908f7a62.png width=400\u003e \u003cimg src=https://qiita-image-store.s3.amazonaws.com/0/178486/8a3d952d-ff73-2c23-7e0e-f7dac3e31c04.png width=400\u003e\n\n# ２眼になる\n\nこれで視差なし２眼になる．\n\n\u003cimg src=https://qiita-image-store.s3.amazonaws.com/0/178486/4eed23cd-8186-0dd3-e821-2a31be47f323.jpeg width=600\u003e\n\n\n\n# 視差\n\nまた，両カメラの位置を現実世界換算で6.41cmくらい[^2]ずらしておくと視差あり２眼になるが，\nIPD警察の警邏に対応するための調整機能の搭載をお勧めする．\n\n\u003cimg src=https://qiita-image-store.s3.amazonaws.com/0/178486/94b515d0-c0f9-5464-7d68-9df20d2c8e5b.png width=600\u003e\n\n\n\u003cbr\u003e\n\n---\n\n\u003cbr\u003e\n\n\n余談だが，２眼を作ったところで上手く填まるARグラスを持ち合わせていないので，\n有識者がおられたらご教授願いたい．\n\nPhab 2 Pro\n\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003ePhab 2 ProでHADOをTangoに移植しようとしてみたものの，6.4インチディスプレイを2眼にしても人間の瞳孔間距離より長いので，全く見えないということがわかった．大は小を兼ねない． \u003ca href=\"https://t.co/aaw83NXULb\"\u003epic.twitter.com/aaw83NXULb\u003c/a\u003e\u003c/p\u003e\u0026mdash; Izumi Shirosaki (@izugch4423) \u003ca href=\"https://twitter.com/izugch4423/status/863956224546447364\"\u003e2017年5月15日\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n\nZenfone AR\n\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eハマらなかったり，デカすぎたり，ピッタリ合わんなあ． \u003ca href=\"https://t.co/DZoCDgwe9c\"\u003epic.twitter.com/DZoCDgwe9c\u003c/a\u003e\u003c/p\u003e\u0026mdash; Izumi Shirosaki (@izugch4423) \u003ca href=\"https://twitter.com/izugch4423/status/864806238659399680\"\u003e2017年5月17日\u003c/a\u003e\u003c/blockquote\u003e\n\u003cscript async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n\n\u003cbr\u003e\n\n\n\n\n---\n\n\n\n[^1]: https://developer.vuforia.com/\n\n[^2]: https://www.dh.aist.go.jp/database/head/index.html 瞳孔間幅\n","coediting":false,"created_at":"2017-05-17T20:43:10+09:00","group":null,"id":"8ed6908f5d017ed4c350","private":false,"tags":[{"name":"Unity","versions":[]},{"name":"Tango","versions":[]}],"title":"Tangoで２眼表示する","updated_at":"2017-05-17T20:43:10+09:00","url":"http://qiita.com/shiroizu/items/8ed6908f5d017ed4c350","user":{"description":"","facebook_id":"","followees_count":3,"followers_count":1,"github_login_name":"izugch73","id":"shiroizu","items_count":3,"linkedin_id":"","location":"","name":"Izumi Shirosaki","organization":"","permanent_id":178486,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/178486/profile-images/1494845023","twitter_screen_name":"izugch4423","website_url":""}},{"rendered_body":"\u003cp\u003e本日のハイライト\u003c/p\u003e\n\n\u003cp\u003e•テキストデータ内の文字列を検索するにはgrepコマンドを使用\u003cbr\u003e\n-nオプションでは行番号を表示する。\u003c/p\u003e\n\n\u003cp\u003e•正規表現について\u003cbr\u003e\n正規表現とは記号や文字列を組み合わせて目的のキーワードを検索するためのパターンを作り検出する手段\u003cbr\u003e\n例: '^a.*o$' 先頭がaで末尾がoの文字列を検索\u003c/p\u003e\n\n\u003cp\u003e主なメタキャラクタ\u003c/p\u003e\n\n\u003cp\u003e「.」任意の文字に一致\u003cbr\u003e\n「^」行の先頭(^文字)\u003cbr\u003e\n「$」行の末尾(文字$)\u003cbr\u003e\n「*」直前の文字が0回以上の繰り返しに一致\u003cbr\u003e\n「?」直前の文字が0回もしくは1回の繰り返しに一致\u003cbr\u003e\n「+」直前の文字が1回以上の繰り返しに一致\u003cbr\u003e\n「[]」[]内の文字グループに一致\u003cbr\u003e\n例:\u003cbr\u003e\n[abAB]a,b,A,Bいずれかに一致\u003cbr\u003e\n[^abAB]a,b,A,B以外のいずれかに一致\u003cbr\u003e\n[a-bA-B]a,b,c,d,A,B,C,Dいずれかに一致\u003c/p\u003e\n\n\u003cp\u003e「\\」メタキャラクタを文字として使う場合に使用\u003cbr\u003e\n例:\u003cbr\u003e\n'^a.\u003cem\u003e.$' これは「.」がメタキャラクタとして扱われているためエラー\u003cbr\u003e\n'^a.\u003c/em\u003e.$' これは「.」が文字として扱われているため「.」が末尾の文字列を検索する指定として機能する\u003c/p\u003e\n\n\u003cp\u003e•egrepコマンドはgrepコマンドより高度な文字列検索を行う\u003cbr\u003e\n-vオプションは条件に一致しない行を検索する\u003c/p\u003e\n\n\u003cp\u003e•行末の#を指定する場合は'#$'となるが、bashでは#以降の文字列をコメントとして無視するため'#$'としてエスケープするなどしなければならない\u003c/p\u003e\n\n\u003cp\u003e•fgrepコマンドはgrepコマンド同様に文字列を検索するコマンドだが、こちらは正規表現を使用しない\u003c/p\u003e\n","body":"本日のハイライト\n\n•テキストデータ内の文字列を検索するにはgrepコマンドを使用\n-nオプションでは行番号を表示する。\n\n•正規表現について\n正規表現とは記号や文字列を組み合わせて目的のキーワードを検索するためのパターンを作り検出する手段\n例: '^a.*o$' 先頭がaで末尾がoの文字列を検索\n\n主なメタキャラクタ\n\n「.」任意の文字に一致\n「^」行の先頭(^文字)\n「$」行の末尾(文字$)\n「*」直前の文字が0回以上の繰り返しに一致\n「?」直前の文字が0回もしくは1回の繰り返しに一致\n「+」直前の文字が1回以上の繰り返しに一致\n「[]」[]内の文字グループに一致\n例:\n[abAB]a,b,A,Bいずれかに一致\n[^abAB]a,b,A,B以外のいずれかに一致\n[a-bA-B]a,b,c,d,A,B,C,Dいずれかに一致\n\n「\\」メタキャラクタを文字として使う場合に使用\n例:\n'^a.*.$' これは「.」がメタキャラクタとして扱われているためエラー\n'^a.*\\.$' これは「.」が文字として扱われているため「.」が末尾の文字列を検索する指定として機能する\n\n•egrepコマンドはgrepコマンドより高度な文字列検索を行う\n-vオプションは条件に一致しない行を検索する\n\n•行末の#を指定する場合は'#$'となるが、bashでは#以降の文字列をコメントとして無視するため'\\#$'としてエスケープするなどしなければならない\n\n•fgrepコマンドはgrepコマンド同様に文字列を検索するコマンドだが、こちらは正規表現を使用しない\n","coediting":false,"created_at":"2017-05-17T20:35:08+09:00","group":null,"id":"ade784260959b9537182","private":false,"tags":[{"name":"lpic","versions":[]}],"title":"LPIC Lv1 学習日記_03","updated_at":"2017-05-17T20:35:08+09:00","url":"http://qiita.com/iori_takahashi/items/ade784260959b9537182","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":null,"id":"iori_takahashi","items_count":4,"linkedin_id":"","location":"","name":"高橋 伊織","organization":"","permanent_id":178870,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/178870/profile-images/1493447045","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eつい先日、masterブランチを開発ブランチにマージした際にやらかしてしまい。\u003cbr\u003e\n開発ブランチ上のコミットが消えて（見えなくなって）、かなり焦ることがありました。\u003cbr\u003e\nその際、.git配下のファイルから復帰が出来たので、その時のメモになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やらかしたこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%89%E3%81%8B%E3%81%97%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやらかしたこと\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"なにをしていたか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%81%AB%E3%82%92%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなにをしていたか\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e開発ブランチで開発中だった\u003c/li\u003e\n\u003cli\u003ehotfix 対応があった\u003c/li\u003e\n\u003cli\u003ehotfix 対応部分を開発ブランチに取込もうと、マージした\u003c/li\u003e\n\u003cli\u003e冗長なコミットに気付く\u003c/li\u003e\n\u003cli\u003eログを綺麗にしようと思いたち、リビジョンを戻した\n\u003ccode\u003eshell-session\ngit reset --hard \u0026lt;revision\u0026gt;\n\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e冗長なコミットをまとめて修正\u003c/li\u003e\n\u003cli\u003eまとめて push \n\u003ccode\u003eshell-session\ngit push -f origin \u0026lt;開発ブランチ\u0026gt;\n\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e正確に把握していない（ボーっと作業していた）ので、\u003cbr\u003e\nなにか間違いがありそうですが、たぶんこんな感じです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ここ３日で作ったコミットがない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%93%EF%BC%93%E6%97%A5%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%8C%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e・・・ここ３日で作ったコミットが、ない！？\u003c/h2\u003e\n\n\u003cp\u003eリモートリポジトリを眺めていて異変に気付きました。\u003c/p\u003e\n\n\u003cp\u003e「あれ？ブランチ間で差分が出てない。」\u003c/p\u003e\n\n\u003cp\u003e「開発ブランチにしかないコミットがあるはずなのに？」\u003c/p\u003e\n\n\u003cp\u003e「・・・ここ３日で作ったコミットが、ない！？」\u003c/p\u003e\n\n\u003cp\u003e久しぶりに心臓が冷える思いがしました。。\u003cbr\u003e\nGWに出勤して作ったのに・・。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"何をして復旧したか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%95%E3%82%92%E3%81%97%E3%81%A6%E5%BE%A9%E6%97%A7%E3%81%97%E3%81%9F%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e何をして復旧したか？\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"git-を信じて-revision-ログを探す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#git-%E3%82%92%E4%BF%A1%E3%81%98%E3%81%A6-revision-%E3%83%AD%E3%82%B0%E3%82%92%E6%8E%A2%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003egit を信じて revision ログを探す\u003c/h2\u003e\n\n\u003cp\u003e心臓は冷えましたが、「git なら残っているはず」と信じて、\u003cbr\u003e\n.git 以下のファイルを見てみました。\u003cbr\u003e\n以下、ほぼ名前からの推測と勘で、目的のファイルに一発で\u003cbr\u003e\n辿り着きました。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e\u003cem\u003e直感的な名付けとフォルダ分けがされていて本当～～～～に助かりました。\u003c/em\u003e\u003c/strong\u003e\u003cbr\u003e\nさすが git様。\u003cbr\u003e\nありがとう、いいツールです。\u003c/p\u003e\n\n\u003cp\u003e以下、見て行った順に画像を貼ります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"git\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#git\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e.git\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/16382/4db5381c-e203-ee87-8e42-15cdbd23f17d.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/16382/4db5381c-e203-ee87-8e42-15cdbd23f17d.png\" alt=\"01.dotgit.png\"\u003e\u003c/a\u003e\u003cbr\u003e\nここは、フォルダ名を信じて logs を見ます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"gitlogs\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gitlogs\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e.git/logs\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/16382/3d29c1a1-6d2a-9752-d98a-7c414925e65c.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/16382/3d29c1a1-6d2a-9752-d98a-7c414925e65c.png\" alt=\"02.logs.png\"\u003e\u003c/a\u003e\u003cbr\u003e\nHEADではないので、refs を見てみます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"gitlogsrefs\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gitlogsrefs\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e.git/logs/refs\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/16382/578d8108-fefe-fd89-6434-6eec69113050.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/16382/578d8108-fefe-fd89-6434-6eec69113050.png\" alt=\"03.refs.png\"\u003e\u003c/a\u003e\u003cbr\u003e\nremoteではないので、heads を見てみます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"gitlogsrefsheads\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gitlogsrefsheads\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e.git/logs/refs/heads\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/16382/549e9297-ac82-7d7e-f1d3-50b319c5a93a.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/16382/549e9297-ac82-7d7e-f1d3-50b319c5a93a.png\" alt=\"04.heads.png\"\u003e\u003c/a\u003e\u003cbr\u003e\nfeatureフォルダが見えました。かなり期待が持てますね。。どきどき\u003cbr\u003e\n※ ちなみに、feautreってなんでしょうね。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"gitlogsrefsheadsfeature\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gitlogsrefsheadsfeature\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e.git/logs/refs/heads/feature\u003c/h3\u003e\n\n\u003cp\u003e画像は割愛していますが、ありました。feature 毎のファイルが。\u003cbr\u003e\nさっそく、やらかしたfeatureと同名のファイルを見てみます・・！\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"repository\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#repository\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003erepository\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/16382/456c3149-2485-3950-53ea-bb1b20446163.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/16382/456c3149-2485-3950-53ea-bb1b20446163.png\" alt=\"repository.png\"\u003e\u003c/a\u003e\u003cbr\u003e\nきました・・。\u003cbr\u003e\nコミット時のリビジョンが残っています・・・。\u003c/p\u003e\n\n\u003cp\u003eこれで、git reset すれば・・！どきどき\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell-session\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003egit reset --hard \u0026lt;revision\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"復旧しました\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BE%A9%E6%97%A7%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e復旧しました！\u003c/h3\u003e\n\n\u003cp\u003e私の場合は、この作業でやらかす前に戻ることができました！\u003cbr\u003e\n（３日分の作業が無駄にならずに済みました・・！）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"教訓\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%95%99%E8%A8%93\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e教訓\u003c/h1\u003e\n\n\u003cp\u003eフォルダ分け、名付けは本当に大事。\u003c/p\u003e\n\n\u003cp\u003eこんなミスを他の人が犯すのかは疑問ですが（苦笑）\u003cbr\u003e\nどなたかの参考になれば幸いです。\u003c/p\u003e\n","body":"# はじめに\n\nつい先日、masterブランチを開発ブランチにマージした際にやらかしてしまい。\n開発ブランチ上のコミットが消えて（見えなくなって）、かなり焦ることがありました。\nその際、.git配下のファイルから復帰が出来たので、その時のメモになります。\n\n# やらかしたこと\n\n## なにをしていたか\n* 開発ブランチで開発中だった\n* hotfix 対応があった\n* hotfix 対応部分を開発ブランチに取込もうと、マージした\n* 冗長なコミットに気付く\n* ログを綺麗にしようと思いたち、リビジョンを戻した\n```shell-session\n  git reset --hard \u003crevision\u003e\n  ```\n* 冗長なコミットをまとめて修正\n* まとめて push \n```shell-session\ngit push -f origin \u003c開発ブランチ\u003e\n  ```\n\n正確に把握していない（ボーっと作業していた）ので、\nなにか間違いがありそうですが、たぶんこんな感じです。\n\n\n## ・・・ここ３日で作ったコミットが、ない！？\nリモートリポジトリを眺めていて異変に気付きました。\n\n「あれ？ブランチ間で差分が出てない。」\n\n「開発ブランチにしかないコミットがあるはずなのに？」\n\n「・・・ここ３日で作ったコミットが、ない！？」\n\n久しぶりに心臓が冷える思いがしました。。\nGWに出勤して作ったのに・・。\n\n\n# 何をして復旧したか？\n\n## git を信じて revision ログを探す\n心臓は冷えましたが、「git なら残っているはず」と信じて、\n.git 以下のファイルを見てみました。\n以下、ほぼ名前からの推測と勘で、目的のファイルに一発で\n辿り着きました。\n\n***直感的な名付けとフォルダ分けがされていて本当～～～～に助かりました。***\nさすが git様。\nありがとう、いいツールです。\n\n以下、見て行った順に画像を貼ります。\n\n### .git \n![01.dotgit.png](https://qiita-image-store.s3.amazonaws.com/0/16382/4db5381c-e203-ee87-8e42-15cdbd23f17d.png)\nここは、フォルダ名を信じて logs を見ます。\n\n### .git/logs\n![02.logs.png](https://qiita-image-store.s3.amazonaws.com/0/16382/3d29c1a1-6d2a-9752-d98a-7c414925e65c.png)\nHEADではないので、refs を見てみます。\n\n### .git/logs/refs\n![03.refs.png](https://qiita-image-store.s3.amazonaws.com/0/16382/578d8108-fefe-fd89-6434-6eec69113050.png)\nremoteではないので、heads を見てみます。\n\n### .git/logs/refs/heads\n![04.heads.png](https://qiita-image-store.s3.amazonaws.com/0/16382/549e9297-ac82-7d7e-f1d3-50b319c5a93a.png)\nfeatureフォルダが見えました。かなり期待が持てますね。。どきどき\n※ ちなみに、feautreってなんでしょうね。\n\n### .git/logs/refs/heads/feature\n画像は割愛していますが、ありました。feature 毎のファイルが。\nさっそく、やらかしたfeatureと同名のファイルを見てみます・・！\n\n\n### repository\n![repository.png](https://qiita-image-store.s3.amazonaws.com/0/16382/456c3149-2485-3950-53ea-bb1b20446163.png)\nきました・・。\nコミット時のリビジョンが残っています・・・。\n\nこれで、git reset すれば・・！どきどき\n\n```shell-session\ngit reset --hard \u003crevision\u003e\n```\n\n### 復旧しました！\n\n私の場合は、この作業でやらかす前に戻ることができました！\n（３日分の作業が無駄にならずに済みました・・！）\n\n\n# 教訓\nフォルダ分け、名付けは本当に大事。\n\n\nこんなミスを他の人が犯すのかは疑問ですが（苦笑）\nどなたかの参考になれば幸いです。\n","coediting":false,"created_at":"2017-05-17T20:26:22+09:00","group":null,"id":"ae9a4639085686834fa2","private":false,"tags":[{"name":"Git","versions":[]}],"title":"git で間違ってリビジョンを消してしまった時にできること","updated_at":"2017-05-17T20:26:22+09:00","url":"http://qiita.com/hirdot/items/ae9a4639085686834fa2","user":{"description":"所属：全日本ピアノ指導者協会（ピティナ）\r\n好き：DB設計、orchestra、日本酒、 足利市\r\n楽器：Didgeridoo、oboe（ピアノが弾けない）","facebook_id":"","followees_count":14,"followers_count":7,"github_login_name":"hirdot","id":"hirdot","items_count":6,"linkedin_id":"","location":"Tokyo, Ashikaga, Japan","name":"大竹 泰斗","organization":"全日本ピアノ指導者協会（ピティナ）","permanent_id":16382,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/16382/profile-images/1483769222","twitter_screen_name":"hirdot","website_url":""}},{"rendered_body":"\u003cp\u003e\u003ca href=\"http://ankaraemekcilingir.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ankaraemekcilingir.com/\u003c/a\u003e\u003cbr\u003e\nAnkara Emek çilingir kendi sektöründe en iyi ve en kaliteli hizmeti vermek amacıyla Emek Mahallesin’de hizmet vermeye başladı. Emek çilingir gün geçtikçe yükselen bir performans yakaladı Alanında tecrübeli ve uzman kadrosu ile çilingir ile alakalı problemleri profesyonelce, müşteri memnuniyeti önceliği ile çözer.7 gün 24 saat, gece gündüz hizmetinizdedir. Ankara’nın neresinde olursanız olun servislerimiz kısa sürede içerisinde emrinizde.7/24 Hizmet Hattı 0555 699 08 09  Kaliteli, uygun ve üstün hizmette hoşgeldiniz.\u003cbr\u003e\nAnkara Emek Çilingir,Emek Çilingir,EmekAnahtarcı,Ankara Emek Anahtarcı,\u003c/p\u003e\n","body":"http://ankaraemekcilingir.com/\nAnkara Emek çilingir kendi sektöründe en iyi ve en kaliteli hizmeti vermek amacıyla Emek Mahallesin’de hizmet vermeye başladı. Emek çilingir gün geçtikçe yükselen bir performans yakaladı Alanında tecrübeli ve uzman kadrosu ile çilingir ile alakalı problemleri profesyonelce, müşteri memnuniyeti önceliği ile çözer.7 gün 24 saat, gece gündüz hizmetinizdedir. Ankara’nın neresinde olursanız olun servislerimiz kısa sürede içerisinde emrinizde.7/24 Hizmet Hattı 0555 699 08 09  Kaliteli, uygun ve üstün hizmette hoşgeldiniz.\nAnkara Emek Çilingir,Emek Çilingir,EmekAnahtarcı,Ankara Emek Anahtarcı,\n","coediting":false,"created_at":"2017-05-17T20:20:54+09:00","group":null,"id":"d5128aa6e225f5c60413","private":false,"tags":[{"name":"Ankara","versions":[]},{"name":"Emek","versions":[]},{"name":"Çilingir,Emek","versions":[]},{"name":"Çilingir,EmekAnahtarcı,","versions":[]}],"title":"Emek çilingir","updated_at":"2017-05-17T20:20:54+09:00","url":"http://qiita.com/EmekCilingirci/items/d5128aa6e225f5c60413","user":{"description":"Ankara Emek Çilingir,Emek Çilingir,EmekAnahtarcı,Ankara Emek Anahtarcı,","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":null,"id":"EmekCilingirci","items_count":1,"linkedin_id":"","location":"türkiye ankara","name":"emre aga","organization":"emek çilingir","permanent_id":182031,"profile_image_url":"https://pbs.twimg.com/profile_images/864800382190530564/n30dmJeU_normal.jpg","twitter_screen_name":"EmekCilingir","website_url":"http://ankaraemekcilingir.com/"}},{"rendered_body":"\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e環境\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e% perl --version\n\nThis is perl 5, version 24, subversion 1 (v5.24.1) built for amd64-freebsd-thread-multi\n\nCopyright 1987-2017, Larry Wall\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"tldr\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tldr\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTL;DR\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e結論\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"n\"\u003estrict\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"n\"\u003eutf8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"n\"\u003efeature\u003c/span\u003e \u003cspan class=\"s\"\u003e'say'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"n\"\u003eEncode\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw/encode_utf8 decode/\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 参考元より拝借\u003c/span\u003e\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# これ！\u003c/span\u003e\n\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/=\\?([^?]+)\\?([bq])\\?([^?=]+)\\?=\\s+=\\?\\g1\\?\\g2\\?(.+)/=?\\1?\\2?\\3\\4/ig\u003c/span\u003e\u003cspan class=\"p\"\u003e){}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MIME-Header'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e-\u0026gt; ギガシネマ with U-NEXT お申し込み完了のお知らせ\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"つまりは何をやったのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A4%E3%81%BE%E3%82%8A%E3%81%AF%E4%BD%95%E3%82%92%E3%82%84%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eつまりは何をやったのか\u003c/h2\u003e\n\n\u003cp\u003e連続した行が、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e同じ文字セット/エンコーディングである\u003c/li\u003e\n\u003cli\u003e前行の行末にパディング('=')がない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eという条件を満たした場合に前後の行を連結する、という処理を繰り返す。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"闘いの狼煙が上がる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%97%98%E3%81%84%E3%81%AE%E7%8B%BC%E7%85%99%E3%81%8C%E4%B8%8A%E3%81%8C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e闘いの狼煙が上がる\u003c/h1\u003e\n\n\u003cp\u003eMIMEヘッダのデコードに引っかかり、\u003ca href=\"http://qiita.com/kizashi1122/items/5a3e6e3928868bead40d\" id=\"reference-74bc3c01df1ac21ebccd\"\u003eこちらのページ\u003c/a\u003eを発見するもISO-2022-JPで撃沈。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edecode_mimewords\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"n\"\u003estrict\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"n\"\u003efeature\u003c/span\u003e \u003cspan class=\"s\"\u003e'say'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMIME::\u003c/span\u003e\u003cspan class=\"n\"\u003eWords\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw/decode_mimewords/\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"n\"\u003eEncode\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw/encode_utf8 decode/\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?ISO-2022-JP?B?GyRCJDMkbCRPGyhCTUlNRSBTVUJKRUNUGyRCJE4bKEJkb2Nv?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e      =?ISO-2022-JP?B?ZGUbJEIlRiU5JUhNUSRHJDkbKEI=?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode_mimewords\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e-\u0026gt; ESC$B$3$l$OESC(BMIME SUBJECTESC$B$NESC(BdocodeESC$B%F%9%HMQ$G$9ESC(B\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e生のISO-2022-JPかよ！\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"穴を掘って埋める\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A9%B4%E3%82%92%E6%8E%98%E3%81%A3%E3%81%A6%E5%9F%8B%E3%82%81%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e穴を掘って埋める\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edecode_mimewords+Encode\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# use文省略（以下同様）\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?ISO-2022-JP?B?GyRCJDMkbCRPGyhCTUlNRSBTVUJKRUNUGyRCJE4bKEJkb2Nv?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e      =?ISO-2022-JP?B?ZGUbJEIlRiU5JUhNUSRHJDkbKEI=?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode_mimewords\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$encoded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'ISO-2022-JP'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$encoded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e-\u0026gt; これはMIME SUBJECTのdocodeテスト用です\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eやや納得いかないが、まあ確認なのでよしとする。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"指令-charsetを取得せよ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8C%87%E4%BB%A4-charset%E3%82%92%E5%8F%96%E5%BE%97%E3%81%9B%E3%82%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【指令】 charsetを取得せよ\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"http://search.cpan.org/%7Edskoll/MIME-tools-5.503/lib/MIME/Words.pm\" rel=\"nofollow noopener\" target=\"_blank\"\u003e[CPAN] MIME::Words\u003c/a\u003eによると、配列コンテキストならcharset取れるとのことなので、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edecode_mimewords+\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?ISO-2022-JP?B?GyRCJDMkbCRPGyhCTUlNRSBTVUJKRUNUGyRCJE4bKEJkb2Nv?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e      =?ISO-2022-JP?B?ZGUbJEIlRiU5JUhNUSRHJDkbKEI=?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e@decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode_mimewords\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$encoded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$encoded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e-\u0026gt; Can't call method \"can\" on unblessed reference at /usr/local/lib/perl5/5.24/mach/Encode.pm line 107.\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e???\u003c/p\u003e\n\n\u003cp\u003eドキュメントを読み直して「あ〜、はいはい」\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edecode_mimewords(array)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# データ\u003c/span\u003e\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?ISO-2022-JP?B?GyRCJDMkbCRPGyhCTUlNRSBTVUJKRUNUGyRCJE4bKEJkb2Nv?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e      =?ISO-2022-JP?B?ZGUbJEIlRiU5JUhNUSRHJDkbKEI=?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edecode_mimewords\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$charset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e@$_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edefined\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e.=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e.=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e-\u0026gt;これはMIME SUBJECTのdocodeテスト用です\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"で\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eで、\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edecode_mimewords(array)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edecode_mimewords\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$charset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e@$_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edefined\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e.=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e.=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e-\u0026gt; ギガシネマ with U-NEXT お申���込み完了のお知らせ\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e元の木阿弥...orz\u003cbr\u003e\nどうも配列コンテキストだと1行ずつの処理に戻ってしまうらしい。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"指令なんとかせよ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8C%87%E4%BB%A4%E3%81%AA%E3%82%93%E3%81%A8%E3%81%8B%E3%81%9B%E3%82%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【指令】なんとかせよ\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edecode_mimewords++(array)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$str\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$charset_l\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edecode_mimewords\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$charset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e@$_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nv\"\u003e$charset_l\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n         \u003cspan class=\"nv\"\u003e$str\u003c/span\u003e \u003cspan class=\"o\"\u003e.=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset_l\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e.=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset_l\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$str\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelsif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$str\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e.=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$str\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n         \u003cspan class=\"nv\"\u003e$str\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"nv\"\u003e$charset_l\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$charset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset_l\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$str\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n         \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e.=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset_l\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$str\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"nv\"\u003e$charset_l\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"nv\"\u003e$str\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e.=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset_l\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$str\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e \u003cspan class=\"o\"\u003e.=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$charset_l\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$str\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$decoded\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e-\u0026gt; ギガシネマ with U-NEXT お申し込み完了のお知らせ\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e＼(^o^)／\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"いやこれで納得しちゃダメだろ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%84%E3%82%84%E3%81%93%E3%82%8C%E3%81%A7%E7%B4%8D%E5%BE%97%E3%81%97%E3%81%A1%E3%82%83%E3%83%80%E3%83%A1%E3%81%A0%E3%82%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eいや、これで納得しちゃダメだろ\u003c/h1\u003e\n\n\u003cp\u003e調べていた時に\"\u003ca href=\"http://blog.livedoor.jp/techblog/archives/64631548.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e[livedoor Tech Blog] モブログに潜んでいる不具合\u003c/a\u003e\"を見つけていたので、こちらを参考に\u003ccode\u003eEncode::decode('MIME-Header', $src)\u003c/code\u003eを使う方法で書き直す。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edecode('MIME-Header')\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/\\?\\=\\s+\\=\\?[^?]+\\?[bq]\\?//igs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MIME-Header'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003e-\u0026gt; ギガシネマ with U-NEXT お申し込み完了のお知らせ\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eお〜\u003c/p\u003e\n\n\u003cp\u003eで、終わらないのはお約束。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"あらたなる敵の出現\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%82%E3%82%89%E3%81%9F%E3%81%AA%E3%82%8B%E6%95%B5%E3%81%AE%E5%87%BA%E7%8F%BE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eあらたなる敵の出現\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e'='パディング\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?UTF-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MIME-Header'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\"before: \"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/\\?\\=\\s+\\=\\?[^?]+\\?[bq]\\?//igs\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MIME-Header'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\"after:  \"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; before: Fire TVのサービス向上にご協力をお願いします\n-\u0026gt; after:  Fire TVのサービス\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e探すと結構ある。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e複数エンコーディング\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?ISO-8859-1?B?SWYgeW91IGNhbiByZWFkIHRoaXMgeW8=?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-8859-2?B?dSB1bmRlcnN0YW5kIHRoZSBleGFtcGxlLg==?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?US-ASCII?Q?.._cool!?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# （以下略）\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; before: If you can read this you understand the example... cool!\n-\u0026gt; after:  If you can read this yo\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e実際あるのかは謎だけど、\u003ca href=\"http://search.cpan.org/%7Edskoll/MIME-tools-5.503/lib/MIME/Words.pm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMIME::Wordsのドキュメント\u003c/a\u003eに書かれてたので対応しないわけにはいくまい、、、\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"パディング付きバイト列としては分断無しとみなす\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%91%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E4%BB%98%E3%81%8D%E3%83%90%E3%82%A4%E3%83%88%E5%88%97%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AF%E5%88%86%E6%96%AD%E7%84%A1%E3%81%97%E3%81%A8%E3%81%BF%E3%81%AA%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eパディング付き＝バイト列としては分断無しとみなす\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eパディング対策\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MIME-Header'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\"before: \"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\"   src: \"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/([^=])\\?\\=\\s+\\=\\?[^?]+\\?[bq]\\?/\\1/ig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MIME-Header'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\"after:  \"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\"  src:  \"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; before: Fire TVのサービス向上にご協力をお願いします\n-\u0026gt;    src: =?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n-\u0026gt;       =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\n-\u0026gt; after:  Fire TVのサービス向上にご協力をお願いします\n-\u0026gt;   src:  =?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n-\u0026gt;      =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eパディング対策の再確認(1)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e      =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?='\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 以下略\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; before: ギガシネマ with U-NEXT お申\\xE3\\x81\\x97込み完了のお知らせ\n-\u0026gt;    src: =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n-\u0026gt;       =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\n-\u0026gt; after:  ギガシネマ with U-NEXT お申し込み完了のお知らせ\n-\u0026gt;   src:  =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OBl+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eパディング対策の再確認(2)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'=?ISO-2022-JP?B?GyRCJSohPCVXJXMlPSE8JTklPSVVJUglJiUnJSIhShsoQk9T?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?UykbJEJASDxlQC0kSCROOH4kLTlnJCRKfRsoQi8bJEI6IzduJE4bKEJP?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?U1MbJEI+UjJwJE46Rz83JSIlQyVXJUchPCVIGyhCKEFwYWNoZU1lc29z?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?GyRCJHJESTJDIUsbKEIvGyRCOiM3biROQ21MXCU7JS0lZSVqJUYbKEI=?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?GyRCJSM+cEpzGyhCPE5SSSBPcGVuU3RhbmRpYRskQiVLJWUhPCU5GyhC?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?KFZvbC4xMTgpPg==?='\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; before: (省略）\n    :\n-\u0026gt; after:  オープンソースソフトウェア（OSS)脆弱性との向き合い方/今月のOSS紹介の最新アップデート(ApacheMesosを追加）/今月の注目セキュリティ情報\u0026lt;NRI OpenStandiaニュース(Vol.118)\u0026gt;\n-\u0026gt;   src:  =?ISO-2022-JP?B?GyRCJSohPCVXJXMlPSE8JTklPSVVJUglJiUnJSIhShsoQk9TUykbJEJASDxlQC0kSCROOH4kLTlnJCRKfRsoQi8bJEI6IzduJE4bKEJPU1MbJEI+UjJwJE46Rz83JSIlQyVXJUchPCVIGyhCKEFwYWNoZU1lc29zGyRCJHJESTJDIUsbKEIvGyRCOiM3biROQ21MXCU7JS0lZSVqJUYbKEI=?=\n-\u0026gt;      =?ISO-2022-JP?B?GyRCJSM+cEpzGyhCPE5SSSBPcGVuU3RhbmRpYRskQiVLJWUhPCU5GyhCKFZvbC4xMTgpPg==?=\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eよしよし。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"伝家の宝刀を抜く誇大\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BC%9D%E5%AE%B6%E3%81%AE%E5%AE%9D%E5%88%80%E3%82%92%E6%8A%9C%E3%81%8F%E8%AA%87%E5%A4%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e伝家の宝刀を抜く（誇大）\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e後方参照\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"=?ISO-8859-1?B?SWYgeW91IGNhbiByZWFkIHRoaXMgeW8=?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-8859-2?B?dSB1bmRlcnN0YW5kIHRoZSBleGFtcGxlLg==?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?US-ASCII?Q?.._cool!?=\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/=\\?([^?]+)\\?([bq])\\?([^?=]+)\\?=\\s+=\\?\\g1\\?\\g2\\?(.+)/=?\\1?\\2?\\3\\4/ig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MIME-Header'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\"src: \"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; If you can read this you understand the example... cool!\n-\u0026gt; src: =?ISO-8859-1?B?SWYgeW91IGNhbiByZWFkIHRoaXMgeW8=?=\n-\u0026gt;      =?ISO-8859-2?B?dSB1bmRlcnN0YW5kIHRoZSBleGFtcGxlLg==?=\n-\u0026gt;      =?US-ASCII?Q?.._cool!?=\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e後方参照確認\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e      =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?='\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; ギガシネマ with U-NEXT お申し込み完了のお知らせ\n-\u0026gt; src: =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OBl+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後の罠\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AE%E7%BD%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後の罠\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eパディングなしの連続行\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'=?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?='\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/=\\?([^?]+)\\?([bq])\\?([^?=]+)\\?=\\s+=\\?\\g1\\?\\g2\\?(.+)/=?\\1?\\2?\\3\\4/ig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MIME-Header'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\"src: \"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; Fire TVのサービス向上にご協力をお願いしますギガシネマ with U-NEXT お申\\xE3\\x81\\x97込み完了のお知らせ\n-\u0026gt; src: =?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n-\u0026gt;      =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n-\u0026gt;      =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"回せ回せ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9B%9E%E3%81%9B%E5%9B%9E%E3%81%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e回せ回せ！！\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ewhile()\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'=?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?='\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/=\\?([^?]+)\\?([bq])\\?([^?=]+)\\?=\\s+=\\?\\g1\\?\\g2\\?(.+)/=?\\1?\\2?\\3\\4/ig\u003c/span\u003e\u003cspan class=\"p\"\u003e){}\u003c/span\u003e\n\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MIME-Header'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"n\"\u003eencode_utf8\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\"src: \"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nv\"\u003e$src\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; Fire TVのサービス向上にご協力をお願いしますギガシネマ with U-NEXT お申し込み完了のお知らせ\n-\u0026gt; src: =?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n     =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OBl+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eあとはこれまでの各種パターン＋αで試す。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e頑張ってるベクター\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'=?iso-2022-jp?B?GyRCPzdIL0dkIVobKEI=?=2,980=?iso-2022-jp?B?GyRCMV8hWxsoQg==?=Microsoft Office=?iso-2022-jp?B?GyRCJEhCPT8nJEokJEFgOm5ALSRINi9OTyRKOF80OUAtIVYbKEI=?=Polaris Office=?iso-2022-jp?B?GyRCIVchWiVZJS8lPyE8GyhC?=PC=?iso-2022-jp?B?GyRCJTclZyVDJVchWxsoQg==?='\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; 新発売【2,980円】Microsoft Officeと遜色ない操作性と強力な互換性「Polaris Office」【ベクターPCショップ】\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"Perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eQiitaだけにQエンコードw\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'=?UTF-8?Q?[Qiita]_FreeBSD_Advent_Calendar_2016?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e =?UTF-8?Q?_16=E6=97=A5=E7=9B=AE=E3=81=AE=E4=BA=88=E7=B4=84=E6=8A=95=E7=A8=BF=E3=81=8C=E5=AE=8C=E4=BA=86=E3=81=97=E3=81=BE=E3=81=97=E3=81=9F?='\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; [Qiita] FreeBSD Advent Calendar 2016 16日目の予約投稿が完了しました\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eぼーずはSJISがお好き\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'=?SHIFT_JIS?B?gXmDe4Fbg1mCqYLngsyCqJJtgueCuYF6IEJvc2UgV2lyZWxl?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?SHIFT_JIS?B?c3MgSGVhZHBob25lcyCDj4NDg4SDjINYgsyOqZdSgrOCxpSXl82CzINU?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?SHIFT_JIS?B?g0WDk4NogqqC0ILGgsKCyYFC?='\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; 【ボーズからのお知らせ】 Bose Wireless Headphones ワイヤレスの自由さと迫力のサウンドがひとつに。\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"perl\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e全部のせ\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$src\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'=?ISO-2022-JP?B?GyRCJSohPCVXJXMlPSE8JTklPSVVJUglJiUnJSIhShsoQk9T?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?UykbJEJASDxlQC0kSCROOH4kLTlnJCRKfRsoQi8bJEI6IzduJE4bKEJP?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?U1MbJEI+UjJwJE46Rz83JSIlQyVXJUchPCVIGyhCKEFwYWNoZU1lc29z?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?GyRCJHJESTJDIUsbKEIvGyRCOiM3biROQ21MXCU7JS0lZSVqJUYbKEI=?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?GyRCJSM+cEpzGyhCPE5SSSBPcGVuU3RhbmRpYRskQiVLJWUhPCU5GyhC?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?KFZvbC4xMTgpPg==?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?GyRCJV0lMSViJXMbKEJHTyAbJEIlIhsoQg==?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-2022-JP?B?GyRCJUMlVyVHITwlSEdbPy4zKztPGyhC?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?SHIFT_JIS?B?gXmDe4Fbg1mCqYLngsyCqJJtgueCuYF6IEJvc2UgV2lyZWxl?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?SHIFT_JIS?B?c3MgSGVhZHBob25lcyCDj4NDg4SDjINYgsyOqZdSgrOCxpSXl82CzINU?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?SHIFT_JIS?B?g0WDk4NogqqC0ILGgsKCyYFC?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?TU9CSUxJVFkgU1RBVElPTiDllYblk4Hos7zlhaXnorroqo3j?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?ga7jgYrnn6XjgonjgZs=?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-8859-1?B?SWYgeW91IGNhbiByZWFkIHRoaXMgeW8=?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?ISO-8859-2?B?dSB1bmRlcnN0YW5kIHRoZSBleGFtcGxlLg==?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?US-ASCII?Q?.._cool!?=\";\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\u003c/span\u003e\n\u003cspan class=\"s\"\u003e     =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?='\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e-\u0026gt; オープンソースソフトウェア（OSS)脆弱性との向き合い方/今月のOSS紹介の最新アップデート(ApacheMesosを追加）/今月の注目セキュリティ情報\u0026lt;NRI OpenStandiaニュース(Vol.118)\u0026gt;ポケモンGO アップデート配信開始【ボーズからのお知らせ】 Bose Wireless Headphones ワイヤレスの自由さと迫力のサウンドがひとつに。MOBILITY STATION 商品購入確認のお知らせIf you can read this you understand the example... cool!ギガシネマ with U-NEXT お申し込み完了のお知らせ\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e手元で試した範囲では大丈夫でしたが、もしダメなパターンあったら教えていただけるとありがたいです。\u003c/li\u003e\n\u003cli\u003e知ってて良かった「田中哲スペシャル」。\u003c/li\u003e\n\u003cli\u003e「TL;DR」って一度書いてみたかった。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"http://qiita.com/kizashi1122/items/5a3e6e3928868bead40d\"\u003e[Qiita] Encode::decode('MIME-Header', $value) の挙動について\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://search.cpan.org/%7Edskoll/MIME-tools-5.503/lib/MIME/Words.pm\" rel=\"nofollow noopener\" target=\"_blank\"\u003e[CPAN] MIME::Words\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://blog.livedoor.jp/techblog/archives/64631548.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e[livedoor Tech Blog] モブログに潜んでいる不具合\u003c/a\u003e\u003c/p\u003e\n","body":"```text:環境\n% perl --version\n\nThis is perl 5, version 24, subversion 1 (v5.24.1) built for amd64-freebsd-thread-multi\n\nCopyright 1987-2017, Larry Wall\n```\n\n# TL;DR\n\n```perl:結論\nuse strict;\nuse utf8;\nuse feature 'say';\nuse Encode qw/encode_utf8 decode/;\n\n# 参考元より拝借\nmy $src = \"=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\";\n\n# これ！\nwhile ($src =~ s/=\\?([^?]+)\\?([bq])\\?([^?=]+)\\?=\\s+=\\?\\g1\\?\\g2\\?(.+)/=?\\1?\\2?\\3\\4/ig){}\n\nmy $dst = decode('MIME-Header', $src);\nsay encode_utf8 $dst;\n```\n\u003e `-\u003e ギガシネマ with U-NEXT お申し込み完了のお知らせ`\n\n## つまりは何をやったのか\n連続した行が、\n\n* 同じ文字セット/エンコーディングである\n* 前行の行末にパディング('=')がない\n\nという条件を満たした場合に前後の行を連結する、という処理を繰り返す。\n\n# 闘いの狼煙が上がる\n\nMIMEヘッダのデコードに引っかかり、[こちらのページ](http://qiita.com/kizashi1122/items/5a3e6e3928868bead40d)を発見するもISO-2022-JPで撃沈。\n\n```perl:decode_mimewords\nuse strict;\nuse feature 'say';\nuse MIME::Words qw/decode_mimewords/;\nuse Encode qw/encode_utf8 decode/;\n\nmy $subject = \"=?ISO-2022-JP?B?GyRCJDMkbCRPGyhCTUlNRSBTVUJKRUNUGyRCJE4bKEJkb2Nv?=\n      =?ISO-2022-JP?B?ZGUbJEIlRiU5JUhNUSRHJDkbKEI=?=\";\n\nmy $decoded = decode_mimewords($subject);\n\nsay $decoded;\n```\n\u003e `-\u003e ESC$B$3$l$OESC(BMIME SUBJECTESC$B$NESC(BdocodeESC$B%F%9%HMQ$G$9ESC(B`\n\n生のISO-2022-JPかよ！\n\n# 穴を掘って埋める\n\n```perl:decode_mimewords+Encode::decode\n# use文省略（以下同様）\n\nmy $subject = \"=?ISO-2022-JP?B?GyRCJDMkbCRPGyhCTUlNRSBTVUJKRUNUGyRCJE4bKEJkb2Nv?=\n      =?ISO-2022-JP?B?ZGUbJEIlRiU5JUhNUSRHJDkbKEI=?=\";\n\nmy $decoded = decode_mimewords($subject);\nmy $encoded = decode('ISO-2022-JP', $decoded);\n                                   \nsay encode_utf8 $encoded;\n```\n\u003e `-\u003e これはMIME SUBJECTのdocodeテスト用です`\n\nやや納得いかないが、まあ確認なのでよしとする。\n\n# 【指令】 charsetを取得せよ\n\n[[CPAN] MIME::Words](http://search.cpan.org/~dskoll/MIME-tools-5.503/lib/MIME/Words.pm)によると、配列コンテキストならcharset取れるとのことなので、\n\n```perl:decode_mimewords+\nmy $subject = \"=?ISO-2022-JP?B?GyRCJDMkbCRPGyhCTUlNRSBTVUJKRUNUGyRCJE4bKEJkb2Nv?=\n      =?ISO-2022-JP?B?ZGUbJEIlRiU5JUhNUSRHJDkbKEI=?=\";\n\nmy @decoded = decode_mimewords($subject);\nmy $encoded = decode($decoded[1], $decoded[0]);\n                    \nsay encode_utf8 $encoded;\n```\n\u003e `-\u003e Can't call method \"can\" on unblessed reference at /usr/local/lib/perl5/5.24/mach/Encode.pm line 107.`\n\n???\n\nドキュメントを読み直して「あ〜、はいはい」\n\n```perl:decode_mimewords(array)\n# データ\nmy $subject = \"=?ISO-2022-JP?B?GyRCJDMkbCRPGyhCTUlNRSBTVUJKRUNUGyRCJE4bKEJkb2Nv?=\n      =?ISO-2022-JP?B?ZGUbJEIlRiU5JUhNUSRHJDkbKEI=?=\";\n\nmy $decoded;\nforeach (decode_mimewords($subject)) {\n   my ($data, $charset) = @$_;\n   if (defined($charset)) {\n      $decoded .= decode($charset, $data);\n   } else {\n      $decoded .= $data;\n   }\n}\n\nsay encode_utf8 $decoded;\n```\n\u003e `-\u003eこれはMIME SUBJECTのdocodeテスト用です`\n\n# で、\n\n```perl:decode_mimewords(array)\nmy $subject = \"=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\";\n\nmy $decoded;\nforeach (decode_mimewords($subject)) {\n   my ($data, $charset) = @$_;\n   if (defined($charset)) {\n      $decoded .= decode($charset, $data);\n   } else {\n      $decoded .= $data;\n   }\n}\n\nsay encode_utf8 $decoded;\n```\n\u003e `-\u003e ギガシネマ with U-NEXT お申���込み完了のお知らせ`\n\n元の木阿弥...orz\nどうも配列コンテキストだと1行ずつの処理に戻ってしまうらしい。\n\n# 【指令】なんとかせよ\n\n```perl:decode_mimewords++(array)\nmy $subject = \"=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\";\n\nmy $decoded;\nmy $str;\nmy $charset_l;\nforeach (decode_mimewords($subject)) {\n   my ($data, $charset) = @$_;\n   if ($charset) {\n      if ($charset == $charset_l) {\n         $str .= $data;\n      } else {\n         if ($charset_l) {\n            $decoded .= decode($charset_l, $str);\n         } elsif ($str) {\n            $decoded .= $str;\n         }\n         $str = $data;\n      }\n      $charset_l = $charset;\n   } else {\n      if ($charset_l \u0026\u0026 $str) {\n         $decoded .= decode($charset_l, $str);\n         $charset_l = '';\n         $str = '';\n      }\n      $decoded .= $data;\n   }\n}\nif ($charset_l \u0026\u0026 $str ) {\n   $decoded .= decode($charset_l, $str);\n}\n\nsay encode_utf8 $decoded;\n```\n\u003e `-\u003e ギガシネマ with U-NEXT お申し込み完了のお知らせ`\n\n＼(^o^)／\n\n# いや、これで納得しちゃダメだろ\n\n調べていた時に\"[[livedoor Tech Blog] モブログに潜んでいる不具合](http://blog.livedoor.jp/techblog/archives/64631548.html)\"を見つけていたので、こちらを参考に`Encode::decode('MIME-Header', $src)`を使う方法で書き直す。\n\n```perl:decode('MIME-Header')\nmy $src = \"=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\";\n\n$src =~ s/\\?\\=\\s+\\=\\?[^?]+\\?[bq]\\?//igs;\nmy $dst = decode('MIME-Header', $src);\nsay encode_utf8 $dst;\n```\n\u003e `-\u003e ギガシネマ with U-NEXT お申し込み完了のお知らせ`\n\nお〜\n\nで、終わらないのはお約束。\n\n# あらたなる敵の出現\n\n```perl:'='パディング\nmy $src = \"=?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n     =?UTF-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\";\n\nmy $dst = decode('MIME-Header', $src);\nsay \"before: \",encode_utf8 $dst;\n$src =~ s/\\?\\=\\s+\\=\\?[^?]+\\?[bq]\\?//igs;\n$dst = decode('MIME-Header', $src);\nsay \"after:  \",encode_utf8 $dst;\n```\n\u003e ```\n-\u003e before: Fire TVのサービス向上にご協力をお願いします\n-\u003e after:  Fire TVのサービス\n```\n\n探すと結構ある。\n\n```perl:複数エンコーディング\nmy $src = \"=?ISO-8859-1?B?SWYgeW91IGNhbiByZWFkIHRoaXMgeW8=?=\n     =?ISO-8859-2?B?dSB1bmRlcnN0YW5kIHRoZSBleGFtcGxlLg==?=\n     =?US-ASCII?Q?.._cool!?=\";\n\n# （以下略）\n```\n\u003e ```\n-\u003e before: If you can read this you understand the example... cool!\n-\u003e after:  If you can read this yo\n```\n\n実際あるのかは謎だけど、[MIME::Wordsのドキュメント](http://search.cpan.org/~dskoll/MIME-tools-5.503/lib/MIME/Words.pm)に書かれてたので対応しないわけにはいくまい、、、\n\n# パディング付き＝バイト列としては分断無しとみなす\n\n```perl:パディング対策\nmy $src = \"=?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n     =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\";\n\nmy $dst = decode('MIME-Header', $src);\nsay \"before: \", encode_utf8 $dst;\nsay \"   src: \", $src;\n$src =~ s/([^=])\\?\\=\\s+\\=\\?[^?]+\\?[bq]\\?/\\1/ig;\n$dst = decode('MIME-Header', $src);\nsay \"after:  \",encode_utf8 $dst;\nsay \"  src:  \", $src;\n```\n\u003e ```\n-\u003e before: Fire TVのサービス向上にご協力をお願いします\n-\u003e    src: =?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n-\u003e       =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\n-\u003e after:  Fire TVのサービス向上にご協力をお願いします\n-\u003e   src:  =?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n-\u003e      =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\n```\n\n```perl:パディング対策の再確認(1)\nmy $src= '=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n      =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=';\n\n# 以下略\n```\n\u003e ```\n-\u003e before: ギガシネマ with U-NEXT お申\\xE3\\x81\\x97込み完了のお知らせ\n-\u003e    src: =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n-\u003e       =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\n-\u003e after:  ギガシネマ with U-NEXT お申し込み完了のお知らせ\n-\u003e   src:  =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OBl+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\n```\n\n```perl:パディング対策の再確認(2)\nmy $src = '=?ISO-2022-JP?B?GyRCJSohPCVXJXMlPSE8JTklPSVVJUglJiUnJSIhShsoQk9T?=\n     =?ISO-2022-JP?B?UykbJEJASDxlQC0kSCROOH4kLTlnJCRKfRsoQi8bJEI6IzduJE4bKEJP?=\n     =?ISO-2022-JP?B?U1MbJEI+UjJwJE46Rz83JSIlQyVXJUchPCVIGyhCKEFwYWNoZU1lc29z?=\n     =?ISO-2022-JP?B?GyRCJHJESTJDIUsbKEIvGyRCOiM3biROQ21MXCU7JS0lZSVqJUYbKEI=?=\n     =?ISO-2022-JP?B?GyRCJSM+cEpzGyhCPE5SSSBPcGVuU3RhbmRpYRskQiVLJWUhPCU5GyhC?=\n     =?ISO-2022-JP?B?KFZvbC4xMTgpPg==?=';\n```\n\u003e ```\n-\u003e before: (省略）\n    :\n-\u003e after:  オープンソースソフトウェア（OSS)脆弱性との向き合い方/今月のOSS紹介の最新アップデート(ApacheMesosを追加）/今月の注目セキュリティ情報\u003cNRI OpenStandiaニュース(Vol.118)\u003e\n-\u003e   src:  =?ISO-2022-JP?B?GyRCJSohPCVXJXMlPSE8JTklPSVVJUglJiUnJSIhShsoQk9TUykbJEJASDxlQC0kSCROOH4kLTlnJCRKfRsoQi8bJEI6IzduJE4bKEJPU1MbJEI+UjJwJE46Rz83JSIlQyVXJUchPCVIGyhCKEFwYWNoZU1lc29zGyRCJHJESTJDIUsbKEIvGyRCOiM3biROQ21MXCU7JS0lZSVqJUYbKEI=?=\n-\u003e      =?ISO-2022-JP?B?GyRCJSM+cEpzGyhCPE5SSSBPcGVuU3RhbmRpYRskQiVLJWUhPCU5GyhCKFZvbC4xMTgpPg==?=\n```\n\nよしよし。\n\n# 伝家の宝刀を抜く（誇大）\n\n```perl:後方参照\nmy $src = \"=?ISO-8859-1?B?SWYgeW91IGNhbiByZWFkIHRoaXMgeW8=?=\n     =?ISO-8859-2?B?dSB1bmRlcnN0YW5kIHRoZSBleGFtcGxlLg==?=\n     =?US-ASCII?Q?.._cool!?=\";\n\n$src =~ s/=\\?([^?]+)\\?([bq])\\?([^?=]+)\\?=\\s+=\\?\\g1\\?\\g2\\?(.+)/=?\\1?\\2?\\3\\4/ig;\nmy $dst = decode('MIME-Header', $src);\nsay encode_utf8 $dst;\nsay \"src: \",$src;\n```\n\u003e ```\n-\u003e If you can read this you understand the example... cool!\n-\u003e src: =?ISO-8859-1?B?SWYgeW91IGNhbiByZWFkIHRoaXMgeW8=?=\n-\u003e      =?ISO-8859-2?B?dSB1bmRlcnN0YW5kIHRoZSBleGFtcGxlLg==?=\n-\u003e      =?US-ASCII?Q?.._cool!?=\n```\n\n```perl:後方参照確認\nmy $src= '=?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n      =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=';\n```\n\u003e ```\n-\u003e ギガシネマ with U-NEXT お申し込み完了のお知らせ\n-\u003e src: =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OBl+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\n```\n\n# 最後の罠\n\n```perl:パディングなしの連続行\nmy $src = '=?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n     =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\n     =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n     =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=';\n\n$src =~ s/=\\?([^?]+)\\?([bq])\\?([^?=]+)\\?=\\s+=\\?\\g1\\?\\g2\\?(.+)/=?\\1?\\2?\\3\\4/ig;\nmy $dst = decode('MIME-Header', $src);\nsay encode_utf8 $dst;\nsay \"src: \",$src;\n```\n\u003e ```\n-\u003e Fire TVのサービス向上にご協力をお願いしますギガシネマ with U-NEXT お申\\xE3\\x81\\x97込み完了のお知らせ\n-\u003e src: =?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n-\u003e      =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n-\u003e      =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\n```\n\n# 回せ回せ！！\n\n```perl:while()\nmy $src = '=?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n     =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ?=\n     =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n     =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=';\n\nwhile ($src =~ s/=\\?([^?]+)\\?([bq])\\?([^?=]+)\\?=\\s+=\\?\\g1\\?\\g2\\?(.+)/=?\\1?\\2?\\3\\4/ig){}\nmy $dst = decode('MIME-Header', $src);\nsay encode_utf8 $dst;\nsay \"src: \",$src;\n```\n\u003e ```\n-\u003e Fire TVのサービス向上にご協力をお願いしますギガシネマ with U-NEXT お申し込み完了のお知らせ\n-\u003e src: =?UTF-8?B?RmlyZSBUVuOBruOCteODvOODk+OCuQ==?=\n     =?utf-8?B?5ZCR5LiK44Gr44GU5Y2U5Yqb44KS44GK6aGY44GE44GX44G+44GZ44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OBl+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=\n\nあとはこれまでの各種パターン＋αで試す。\n\n```perl:頑張ってるベクター\nmy $src = '=?iso-2022-jp?B?GyRCPzdIL0dkIVobKEI=?=2,980=?iso-2022-jp?B?GyRCMV8hWxsoQg==?=Microsoft Office=?iso-2022-jp?B?GyRCJEhCPT8nJEokJEFgOm5ALSRINi9OTyRKOF80OUAtIVYbKEI=?=Polaris Office=?iso-2022-jp?B?GyRCIVchWiVZJS8lPyE8GyhC?=PC=?iso-2022-jp?B?GyRCJTclZyVDJVchWxsoQg==?=';\n```\n\u003e ```\n-\u003e 新発売【2,980円】Microsoft Officeと遜色ない操作性と強力な互換性「Polaris Office」【ベクターPCショップ】\n```\n\n```Perl:QiitaだけにQエンコードw\nmy $src = '=?UTF-8?Q?[Qiita]_FreeBSD_Advent_Calendar_2016?=\n =?UTF-8?Q?_16=E6=97=A5=E7=9B=AE=E3=81=AE=E4=BA=88=E7=B4=84=E6=8A=95=E7=A8=BF=E3=81=8C=E5=AE=8C=E4=BA=86=E3=81=97=E3=81=BE=E3=81=97=E3=81=9F?=';\n```\n\u003e ```\n-\u003e [Qiita] FreeBSD Advent Calendar 2016 16日目の予約投稿が完了しました\n```\n\n```perl:ぼーずはSJISがお好き\nmy $src = '=?SHIFT_JIS?B?gXmDe4Fbg1mCqYLngsyCqJJtgueCuYF6IEJvc2UgV2lyZWxl?=\n     =?SHIFT_JIS?B?c3MgSGVhZHBob25lcyCDj4NDg4SDjINYgsyOqZdSgrOCxpSXl82CzINU?=\n     =?SHIFT_JIS?B?g0WDk4NogqqC0ILGgsKCyYFC?=';\n```\n\u003e ```\n-\u003e 【ボーズからのお知らせ】 Bose Wireless Headphones ワイヤレスの自由さと迫力のサウンドがひとつに。\n```\n\n```perl:全部のせ\nmy $src = '=?ISO-2022-JP?B?GyRCJSohPCVXJXMlPSE8JTklPSVVJUglJiUnJSIhShsoQk9T?=\n     =?ISO-2022-JP?B?UykbJEJASDxlQC0kSCROOH4kLTlnJCRKfRsoQi8bJEI6IzduJE4bKEJP?=\n     =?ISO-2022-JP?B?U1MbJEI+UjJwJE46Rz83JSIlQyVXJUchPCVIGyhCKEFwYWNoZU1lc29z?=\n     =?ISO-2022-JP?B?GyRCJHJESTJDIUsbKEIvGyRCOiM3biROQ21MXCU7JS0lZSVqJUYbKEI=?=\n     =?ISO-2022-JP?B?GyRCJSM+cEpzGyhCPE5SSSBPcGVuU3RhbmRpYRskQiVLJWUhPCU5GyhC?=\n     =?ISO-2022-JP?B?KFZvbC4xMTgpPg==?=\n     =?ISO-2022-JP?B?GyRCJV0lMSViJXMbKEJHTyAbJEIlIhsoQg==?=\n     =?ISO-2022-JP?B?GyRCJUMlVyVHITwlSEdbPy4zKztPGyhC?=\n     =?SHIFT_JIS?B?gXmDe4Fbg1mCqYLngsyCqJJtgueCuYF6IEJvc2UgV2lyZWxl?=\n     =?SHIFT_JIS?B?c3MgSGVhZHBob25lcyCDj4NDg4SDjINYgsyOqZdSgrOCxpSXl82CzINU?=\n     =?SHIFT_JIS?B?g0WDk4NogqqC0ILGgsKCyYFC?=\n     =?utf-8?B?TU9CSUxJVFkgU1RBVElPTiDllYblk4Hos7zlhaXnorroqo3j?=\n     =?utf-8?B?ga7jgYrnn6XjgonjgZs=?=\n     =?ISO-8859-1?B?SWYgeW91IGNhbiByZWFkIHRoaXMgeW8=?=\n     =?ISO-8859-2?B?dSB1bmRlcnN0YW5kIHRoZSBleGFtcGxlLg==?=\n     =?US-ASCII?Q?.._cool!?=\";\n     =?utf-8?B?44Ku44Ks44K344ON44OeIHdpdGggVS1ORVhUIOOBiueUs+OB?=\n     =?utf-8?B?l+i+vOOBv+WujOS6huOBruOBiuefpeOCieOBmw==?=';\n```\n\u003e ```\n-\u003e オープンソースソフトウェア（OSS)脆弱性との向き合い方/今月のOSS紹介の最新アップデート(ApacheMesosを追加）/今月の注目セキュリティ情報\u003cNRI OpenStandiaニュース(Vol.118)\u003eポケモンGO アップデート配信開始【ボーズからのお知らせ】 Bose Wireless Headphones ワイヤレスの自由さと迫力のサウンドがひとつに。MOBILITY STATION 商品購入確認のお知らせIf you can read this you understand the example... cool!ギガシネマ with U-NEXT お申し込み完了のお知らせ\n```\n\n# おわりに\n\n* 手元で試した範囲では大丈夫でしたが、もしダメなパターンあったら教えていただけるとありがたいです。\n* 知ってて良かった「田中哲スペシャル」。\n* 「TL;DR」って一度書いてみたかった。\n\n# 参考\n[[Qiita] Encode::decode('MIME-Header', $value) の挙動について](http://qiita.com/kizashi1122/items/5a3e6e3928868bead40d)\n[[CPAN] MIME::Words](http://search.cpan.org/~dskoll/MIME-tools-5.503/lib/MIME/Words.pm)\n[[livedoor Tech Blog] モブログに潜んでいる不具合](http://blog.livedoor.jp/techblog/archives/64631548.html)\n","coediting":false,"created_at":"2017-05-17T20:03:14+09:00","group":null,"id":"ed66c1f3705fc037603a","private":false,"tags":[{"name":"Perl","versions":[]},{"name":"mime","versions":[]}],"title":"MIMEヘッダをデコードする 〜 decode_mimewordsさんのいけず、、、","updated_at":"2017-05-17T20:03:14+09:00","url":"http://qiita.com/hs_onsky/items/ed66c1f3705fc037603a","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":null,"id":"hs_onsky","items_count":2,"linkedin_id":"","location":"Tsukuba-shi, Ibaraki Japan","name":"Hideki SAKAMOTO","organization":"Tsukuba Secure Network Research Co., Ltd.","permanent_id":154669,"profile_image_url":"https://pbs.twimg.com/profile_images/689484566/DSC_0461_normal.JPG","twitter_screen_name":"hs_onsky","website_url":""}},{"rendered_body":"\n\u003ch2\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h2\u003e\n\n\u003cp\u003eCompose とは、複数のコンテナを使う Docker アプリケーションを、定義・実行するツールです。Compose はアプリケーションのサービスの設定に、Compose ファイルを使います。そして、コマンドを１つ実行するだけで、設定した全てのサービスを作成・起動します。  \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://docs.docker.jp/compose/overview.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDocker Compose 概要 — Docker-docs-ja 1.13.RC ドキュメント\u003c/a\u003eより抜粋　\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プロジェクトを定義する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロジェクトを定義する\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003e1. 任意の場所にディレクトリを作成し移動\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ cd Desktop\n\n$ mkdir docker\n\n$ cd docker\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e2. Dockerfileを作成\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eFROM ruby:2.3.3\nRUN apt-get update -qq \u0026amp;\u0026amp; apt-get install -y build-essential libpq-dev nodejs\nRUN mkdir /myapp\nWORKDIR /myapp\nADD Gemfile /myapp/Gemfile\nADD Gemfile.lock /myapp/Gemfile.lock\nRUN bundle install\nADD . /myapp\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e3.Gemfileを作成\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003esource 'https://rubygems.org'\ngem 'rails', '5.0.0.1'\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e4.Gemfile.lockを作成\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ touch Gemfile.lock\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e5.docker-compose.ymlを作成\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eversion: '2'\nservices:\n  db:\n    image: postgres\n  web:\n    build: .\n    command: bundle exec rails s -p 3000 -b '0.0.0.0'\n    volumes:\n      - .:/myapp\n    ports:\n      - \"3000:3000\"\n    depends_on:\n      - db\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e注:タブインデントで書くと実行時エラーになります。(vimで書いてたら行毎にエラー出まくり(汗)\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プロジェクトを構築\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E6%A7%8B%E7%AF%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロジェクトを構築\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003e1.Railsアプリケーションを生成\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ docker-compose run web rails new . --force --database=postgresql --skip-bundle\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e下記の様な構成のアプリケーションが生成されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ ls -l\n\ntotal 64\n-rw-r--r--   1 username  staff   222  5 17 17:19 Dockerfile\n-rw-r--r--   1 username  staff  1738  5 17 17:37 Gemfile\n-rw-r--r--   1 username  staff  4306  5 17 18:18 Gemfile.lock\n-rw-r--r--   1 username  staff   374  5 17 17:37 README.md\n-rw-r--r--   1 username  staff   227  5 17 17:37 Rakefile\ndrwxr-xr-x  10 username  staff   340  5 17 17:37 app\ndrwxr-xr-x   7 username  staff   238  5 17 17:37 bin\ndrwxr-xr-x  14 username  staff   476  5 17 17:47 config\n-rw-r--r--   1 username  staff   130  5 17 17:37 config.ru\ndrwxr-xr-x   3 username  staff   102  5 17 17:37 db\n-rw-r--r--   1 username  staff   211  5 17 17:33 docker-compose.yml\ndrwxr-xr-x   4 username  staff   136  5 17 17:37 lib\ndrwxr-xr-x   4 username  staff   136  5 17 18:24 log\ndrwxr-xr-x   9 username  staff   306  5 17 17:37 public\ndrwxr-xr-x   9 username  staff   306  5 17 17:37 test\ndrwxr-xr-x   7 username  staff   238  5 17 18:24 tmp\ndrwxr-xr-x   3 username  staff   102  5 17 17:37 vendor\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e2.イメージをビルドする\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ docker-compose build\n\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e3.データベースの設定を行う\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003edatabase.ymlのdevelopmentの設定を下記に変更\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003econfig/database.yml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003edevelopment\u003c/span\u003e\u003cspan class=\"p p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"nl\"\u003e\u0026amp;default\u003c/span\u003e\n  \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003eadapter\u003c/span\u003e\u003cspan class=\"p p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003epostgresql\u003c/span\u003e\n  \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003eencoding\u003c/span\u003e\u003cspan class=\"p p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003eunicode\u003c/span\u003e\n  \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003edatabase\u003c/span\u003e\u003cspan class=\"p p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003emyapp_development\u003c/span\u003e\n  \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003epool\u003c/span\u003e\u003cspan class=\"p p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003e5\u003c/span\u003e\n  \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003eusername\u003c/span\u003e\u003cspan class=\"p p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003epostgres\u003c/span\u003e\n  \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003epassword\u003c/span\u003e\u003cspan class=\"p p-Indicator\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003ehost\u003c/span\u003e\u003cspan class=\"p p-Indicator\"\u003e:\u003c/span\u003e \u003cspan class=\"l l-Scalar l-Scalar-Plain\"\u003edb\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e4.アプリケーションの起動\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ docker-compose up\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eうまくいっていれば下記の様なログが出力されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eweb_1  | =\u0026gt; Booting Puma\nweb_1  | =\u0026gt; Rails 5.0.0.1 application starting in development on http://0.0.0.0:3000\nweb_1  | =\u0026gt; Run `rails server -h` for more startup options\nweb_1  | Puma starting in single mode...\nweb_1  | * Version 3.8.2 (ruby 2.3.3-p222), codename: Sassy Salamander\nweb_1  | * Min threads: 5, max threads: 5\nweb_1  | * Environment: development\nweb_1  | * Listening on tcp://0.0.0.0:3000\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e注:アプリケーションを再起動しようとすると下記のエラーが出ました。このエラーが出た際は\u003ccode\u003eserver.pid\u003c/code\u003eを削除し、再起動します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eA server is already running. Check /myapp/tmp/pids/server.pid.\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003e5.データベースの作成\u003c/strong\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ docker-compose run web rake db:create\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ブラウザで確認してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eブラウザで確認してみる\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/134872/d672ed57-9686-fbaf-9b98-3f2176f422a4.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/134872/d672ed57-9686-fbaf-9b98-3f2176f422a4.png\" alt=\"スクリーンショット 2017-05-17 19.19.50（2）.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eおお...なんということでしょう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h2\u003e\n\n\u003cp\u003e普段なにげなく使用していたDockerでしたが、自分でいちから環境を作ってみると改めて便利さがわかりました。\u003cbr\u003e\nあんなに煩わしい環境構築がこれだけの手順でできてしまうとは、すごいの一言!!\u003cbr\u003e\n今回は\u003ca href=\"https://docs.docker.com/compose/rails/#define-the-project\" rel=\"nofollow noopener\" target=\"_blank\"\u003eQuickstart: Compose and Rails - Docker Documentation\u003c/a\u003eを写経しただけでしたが、他にも色々試してみて理解を深めたいと思います。\u003c/p\u003e\n","body":"## 概要\nCompose とは、複数のコンテナを使う Docker アプリケーションを、定義・実行するツールです。Compose はアプリケーションのサービスの設定に、Compose ファイルを使います。そして、コマンドを１つ実行するだけで、設定した全てのサービスを作成・起動します。  \n\n[Docker Compose 概要 — Docker\\-docs\\-ja 1\\.13\\.RC ドキュメント](http://docs.docker.jp/compose/overview.html)より抜粋　\n\n## プロジェクトを定義する\n\n**1. 任意の場所にディレクトリを作成し移動**\n\n```\n$ cd Desktop\n\n$ mkdir docker\n\n$ cd docker\n```\n\n**2. Dockerfileを作成**\n\n```\nFROM ruby:2.3.3\nRUN apt-get update -qq \u0026\u0026 apt-get install -y build-essential libpq-dev nodejs\nRUN mkdir /myapp\nWORKDIR /myapp\nADD Gemfile /myapp/Gemfile\nADD Gemfile.lock /myapp/Gemfile.lock\nRUN bundle install\nADD . /myapp\n```\n\n**3.Gemfileを作成**\n\n```\nsource 'https://rubygems.org'\ngem 'rails', '5.0.0.1'\n```\n\n**4.Gemfile.lockを作成**\n\n```\n$ touch Gemfile.lock\n```\n\n**5.docker-compose.ymlを作成**\n\n```\nversion: '2'\nservices:\n  db:\n    image: postgres\n  web:\n    build: .\n    command: bundle exec rails s -p 3000 -b '0.0.0.0'\n    volumes:\n      - .:/myapp\n    ports:\n      - \"3000:3000\"\n    depends_on:\n      - db\n```\n**注:タブインデントで書くと実行時エラーになります。(vimで書いてたら行毎にエラー出まくり(汗)**\n\n## プロジェクトを構築\n\n**1.Railsアプリケーションを生成**\n\n```\n$ docker-compose run web rails new . --force --database=postgresql --skip-bundle\n```\n\n下記の様な構成のアプリケーションが生成されます。\n\n```\n$ ls -l\n\ntotal 64\n-rw-r--r--   1 username  staff   222  5 17 17:19 Dockerfile\n-rw-r--r--   1 username  staff  1738  5 17 17:37 Gemfile\n-rw-r--r--   1 username  staff  4306  5 17 18:18 Gemfile.lock\n-rw-r--r--   1 username  staff   374  5 17 17:37 README.md\n-rw-r--r--   1 username  staff   227  5 17 17:37 Rakefile\ndrwxr-xr-x  10 username  staff   340  5 17 17:37 app\ndrwxr-xr-x   7 username  staff   238  5 17 17:37 bin\ndrwxr-xr-x  14 username  staff   476  5 17 17:47 config\n-rw-r--r--   1 username  staff   130  5 17 17:37 config.ru\ndrwxr-xr-x   3 username  staff   102  5 17 17:37 db\n-rw-r--r--   1 username  staff   211  5 17 17:33 docker-compose.yml\ndrwxr-xr-x   4 username  staff   136  5 17 17:37 lib\ndrwxr-xr-x   4 username  staff   136  5 17 18:24 log\ndrwxr-xr-x   9 username  staff   306  5 17 17:37 public\ndrwxr-xr-x   9 username  staff   306  5 17 17:37 test\ndrwxr-xr-x   7 username  staff   238  5 17 18:24 tmp\ndrwxr-xr-x   3 username  staff   102  5 17 17:37 vendor\n```\n\n**2.イメージをビルドする**\n\n```\n$ docker-compose build\n\n```\n\n**3.データベースの設定を行う**\n\ndatabase.ymlのdevelopmentの設定を下記に変更\n\n```config/database.yml\ndevelopment: \u0026default\n  adapter: postgresql\n  encoding: unicode\n  database: myapp_development\n  pool: 5\n  username: postgres\n  password:\n  host: db\n```\n\n**4.アプリケーションの起動**\n\n```\n$ docker-compose up\n```\n\nうまくいっていれば下記の様なログが出力されます。\n\n```\nweb_1  | =\u003e Booting Puma\nweb_1  | =\u003e Rails 5.0.0.1 application starting in development on http://0.0.0.0:3000\nweb_1  | =\u003e Run `rails server -h` for more startup options\nweb_1  | Puma starting in single mode...\nweb_1  | * Version 3.8.2 (ruby 2.3.3-p222), codename: Sassy Salamander\nweb_1  | * Min threads: 5, max threads: 5\nweb_1  | * Environment: development\nweb_1  | * Listening on tcp://0.0.0.0:3000\n```\n\n注:アプリケーションを再起動しようとすると下記のエラーが出ました。このエラーが出た際は```server.pid```を削除し、再起動します。\n\n```\nA server is already running. Check /myapp/tmp/pids/server.pid.\n```\n\n**5.データベースの作成**\n\n```\n$ docker-compose run web rake db:create\n```\n\n## ブラウザで確認してみる\n![スクリーンショット 2017-05-17 19.19.50（2）.png](https://qiita-image-store.s3.amazonaws.com/0/134872/d672ed57-9686-fbaf-9b98-3f2176f422a4.png)\n\nおお...なんということでしょう。\n\n## 最後に\n普段なにげなく使用していたDockerでしたが、自分でいちから環境を作ってみると改めて便利さがわかりました。\nあんなに煩わしい環境構築がこれだけの手順でできてしまうとは、すごいの一言!!\n今回は[Quickstart: Compose and Rails \\- Docker Documentation](https://docs.docker.com/compose/rails/#define-the-project)を写経しただけでしたが、他にも色々試してみて理解を深めたいと思います。\n\n","coediting":false,"created_at":"2017-05-17T19:57:30+09:00","group":null,"id":"2c8caaeb4d3be0025712","private":false,"tags":[{"name":"Ruby","versions":[]},{"name":"PostgreSQL","versions":[]},{"name":"RubyOnRails","versions":[]},{"name":"docker","versions":[]},{"name":"docker-compose","versions":[]}],"title":"DockerComposeを使用してRails/PostgreSQL環境を作ってみた","updated_at":"2017-05-17T20:01:20+09:00","url":"http://qiita.com/t_yamashita0604/items/2c8caaeb4d3be0025712","user":{"description":null,"facebook_id":null,"followees_count":4,"followers_count":6,"github_login_name":null,"id":"t_yamashita0604","items_count":9,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":134872,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/134872/profile-images/1473719439","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003eDeep Learningのお仕事をしていると、お客様から「なんでこういう結果になるの？」という質問をよく頂きます。\u003c/p\u003e\n\n\u003cp\u003eその際利用するのが「注目位置の可視化」なのですが、その一つの例である「Class Activation Mapping（CAM）」の処理を理解するために、実装コードである「Weakly_detector」を読み込んでみます。\u003c/p\u003e\n\n\u003cp\u003eちなみに、「Weakly_detector」のソースコードは\u003ca href=\"https://github.com/jazzsaxmafia/Weakly_detector\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGitHub\u003c/a\u003eで公開されています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"トレーニング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%88%E3%83%AC%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eトレーニング\u003c/h1\u003e\n\n\u003cp\u003eまずはトレーニングのコード「train.caltech.py」を読み込んでいきます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"インポートライブラリ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eインポートライブラリ\u003c/h2\u003e\n\n\u003cp\u003e今回の処理で必要になるライブラリは以下の通りです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etrain.caltech.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etensorflow\u003c/span\u003e \u003cspan class=\"kn\"\u003eas\u003c/span\u003e \u003cspan class=\"nn\"\u003etf\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"kn\"\u003eas\u003c/span\u003e \u003cspan class=\"nn\"\u003enp\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003epandas\u003c/span\u003e \u003cspan class=\"kn\"\u003eas\u003c/span\u003e \u003cspan class=\"nn\"\u003epd\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003edetector\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eDetector\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eutil\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eload_image\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eos\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eipdb\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eまた、呼び出している関数が定義されている別のファイル（detector.py、util.py）でも、他のライブラリを利用しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edetector.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etensorflow\u003c/span\u003e \u003cspan class=\"kn\"\u003eas\u003c/span\u003e \u003cspan class=\"nn\"\u003etf\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"kn\"\u003eas\u003c/span\u003e \u003cspan class=\"nn\"\u003enp\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ecPickle\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eipdb\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eutil.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eskimage.io\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eskimage.transform\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eipdb\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"kn\"\u003eas\u003c/span\u003e \u003cspan class=\"nn\"\u003enp\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eよって、外部モジュールとして「\u003ca href=\"https://www.tensorflow.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eTensorFlow\u003c/a\u003e」「\u003ca href=\"http://www.numpy.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNumPy\u003c/a\u003e」「\u003ca href=\"http://pandas.pydata.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003epandas\u003c/a\u003e」「\u003ca href=\"http://scikit-image.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003escikit-image\u003c/a\u003e」が必要になります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"入出力パスファイル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%A5%E5%87%BA%E5%8A%9B%E3%83%91%E3%82%B9%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e入出力パス／ファイル\u003c/h2\u003e\n\n\u003cp\u003e次に、入出力に関連するパス名やファイル名の指定があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eweight_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'../data/caffe_layers_value.pickle'\u003c/span\u003e\n\u003cspan class=\"n\"\u003emodel_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'../models/caltech256/'\u003c/span\u003e\n\u003cspan class=\"n\"\u003epretrained_model_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e \u003cspan class=\"c1\"\u003e#'../models/caltech256/model-0'\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edataset_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/media/storage3/Study/data/256_ObjectCategories'\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ecaltech_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'../data/caltech'\u003c/span\u003e\n\u003cspan class=\"n\"\u003etrainset_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'../data/caltech/train.pickle'\u003c/span\u003e\n\u003cspan class=\"n\"\u003etestset_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'../data/caltech/test.pickle'\u003c/span\u003e\n\u003cspan class=\"n\"\u003elabel_dict_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'../data/caltech/label_dict.pickle'\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e必ず事前に準備が必要なのは、「dataset_path」で指定されている学習データセットになります。\u003cbr\u003e\n今回はCaltech-256を使用しています。\u003ca href=\"http://www.vision.caltech.edu/Image_Datasets/Caltech256/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003eからダウンロードしておきます。\u003cbr\u003e\n学習データは、それぞれ「nnn.label_name」（nnnは001～257までの数字、label_nameはラベル名）の形式で命名されたディレクトリ内に保存されています。\u003cbr\u003e\n学習データ自体は、「nnn_mmmm.jpg」（nnnは001～257までの数字、mmmmは0001～の数字）になっています。\u003c/p\u003e\n\n\u003cp\u003eまた「weight_path」も必要になりますが、これはGitHubのところから辿れる\u003ca href=\"https://drive.google.com/file/d/0B5o40yxdA9PqOVI5dF9tN3NUc2c/view?usp=sharing\" rel=\"nofollow noopener\" target=\"_blank\"\u003eリンク先\u003c/a\u003eから取得してください。\u003c/p\u003e\n\n\u003cp\u003e他はトレーニングでできるファイル等です。\u003cbr\u003e\nもしすでにトレーニング済みであれば、これらのパスにファイルが存在しているはずですので、そこに続けてトレーニングを行う（ファインチューニング）ことになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"定数定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9A%E6%95%B0%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e定数定義\u003c/h2\u003e\n\n\u003cp\u003e前述の入出力パスと同時に、いくつかの定数を定義しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003en_epochs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\n\u003cspan class=\"n\"\u003einit_learning_rate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.01\u003c/span\u003e\n\u003cspan class=\"n\"\u003eweight_decay_rate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.0005\u003c/span\u003e\n\u003cspan class=\"n\"\u003emomentum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.9\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e60\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれらは学習時のパラメータとして使用されます。\u003cbr\u003e\nもちろん変更することで調整が可能です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"学習データリストの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AD%A6%E7%BF%92%E3%83%87%E3%83%BC%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e学習データリストの作成\u003c/h2\u003e\n\n\u003cp\u003eここから、ようやくトレーニングに向けた処理が始まります。\u003c/p\u003e\n\n\u003cp\u003eまず初めにトレーニング、および、テストで使用する学習データのリストを作成します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003etrainset_path\u003c/span\u003e \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexists\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ecaltech_path\u003c/span\u003e \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emakedirs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ecaltech_path\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimage_dir_list\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elistdir\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003edataset_path\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003elabel_pairs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'.'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eimage_dir_list\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elabel_names\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ezip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_pairs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elabels\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003elabel_dict\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSeries\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_names\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elabel_dict\u003c/span\u003e \u003cspan class=\"o\"\u003e-=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"n\"\u003en_labels\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003elabel_dict\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eimage_paths_per_label\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003eone_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003eone_file\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003edataset_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eone_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eone_file\u003c/span\u003e \u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elistdir\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003edataset_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eone_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e))),\u003c/span\u003e \u003cspan class=\"n\"\u003eimage_dir_list\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimage_paths_train\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehstack\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003eone_class\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eone_class\u003c/span\u003e\u003cspan class=\"p\"\u003e[:\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eimage_paths_per_label\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimage_paths_test\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehstack\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003eone_class\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eone_class\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e:],\u003c/span\u003e \u003cspan class=\"n\"\u003eimage_paths_per_label\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDataFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\u003cspan class=\"s1\"\u003e'image_path'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eimage_paths_train\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etestset\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDataFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\u003cspan class=\"s1\"\u003e'image_path'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eimage_paths_test\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'image_path'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendswith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'.jpg'\u003c/span\u003e\u003cspan class=\"p\"\u003e))]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'label'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'image_path'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'label_name'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'image_path'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003etestset\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'image_path'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendswith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'.jpg'\u003c/span\u003e\u003cspan class=\"p\"\u003e))]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'label'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'image_path'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'label_name'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'image_path'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003elabel_dict\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_pickle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_dict_path\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_pickle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrainset_path\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_pickle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestset_path\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread_pickle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003etrainset_path\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etestset\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread_pickle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003etestset_path\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elabel_dict\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread_pickle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003elabel_dict_path\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003en_labels\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_dict\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまず学習データセットの各ディレクトリ名がlabel_pairsに保存されます。\u003cbr\u003e\nそれをラベルとラベル名に分割して、labels・label_namesに保存します。（labelsは文字列から数値に変換します）\u003cbr\u003e\nラベル名を1次元配列label_dictに格納し、ラベル数をn_labelsに設定しておきます。\u003c/p\u003e\n\n\u003cp\u003eそれぞれのラベルにおいて、その中に設定されている学習データの内10個をテスト用とし、残りをトレーニング用とします。\u003cbr\u003e\nこれらはNumPyのDataFrameの形式で保存され、各レコードは「image_path（画像ファイル名）」「label（ラベル）」「label_name（ラベル名）」で構成されます。\u003c/p\u003e\n\n\u003cp\u003e出来上がったDaraFrameはPicklingしてファイル化しています。\u003cbr\u003e\n作成済みの場合は、Picklingしたファイルを読み込んでいます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"余談pickling\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%99%E8%AB%87pickling\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【余談】Pickling\u003c/h3\u003e\n\n\u003cp\u003ePython初心者の私には、「Pickling」が何のことかわかりませんでした（苦笑）\u003cbr\u003e\n・・・ピクルスとは関係ないことは、うすうす気づいていましたが ^^;\u003cbr\u003e\nいわゆる「シリアライズ」のようです。\u003cbr\u003e\n詳しくは\u003ca href=\"https://docs.python.jp/3/library/pickle.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこの辺り\u003c/a\u003eを参考にしてみてください。\u003c/p\u003e\n\n\u003cp\u003eこれらの処理は、Pandasの関数として実装されており、今回はそれをそのまま使用しています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"推論inference\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8E%A8%E8%AB%96inference\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e推論（Inference）\u003c/h2\u003e\n\n\u003cp\u003eここからはTensorFlowでの実装パターンでいうところの「推論（Inference）」の処理になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003elearning_rate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efloat32\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[])\u003c/span\u003e\n\u003cspan class=\"n\"\u003eimages_tf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efloat32\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"images\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003elabels_tf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eint64\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'labels'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edetector\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDetector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eweight_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003en_labels\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ep3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ep4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003econv5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econv6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egap\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edetector\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimages_tf\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまず受け渡しの変数であるplaceholder（入力画像用、出力ラベル用）を用意します。さらに、ここでは学習レートも変数として用意しています。\u003cbr\u003e\nなお、今回の学習データは224x224で3チャンネル（BGR）の画像になります。\u003c/p\u003e\n\n\u003cp\u003e次にネットワークモデルを定義しています。\u003cbr\u003e\n「Detector()」の中身は別のファイルで定義されています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edetector.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etensorflow\u003c/span\u003e \u003cspan class=\"kn\"\u003eas\u003c/span\u003e \u003cspan class=\"nn\"\u003etf\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"kn\"\u003eas\u003c/span\u003e \u003cspan class=\"nn\"\u003enp\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ecPickle\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eipdb\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDetector\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eweight_file_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003en_labels\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimage_mean\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mf\"\u003e103.939\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mf\"\u003e116.779\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mf\"\u003e123.68\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003en_labels\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003en_labels\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eweight_file_path\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epretrained_weights\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecPickle\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eget_weight\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elayer_name\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elayer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epretrained_weights\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003elayer_name\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003elayer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eget_bias\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elayer_name\u003c/span\u003e \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elayer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epretrained_weights\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003elayer_name\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003elayer\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eget_conv_weight\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_weight\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etranspose\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evariable_scope\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_conv_weight\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_bias\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003econv_weights\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_variable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\"W\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003einitializer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstant_initializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003econv_biases\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_variable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003einitializer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstant_initializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003econv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv2d\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econv_weights\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003epadding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'SAME'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebias\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebias_add\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003econv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econv_biases\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003erelu\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erelu\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ebias\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003erelu\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003enew_conv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efilter_shape\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evariable_scope\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_variable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\"W\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003efilter_shape\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003einitializer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erandom_normal_initializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.01\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_variable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003efilter_shape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003einitializer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstant_initializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003econv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv2d\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003epadding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'SAME'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ebias\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebias_add\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ebias\u003c/span\u003e \u003cspan class=\"c1\"\u003e#relu\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efc_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecreate\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eshape\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_shape\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eas_list\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edim\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:]\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereshape\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edim\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003ecw\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_weight\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_bias\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"fc6\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecw\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecw\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereshape\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e4096\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecw\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecw\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etranspose\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecw\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecw\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereshape\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e25088\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e4096\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecw\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecw\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etranspose\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evariable_scope\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecw\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_variable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\"W\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecw\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003einitializer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstant_initializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecw\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_variable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003einitializer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstant_initializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003efc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebias_add\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematmul\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecw\u003c/span\u003e \u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efc\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003enew_fc_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einput_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eshape\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_shape\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_list\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edim\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:]\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereshape\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edim\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evariable_scope\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_variable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\"W\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003einput_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput_size\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003einitializer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erandom_normal_initializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.01\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_variable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eoutput_size\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003einitializer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstant_initializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebias_add\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematmul\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003escope\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efc\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einference\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ergb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etrain\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ergb\u003c/span\u003e \u003cspan class=\"o\"\u003e*=\u003c/span\u003e \u003cspan class=\"mf\"\u003e255.\u003c/span\u003e\n        \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ergb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ebgr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimage_mean\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eg\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimage_mean\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimage_mean\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003erelu1_1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ebgr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv1_1\"\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erelu1_2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003erelu1_1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv1_2\"\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003epool1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emax_pool\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erelu1_2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eksize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003estrides\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                                         \u003cspan class=\"n\"\u003epadding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'SAME'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'pool1'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003erelu2_1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epool1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv2_1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erelu2_2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erelu2_1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv2_2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epool2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emax_pool\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erelu2_2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eksize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003estrides\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                               \u003cspan class=\"n\"\u003epadding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'SAME'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'pool2'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003erelu3_1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epool2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv3_1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erelu3_2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003erelu3_1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv3_2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erelu3_3\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003erelu3_2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv3_3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epool3\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emax_pool\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erelu3_3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eksize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003estrides\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                               \u003cspan class=\"n\"\u003epadding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'SAME'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'pool3'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003erelu4_1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epool3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv4_1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erelu4_2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003erelu4_1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv4_2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erelu4_3\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003erelu4_2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv4_3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epool4\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emax_pool\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erelu4_3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eksize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003estrides\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                               \u003cspan class=\"n\"\u003epadding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'SAME'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'pool4'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003erelu5_1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epool4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv5_1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erelu5_2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003erelu5_1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv5_2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erelu5_3\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003erelu5_2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv5_3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003econv6\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enew_conv_layer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003erelu5_3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1024\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"conv6\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egap\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereduce_mean\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003econv6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evariable_scope\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"GAP\"\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"n\"\u003egap_w\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_variable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"s2\"\u003e\"W\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1024\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003en_labels\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003einitializer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erandom_normal_initializer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.01\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematmul\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003egap\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egap_w\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003epool1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epool2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epool3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epool4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erelu5_3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econv6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egap\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eget_classmap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elabel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econv6\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econv6_resized\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresize_bilinear\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003econv6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evariable_scope\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"GAP\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ereuse\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elabel_w\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egather\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etranspose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_variable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"W\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e \u003cspan class=\"n\"\u003elabel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elabel_w\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereshape\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003elabel_w\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1024\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# [batch_size, 1024, 1]\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003econv6_resized\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereshape\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econv6_resized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e224\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mi\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1024\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"c1\"\u003e# [batch_size, 224*224, 1024]\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eclassmap\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebatch_matmul\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003econv6_resized\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elabel_w\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eclassmap\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereshape\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eclassmap\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eclassmap\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e畳み込みレイヤーを重ね、最後にpoolingを行うというパターンを繰り返しています。\u003cbr\u003e\nなお、「fc_laye()」「new_fc_layer()」「get_classmap()」は、トレーニング時には使用しません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"目標値との誤差loss\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E6%A8%99%E5%80%A4%E3%81%A8%E3%81%AE%E8%AA%A4%E5%B7%AEloss\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目標値との誤差（Loss）\u003c/h2\u003e\n\n\u003cp\u003e次に目標値との誤差（Loss）を指定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eloss_tf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereduce_mean\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esparse_softmax_cross_entropy_with_logits\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elabels_tf\u003c/span\u003e \u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eここではSoftmax関数を使用しています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"最適化のアルゴリズムtraining\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%AE%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0training\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最適化のアルゴリズム（Training）\u003c/h2\u003e\n\n\u003cp\u003e最後に最適化のアルゴリズム（Training）を指定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eweights_only\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendswith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'W:0'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrainable_variables\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eweight_decay\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereduce_sum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epack\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003el2_loss\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eweights_only\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eweight_decay_rate\u003c/span\u003e\n\u003cspan class=\"n\"\u003eloss_tf\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eweight_decay\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさらに、オプティマイザの設定も行っています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eoptimizer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMomentumOptimizer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003elearning_rate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emomentum\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003egrads_and_vars\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoptimizer\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompute_gradients\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eloss_tf\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003egrads_and_vars\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003egv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003egv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'conv6'\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003egv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"ow\"\u003eor\u003c/span\u003e \u003cspan class=\"s1\"\u003e'GAP'\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003egv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]),\u003c/span\u003e \u003cspan class=\"n\"\u003egrads_and_vars\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#grads_and_vars = [(tf.clip_by_value(gv[0], -5., 5.), gv[1]) for gv in grads_and_vars]\u003c/span\u003e\n\u003cspan class=\"n\"\u003etrain_op\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoptimizer\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapply_gradients\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003egrads_and_vars\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなお、オプティマイザに関しては勉強不足で、その効果や意味などは理解できていません。\u003cbr\u003e\nもっとお勉強します．．．\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"処理の実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%A6%E7%90%86%E3%81%AE%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e処理の実行\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"初期化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e初期化\u003c/h3\u003e\n\n\u003cp\u003eまずはセッションを用意します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003esess\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eInteractiveSession\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003esaver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSaver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003emax_to_keep\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e50\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003esaverは、epoch単位で学習済みモデルを出力するために用意しています。\u003cbr\u003e\nこの後にオプティマイザの設定を行い、続けて初期化を行っています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003etf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einitialize_all_variables\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"学習済モデルの読み込み\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AD%A6%E7%BF%92%E6%B8%88%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e学習済モデルの読み込み\u003c/h3\u003e\n\n\u003cp\u003eもし学習済みモデルがあるのであれば、ここで読み込み、重みパラメータの初期値として利用（ファインチューニング）します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003epretrained_model_path\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Pretrained\"\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esaver\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erestore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esess\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epretrained_model_path\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e？？？\u003c/h3\u003e\n\n\u003cp\u003eここでテスト用データにインデックスを設定しているのですが、ちょっと理由がわかりませんでした。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#testset = testset.ix[np.random.permutation( len(testset) )]#[:1000]\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#trainset2 = testset[1000:]\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#testset = testset[:1000]\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#trainset = pd.concat( [trainset, trainset2] )\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# We lack the number of training set. Let's use some of the test images\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"余談とかとかとか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%99%E8%AB%87%E3%81%A8%E3%81%8B%E3%81%A8%E3%81%8B%E3%81%A8%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【余談】#とか[]とか:とか\u003c/h4\u003e\n\n\u003cp\u003ePython初心者には、何を表しているのかよくわからないです（涙）\u003cbr\u003e\nC/C++の知識が邪魔になります．．．\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ログ出力の準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%82%B0%E5%87%BA%E5%8A%9B%E3%81%AE%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eログ出力の準備\u003c/h3\u003e\n\n\u003cp\u003eログ出力するファイルを用意しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003ef_log\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'../results/log.caltech256.txt'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'w'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"epoch単位の処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#epoch%E5%8D%98%E4%BD%8D%E3%81%AE%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eepoch単位の処理\u003c/h3\u003e\n\n\u003cp\u003eここからepoch単位に処理を行っていきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eiterations\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003cspan class=\"n\"\u003eloss_list\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eepoch\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en_epochs\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erandom\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epermutation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eend\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003ezip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecurrent_image_paths\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'image_path'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecurrent_images\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eload_image\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_image_paths\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003egood_index\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"ow\"\u003eis\u003c/span\u003e \u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_images\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003egood_index\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecurrent_images\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estack\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent_images\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003egood_index\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecurrent_labels\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'label'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eloss_val\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput_val\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esess\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003etrain_op\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eloss_tf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                \u003cspan class=\"n\"\u003efeed_dict\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elearning_rate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003einit_learning_rate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eimages_tf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_images\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003elabels_tf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_labels\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eloss_list\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eloss_val\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eiterations\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eiterations\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"======================================\"\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Epoch\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eepoch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Iteration\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eiterations\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Processed\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrainset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003elabel_predictions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput_val\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eargmax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaxis\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eacc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_predictions\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_labels\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esum\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Accuracy:\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eacc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent_labels\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Training Loss:\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emean\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eloss_list\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eloss_list\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003en_correct\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"n\"\u003en_data\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eend\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003ezip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etestset\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecurrent_image_paths\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'image_path'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecurrent_images\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eload_image\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_image_paths\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003egood_index\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"ow\"\u003eis\u003c/span\u003e \u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_images\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003egood_index\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecurrent_images\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estack\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent_images\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003egood_index\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecurrent_labels\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'label'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eoutput_vals\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esess\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"n\"\u003efeed_dict\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eimages_tf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent_images\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003elabel_predictions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput_vals\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eargmax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaxis\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eacc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_predictions\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_labels\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esum\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003en_correct\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eacc\u003c/span\u003e\n        \u003cspan class=\"n\"\u003en_data\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecurrent_data\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eacc_all\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003en_correct\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en_data\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ef_log\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'epoch:'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eepoch\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\t\u003c/span\u003e\u003cspan class=\"s1\"\u003eacc:'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eacc_all\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\"\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s1\"\u003e'epoch:'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eepoch\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\t\u003c/span\u003e\u003cspan class=\"s1\"\u003eacc:'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eacc_all\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\"\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003esaver\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003esess\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003emodel_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'model'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eglobal_step\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eepoch\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003einit_learning_rate\u003c/span\u003e \u003cspan class=\"o\"\u003e*=\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.99\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまず、ごっそりトレーニング用データを取得し、ランダムに並べ替えます。\u003c/p\u003e\n\n\u003cp\u003e次にミニバッチのサイズでぐりぐり回していきます。\u003cbr\u003e\nなお、このミニバッチのループは2つあり、つまり2つの出力（実行処理）を行います。\u003cbr\u003e\n1つ目がトレーニングのためのループで、1つ目がテストのためのループになります。\u003cbr\u003e\nトレーニング経過は、1つ目のループで出力しています。\u003c/p\u003e\n\n\u003cp\u003e実際に画像ファイルを読み込んでいるのは「load_image()」になります。\u003cbr\u003e\nこちらは別ファイルで定義されています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eutil.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eskimage.io\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eskimage.transform\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eipdb\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"kn\"\u003eas\u003c/span\u003e \u003cspan class=\"nn\"\u003enp\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eload_image\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eskimage\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eio\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eastype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"ow\"\u003eis\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e[:,:,\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e[:,:,:\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e/=\u003c/span\u003e \u003cspan class=\"mf\"\u003e255.\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eshort_edge\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[:\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eyy\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eshort_edge\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003exx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eshort_edge\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecrop_img\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eyy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eyy\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003eshort_edge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003exx\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003exx\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003eshort_edge\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eresized_img\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eskimage\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ecrop_img\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e224\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eresized_img\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e画像ファイルの読み込みはscikit-learnを使用しています。\u003cbr\u003e\n読み込み後、各画素の値を0～1に正規化し、さらに画像サイズを224x224にリサイズしています。\u003c/p\u003e\n\n\u003cp\u003eepoch分の処理が終わるとテスト結果を表示し、学習済みモデルを作成（ファイル出力）します。\u003cbr\u003e\nこのファイルは、識別処理時に使用します。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003eとりあえずトレーニングに関しては、通常と大きく異なる処理は行っていません。\u003cbr\u003e\n重要なところは、識別処理の方になります。\u003c/p\u003e\n","body":"Deep Learningのお仕事をしていると、お客様から「なんでこういう結果になるの？」という質問をよく頂きます。\n\nその際利用するのが「注目位置の可視化」なのですが、その一つの例である「Class Activation Mapping（CAM）」の処理を理解するために、実装コードである「Weakly_detector」を読み込んでみます。\n\nちなみに、「Weakly_detector」のソースコードは[GitHub](https://github.com/jazzsaxmafia/Weakly_detector)で公開されています。\n\n# トレーニング\nまずはトレーニングのコード「train.caltech.py」を読み込んでいきます。\n\n## インポートライブラリ\n今回の処理で必要になるライブラリは以下の通りです。\n\n```python:train.caltech.py\nimport tensorflow as tf\nimport numpy as np\nimport pandas as pd\n\nfrom detector import Detector\nfrom util import load_image\nimport os\nimport ipdb\n```\n\nまた、呼び出している関数が定義されている別のファイル（detector.py、util.py）でも、他のライブラリを利用しています。\n\n```python:detector.py\nimport tensorflow as tf\nimport numpy as np\nimport cPickle\nimport ipdb\n```\n\n```python:util.py\nimport skimage.io\nimport skimage.transform\nimport ipdb\n\nimport numpy as np\n```\n\nよって、外部モジュールとして「[TensorFlow](https://www.tensorflow.org/)」「[NumPy](http://www.numpy.org/)」「[pandas](http://pandas.pydata.org/)」「[scikit-image](http://scikit-image.org/)」が必要になります。\n\n## 入出力パス／ファイル\n次に、入出力に関連するパス名やファイル名の指定があります。\n\n```python\nweight_path = '../data/caffe_layers_value.pickle'\nmodel_path = '../models/caltech256/'\npretrained_model_path = None #'../models/caltech256/model-0'\n\ndataset_path = '/media/storage3/Study/data/256_ObjectCategories'\n\ncaltech_path = '../data/caltech'\ntrainset_path = '../data/caltech/train.pickle'\ntestset_path = '../data/caltech/test.pickle'\nlabel_dict_path = '../data/caltech/label_dict.pickle'\n```\n\n必ず事前に準備が必要なのは、「dataset_path」で指定されている学習データセットになります。\n今回はCaltech-256を使用しています。[こちら](http://www.vision.caltech.edu/Image_Datasets/Caltech256/)からダウンロードしておきます。\n学習データは、それぞれ「nnn.label_name」（nnnは001～257までの数字、label_nameはラベル名）の形式で命名されたディレクトリ内に保存されています。\n学習データ自体は、「nnn_mmmm.jpg」（nnnは001～257までの数字、mmmmは0001～の数字）になっています。\n\nまた「weight_path」も必要になりますが、これはGitHubのところから辿れる[リンク先](https://drive.google.com/file/d/0B5o40yxdA9PqOVI5dF9tN3NUc2c/view?usp=sharing)から取得してください。\n\n他はトレーニングでできるファイル等です。\nもしすでにトレーニング済みであれば、これらのパスにファイルが存在しているはずですので、そこに続けてトレーニングを行う（ファインチューニング）ことになります。\n\n## 定数定義\n前述の入出力パスと同時に、いくつかの定数を定義しています。\n\n```python\nn_epochs = 10000\ninit_learning_rate = 0.01\nweight_decay_rate = 0.0005\nmomentum = 0.9\nbatch_size = 60\n```\n\nこれらは学習時のパラメータとして使用されます。\nもちろん変更することで調整が可能です。\n\n## 学習データリストの作成\nここから、ようやくトレーニングに向けた処理が始まります。\n\nまず初めにトレーニング、および、テストで使用する学習データのリストを作成します。\n\n```python\nif not os.path.exists( trainset_path ):\n    if not os.path.exists( caltech_path ):\n        os.makedirs( caltech_path )\n    image_dir_list = os.listdir( dataset_path )\n\n    label_pairs = map(lambda x: x.split('.'), image_dir_list)\n    labels, label_names = zip(*label_pairs)\n    labels = map(lambda x: int(x), labels)\n\n    label_dict = pd.Series( labels, index=label_names )\n    label_dict -= 1\n    n_labels = len( label_dict )\n\n    image_paths_per_label = map(lambda one_dir: map(lambda one_file: os.path.join( dataset_path, one_dir, one_file ), os.listdir( os.path.join( dataset_path, one_dir))), image_dir_list)\n    image_paths_train = np.hstack(map(lambda one_class: one_class[:-10], image_paths_per_label))\n    image_paths_test = np.hstack(map(lambda one_class: one_class[-10:], image_paths_per_label))\n\n    trainset = pd.DataFrame({'image_path': image_paths_train})\n    testset  = pd.DataFrame({'image_path': image_paths_test })\n\n    trainset = trainset[ trainset['image_path'].map( lambda x: x.endswith('.jpg'))]\n    trainset['label'] = trainset['image_path'].map(lambda x: int(x.split('/')[-2].split('.')[0]) - 1)\n    trainset['label_name'] = trainset['image_path'].map(lambda x: x.split('/')[-2].split('.')[1])\n\n    testset = testset[ testset['image_path'].map( lambda x: x.endswith('.jpg'))]\n    testset['label'] = testset['image_path'].map(lambda x: int(x.split('/')[-2].split('.')[0]) - 1)\n    testset['label_name'] = testset['image_path'].map(lambda x: x.split('/')[-2].split('.')[1])\n\n    label_dict.to_pickle(label_dict_path)\n    trainset.to_pickle(trainset_path)\n    testset.to_pickle(testset_path)\nelse:\n    trainset = pd.read_pickle( trainset_path )\n    testset  = pd.read_pickle( testset_path )\n    label_dict = pd.read_pickle( label_dict_path )\n    n_labels = len(label_dict)\n```\n\nまず学習データセットの各ディレクトリ名がlabel_pairsに保存されます。\nそれをラベルとラベル名に分割して、labels・label_namesに保存します。（labelsは文字列から数値に変換します）\nラベル名を1次元配列label_dictに格納し、ラベル数をn_labelsに設定しておきます。\n\nそれぞれのラベルにおいて、その中に設定されている学習データの内10個をテスト用とし、残りをトレーニング用とします。\nこれらはNumPyのDataFrameの形式で保存され、各レコードは「image_path（画像ファイル名）」「label（ラベル）」「label_name（ラベル名）」で構成されます。\n\n出来上がったDaraFrameはPicklingしてファイル化しています。\n作成済みの場合は、Picklingしたファイルを読み込んでいます。\n\n### 【余談】Pickling\nPython初心者の私には、「Pickling」が何のことかわかりませんでした（苦笑）\n・・・ピクルスとは関係ないことは、うすうす気づいていましたが ^^;\nいわゆる「シリアライズ」のようです。\n詳しくは[この辺り](https://docs.python.jp/3/library/pickle.html)を参考にしてみてください。\n\nこれらの処理は、Pandasの関数として実装されており、今回はそれをそのまま使用しています。\n\n## 推論（Inference）\nここからはTensorFlowでの実装パターンでいうところの「推論（Inference）」の処理になります。\n\n```python\nlearning_rate = tf.placeholder( tf.float32, [])\nimages_tf = tf.placeholder( tf.float32, [None, 224, 224, 3], name=\"images\")\nlabels_tf = tf.placeholder( tf.int64, [None], name='labels')\n\ndetector = Detector(weight_path, n_labels)\n\np1,p2,p3,p4,conv5, conv6, gap, output = detector.inference(images_tf)\n```\n\nまず受け渡しの変数であるplaceholder（入力画像用、出力ラベル用）を用意します。さらに、ここでは学習レートも変数として用意しています。\nなお、今回の学習データは224x224で3チャンネル（BGR）の画像になります。\n\n次にネットワークモデルを定義しています。\n「Detector()」の中身は別のファイルで定義されています。\n\n```python:detector.py\nimport tensorflow as tf\nimport numpy as np\nimport cPickle\nimport ipdb\nclass Detector():\n    def __init__(self, weight_file_path, n_labels):\n        self.image_mean = [103.939, 116.779, 123.68]\n        self.n_labels = n_labels\n\n        with open(weight_file_path) as f:\n            self.pretrained_weights = cPickle.load(f)\n\n    def get_weight( self, layer_name):\n        layer = self.pretrained_weights[layer_name]\n        return layer[0]\n\n    def get_bias( self, layer_name ):\n        layer = self.pretrained_weights[layer_name]\n        return layer[1]\n\n    def get_conv_weight( self, name ):\n        f = self.get_weight( name )\n        return f.transpose(( 2,3,1,0 ))\n\n    def conv_layer( self, bottom, name ):\n        with tf.variable_scope(name) as scope:\n\n            w = self.get_conv_weight(name)\n            b = self.get_bias(name)\n\n            conv_weights = tf.get_variable(\n                    \"W\",\n                    shape=w.shape,\n                    initializer=tf.constant_initializer(w)\n                    )\n            conv_biases = tf.get_variable(\n                    \"b\",\n                    shape=b.shape,\n                    initializer=tf.constant_initializer(b)\n                    )\n\n            conv = tf.nn.conv2d( bottom, conv_weights, [1,1,1,1], padding='SAME')\n            bias = tf.nn.bias_add( conv, conv_biases )\n            relu = tf.nn.relu( bias, name=name )\n\n        return relu\n\n    def new_conv_layer( self, bottom, filter_shape, name ):\n        with tf.variable_scope( name ) as scope:\n            w = tf.get_variable(\n                    \"W\",\n                    shape=filter_shape,\n                    initializer=tf.random_normal_initializer(0., 0.01))\n            b = tf.get_variable(\n                    \"b\",\n                    shape=filter_shape[-1],\n                    initializer=tf.constant_initializer(0.))\n\n            conv = tf.nn.conv2d( bottom, w, [1,1,1,1], padding='SAME')\n            bias = tf.nn.bias_add(conv, b)\n\n        return bias #relu\n\n    def fc_layer(self, bottom, name, create=False):\n        shape = bottom.get_shape().as_list()\n        dim = np.prod( shape[1:] )\n        x = tf.reshape(bottom, [-1, dim])\n\n        cw = self.get_weight(name)\n        b = self.get_bias(name)\n\n        if name == \"fc6\":\n            cw = cw.reshape((4096, 512, 7,7))\n            cw = cw.transpose((2,3,1,0))\n            cw = cw.reshape((25088,4096))\n        else:\n            cw = cw.transpose((1,0))\n\n        with tf.variable_scope(name) as scope:\n            cw = tf.get_variable(\n                    \"W\",\n                    shape=cw.shape,\n                    initializer=tf.constant_initializer(cw))\n            b = tf.get_variable(\n                    \"b\",\n                    shape=b.shape,\n                    initializer=tf.constant_initializer(b))\n\n            fc = tf.nn.bias_add( tf.matmul( x, cw ), b, name=scope)\n\n        return fc\n\n    def new_fc_layer( self, bottom, input_size, output_size, name ):\n        shape = bottom.get_shape().to_list()\n        dim = np.prod( shape[1:] )\n        x = tf.reshape( bottom, [-1, dim])\n\n        with tf.variable_scope(name) as scope:\n            w = tf.get_variable(\n                    \"W\",\n                    shape=[input_size, output_size],\n                    initializer=tf.random_normal_initializer(0., 0.01))\n            b = tf.get_variable(\n                    \"b\",\n                    shape=[output_size],\n                    initializer=tf.constant_initializer(0.))\n            fc = tf.nn.bias_add( tf.matmul(x, w), b, name=scope)\n\n        return fc\n\n    def inference( self, rgb, train=False ):\n        rgb *= 255.\n        r, g, b = tf.split(3, 3, rgb)\n        bgr = tf.concat(3,\n            [\n                b-self.image_mean[0],\n                g-self.image_mean[1],\n                r-self.image_mean[2]\n            ])\n\n        relu1_1 = self.conv_layer( bgr, \"conv1_1\" )\n        relu1_2 = self.conv_layer( relu1_1, \"conv1_2\" )\n\n        pool1 = tf.nn.max_pool(relu1_2, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1],\n                                         padding='SAME', name='pool1')\n\n        relu2_1 = self.conv_layer(pool1, \"conv2_1\")\n        relu2_2 = self.conv_layer(relu2_1, \"conv2_2\")\n        pool2 = tf.nn.max_pool(relu2_2, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1],\n                               padding='SAME', name='pool2')\n\n        relu3_1 = self.conv_layer( pool2, \"conv3_1\")\n        relu3_2 = self.conv_layer( relu3_1, \"conv3_2\")\n        relu3_3 = self.conv_layer( relu3_2, \"conv3_3\")\n        pool3 = tf.nn.max_pool(relu3_3, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1],\n                               padding='SAME', name='pool3')\n\n        relu4_1 = self.conv_layer( pool3, \"conv4_1\")\n        relu4_2 = self.conv_layer( relu4_1, \"conv4_2\")\n        relu4_3 = self.conv_layer( relu4_2, \"conv4_3\")\n        pool4 = tf.nn.max_pool(relu4_3, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1],\n                               padding='SAME', name='pool4')\n\n        relu5_1 = self.conv_layer( pool4, \"conv5_1\")\n        relu5_2 = self.conv_layer( relu5_1, \"conv5_2\")\n        relu5_3 = self.conv_layer( relu5_2, \"conv5_3\")\n\n        conv6 = self.new_conv_layer( relu5_3, [3,3,512,1024], \"conv6\")\n        gap = tf.reduce_mean( conv6, [1,2] )\n\n        with tf.variable_scope(\"GAP\"):\n            gap_w = tf.get_variable(\n                    \"W\",\n                    shape=[1024, self.n_labels],\n                    initializer=tf.random_normal_initializer(0., 0.01))\n\n        output = tf.matmul( gap, gap_w)\n\n        return pool1, pool2, pool3, pool4, relu5_3, conv6, gap, output\n\n    def get_classmap(self, label, conv6):\n        conv6_resized = tf.image.resize_bilinear( conv6, [224, 224] )\n        with tf.variable_scope(\"GAP\", reuse=True):\n            label_w = tf.gather(tf.transpose(tf.get_variable(\"W\")), label)\n            label_w = tf.reshape( label_w, [-1, 1024, 1] ) # [batch_size, 1024, 1]\n\n        conv6_resized = tf.reshape(conv6_resized, [-1, 224*224, 1024]) # [batch_size, 224*224, 1024]\n\n        classmap = tf.batch_matmul( conv6_resized, label_w )\n        classmap = tf.reshape( classmap, [-1, 224,224] )\n        return classmap\n```\n\n畳み込みレイヤーを重ね、最後にpoolingを行うというパターンを繰り返しています。\nなお、「fc_laye()」「new_fc_layer()」「get_classmap()」は、トレーニング時には使用しません。\n\n## 目標値との誤差（Loss）\n次に目標値との誤差（Loss）を指定します。\n\n```python\nloss_tf = tf.reduce_mean(tf.nn.sparse_softmax_cross_entropy_with_logits( output, labels_tf ))\n```\n\nここではSoftmax関数を使用しています。\n\n## 最適化のアルゴリズム（Training）\n最後に最適化のアルゴリズム（Training）を指定します。\n\n```python\nweights_only = filter( lambda x: x.name.endswith('W:0'), tf.trainable_variables() )\nweight_decay = tf.reduce_sum(tf.pack([tf.nn.l2_loss(x) for x in weights_only])) * weight_decay_rate\nloss_tf += weight_decay\n```\n\nさらに、オプティマイザの設定も行っています。\n\n```python\noptimizer = tf.train.MomentumOptimizer( learning_rate, momentum )\ngrads_and_vars = optimizer.compute_gradients( loss_tf )\ngrads_and_vars = map(lambda gv: (gv[0], gv[1]) if ('conv6' in gv[1].name or 'GAP' in gv[1].name) else (gv[0]*0.1, gv[1]), grads_and_vars)\n#grads_and_vars = [(tf.clip_by_value(gv[0], -5., 5.), gv[1]) for gv in grads_and_vars]\ntrain_op = optimizer.apply_gradients( grads_and_vars )\n```\n\nなお、オプティマイザに関しては勉強不足で、その効果や意味などは理解できていません。\nもっとお勉強します．．．\n\n## 処理の実行\n\n### 初期化\nまずはセッションを用意します。\n\n```python\nsess = tf.InteractiveSession()\nsaver = tf.train.Saver( max_to_keep=50 )\n```\n\nsaverは、epoch単位で学習済みモデルを出力するために用意しています。\nこの後にオプティマイザの設定を行い、続けて初期化を行っています。\n\n```python\ntf.initialize_all_variables().run()\n```\n\n### 学習済モデルの読み込み\nもし学習済みモデルがあるのであれば、ここで読み込み、重みパラメータの初期値として利用（ファインチューニング）します。\n\n```python\nif pretrained_model_path:\n    print \"Pretrained\"\n    saver.restore(sess, pretrained_model_path)\n```\n\n### ？？？\nここでテスト用データにインデックスを設定しているのですが、ちょっと理由がわかりませんでした。\n\n```python\ntestset.index  = range( len(testset) )\n#testset = testset.ix[np.random.permutation( len(testset) )]#[:1000]\n#trainset2 = testset[1000:]\n#testset = testset[:1000]\n\n#trainset = pd.concat( [trainset, trainset2] )\n# We lack the number of training set. Let's use some of the test images\n```\n\n#### 【余談】#とか[]とか:とか\nPython初心者には、何を表しているのかよくわからないです（涙）\nC/C++の知識が邪魔になります．．．\n\n### ログ出力の準備\nログ出力するファイルを用意しています。\n\n```python\nf_log = open('../results/log.caltech256.txt', 'w')\n```\n\n### epoch単位の処理\nここからepoch単位に処理を行っていきます。\n\n```python\niterations = 0\nloss_list = []\nfor epoch in range(n_epochs):\n\n    trainset.index = range( len(trainset) )\n    trainset = trainset.ix[ np.random.permutation( len(trainset) )]\n\n    for start, end in zip(\n        range( 0, len(trainset)+batch_size, batch_size),\n        range(batch_size, len(trainset)+batch_size, batch_size)):\n\n        current_data = trainset[start:end]\n        current_image_paths = current_data['image_path'].values\n        current_images = np.array(map(lambda x: load_image(x), current_image_paths))\n\n        good_index = np.array(map(lambda x: x is not None, current_images))\n\n        current_data = current_data[good_index]\n        current_images = np.stack(current_images[good_index])\n        current_labels = current_data['label'].values\n\n        _, loss_val, output_val = sess.run(\n                [train_op, loss_tf, output],\n                feed_dict={\n                    learning_rate: init_learning_rate,\n                    images_tf: current_images,\n                    labels_tf: current_labels\n                    })\n\n        loss_list.append( loss_val )\n\n        iterations += 1\n        if iterations % 5 == 0:\n            print \"======================================\"\n            print \"Epoch\", epoch, \"Iteration\", iterations\n            print \"Processed\", start, '/', len(trainset)\n\n            label_predictions = output_val.argmax(axis=1)\n            acc = (label_predictions == current_labels).sum()\n\n            print \"Accuracy:\", acc, '/', len(current_labels)\n            print \"Training Loss:\", np.mean(loss_list)\n            print \"\\n\"\n            loss_list = []\n\n    n_correct = 0\n    n_data = 0\n    for start, end in zip(\n            range(0, len(testset)+batch_size, batch_size),\n            range(batch_size, len(testset)+batch_size, batch_size)\n            ):\n        current_data = testset[start:end]\n        current_image_paths = current_data['image_path'].values\n        current_images = np.array(map(lambda x: load_image(x), current_image_paths))\n\n        good_index = np.array(map(lambda x: x is not None, current_images))\n\n        current_data = current_data[good_index]\n        current_images = np.stack(current_images[good_index])\n        current_labels = current_data['label'].values\n\n        output_vals = sess.run(\n                output,\n                feed_dict={images_tf:current_images})\n\n        label_predictions = output_vals.argmax(axis=1)\n        acc = (label_predictions == current_labels).sum()\n\n        n_correct += acc\n        n_data += len(current_data)\n\n    acc_all = n_correct / float(n_data)\n    f_log.write('epoch:'+str(epoch)+'\\tacc:'+str(acc_all) + '\\n')\n    print \"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\"\n    print 'epoch:'+str(epoch)+'\\tacc:'+str(acc_all) + '\\n'\n    print \"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\"\n\n    saver.save( sess, os.path.join( model_path, 'model'), global_step=epoch)\n\n    init_learning_rate *= 0.99\n```\n\nまず、ごっそりトレーニング用データを取得し、ランダムに並べ替えます。\n\n次にミニバッチのサイズでぐりぐり回していきます。\nなお、このミニバッチのループは2つあり、つまり2つの出力（実行処理）を行います。\n1つ目がトレーニングのためのループで、1つ目がテストのためのループになります。\nトレーニング経過は、1つ目のループで出力しています。\n\n実際に画像ファイルを読み込んでいるのは「load_image()」になります。\nこちらは別ファイルで定義されています。\n\n```python:util.py\nimport skimage.io\nimport skimage.transform\nimport ipdb\n\nimport numpy as np\n\ndef load_image( path ):\n    try:\n        img = skimage.io.imread( path ).astype( float )\n    except:\n        return None\n\n    if img is None: return None\n    if len(img.shape) \u003c 2: return None\n    if len(img.shape) == 4: return None\n    if len(img.shape) == 2: img=np.tile(img[:,:,None], 3)\n    if img.shape[2] == 4: img=img[:,:,:3]\n    if img.shape[2] \u003e 4: return None\n\n    img /= 255.\n\n    short_edge = min( img.shape[:2] )\n    yy = int((img.shape[0] - short_edge) / 2)\n    xx = int((img.shape[1] - short_edge) / 2)\n    crop_img = img[yy:yy+short_edge, xx:xx+short_edge]\n    resized_img = skimage.transform.resize( crop_img, [224,224] )\n    return resized_img\n```\n\n画像ファイルの読み込みはscikit-learnを使用しています。\n読み込み後、各画素の値を0～1に正規化し、さらに画像サイズを224x224にリサイズしています。\n\nepoch分の処理が終わるとテスト結果を表示し、学習済みモデルを作成（ファイル出力）します。\nこのファイルは、識別処理時に使用します。\n\n# まとめ\nとりあえずトレーニングに関しては、通常と大きく異なる処理は行っていません。\n重要なところは、識別処理の方になります。\n","coediting":false,"created_at":"2017-05-17T19:38:18+09:00","group":null,"id":"c3726cb906c45a2e5265","private":false,"tags":[{"name":"DeepLearning","versions":[]},{"name":"CAM","versions":[]},{"name":"TensorFlow","versions":[]}],"title":"Class Activation Mapping（CAM）の実装である「Weakly_detector」のソースを読み解く　～トレーニング編～","updated_at":"2017-05-18T00:23:17+09:00","url":"http://qiita.com/mine820/items/c3726cb906c45a2e5265","user":{"description":"もうプログラムを書かなくなって久しい、元アプリケーションエンジニアのおじさんです。\r\nC言語万能教に侵されています。\r\nOpenGLとOpenCVとDirectShowでメシ食ってました。\r\nたまには趣味で書いていこうかと思っています。\r\n※発信の内容は全て個人の見解に基づくもので、所属する組織の見解ではありません","facebook_id":"","followees_count":0,"followers_count":8,"github_login_name":null,"id":"mine820","items_count":30,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":130771,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/130771/profile-images/1478837933","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003e関数やクラスのtestをやらなきゃなー思って...\u003cbr\u003e\nとりあえず、やり方だけ覚えとこう（実際やるかはまた別のお話w\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"プロジェクト作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロジェクト作成\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eTestSample\u003c/code\u003e というプロジェクトを作成します\u003cbr\u003e\n作成時にこの2つにチェックを入れておきます\u003cbr\u003e\n（チェックしてなくても後から足すこともできますが今回説明は割愛します。\u003ca href=\"http://qiita.com/s-harada_i-enter/items/f7d57966a5bf9d53038e\" id=\"reference-997a1165b6cb3ec6fbd3\"\u003eこちら\u003c/a\u003eを参考に...）\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/150615/b803b8e8-717a-554f-761a-d8fce1a429d0.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/150615/b803b8e8-717a-554f-761a-d8fce1a429d0.png\" alt=\"スクリーンショット 2017-05-17 17.57.23.png\" title=\"スクリーンショット 2017-05-17 17.57.23.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"プロジェクト設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロジェクト設定\u003c/h1\u003e\n\n\u003cp\u003eプロジェクト設定を少し変更します\u003cbr\u003e\n\u003ccode\u003eDefines Module\u003c/code\u003eを\u003ccode\u003eYES\u003c/code\u003eにします\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/150615/137c650c-fd84-0e49-c9d8-72e4f43c36f7.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/150615/137c650c-fd84-0e49-c9d8-72e4f43c36f7.png\" alt=\"スクリーンショット 2017-05-17 18.47.00.png\" title=\"スクリーンショット 2017-05-17 18.47.00.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"maincode\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#maincode\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMainCode\u003c/h1\u003e\n\n\u003cp\u003eメインのところにコードを書きます\u003cbr\u003e\n今回は、簡単に新しい\u003ccode\u003eMySample.swift\u003c/code\u003eファイルを作成して、クラスとaddメソッドを追加します\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMySample.swift\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eFoundation\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eUIKit\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eopen\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMySample\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e引数を足すだけの簡単な関数ですw\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eMySample.swift\u003c/code\u003eの右側のチェックをつけておくことで、Test側でも参照できるようにしておきます\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/150615/154e04a3-cc0c-a567-d932-0d3a536c533a.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/150615/154e04a3-cc0c-a567-d932-0d3a536c533a.png\" alt=\"スクリーンショット 2017-05-17 19.23.08.png\" title=\"スクリーンショット 2017-05-17 19.23.08.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"testcode\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#testcode\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTestCode\u003c/h1\u003e\n\n\u003cp\u003e先ほど作ったaddメソッドをtestします\u003cbr\u003e\n最初にチェックしておいたことで\u003ccode\u003e[プロジェクト名]Test\u003c/code\u003eフォルダができていると思います\u003cbr\u003e\n\u003ccode\u003e[プロジェクト名]Test.swift\u003c/code\u003eを開くとすでにコードが書いてあります\u003cbr\u003e\n\u003ccode\u003e@testable import [プロジェクト名]\u003c/code\u003eで先ほどメインに書いたクラスを参照できます\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e[プロジェクト名]Test.swift\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eXCTest\u003c/span\u003e\n\u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003etestable\u003c/span\u003e \u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eTestSample\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTestSampleTests\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eXCTestCase\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"kr\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003esetUp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kc\"\u003esuper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esetUp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Put setup code here. This method is called before the invocation of each test method in the class.\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kr\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etearDown\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Put teardown code here. This method is called after the invocation of each test method in the class.\u003c/span\u003e\n        \u003cspan class=\"kc\"\u003esuper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etearDown\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etestExample\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// This is an example of a functional test case.\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// Use XCTAssert and related functions to verify your tests produce the correct results.\u003c/span\u003e\n\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etestPerformanceExample\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// This is an example of a performance test case.\u003c/span\u003e\n        \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emeasure\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Put the code you want to measure the time of here.\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e   \n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"testしたいメソッドの追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#test%E3%81%97%E3%81%9F%E3%81%84%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etestしたいメソッドの追加\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003etest\u003c/code\u003eから始まるメソッドを追加します\u003cbr\u003e\n（\u003ccode\u003etest\u003c/code\u003eから始めるメソッド名にすることで、testと認識してくれます）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e[プロジェクト名]Test.swift\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eXCTest\u003c/span\u003e\n\u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003etestable\u003c/span\u003e \u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eTestSample\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTestSampleTests\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eXCTestCase\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 省略\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etestMySample\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003emySample\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMySample\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eadd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emySample\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// addメソッドの返り値が5であるかの判断\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eXCTAssertEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"テストの実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテストの実行\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003ecommand + U\u003c/code\u003eで実行できます\u003cbr\u003e\n左から5番目の場所に表示されます\u003cbr\u003e\n実行して成功したものには、緑のマークがつきます\u003cbr\u003e\n実行して失敗したものには、赤のマークがつきます\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/150615/2330c007-9198-a00f-45fa-9420635f97b8.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/150615/2330c007-9198-a00f-45fa-9420635f97b8.png\" alt=\"スクリーンショット 2017-05-17 19.30.13.png\" title=\"スクリーンショット 2017-05-17 19.30.13.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"個別実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E5%88%A5%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個別実行\u003c/h2\u003e\n\n\u003cp\u003etestをメソッドごとに個別に実行したい場合、そのメソッドにマウスを合わせると実行マークに変わるので選択すると実行できます\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/150615/eb4f403c-9361-5ef9-da17-e00201ccffb3.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/150615/eb4f403c-9361-5ef9-da17-e00201ccffb3.png\" alt=\"スクリーンショット 2017-05-17 19.28.03.png\" title=\"スクリーンショット 2017-05-17 19.28.03.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"成功と失敗\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%88%90%E5%8A%9F%E3%81%A8%E5%A4%B1%E6%95%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e成功と失敗\u003c/h2\u003e\n\n\u003cp\u003e先ほど書いたコードの\u003ccode\u003eXCTAssertEqual\u003c/code\u003eで成功か失敗かを判断します\u003cbr\u003e\nなので、わざと失敗させてみたいと思います\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e[プロジェクト名]Test.swift\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eXCTest\u003c/span\u003e\n\u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003etestable\u003c/span\u003e \u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eTestSample\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTestSampleTests\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eXCTestCase\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 省略\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etestMySample\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003emySample\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMySample\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eadd\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emySample\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eXCTAssertEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e2 + 3\u003c/code\u003eが\u003ccode\u003e4\u003c/code\u003eになるとしてみますw\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/150615/b17214f7-e120-2cd9-a4c4-70dd26ce6eea.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/150615/b17214f7-e120-2cd9-a4c4-70dd26ce6eea.png\" alt=\"スクリーンショット 2017-05-17 19.33.04.png\" title=\"スクリーンショット 2017-05-17 19.33.04.png\"\u003e\u003c/a\u003e\u003cbr\u003e\n（もちろん失敗しますw）\u003c/p\u003e\n\n\u003cp\u003e（\u003ccode\u003eXCTAssert\u003c/code\u003eの他のメソッドは\u003ca href=\"http://qiita.com/shirochan/items/10271912289dc563cc36\" id=\"reference-756733d649edabc8aa17\"\u003eこちら\u003c/a\u003eを参考に...）\u003c/p\u003e\n","body":"関数やクラスのtestをやらなきゃなー思って...\nとりあえず、やり方だけ覚えとこう（実際やるかはまた別のお話w\n\n# プロジェクト作成\n`TestSample` というプロジェクトを作成します\n作成時にこの2つにチェックを入れておきます\n（チェックしてなくても後から足すこともできますが今回説明は割愛します。[こちら](http://qiita.com/s-harada_i-enter/items/f7d57966a5bf9d53038e)を参考に...）\n![スクリーンショット 2017-05-17 17.57.23.png](https://qiita-image-store.s3.amazonaws.com/0/150615/b803b8e8-717a-554f-761a-d8fce1a429d0.png \"スクリーンショット 2017-05-17 17.57.23.png\")\n\n# プロジェクト設定\nプロジェクト設定を少し変更します\n`Defines Module`を`YES`にします\n![スクリーンショット 2017-05-17 18.47.00.png](https://qiita-image-store.s3.amazonaws.com/0/150615/137c650c-fd84-0e49-c9d8-72e4f43c36f7.png \"スクリーンショット 2017-05-17 18.47.00.png\")\n\n# MainCode\nメインのところにコードを書きます\n今回は、簡単に新しい`MySample.swift`ファイルを作成して、クラスとaddメソッドを追加します\n\n```MySample.swift\nimport Foundation\nimport UIKit\n\nopen class MySample {\n\t\n\tpublic func add(a: Int, b: Int) -\u003e Int {\n\t\treturn a + b\n\t}\n\t\n}\n```\n\n引数を足すだけの簡単な関数ですw\n\n`MySample.swift`の右側のチェックをつけておくことで、Test側でも参照できるようにしておきます\n![スクリーンショット 2017-05-17 19.23.08.png](https://qiita-image-store.s3.amazonaws.com/0/150615/154e04a3-cc0c-a567-d932-0d3a536c533a.png \"スクリーンショット 2017-05-17 19.23.08.png\")\n\n\n\n# TestCode\n先ほど作ったaddメソッドをtestします\n最初にチェックしておいたことで`[プロジェクト名]Test`フォルダができていると思います\n`[プロジェクト名]Test.swift`を開くとすでにコードが書いてあります\n`@testable import [プロジェクト名]`で先ほどメインに書いたクラスを参照できます\n\n```[プロジェクト名]Test.swift\nimport XCTest\n@testable import TestSample\n\nclass TestSampleTests: XCTestCase {\n    \n    override func setUp() {\n        super.setUp()\n        // Put setup code here. This method is called before the invocation of each test method in the class.\n    }\n    \n    override func tearDown() {\n        // Put teardown code here. This method is called after the invocation of each test method in the class.\n        super.tearDown()\n    }\n    \n    func testExample() {\n        // This is an example of a functional test case.\n        // Use XCTAssert and related functions to verify your tests produce the correct results.\n\t\t\n    }\n    \n    func testPerformanceExample() {\n        // This is an example of a performance test case.\n        self.measure {\n            // Put the code you want to measure the time of here.\n        }\n    }\n}\t\n```\n\n## testしたいメソッドの追加\n`test`から始まるメソッドを追加します\n（`test`から始めるメソッド名にすることで、testと認識してくれます）\n\n```[プロジェクト名]Test.swift\nimport XCTest\n@testable import TestSample\n\nclass TestSampleTests: XCTestCase {\n    // 省略\n    func testMySample() {\n\t\tlet mySample = MySample()\n\t\tlet add = mySample.add(a: 2, b: 3)\n\t\t// addメソッドの返り値が5であるかの判断\n\t\tXCTAssertEqual(add, 5)\n\t}\n}\n\n```\n\n# テストの実行\n`command + U`で実行できます\n左から5番目の場所に表示されます\n実行して成功したものには、緑のマークがつきます\n実行して失敗したものには、赤のマークがつきます\n![スクリーンショット 2017-05-17 19.30.13.png](https://qiita-image-store.s3.amazonaws.com/0/150615/2330c007-9198-a00f-45fa-9420635f97b8.png \"スクリーンショット 2017-05-17 19.30.13.png\")\n\n## 個別実行\ntestをメソッドごとに個別に実行したい場合、そのメソッドにマウスを合わせると実行マークに変わるので選択すると実行できます\n![スクリーンショット 2017-05-17 19.28.03.png](https://qiita-image-store.s3.amazonaws.com/0/150615/eb4f403c-9361-5ef9-da17-e00201ccffb3.png \"スクリーンショット 2017-05-17 19.28.03.png\")\n\n\n## 成功と失敗\n先ほど書いたコードの`XCTAssertEqual`で成功か失敗かを判断します\nなので、わざと失敗させてみたいと思います\n\n```[プロジェクト名]Test.swift\nimport XCTest\n@testable import TestSample\n\nclass TestSampleTests: XCTestCase {\n    // 省略\n    func testMySample() {\n\t\tlet mySample = MySample()\n\t\tlet add = mySample.add(a: 2, b: 3)\n\t\tXCTAssertEqual(add, 4)\n\t}\n}\n\n```\n\n`2 + 3`が`4`になるとしてみますw\n![スクリーンショット 2017-05-17 19.33.04.png](https://qiita-image-store.s3.amazonaws.com/0/150615/b17214f7-e120-2cd9-a4c4-70dd26ce6eea.png \"スクリーンショット 2017-05-17 19.33.04.png\")\n（もちろん失敗しますw）\n\n（`XCTAssert`の他のメソッドは[こちら](http://qiita.com/shirochan/items/10271912289dc563cc36)を参考に...）\n\n","coediting":false,"created_at":"2017-05-17T19:37:37+09:00","group":null,"id":"a0289263b8ed2e1f808f","private":false,"tags":[{"name":"test","versions":[]},{"name":"Xcode","versions":[]},{"name":"Swift","versions":[]}],"title":"SwiftでTestコード（on Xcode）","updated_at":"2017-05-17T19:37:37+09:00","url":"http://qiita.com/hmhmsh/items/a0289263b8ed2e1f808f","user":{"description":"[ 入社 : 2015年 ]\r\n[ アプリ開発 : iOS・Android ]\r\n[ 主な言語 : Objective-C・Swift・Java・Kotlin ]","facebook_id":"","followees_count":9,"followers_count":5,"github_login_name":"hmhmsh","id":"hmhmsh","items_count":14,"linkedin_id":"","location":"Japan","name":"hmhm","organization":"","permanent_id":150615,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/150615/profile-images/1484796156","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eAVX-512には\u003ccode\u003evrcp28pd\u003c/code\u003eという、28bit精度の逆数近似命令がある。AVX-512Fには含まれておらず、AVX-512ER拡張が必要。これが本当に28bitの精度があるか、また一回の補正でフル精度になるか確認してみる。\u003c/p\u003e\n\n\u003cp\u003eコードは以下においておく。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/kaityo256/rcp28_sample\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/kaityo256/rcp28_sample\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"無補正\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%84%A1%E8%A3%9C%E6%AD%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e無補正\u003c/h1\u003e\n\n\u003cp\u003eまずは無補正で精度の確認。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etest.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\n\u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n  \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003emt19937\u003c/span\u003e \u003cspan class=\"n\"\u003emt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003euniform_real_distribution\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eud\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eud\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emt\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e__m512d\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_mm512_set1_pd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e__m512d\u003c/span\u003e \u003cspan class=\"n\"\u003ezinv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_mm512_rcp28_pd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003eainv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_mm512_storeu_pd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ezinv\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebitdump\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eainv\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebitdump\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"%d\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ebitcomp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eainv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e一様乱数を10個作って、それを普通に逆数にした値と、逆数近似した場合の値を調べる。\u003c/p\u003e\n\n\u003cp\u003ebitdumpは\u003ccode\u003edouble\u003c/code\u003eのビット表現をダンプする関数で、中身はこんな感じ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\n\u003cspan class=\"nf\"\u003ebitdump\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"%.16f\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" \"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ebitcompは、2つのdoubleを受け取って、仮数部が何ビット一致するか調べる関数\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" rel=\"footnote\" title=\"ビット演算とか使うともっときれいにできると思うけど手抜き。\"\u003e1\u003c/a\u003e\u003c/sup\u003e。実際には符号ビットとか指数部とかも一緒に比較して(それらは一致すると仮定して)、最後に12ビット分引いてる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\n\u003cspan class=\"nf\"\u003ebitcomp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003exb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n      \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003eyb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003exb\u003c/span\u003e\u003cspan class=\"o\"\u003e!=\u003c/span\u003e\u003cspan class=\"n\"\u003eyb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esum\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003esum\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実行結果はこんな感じ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell-session\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003e1.0028231394486751\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0 01111111111 0000000010111001000001000110101110011010101001101100\u003c/span\u003e\n\u003cspan class=\"go\"\u003e1.0028231400601602\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0 01111111111 0000000010111001000001000110111000111010111111001000\u003c/span\u003e\n\u003cspan class=\"go\"\u003e29\u003c/span\u003e\n\u003cspan class=\"go\"\u003e(snip)\u003c/span\u003e\n\u003cspan class=\"go\"\u003e1.1815988407141602\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0 01111111111 0010111001111101010000101111100111011011110111000110\u003c/span\u003e\n\u003cspan class=\"go\"\u003e1.1815988415114642\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0 01111111111 0010111001111101010000101111110101001000100000011000\u003c/span\u003e\n\u003cspan class=\"go\"\u003e29\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれは、フル精度でやったら「1.0028231394486751」となるべき値が、\u003ccode\u003evrcp28pd\u003c/code\u003e使ったら「1.0028231400601602」になって、仮数部は29ビット一致している、という意味。\u003c/p\u003e\n\n\u003cp\u003eたまに20bitの一致とかでることがある。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell-session\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003e1.1346335406111951\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0 01111111111 0010001001110111010101111111110111011110101010010101\u003c/span\u003e\n\u003cspan class=\"go\"\u003e1.1346335413761803\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0 01111111111 0010001001110111010110000000000100100111110001011000\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0.881342\u003c/span\u003e\n\u003cspan class=\"go\"\u003e20\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれはたまたま21〜28ビットが1で、29bit目に誤差で1ビット足されてばたばたとビットが変わってしまったからで、ちゃんと28bitの精度が出ている。そういう意味では、ちゃんと引き算して誤差を見ないとだめなんだけど、まぁ気にしないことにする。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"補正公式の導出\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A3%9C%E6%AD%A3%E5%85%AC%E5%BC%8F%E3%81%AE%E5%B0%8E%E5%87%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e補正公式の導出\u003c/h1\u003e\n\n\u003cp\u003e28bitの逆数が得られたら、一回補正すると精度が倍になってほぼフル精度になるはずである。それを調べる。\u003c/p\u003e\n\n\u003cp\u003eある数$a$の逆数近似の値$x$が得られたとする。本来ある数とその逆数をかけたら1になるはずだが、これは近似された値なので誤差があるだろう。それを$\\epsilon$とすると、\u003c/p\u003e\n\n\u003cp\u003e$$\u003cbr\u003e\na x = 1 + \\epsilon\u003cbr\u003e\n$$\u003c/p\u003e\n\n\u003cp\u003eとなる。これを変形して$1-\\epsilon$を作ろう。\u003c/p\u003e\n\n\u003cp\u003e$$\u003cbr\u003e\n2 - a x = 1 - \\epsilon\u003cbr\u003e\n$$\u003c/p\u003e\n\n\u003cp\u003e先の式と辺々かけると、\u003c/p\u003e\n\n\u003cp\u003e$$\u003cbr\u003e\na x (2 - a x) = 1 - \\epsilon^2\u003cbr\u003e\n$$\u003c/p\u003e\n\n\u003cp\u003eこれは、$x(2 - a x)$が$O(\\epsilon^2)$の精度の逆数になったことを意味する。\u003c/p\u003e\n\n\u003cp\u003e次に、これがニュートン法になっていることを示す。\u003c/p\u003e\n\n\u003cp\u003eニュートン法は、ある関数$f(x)=0$となる点$x$を探す問題で、近似値$x_n$が与えられた時に、次の値$x_{n+1}$を\u003c/p\u003e\n\n\u003cp\u003e$$\u003cbr\u003e\nx_{n+1} = x_n - \\frac{f(x_n)}{f'(x_n)}\u003cbr\u003e\n$$\u003c/p\u003e\n\n\u003cp\u003eとして求める手法である。いま、$a$の逆数が知りたいのであるから、\u003c/p\u003e\n\n\u003cp\u003e$$\u003cbr\u003e\nf(x) = \\frac{1}{ax} - 1\u003cbr\u003e\n$$\u003c/p\u003e\n\n\u003cp\u003eと定義すれば、$f(x) = 0$となる$x$が求めたい$a$の逆数となる\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" rel=\"footnote\" title=\"ここで$f(x) = ax -1$としても$f(x) =0$の解が求める逆数となるが、これは線形関数なのでニュートン法がうまく働かず、自明な結果しか出てこない。\"\u003e2\u003c/a\u003e\u003c/sup\u003e。\u003c/p\u003e\n\n\u003cp\u003e代入すると、\u003c/p\u003e\n\n\u003cp\u003e$$\u003cbr\u003e\nx_{n+1} = x_n(2 - a x_n)\u003cbr\u003e\n$$\u003c/p\u003e\n\n\u003cp\u003eとなり、先程の補正公式と一致する。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"逆数近似補正\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%86%E6%95%B0%E8%BF%91%E4%BC%BC%E8%A3%9C%E6%AD%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e逆数近似＋補正\u003c/h1\u003e\n\n\u003cp\u003eというわけで逆数近似に一度補正をかけてみる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003etest2.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\n\u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n  \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003emt19937\u003c/span\u003e \u003cspan class=\"n\"\u003emt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003e__m512d\u003c/span\u003e \u003cspan class=\"n\"\u003ev2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_mm512_set1_pd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e2.0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003euniform_real_distribution\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003edouble\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eud\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eud\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emt\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e__m512d\u003c/span\u003e \u003cspan class=\"n\"\u003ez\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_mm512_set1_pd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e__m512d\u003c/span\u003e \u003cspan class=\"n\"\u003ezinv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_mm512_rcp28_pd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e__m512d\u003c/span\u003e \u003cspan class=\"n\"\u003eze\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_mm512_mul_pd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ez\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ezinv\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e__m512d\u003c/span\u003e \u003cspan class=\"n\"\u003ezinv2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_mm512_sub_pd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ev2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eze\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ezinv2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_mm512_mul_pd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezinv2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ezinv\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003edouble\u003c/span\u003e \u003cspan class=\"n\"\u003eainv\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003e_mm512_storeu_pd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ezinv2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebitdump\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eainv\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebitdump\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"%d\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ebitcomp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eainv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ezinv\u003c/code\u003eが逆数近似の結果、\u003ccode\u003ezinv2\u003c/code\u003eが一度補正をかけたもの。実行結果はこんな感じ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell-session\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"go\"\u003e1.0028231394486751\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0 01111111111 0000000010111001000001000110101110011010101001101100\u003c/span\u003e\n\u003cspan class=\"go\"\u003e1.0028231394486751\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0 01111111111 0000000010111001000001000110101110011010101001101100\u003c/span\u003e\n\u003cspan class=\"go\"\u003e52\u003c/span\u003e\n\u003cspan class=\"go\"\u003e(snip)\u003c/span\u003e\n\u003cspan class=\"go\"\u003e1.1815988407141602\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0 01111111111 0010111001111101010000101111100111011011110111000110\u003c/span\u003e\n\u003cspan class=\"go\"\u003e1.1815988407141602\u003c/span\u003e\n\u003cspan class=\"go\"\u003e0 01111111111 0010111001111101010000101111100111011011110111000110\u003c/span\u003e\n\u003cspan class=\"go\"\u003e52\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eというわけで、ちゃんとフル精度出てるみたいですね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003eAVX-512ERで追加された\u003ccode\u003evrcp28pd\u003c/code\u003e命令と、その精度補正を試してみた。フル精度の除算が欲しい場合、近似＋補正公式にバラした方が早くなるかどうかはコードによると思うが(まだ試してない)、ループの形によっては結構効くかも？\u003c/p\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003eビット演算とか使うともっときれいにできると思うけど手抜き。 \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003eここで$f(x) = ax -1$としても$f(x) =0$の解が求める逆数となるが、これは線形関数なのでニュートン法がうまく働かず、自明な結果しか出てこない。 \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","body":"\n# はじめに\n\nAVX-512には`vrcp28pd`という、28bit精度の逆数近似命令がある。AVX-512Fには含まれておらず、AVX-512ER拡張が必要。これが本当に28bitの精度があるか、また一回の補正でフル精度になるか確認してみる。\n\nコードは以下においておく。\n\nhttps://github.com/kaityo256/rcp28_sample\n\n\n# 無補正\n\nまずは無補正で精度の確認。\n\n```cpp:test.cpp\ndouble out[8];\n\nint\nmain(){\n  std::mt19937 mt(1);\n  std::uniform_real_distribution\u003cdouble\u003e ud(0.0,1.0);\n  for(int i=0;i\u003c10;i++){\n    double a = ud(mt);\n    __m512d z = _mm512_set1_pd(a);\n    __m512d zinv = _mm512_rcp28_pd(z);\n    double ainv = 1.0/a;\n    _mm512_storeu_pd(out, zinv);\n    bitdump(ainv);\n    bitdump(out[0]);\n    printf(\"%d\\n\",bitcomp(ainv,out[0]));\n    printf(\"\\n\");\n  }\n}\n```\n\n一様乱数を10個作って、それを普通に逆数にした値と、逆数近似した場合の値を調べる。\n\nbitdumpは`double`のビット表現をダンプする関数で、中身はこんな感じ。\n\n```cpp\nvoid\nbitdump(double a){\n  printf(\"%.16f\\n\",a);\n  char *x = (char*)(\u0026a);\n  int count = 0;\n  for(int i=0;i\u003c8;i++){\n    for(int j=0;j\u003c8;j++){\n      if(x[7-i] \u0026 (1\u003c\u003c(7-j)))printf(\"1\");\n      else printf(\"0\");\n      count++;\n      if(count==1 || count==12)printf(\" \");\n    }\n  }\n  printf(\"\\n\");\n}\n```\n\nbitcompは、2つのdoubleを受け取って、仮数部が何ビット一致するか調べる関数[^1]。実際には符号ビットとか指数部とかも一緒に比較して(それらは一致すると仮定して)、最後に12ビット分引いてる。\n\n[^1]: ビット演算とか使うともっときれいにできると思うけど手抜き。\n\n```cpp\nint\nbitcomp(double a, double b){\n  char *x = (char*)(\u0026a);\n  char *y = (char*)(\u0026b);\n  int sum = 0;\n  for(int i=0;i\u003c8;i++){\n    for(int j=0;j\u003c8;j++){\n      char xb = x[7-i] \u0026 (1\u003c\u003c(7-j));\n      char yb = y[7-i] \u0026 (1\u003c\u003c(7-j));\n      if(xb!=yb)return sum-12;\n      sum++;\n    }\n  }\n  return sum - 12;\n}\n```\n\n実行結果はこんな感じ。\n\n```shell-session\n1.0028231394486751\n0 01111111111 0000000010111001000001000110101110011010101001101100\n1.0028231400601602\n0 01111111111 0000000010111001000001000110111000111010111111001000\n29\n(snip)\n1.1815988407141602\n0 01111111111 0010111001111101010000101111100111011011110111000110\n1.1815988415114642\n0 01111111111 0010111001111101010000101111110101001000100000011000\n29\n```\n\nこれは、フル精度でやったら「1.0028231394486751」となるべき値が、`vrcp28pd`使ったら「1.0028231400601602」になって、仮数部は29ビット一致している、という意味。\n\nたまに20bitの一致とかでることがある。\n\n```shell-session\n1.1346335406111951\n0 01111111111 0010001001110111010101111111110111011110101010010101\n1.1346335413761803\n0 01111111111 0010001001110111010110000000000100100111110001011000\n0.881342\n20\n```\n\nこれはたまたま21〜28ビットが1で、29bit目に誤差で1ビット足されてばたばたとビットが変わってしまったからで、ちゃんと28bitの精度が出ている。そういう意味では、ちゃんと引き算して誤差を見ないとだめなんだけど、まぁ気にしないことにする。\n\n# 補正公式の導出\n\n28bitの逆数が得られたら、一回補正すると精度が倍になってほぼフル精度になるはずである。それを調べる。\n\nある数$a$の逆数近似の値$x$が得られたとする。本来ある数とその逆数をかけたら1になるはずだが、これは近似された値なので誤差があるだろう。それを$\\epsilon$とすると、\n\n$$\na x = 1 + \\epsilon\n$$\n\nとなる。これを変形して$1-\\epsilon$を作ろう。\n\n$$\n2 - a x = 1 - \\epsilon\n$$\n\n先の式と辺々かけると、\n\n$$\na x (2 - a x) = 1 - \\epsilon^2\n$$\n\nこれは、$x(2 - a x)$が$O(\\epsilon^2)$の精度の逆数になったことを意味する。\n\n次に、これがニュートン法になっていることを示す。\n\nニュートン法は、ある関数$f(x)=0$となる点$x$を探す問題で、近似値$x_n$が与えられた時に、次の値$x_{n+1}$を\n\n$$\nx_{n+1} = x_n - \\frac{f(x_n)}{f'(x_n)}\n$$\n\nとして求める手法である。いま、$a$の逆数が知りたいのであるから、\n\n$$\nf(x) = \\frac{1}{ax} - 1\n$$\n\nと定義すれば、$f(x) = 0$となる$x$が求めたい$a$の逆数となる[^2]。\n\n[^2]: ここで$f(x) = ax -1$としても$f(x) =0$の解が求める逆数となるが、これは線形関数なのでニュートン法がうまく働かず、自明な結果しか出てこない。\n\n代入すると、\n\n$$\nx_{n+1} = x_n(2 - a x_n)\n$$\n\nとなり、先程の補正公式と一致する。\n\n# 逆数近似＋補正\n\nというわけで逆数近似に一度補正をかけてみる。\n\n```cpp:test2.cpp\nint\nmain(){\n  std::mt19937 mt(1);\n  __m512d v2 = _mm512_set1_pd(2.0);\n  std::uniform_real_distribution\u003cdouble\u003e ud(0.0,1.0);\n  for(int i=0;i\u003c10;i++){\n    double a = ud(mt);\n    __m512d z = _mm512_set1_pd(a);\n    __m512d zinv = _mm512_rcp28_pd(z);\n    __m512d ze = _mm512_mul_pd(z,zinv);\n    __m512d zinv2 = _mm512_sub_pd(v2,ze);\n    zinv2 = _mm512_mul_pd(zinv2,zinv);\n    double ainv = 1.0/a;\n    _mm512_storeu_pd(out, zinv2);\n    bitdump(ainv);\n    bitdump(out[0]);\n    printf(\"%d\\n\",bitcomp(ainv,out[0]));\n    printf(\"\\n\");\n  }\n}\n```\n\n`zinv`が逆数近似の結果、`zinv2`が一度補正をかけたもの。実行結果はこんな感じ。\n\n```shell-session\n1.0028231394486751\n0 01111111111 0000000010111001000001000110101110011010101001101100\n1.0028231394486751\n0 01111111111 0000000010111001000001000110101110011010101001101100\n52\n(snip)\n1.1815988407141602\n0 01111111111 0010111001111101010000101111100111011011110111000110\n1.1815988407141602\n0 01111111111 0010111001111101010000101111100111011011110111000110\n52\n```\n\nというわけで、ちゃんとフル精度出てるみたいですね。\n\n# まとめ\n\nAVX-512ERで追加された`vrcp28pd`命令と、その精度補正を試してみた。フル精度の除算が欲しい場合、近似＋補正公式にバラした方が早くなるかどうかはコードによると思うが(まだ試してない)、ループの形によっては結構効くかも？\n","coediting":false,"created_at":"2017-05-17T19:33:54+09:00","group":null,"id":"df33b64040794473db92","private":false,"tags":[{"name":"avx512","versions":[]}],"title":"AVX512での逆数近似と精度補正","updated_at":"2017-05-17T23:20:40+09:00","url":"http://qiita.com/kaityo256/items/df33b64040794473db92","user":{"description":"ロボ太","facebook_id":"","followees_count":0,"followers_count":69,"github_login_name":"kaityo256","id":"kaityo256","items_count":100,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":79744,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/79744/profile-images/1473701554","twitter_screen_name":"kaityo256","website_url":""}},{"rendered_body":"\u003cp\u003eThere are many Magento 2 extension available in the market that you can easily get for your e-commerce site but few of the Magento 2 marketplace extensions are very helpful to make your e-commerce website helpful. Let’s discuss some extensions which will convert your simple e-commerce site to well reputed multi platform e-commerce sites.\u003c/p\u003e\n\n\u003cp\u003eVendor Management:\u003c/p\u003e\n\n\u003cp\u003eVendors are the heart of any marketplace. This extension provided a comprehensive separate user interface for vendors to manage their products and transactions. The vendor can add and edit their profile information, manage products, orders and more.\u003c/p\u003e\n\n\u003cp\u003eVendor panel:\u003c/p\u003e\n\n\u003cp\u003eBrand management module serves your brand conscious customers in a way they would ever wish. Plenty of useful functionality is added to the vendor panel module to let your customers browse and shop by brand easily. The customer can easily search and browse products with the help of intuitive design of a brand page.\u003c/p\u003e\n\n\u003cp\u003eCustomers Management:\u003c/p\u003e\n\n\u003cp\u003eYou can manage your customer’s behavior easily. With help of this extension, the customer can easily search and browse products with the help of intuitive design of the brand page.\u003c/p\u003e\n\n\u003cp\u003eCatalog Management:\u003c/p\u003e\n\n\u003cp\u003eProducts are the sole entity to generate revenue on the marketplace. Products can be added from the admin panel as well as vendor panel. The product catalog is built by multiple products and it is managed by admin or vendor by performing these actions, add, edit or delete.\u003c/p\u003e\n\n\u003cp\u003eOrder Management:\u003c/p\u003e\n\n\u003cp\u003eOrder management is an important part of any ecommerce marketplace owner. It provides an effective and efficient way for vendors to manage their orders from the vendor panel and also admin can manage the vendor orders from admin panel. Below flow chart will explain the order flow.\u003c/p\u003e\n\n\u003cp\u003eFinancial management:\u003c/p\u003e\n\n\u003cp\u003eFinancial management allows to the vendor for analysis of each sale details and latest status.\u003c/p\u003e\n\n\u003cp\u003eVendor services:\u003c/p\u003e\n\n\u003cp\u003eVendor services show the feedback and ratings given to the vendor for their services like delivery, packing, product condition etc. It helps to manage and view each feedback and rating given by the customer and which is approved by admin. From the feedback received, the vendor will be able to know that on which area he need to improve and give best services.\u003c/p\u003e\n\n\u003cp\u003eRead full post here\u0026gt;\u0026gt; \u003ca\u003eTop 12 Magento 2 Extensions for eCommerce Site That Developers Don’t Know\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eOriginally published at \u003ca href=\"http://findnerd.com\" rel=\"nofollow noopener\" target=\"_blank\"\u003efindnerd.com\u003c/a\u003e\u003c/p\u003e\n","body":"There are many Magento 2 extension available in the market that you can easily get for your e-commerce site but few of the Magento 2 marketplace extensions are very helpful to make your e-commerce website helpful. Let’s discuss some extensions which will convert your simple e-commerce site to well reputed multi platform e-commerce sites.\n\nVendor Management:\n\nVendors are the heart of any marketplace. This extension provided a comprehensive separate user interface for vendors to manage their products and transactions. The vendor can add and edit their profile information, manage products, orders and more.\n\nVendor panel:\n\nBrand management module serves your brand conscious customers in a way they would ever wish. Plenty of useful functionality is added to the vendor panel module to let your customers browse and shop by brand easily. The customer can easily search and browse products with the help of intuitive design of a brand page.\n\nCustomers Management:\n\nYou can manage your customer’s behavior easily. With help of this extension, the customer can easily search and browse products with the help of intuitive design of the brand page.\n\nCatalog Management:\n\nProducts are the sole entity to generate revenue on the marketplace. Products can be added from the admin panel as well as vendor panel. The product catalog is built by multiple products and it is managed by admin or vendor by performing these actions, add, edit or delete.\n\nOrder Management:\n\nOrder management is an important part of any ecommerce marketplace owner. It provides an effective and efficient way for vendors to manage their orders from the vendor panel and also admin can manage the vendor orders from admin panel. Below flow chart will explain the order flow.\n\nFinancial management:\n\nFinancial management allows to the vendor for analysis of each sale details and latest status.\n\nVendor services:\n\nVendor services show the feedback and ratings given to the vendor for their services like delivery, packing, product condition etc. It helps to manage and view each feedback and rating given by the customer and which is approved by admin. From the feedback received, the vendor will be able to know that on which area he need to improve and give best services.\n\nRead full post here\u003e\u003e \u003ca href=\"![image.png](https://qiita-image-store.s3.amazonaws.com/0/158032/0303f11d-4bdd-6b3f-14d1-419bb7db51df.png)\n\"\u003eTop 12 Magento 2 Extensions for eCommerce Site That Developers Don’t Know\u003c/a\u003e\n\nOriginally published at \u003ca href=\"http://findnerd.com\"\u003efindnerd.com\u003c/a\u003e\n\n","coediting":false,"created_at":"2017-05-17T19:18:59+09:00","group":null,"id":"8bcbee27eecab3c20d61","private":false,"tags":[{"name":"Web","versions":[]},{"name":"developer","versions":[]},{"name":"Magento,","versions":[]},{"name":"CMS,","versions":[]},{"name":"Magento2,","versions":[]}],"title":"Top 12 Magento 2 Extensions for eCommerce Site That Developers Don't Know","updated_at":"2017-05-17T19:18:59+09:00","url":"http://qiita.com/rinkidhiman771/items/8bcbee27eecab3c20d61","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":null,"id":"rinkidhiman771","items_count":12,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":158032,"profile_image_url":"https://pbs.twimg.com/profile_images/705358647245692929/L9nUeNFS_normal.jpg","twitter_screen_name":"rinkidhiman771","website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eVim\u003c/code\u003eを使い始めて3年経つ新人が更なる新人に対して\u003ccode\u003eVim\u003c/code\u003eを売り込むための話\u003c/li\u003e\n\u003cli\u003e興味を持ってもらうための話なのでポジティブな部分多めです\u003c/li\u003e\n\u003cli\u003e新人向けなので深い話はしないです\u003c/li\u003e\n\u003cli\u003e少しでも興味を持って「使ってみようかな？」と思ってもらえれば幸いです\u003c/li\u003e\n\u003cli\u003e\u003cdel\u003e（あとせっかくなので前々から気になってたqiitaのスライドモードを使ってみたかった）\u003c/del\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003chr\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"vimとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vim%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVimとは\u003c/h1\u003e\n\n\u003cp\u003eエディタです。\u003cbr\u003e\nそれ以上でも以下でもないです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eメリット\n\n\u003cul\u003e\n\u003cli\u003eUNIX系に標準で入ってるので入れるコストがない\u003c/li\u003e\n\u003cli\u003e拡張性が高くできないことはない\u003c/li\u003e\n\u003cli\u003e拡張しない素の状態でもできることが多い\u003c/li\u003e\n\u003cli\u003eエディタ自体が軽量なので重いファイルもサクッと開ける\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eデメリット\n\n\u003cul\u003e\n\u003cli\u003e操作が独特で初見の感想「使いづらい」\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eVim\u003c/code\u003eである必要がなく「それ\u003ccode\u003eSublime\u003c/code\u003eでできるよね？」ってこともよくある\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003chr\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"できるようになること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eできるようになること\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e入力したい箇所に移動するのが爆速\u003c/li\u003e\n\u003cli\u003e先頭・末尾に何度も同じ文字を書かなくても一括で入力可能\u003c/li\u003e\n\u003cli\u003e連番を振るのが楽\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/67471/a89c242c-f909-c00c-4749-bbeaf4bc0837.gif\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/67471/a89c242c-f909-c00c-4749-bbeaf4bc0837.gif\" alt=\"QGU0Yo4JZ7.gif\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"早速触ってみよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%97%A9%E9%80%9F%E8%A7%A6%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e早速触ってみよう\u003c/h1\u003e\n\n\u003cp\u003eターミナルを開いて以下を入力\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003evim hoge.txt\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e真っ暗い画面が出てきたら成功です。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"文字を入力して保存してみよう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%87%E5%AD%97%E3%82%92%E5%85%A5%E5%8A%9B%E3%81%97%E3%81%A6%E4%BF%9D%E5%AD%98%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e文字を入力して保存してみよう\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003ei\u003c/code\u003eを押して入力モードにする\u003cbr\u003e\n\u003ccode\u003ehoge\u003c/code\u003eと入力\u003cbr\u003e\n\u003ccode\u003eesc\u003c/code\u003eを押してノーマルモードにする\u003cbr\u003e\n\u003ccode\u003e:\u003c/code\u003eを押してコマンドモードにする\u003cbr\u003e\n\u003ccode\u003ewq\u003c/code\u003eを押して保存して終了\u003cbr\u003e\nやることはこれだけ。ね？簡単でしょ？\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/67471/c47f421f-aa06-e20f-81f6-b0673f293b53.gif\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/67471/c47f421f-aa06-e20f-81f6-b0673f293b53.gif\" alt=\"R3I4ytZnSa.gif\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"覚えなきゃいけないこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A6%9A%E3%81%88%E3%81%AA%E3%81%8D%E3%82%83%E3%81%84%E3%81%91%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e覚えなきゃいけないこと\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eVim\u003c/code\u003eにはモードが4つあるのでそれらの役割を覚える必要があります\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eノーマルモード\n\n\u003cul\u003e\n\u003cli\u003e1番基本的な状態。何か操作が終わったらノーマルモードに戻っておくことが望ましい。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eインサートモード\n\n\u003cul\u003e\n\u003cli\u003eノーマルモードの次によく使うモード。文字列を入力するためのモード。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eコマンドモード\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eVim\u003c/code\u003eに対してコマンド（司令）を渡すモード。保存したり終了したり置換したり…。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eビジュアルモード\n\n\u003cul\u003e\n\u003cli\u003e範囲選択をする時などに主に使用するモード。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e何か困ったらとりあえず\u003ccode\u003eesc\u003c/code\u003e連打しておけば何とかなります。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"図解\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9B%B3%E8%A7%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e図解\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/67471/ea4051ce-368c-0c8d-00c9-22905ef8471e.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/67471/ea4051ce-368c-0c8d-00c9-22905ef8471e.png\" alt=\"Vimのモード遷移図.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"動画の解説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%95%E7%94%BB%E3%81%AE%E8%A7%A3%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e動画の解説\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/67471/a89c242c-f909-c00c-4749-bbeaf4bc0837.gif\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/67471/a89c242c-f909-c00c-4749-bbeaf4bc0837.gif\" alt=\"QGU0Yo4JZ7.gif\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eインサートモードでhogeを入力\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eyy\u003c/code\u003eで現在の行をヤンク（コピー）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e10p\u003c/code\u003eで10行ペースト\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003egg\u003c/code\u003eで先頭に移動\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eCtrl + v\u003c/code\u003eでビジュアルモードに移行（矩形選択モード）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eG\u003c/code\u003eで末尾まで選択\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eI\u003c/code\u003eでインサートモードに移行\u003c/li\u003e\n\u003cli\u003e0を入力し\u003ccode\u003eesc\u003c/code\u003eでノーマルモードに移行\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eCtrl + v\u003c/code\u003eでビジュアルモードに移行（矩形選択モード）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eG\u003c/code\u003eで末尾まで選択\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eg Ctrl + a\u003c/code\u003eで選択箇所をインクリメント\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eCtrl + v\u003c/code\u003eでビジュアルモードに移行（矩形選択モード）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eG\u003c/code\u003eで末尾まで選択\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e$\u003c/code\u003eで行末まで選択\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eA\u003c/code\u003eでインサートモードに移行\u003c/li\u003e\n\u003cli\u003ehogeを入力し\u003ccode\u003eesc\u003c/code\u003eでノーマルモードに戻る\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003chr\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おまけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおまけ\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003e.vimrc\u003c/code\u003eというファイルを生成してホームにおいておけば、これが拡張するためのカスタマイズファイルとなります。\u003cbr\u003e\n世の中にはありとあらゆる\u003ccode\u003e.vimrc\u003c/code\u003eが転がってますのではじめは有名なものをまんまコピーするといいかもしれないですね。\u003cbr\u003e\nそこから自分好みにカスタマイズしていくと段々自分だけの秘伝のタレが整っていきます。\u003cbr\u003e\n最近作業マシンを引っ越したのですがエディタに関しては\u003ccode\u003e.vimrc\u003c/code\u003eを持っていくだけで済んだのでとてもお手軽でした。\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h1\u003e\n\n\u003cp\u003eいかがでしたでしょうか？\u003cbr\u003e\nお世辞にもとっつきやすいとは言えないですが、使いこなしたら便利そうなのが伝われば嬉しいです。\u003cbr\u003e\n実際に業務で本番サーバに入って何か操作をする際には必須スキルとなってきますので、リテラシーだと思って最低限の操作だけは押さえておきましょう。\u003cbr\u003e\nそれでは快適な\u003ccode\u003eVim\u003c/code\u003eライフを\u003cimg alt=\":smile:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f604.png\" title=\":smile:\" width=\"20\"\u003e\u003c/p\u003e\n","body":"# はじめに\n\n* `Vim`を使い始めて3年経つ新人が更なる新人に対して`Vim`を売り込むための話\n* 興味を持ってもらうための話なのでポジティブな部分多めです\n* 新人向けなので深い話はしないです\n* 少しでも興味を持って「使ってみようかな？」と思ってもらえれば幸いです\n* ~~（あとせっかくなので前々から気になってたqiitaのスライドモードを使ってみたかった）~~\n\n---\n\n# Vimとは\n\nエディタです。\nそれ以上でも以下でもないです。\n\n* メリット\n    * UNIX系に標準で入ってるので入れるコストがない\n    * 拡張性が高くできないことはない\n    * 拡張しない素の状態でもできることが多い\n    * エディタ自体が軽量なので重いファイルもサクッと開ける\n* デメリット\n    * 操作が独特で初見の感想「使いづらい」\n    * `Vim`である必要がなく「それ`Sublime`でできるよね？」ってこともよくある\n\n---\n\n# できるようになること\n\n* 入力したい箇所に移動するのが爆速\n* 先頭・末尾に何度も同じ文字を書かなくても一括で入力可能\n* 連番を振るのが楽\n\n![QGU0Yo4JZ7.gif](https://qiita-image-store.s3.amazonaws.com/0/67471/a89c242c-f909-c00c-4749-bbeaf4bc0837.gif)\n\n---\n\n# 早速触ってみよう\n\nターミナルを開いて以下を入力\n\n```bash\nvim hoge.txt\n```\n\n真っ暗い画面が出てきたら成功です。\n\n---\n\n# 文字を入力して保存してみよう\n\n`i`を押して入力モードにする\n`hoge`と入力\n`esc`を押してノーマルモードにする\n`:`を押してコマンドモードにする\n`wq`を押して保存して終了\nやることはこれだけ。ね？簡単でしょ？\n\n![R3I4ytZnSa.gif](https://qiita-image-store.s3.amazonaws.com/0/67471/c47f421f-aa06-e20f-81f6-b0673f293b53.gif)\n\n---\n\n# 覚えなきゃいけないこと\n\n`Vim`にはモードが4つあるのでそれらの役割を覚える必要があります\n\n* ノーマルモード\n    * 1番基本的な状態。何か操作が終わったらノーマルモードに戻っておくことが望ましい。\n* インサートモード\n    * ノーマルモードの次によく使うモード。文字列を入力するためのモード。\n* コマンドモード\n    * `Vim`に対してコマンド（司令）を渡すモード。保存したり終了したり置換したり…。\n* ビジュアルモード\n    * 範囲選択をする時などに主に使用するモード。\n\n何か困ったらとりあえず`esc`連打しておけば何とかなります。\n\n---\n\n# 図解\n\n![Vimのモード遷移図.png](https://qiita-image-store.s3.amazonaws.com/0/67471/ea4051ce-368c-0c8d-00c9-22905ef8471e.png)\n\n---\n\n# 動画の解説\n\n![QGU0Yo4JZ7.gif](https://qiita-image-store.s3.amazonaws.com/0/67471/a89c242c-f909-c00c-4749-bbeaf4bc0837.gif)\n\n* インサートモードでhogeを入力\n* `yy`で現在の行をヤンク（コピー）\n* `10p`で10行ペースト\n* `gg`で先頭に移動\n* `Ctrl + v`でビジュアルモードに移行（矩形選択モード）\n* `G`で末尾まで選択\n* `I`でインサートモードに移行\n* 0を入力し`esc`でノーマルモードに移行\n* `Ctrl + v`でビジュアルモードに移行（矩形選択モード）\n* `G`で末尾まで選択\n* `g Ctrl + a`で選択箇所をインクリメント\n* `Ctrl + v`でビジュアルモードに移行（矩形選択モード）\n* `G`で末尾まで選択\n* `$`で行末まで選択\n* `A`でインサートモードに移行\n* hogeを入力し`esc`でノーマルモードに戻る\n\n---\n\n# おまけ\n\n`.vimrc`というファイルを生成してホームにおいておけば、これが拡張するためのカスタマイズファイルとなります。\n世の中にはありとあらゆる`.vimrc`が転がってますのではじめは有名なものをまんまコピーするといいかもしれないですね。\nそこから自分好みにカスタマイズしていくと段々自分だけの秘伝のタレが整っていきます。\n最近作業マシンを引っ越したのですがエディタに関しては`.vimrc`を持っていくだけで済んだのでとてもお手軽でした。\n\n---\n\n# おわりに\n\nいかがでしたでしょうか？\nお世辞にもとっつきやすいとは言えないですが、使いこなしたら便利そうなのが伝われば嬉しいです。\n実際に業務で本番サーバに入って何か操作をする際には必須スキルとなってきますので、リテラシーだと思って最低限の操作だけは押さえておきましょう。\nそれでは快適な`Vim`ライフを:smile:\n","coediting":false,"created_at":"2017-05-17T19:10:55+09:00","group":null,"id":"31ce5bef451d9e3be225","private":false,"tags":[{"name":"Vim","versions":[]},{"name":"新人プログラマ応援","versions":[]}],"title":"【新人エンジニア向け】Vimに興味を持ってもらうための話","updated_at":"2017-05-17T19:11:56+09:00","url":"http://qiita.com/yamamoto_hiroya/items/31ce5bef451d9e3be225","user":{"description":"","facebook_id":"","followees_count":2,"followers_count":15,"github_login_name":null,"id":"yamamoto_hiroya","items_count":33,"linkedin_id":"","location":"","name":"紘也 山本","organization":"","permanent_id":67471,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/67471/profile-images/1473697537","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003e配列＆ループを使って、同じようなものをコード少なくしたい。。。\u003cbr\u003e\n試してみたら、コケるポイントがあったので、メモメモ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やりたかったこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたかったこと。\u003c/h1\u003e\n\n\u003cp\u003eこんな感じのものがあって、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e雰囲気オブジェクト\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ecategory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecate1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ecolor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ecategory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecate2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ecolor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor2\u003c/span\u003e\n\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ecategory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecate3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ecolor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor3\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれを、scssの配列を使って↓こんな感じにしたい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e仕上げたいcss\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecate1\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecate2\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elist\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecate3\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"ss\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やったこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやったこと。\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"前提\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提。\u003c/h2\u003e\n\n\u003cp\u003e色は変数で設定しておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escss：色の変数設定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"vg\"\u003e$cateColor\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"ss\"\u003ecate1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e#cate1なカラー;\u003c/span\u003e\n\u003cspan class=\"vg\"\u003e$cateColor\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"ss\"\u003ecate2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e#cate2なカラー;\u003c/span\u003e\n\u003cspan class=\"vg\"\u003e$cateColor\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"ss\"\u003ecate3\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e#cate3なカラー;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"こちらができたやり方です\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%A1%E3%82%89%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%9F%E3%82%84%E3%82%8A%E6%96%B9%E3%81%A7%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこちらができたやり方です。\u003c/h2\u003e\n\n\u003cp\u003eカテゴリ名と色の変数をそれぞれ順番をそろえて配列に入れます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escss：配列に設置\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"vg\"\u003e$categories\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"cate1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"cate2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"cate3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"vg\"\u003e$color\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e#{$cateColor-cate1}, #{$cateColor-cate2}, #{$cateColor-cate3};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eindexを使って、それぞれ取り出します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escss：CSS書き出し部分ループ\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"vi\"\u003e@each\u003c/span\u003e \u003cspan class=\"vg\"\u003e$category\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"vg\"\u003e$categories\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"vg\"\u003e$n\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"vg\"\u003e$categories\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"vg\"\u003e$category\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"vg\"\u003e$color\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enth\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"vg\"\u003e$color\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"vg\"\u003e$n\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecate\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"c1\"\u003e#{$category} {\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"vg\"\u003e$color\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"こちらではうまくいかなかったです\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%A1%E3%82%89%E3%81%A7%E3%81%AF%E3%81%86%E3%81%BE%E3%81%8F%E3%81%84%E3%81%8B%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%A7%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこちらではうまくいかなかったです。\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escss：CSS書き出し部分ループ　例1\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"vi\"\u003e@each\u003c/span\u003e \u003cspan class=\"vg\"\u003e$category\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"vg\"\u003e$categories\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecate\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"c1\"\u003e#{$category} {\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"vg\"\u003e$cateColor\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"c1\"\u003e#{$category};\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecss：結果\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003eコンパイルエラー\u003c/span\u003e\n\u003cspan class=\"vg\"\u003e$cateColor\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"err\"\u003e　ってなんやねん。知らんわ。\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eそれを乗り越えても、いったん色変数を配列にいれず、ループの中で変数名を作り出しても変数の文字列のまま吐き出されるようです...\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escss：CSS書き出し部分ループ　例2\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"vi\"\u003e@each\u003c/span\u003e \u003cspan class=\"vg\"\u003e$category\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"vg\"\u003e$categories\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"vg\"\u003e$colorName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"$cateColor-\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"vg\"\u003e$category\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"vg\"\u003e$color\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e#{$colorName};\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecate\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"c1\"\u003e#{$category} {\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"vg\"\u003e$color\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003escss：CSS書き出し部分ループ　例3\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"vi\"\u003e@each\u003c/span\u003e \u003cspan class=\"vg\"\u003e$category\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"vg\"\u003e$categories\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"vg\"\u003e$colorName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"$cateColor-\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"vg\"\u003e$category\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"vg\"\u003e$color\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eunquote\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"vg\"\u003e$colorName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecate\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"c1\"\u003e#{$category} {\u003c/span\u003e\n    \u003cspan class=\"ss\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"vg\"\u003e$color\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ecss：例2\u0026amp;3の結果\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecate\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecate1\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"ss\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"vg\"\u003e$cateColor\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecate1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecate\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecate2\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"ss\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"vg\"\u003e$cateColor\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecate2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecate\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecate3\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"ss\"\u003ebackground\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"vg\"\u003e$cateColor\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ecate2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e。。。。変数が文字列のままコンパイルされてるやんTT。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"http://5509.hatenablog.com/entry/2012/03/01/021535\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://5509.hatenablog.com/entry/2012/03/01/021535\u003c/a\u003e\u003cbr\u003e\nありがとうございました。（あ、、、2012年。。。。）\u003c/p\u003e\n","body":"配列＆ループを使って、同じようなものをコード少なくしたい。。。\n試してみたら、コケるポイントがあったので、メモメモ。\n\n#やりたかったこと。\n\nこんな感じのものがあって、\n\n```ruby:雰囲気オブジェクト\n{\n  category: cate1,\n  color: color1\n},\n{\n  category: cate2,\n  color: color2\n},\n{\n  category: cate3,\n  color: color3\n}\n```\n\nこれを、scssの配列を使って↓こんな感じにしたい。\n\n```ruby:仕上げたいcss\n.list-cate1{\n  background: color1;\n}\n.list-cate2{\n  background: color2;\n}\n.list-cate3{\n  background: color3;\n}\n```\n\n#やったこと。\n\n##前提。\n色は変数で設定しておきます。\n\n```ruby:scss：色の変数設定\n$cateColor-cate1: #cate1なカラー;\n$cateColor-cate2: #cate2なカラー;\n$cateColor-cate3: #cate3なカラー;\n```\n\n\n##こちらができたやり方です。\nカテゴリ名と色の変数をそれぞれ順番をそろえて配列に入れます。\n\n```ruby:scss：配列に設置\n$categories: \"cate1\", \"cate2\", \"cate3\";\n$color: #{$cateColor-cate1}, #{$cateColor-cate2}, #{$cateColor-cate3};\n```\n\nindexを使って、それぞれ取り出します。\n\n```ruby:scss：CSS書き出し部分ループ\n@each $category in $categories {\n  $n: index($categories, $category);\n  $color: nth($color, $n);\n    .cate-#{$category} {\n    background: $color;\n  }\n}\n```\n\n\n##こちらではうまくいかなかったです。\n\n```ruby:scss：CSS書き出し部分ループ　例1\n@each $category in $categories {\n  .cate-#{$category} {\n    background: $cateColor-#{$category};\n  }\n}\n```\n```ruby:css：結果\nコンパイルエラー\n$cateColor-　ってなんやねん。知らんわ。\n```\n\nそれを乗り越えても、いったん色変数を配列にいれず、ループの中で変数名を作り出しても変数の文字列のまま吐き出されるようです...\n\n```ruby:scss：CSS書き出し部分ループ　例2\n@each $category in $categories {\n  $colorName: \"$cateColor-#{$category}\";\n  $color: #{$colorName};\n  .cate-#{$category} {\n    background: $color;\n  }\n}\n```\n\n```ruby:scss：CSS書き出し部分ループ　例3\n@each $category in $categories {\n  $colorName: \"$cateColor-#{$category}\";\n  $color: unquote($colorName);\n  .cate-#{$category} {\n    background: $color;\n  }\n}\n```\n\n```ruby:css：例2\u00263の結果\n.cate-cate1 {background: $cateColor-cate1; }\n.cate-cate2 {background: $cateColor-cate2; }\n.cate-cate3 {background: $cateColor-cate2; }\n```\n\n。。。。変数が文字列のままコンパイルされてるやんTT。\n\n\n#参考\nhttp://5509.hatenablog.com/entry/2012/03/01/021535\nありがとうございました。（あ、、、2012年。。。。）\n","coediting":false,"created_at":"2017-05-17T18:54:18+09:00","group":null,"id":"8d9aff3acc3189770c07","private":false,"tags":[{"name":"CSS","versions":[]},{"name":"scss","versions":[]}],"title":"scssの配列ループ＋変数でカテゴリ色分けなどを簡単にするよ！","updated_at":"2017-05-17T18:57:32+09:00","url":"http://qiita.com/niever66/items/8d9aff3acc3189770c07","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":null,"id":"niever66","items_count":3,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":165366,"profile_image_url":"https://lh3.googleusercontent.com/-OL2rSvLTdzg/AAAAAAAAAAI/AAAAAAAAAM0/g2CgO2Odxd8/photo.jpg?sz=50","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"ページが変わるイベントの拾え方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%8C%E5%A4%89%E3%82%8F%E3%82%8B%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E6%8B%BE%E3%81%88%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eページが変わるイベントの拾え方\u003c/h1\u003e\n\n\u003cp\u003e画面構成上ではそれぞれのページのURLが違いますので、URLが変わるタミングでGAトラッキングデータを送信したいです。\u003cbr\u003e\nReact+Reduxの場合、次の２つ方法でそのイベントを拾えることができますが、react-gaのホームページ載せているonUpdate案を採用することになりました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eHisotryリスナー案\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eRouterに設定されたHistoryオブジェクトにリスナーを登録することで、画面遷移が発生するたびに呼ばれます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e// router.jsx (一部)\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eRouter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eRoute\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eIndexRoute\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ebrowserHistory\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'react-router'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003esyncHistoryWithStore\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'react-router-redux'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'./store/configStore'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ehistory\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esyncHistoryWithStore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebrowserHistory\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003ehistory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// locationが新しいものです\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// ga処理\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eProvider\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eRouter\u003c/span\u003e \u003cspan class=\"nx\"\u003ehistory\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ehistory\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eRoute\u003c/span\u003e \u003cspan class=\"nx\"\u003ecomponent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eApp\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eRouterのonUpdate案\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eRouterのonUpdate属性にコールバックを登録します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e// router.jsx (一部)\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eReactGA\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'./ReactGA'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eProvider\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eRouter\u003c/span\u003e \u003cspan class=\"nx\"\u003ehistory\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ehistory\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nx\"\u003eonUpdate\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eReactGA\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edoPageTracking\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// ReactGA.js\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eimport\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003eOrginalReactGA\u003c/span\u003e \u003cspan class=\"nx\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e'react-ga'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eReactGA\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// window.ga_debug = { trace: true }; // google-analyticsのデバッグログフラグ\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elastestPage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eOrginalReactGA\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'U-12345678-9'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// debug: true   // react-gaのログ出力\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// sendHitTask: null,  // google-analytics送信しない設定\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"sb\"\u003e//\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehostname\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"sb\"\u003e/`\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edoPageTracking\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edoPageTracking\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003edoPageTracking\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epathname\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epage\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elastestPage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elastestPage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003epage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// 独自なデータを設定\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003epage\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epageview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003eexport\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eReactGA\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"デバッグ方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデバッグ方法\u003c/h1\u003e\n\n\u003cp\u003eGAトラッキングがうまく行ったかどうかをログから確認できます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ログ種類\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%82%B0%E7%A8%AE%E9%A1%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eログ種類\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003ereact-gaログ\n初期化時にdebugオプションで指定できます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'U-12345678-9'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003edebug\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// react-gaのログ出力ON\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003egoogle-analyticsログ\n下記ソースコードを実行することで、実際に送信された内容がブラウザのconsoleログに出力されます。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ega_debug\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003etrace\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなお、chromeにgoogle analytics debuggerプラグインをインストールすることで、ブラウザ情報ログ出力ON/OFFをコントロールできます。ログ内容が上記と同じです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"本当なトラッキングidでデバッグしたい場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E5%BD%93%E3%81%AA%E3%83%88%E3%83%A9%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0id%E3%81%A7%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本当なトラッキングIDでデバッグしたい場合\u003c/h3\u003e\n\n\u003cp\u003esendHitTaskをnullに設定したら、統計情報を送信せずに動作確認することができます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esendHitTask\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"sb\"\u003e//\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehostname\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"sb\"\u003e/`\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考記事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E8%A8%98%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考記事\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://web-design-weekly.com/2016/07/08/adding-google-analytics-react-application/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAdding Google Analytics to your React Application\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developers.google.com/analytics/devguides/collection/analyticsjs/\" rel=\"nofollow noopener\" target=\"_blank\"\u003egoogle analytics.js\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/react-ga/react-ga\" rel=\"nofollow noopener\" target=\"_blank\"\u003ereact-ga\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://stackoverflow.com/questions/34836500/how-to-set-up-google-analytics-for-react-router\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow to set up Google Analytics for React-Router?\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# ページが変わるイベントの拾え方\n画面構成上ではそれぞれのページのURLが違いますので、URLが変わるタミングでGAトラッキングデータを送信したいです。\nReact+Reduxの場合、次の２つ方法でそのイベントを拾えることができますが、react-gaのホームページ載せているonUpdate案を採用することになりました。\n\n- Hisotryリスナー案\n\nRouterに設定されたHistoryオブジェクトにリスナーを登録することで、画面遷移が発生するたびに呼ばれます。\n\n```js\n// router.jsx (一部)\n\nimport { Router, Route, IndexRoute, browserHistory } from 'react-router';\nimport { syncHistoryWithStore } from 'react-router-redux';\nimport store from './store/configStore';\nconst history = syncHistoryWithStore(browserHistory, store);\n\nhistory.listen(function (location) {\n  // locationが新しいものです\n  // ga処理\n});\n\nrender((\n  \u003cProvider store={store}\u003e\n    \u003cRouter history={history}\u003e\n      \u003cRoute component={App}\u003e\n...\n\n```\n\n- RouterのonUpdate案\n\nRouterのonUpdate属性にコールバックを登録します。\n\n```js\n// router.jsx (一部)\nimport ReactGA from './ReactGA';\n\nrender((\n  \u003cProvider store={store}\u003e\n    \u003cRouter history={history} onUpdate={ReactGA.doPageTracking}\u003e\n...\n\n// ReactGA.js\nimport * as OrginalReactGA from 'react-ga';\n\nclass ReactGA {\n\n  constructor() {\n    // window.ga_debug = { trace: true }; // google-analyticsのデバッグログフラグ\n    this.lastestPage = null;\n    this.original = OrginalReactGA;\n\n    this.original.initialize('U-12345678-9', {\n      // debug: true   // react-gaのログ出力\n    });\n\n    this.original.set({\n      // sendHitTask: null,  // google-analytics送信しない設定\n      location: `${window.location.protocol}//${window.location.hostname}/`\n    });\n\n    this.doPageTracking = this.doPageTracking.bind(this);\n  }\n\n  doPageTracking() {\n    const page = window.location.pathname;\n    if (page === this.lastestPage) {\n      return;\n    }\n    this.lastestPage = page;\n\n    this.original.set({\n      // 独自なデータを設定\n      page\n    });\n    this.original.pageview(page);\n  }\n\n}\n\nexport default new ReactGA();\n```\n\n# デバッグ方法\nGAトラッキングがうまく行ったかどうかをログから確認できます。\n### ログ種類\n- react-gaログ\n初期化時にdebugオプションで指定できます。\n\n```js\nthis.original.initialize('U-12345678-9', {\n  debug: true   // react-gaのログ出力ON\n});\n```\n\n- google-analyticsログ\n下記ソースコードを実行することで、実際に送信された内容がブラウザのconsoleログに出力されます。\n\n```js\nwindow.ga_debug = { trace: true };\n```\n\nなお、chromeにgoogle analytics debuggerプラグインをインストールすることで、ブラウザ情報ログ出力ON/OFFをコントロールできます。ログ内容が上記と同じです。\n\n### 本当なトラッキングIDでデバッグしたい場合\nsendHitTaskをnullに設定したら、統計情報を送信せずに動作確認することができます。\n\n```js\nthis.original.set({\n  sendHitTask: null,\n  location: `${window.location.protocol}//${window.location.hostname}/`\n});\n```\n\n# 参考記事\n- [Adding Google Analytics to your React Application](https://web-design-weekly.com/2016/07/08/adding-google-analytics-react-application/)\n- [google analytics.js](https://developers.google.com/analytics/devguides/collection/analyticsjs/)\n- [react-ga](https://github.com/react-ga/react-ga)\n- [How to set up Google Analytics for React-Router?](http://stackoverflow.com/questions/34836500/how-to-set-up-google-analytics-for-react-router)\n","coediting":false,"created_at":"2017-05-17T18:52:02+09:00","group":null,"id":"2dd1bd26f4ec0e2244c7","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"GoogleAnalytics","versions":[]},{"name":"react.js","versions":[]},{"name":"reactjs","versions":[]}],"title":"【GAトラッキング】React+Reduxでページごとに統計情報を送信する","updated_at":"2017-05-17T22:47:08+09:00","url":"http://qiita.com/Anders/items/2dd1bd26f4ec0e2244c7","user":{"description":"","facebook_id":"","followees_count":5,"followers_count":0,"github_login_name":"BaiLingLi","id":"Anders","items_count":14,"linkedin_id":"","location":"Tokyo,Japan","name":"","organization":"","permanent_id":123446,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/123446/profile-images/1473715561","twitter_screen_name":"AndersLee","website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"-事前準備として\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%A8%E3%81%97%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e○ 事前準備として\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"fragmentstatepageradapterクラスを作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#fragmentstatepageradapter%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFragmentStatePagerAdapterクラスを作成\u003c/h2\u003e\n\n\u003cp\u003e役割：viewPagerに必要なFragmentページを渡す\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"java\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eCustomFragmentStatePagerAdapter.java\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eCustomFragmentStatePagerAdapter\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"n\"\u003eFragmentStatePagerAdapter\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"c1\"\u003e//FragmentStatePageAdapterを継承(*1)\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eSparseArray\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFragment\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003emFragmentArray\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eHogeData\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003emHogeDataList\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003eCustomFragmentStatePagerAdapter\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFragmentManager\u003c/span\u003e \u003cspan class=\"n\"\u003efm\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eHogeData\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edataList\u003c/span\u003e\u003cspan class=\"o\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003esuper\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efm\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emFragmentArray\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eArrayList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;();\u003c/span\u003e \u003cspan class=\"c1\"\u003e//返却するFragmentのList初期化\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emHogeDataList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edataList\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//ここでデータを保持しておく　//FragmentはgetItemで作成\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n　　　　\u003cspan class=\"nd\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eHogeFragment\u003c/span\u003e \u003cspan class=\"nf\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"o\"\u003e){\u003c/span\u003e \u003cspan class=\"c1\"\u003e//Fragmentのページを返却する実装を書く\u003c/span\u003e\n　　　　　　　　 \u003cspan class=\"n\"\u003eHogeFragment\u003c/span\u003e \u003cspan class=\"n\"\u003efragment\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emFragmentArray\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efragment\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efragment\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//すでにFragmentを作っていたらリサイクルして使用する\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003efragment\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eHogeFragment\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ecreateInstance\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emHogeDataList\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"o\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emFragmentArray\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eappend\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eposition\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efragment\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efragment\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n　　　\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nd\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003egetCount\u003c/span\u003e\u003cspan class=\"o\"\u003e(){\u003c/span\u003e  \u003cspan class=\"c1\"\u003e//mViewPager.setAdapterするときにここを参照してページ数を決める\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003emHogeDataList\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003esize\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nd\"\u003e@Override\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"nf\"\u003egetPageTitle\u003c/span\u003e\u003cspan class=\"o\"\u003e(){\u003c/span\u003e  \u003cspan class=\"c1\"\u003e//tabLayoutと連携しているときmViewPager.setAdapterしたときにここの文言をタブに表示する\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etitle\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003esetHogeDataList\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eHogeData\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edataList\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emHogeDataList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edataList\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enotifyDataSetChanged\u003c/span\u003e\u003cspan class=\"o\"\u003e();\u003c/span\u003e\u003cspan class=\"c1\"\u003e//データを変更した時に呼ぶ//すべてのfragmentページが再生成される\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e(補足)\u003cbr\u003e\n*1 Fragmentを使用する時のViewPagerのAdapterは\u003ccode\u003eFragmentStatePagerAdapter\u003c/code\u003eと\u003ccode\u003eFragmentPagerAdapter\u003c/code\u003eがある。Stateの方はFragmentの状態のみを保持する。メモリ節約したい時はStateを使うみたい\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"-使用例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-%E4%BD%BF%E7%94%A8%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e○ 使用例\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eViewPager mViewPager;\nCustomFragmentStatePagerAdapter mAdapter;\nTabLayout mTabs; //tabLayoutを連携させる時\n\nmViewPager.setAdapter(mAdapter);\nmViewPager.setOffscreenPageLimit(2);　　　　//左右の保持するFragment数を設定、デフォルトは1\nmTabs.setupWithViewPager(mViewPager); //tabLayoutと連携する場合\n\n//補足\nmPager.setCurrentItem(3); //ページ変更\nmTabs.addOnTabSelectedListener();//Tabが選択された時のリスナー\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e参考資料\u003cbr\u003e\n\u003ca href=\"https://developer.android.com/reference/android/support/v4/app/FragmentPagerAdapter.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://developer.android.com/reference/android/support/v4/app/FragmentPagerAdapter.html\u003c/a\u003e //公式HP\u003cbr\u003e\n\u003ca href=\"http://k-1-ne-jp.blogspot.jp/2013/12/viewpagerfragmentstatepageradapter.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://k-1-ne-jp.blogspot.jp/2013/12/viewpagerfragmentstatepageradapter.html\u003c/a\u003e //ViewPagerを使ってみる(FragmentStatePagerAdapterを利用する）\u003c/p\u003e\n","body":"#○ 事前準備として\n##FragmentStatePagerAdapterクラスを作成\n役割：viewPagerに必要なFragmentページを渡す\n\n```CustomFragmentStatePagerAdapter.java\npublic CustomFragmentStatePagerAdapter extends FragmentStatePagerAdapter{//FragmentStatePageAdapterを継承(*1)\n  \n  private SparseArray\u003cFragment\u003e mFragmentArray;\n  private List\u003cHogeData\u003e mHogeDataList;\n  \n  public CustomFragmentStatePagerAdapter(FragmentManager fm,List\u003cHogeData\u003e dataList){\n    super(fm);\n    mFragmentArray = new ArrayList\u003c\u003e(); //返却するFragmentのList初期化\n    mHogeDataList = dataList; //ここでデータを保持しておく　//FragmentはgetItemで作成\n  }\n\n　　　　@Override\n  public HogeFragment getItem(int position){ //Fragmentのページを返却する実装を書く\n　　　　　　　　 HogeFragment fragment = mFragmentArray.get(position);\n        if (fragment != null) {\n            return fragment; //すでにFragmentを作っていたらリサイクルして使用する\n        }\n        fragment = HogeFragment.createInstance(mHogeDataList.get(position));\n        mFragmentArray.append(position, fragment);\n        return fragment;\n　　　}\n\n  @Override\n  public getCount(){  //mViewPager.setAdapterするときにここを参照してページ数を決める\n    return mHogeDataList.size();\n  }\n\n  @Override\n  public getPageTitle(){  //tabLayoutと連携しているときmViewPager.setAdapterしたときにここの文言をタブに表示する\n    return title;\n  }\n\n  public void setHogeDataList(List\u003cHogeData\u003e dataList) {\n    mHogeDataList = dataList;\n    notifyDataSetChanged();//データを変更した時に呼ぶ//すべてのfragmentページが再生成される\n  }\n}\n```\n\n\u003e(補足)\n*1 Fragmentを使用する時のViewPagerのAdapterは`FragmentStatePagerAdapter`と`FragmentPagerAdapter`がある。Stateの方はFragmentの状態のみを保持する。メモリ節約したい時はStateを使うみたい\n\n#○ 使用例\n```\nViewPager mViewPager;\nCustomFragmentStatePagerAdapter mAdapter;\nTabLayout mTabs; //tabLayoutを連携させる時\n\nmViewPager.setAdapter(mAdapter);\nmViewPager.setOffscreenPageLimit(2);　　　　//左右の保持するFragment数を設定、デフォルトは1\nmTabs.setupWithViewPager(mViewPager); //tabLayoutと連携する場合\n\n//補足\nmPager.setCurrentItem(3); //ページ変更\nmTabs.addOnTabSelectedListener();//Tabが選択された時のリスナー\n```\n参考資料\nhttps://developer.android.com/reference/android/support/v4/app/FragmentPagerAdapter.html //公式HP\nhttp://k-1-ne-jp.blogspot.jp/2013/12/viewpagerfragmentstatepageradapter.html //ViewPagerを使ってみる(FragmentStatePagerAdapterを利用する）\n","coediting":false,"created_at":"2017-05-17T18:40:05+09:00","group":null,"id":"1e5dd319e6fb3ae0c8ba","private":false,"tags":[{"name":"Android","versions":[]},{"name":"Fragment","versions":[]},{"name":"ViewPager","versions":[]}],"title":"ViewPagerの使い方(Android)~Fragmentページを作る~","updated_at":"2017-05-17T18:58:35+09:00","url":"http://qiita.com/haruki99/items/1e5dd319e6fb3ae0c8ba","user":{"description":"はじめまして、まだまだ新米のエンジニアです。基本的なことを黙々と忘れないように記録していきたいと思っています。ゆるく見守ってください。","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":null,"id":"haruki99","items_count":2,"linkedin_id":"","location":"Osaka,Japan","name":"","organization":"","permanent_id":50917,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/50917/profile-images/1495005036","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$sql3 = \"SELECT count(*),SUM(case when t_history_chat_logs.message_type = 1 THEN 1 ELSE 0 END) req, \nSUM(case when t_history_chat_logs.message_type = 2 THEN 1 ELSE 0 END) res,\nSUM(case when t_history_chat_logs.message_type = 4 THEN 1 ELSE 0 END) no,\nSUM(case when t_history_chat_logs.achievement_flg = 2 THEN 1 ELSE 0 END) effec \nFROM sinclo_db2.t_histories LEFT JOIN t_history_chat_logs ON \nt_history_chat_logs.t_histories_id = t_histories.id \nwhere t_histories.m_companies_id = \".$this-\u0026gt;userInfo['MCompany']['id'];\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"\n```\n$sql3 = \"SELECT count(*),SUM(case when t_history_chat_logs.message_type = 1 THEN 1 ELSE 0 END) req, \nSUM(case when t_history_chat_logs.message_type = 2 THEN 1 ELSE 0 END) res,\nSUM(case when t_history_chat_logs.message_type = 4 THEN 1 ELSE 0 END) no,\nSUM(case when t_history_chat_logs.achievement_flg = 2 THEN 1 ELSE 0 END) effec \nFROM sinclo_db2.t_histories LEFT JOIN t_history_chat_logs ON \nt_history_chat_logs.t_histories_id = t_histories.id \nwhere t_histories.m_companies_id = \".$this-\u003euserInfo['MCompany']['id'];\n","coediting":false,"created_at":"2017-05-17T18:38:31+09:00","group":null,"id":"e9084c30e8546488a186","private":false,"tags":[{"name":"SQL","versions":[]}],"title":"sql query caseを使った書き方(件数を取る時に便利)","updated_at":"2017-05-17T18:38:31+09:00","url":"http://qiita.com/hennnnnmi/items/e9084c30e8546488a186","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":3,"github_login_name":null,"id":"hennnnnmi","items_count":156,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":138125,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/138125/profile-images/1473720500","twitter_screen_name":"hennnnnmi","website_url":null}},{"rendered_body":"\u003cp\u003eRailsアプリを作る時、SNSのシェアボタンを設置するにはどうすれば良いのでしょうか？\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/32902/c8f4fd96-f438-8674-b2a2-3566de58e29b.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/32902/c8f4fd96-f438-8674-b2a2-3566de58e29b.png\" alt=\"OhkEventRails.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e今回たまたま\u003ccode\u003esocial-share-button\u003c/code\u003eというgemを見つけたので、それを使ってみました。\u003cbr\u003e\n\u003ca href=\"https://github.com/huacnlee/social-share-button\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/huacnlee/social-share-button\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eやり方は\u003ccode\u003eREADME.md\u003c/code\u003eに書かれていますが、まとめます。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eGemfileに追加して\u003ccode\u003ebundle install\u003c/code\u003eする\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"Gemfile\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003egem 'social-share-button'\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003col\u003e\n\u003cli\u003eapplication.cssに追加する\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"css\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapplication.css\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nt\"\u003erequire\u003c/span\u003e \u003cspan class=\"nt\"\u003esocial-share-button\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003col\u003e\n\u003cli\u003eapplication.jsに追加する\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapplication.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e//= require social-share-button\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"haml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eshow.html.haml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003e%p\u003c/span\u003e\u003cspan class=\"nf\"\u003e#notice\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enotice\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e%h2\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"vi\"\u003e@event\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etitle\u003c/span\u003e\n\u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esocial_share_button_tag\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"vi\"\u003e@event\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehash_tag\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:allow_sites\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"sx\"\u003e%w(twitter facebook google_plus weibo qq douban google_bookmark delicious tumblr pinterest email linkedin wechat vkontakte xing reddit hacker_news telegram odnoklassniki)\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれだけ！！\u003c/p\u003e\n\n\u003cp\u003e第一引数に渡した文字列がツイートの本文になる。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/32902/8a7cf941-3f83-e0c4-bab5-4e6ef90e8a7e.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/32902/8a7cf941-3f83-e0c4-bab5-4e6ef90e8a7e.png\" alt=\"Twitter_でリンクを共有する.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eとりあえず全部アイコン出してますけど、半分以上分からない...\u003c/p\u003e\n\n\u003cp\u003eあと、\u003ccode\u003efacebook\u003c/code\u003eは使えないんだって。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/32902/1d4abbac-321f-090c-72f6-2fa2914de776.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/32902/1d4abbac-321f-090c-72f6-2fa2914de776.png\" alt=\"Error_と_OhkEventRails.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eまーこんな感じです。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eREADME.md\u003c/code\u003e通りやると途中で\u003ccode\u003erails g\u003c/code\u003eコメンドでファイル作成して、そっちに表示したいアイコンの配列を作るのですがエラーになって上手くいかなかった。\u003cbr\u003e\n多分上手くそのファイルが読み込めてないのだけど、原因わからないから\u003ccode\u003eview\u003c/code\u003eから直接渡しちゃってる。\u003c/p\u003e\n\n\u003cp\u003eとりあえず出来たからOK！\u003c/p\u003e\n","body":"Railsアプリを作る時、SNSのシェアボタンを設置するにはどうすれば良いのでしょうか？\n![OhkEventRails.png](https://qiita-image-store.s3.amazonaws.com/0/32902/c8f4fd96-f438-8674-b2a2-3566de58e29b.png)\n\n今回たまたま`social-share-button`というgemを見つけたので、それを使ってみました。\nhttps://github.com/huacnlee/social-share-button\n\nやり方は`README.md`に書かれていますが、まとめます。\n\n1. Gemfileに追加して`bundle install`する\n\n```Gemfile\ngem 'social-share-button'\n```\n\n2. application.cssに追加する\n\n```application.css\n#= require social-share-button\n```\n\n3. application.jsに追加する\n\n```application.js\n//= require social-share-button\n```\n\n```show.html.haml\n%p#notice= notice\n%h2\n  = @event.title\n= social_share_button_tag(@event.hash_tag, :allow_sites =\u003e %w(twitter facebook google_plus weibo qq douban google_bookmark delicious tumblr pinterest email linkedin wechat vkontakte xing reddit hacker_news telegram odnoklassniki))\n```\nこれだけ！！\n\n第一引数に渡した文字列がツイートの本文になる。\n![Twitter_でリンクを共有する.png](https://qiita-image-store.s3.amazonaws.com/0/32902/8a7cf941-3f83-e0c4-bab5-4e6ef90e8a7e.png)\n\n\nとりあえず全部アイコン出してますけど、半分以上分からない...\n\nあと、`facebook`は使えないんだって。\n![Error_と_OhkEventRails.png](https://qiita-image-store.s3.amazonaws.com/0/32902/1d4abbac-321f-090c-72f6-2fa2914de776.png)\n\nまーこんな感じです。\n\n\n`README.md`通りやると途中で`rails g`コメンドでファイル作成して、そっちに表示したいアイコンの配列を作るのですがエラーになって上手くいかなかった。\n多分上手くそのファイルが読み込めてないのだけど、原因わからないから`view`から直接渡しちゃってる。\n\nとりあえず出来たからOK！\n","coediting":false,"created_at":"2017-05-17T18:21:56+09:00","group":null,"id":"9ce913e3ed874571ba44","private":false,"tags":[{"name":"Ruby","versions":[]},{"name":"Rails","versions":[]},{"name":"初心者","versions":[]}],"title":"RailsアプリにSNSボタンを5分で追加する","updated_at":"2017-05-17T18:21:56+09:00","url":"http://qiita.com/opiyo_taku/items/9ce913e3ed874571ba44","user":{"description":"カッコイイ先輩達は皆エンジニアでした。\r\nだから頑張ってみようと思う。\r\n\r\nマストドン岡山を運営しています。\r\nhttps://mstdn.okayama.jp/","facebook_id":"","followees_count":0,"followers_count":4,"github_login_name":null,"id":"opiyo_taku","items_count":49,"linkedin_id":"","location":"","name":"中野 拓","organization":"","permanent_id":32902,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/32902/profile-images/1473686004","twitter_screen_name":"opiyo_taku","website_url":"http://opiyotan.hatenablog.com/"}},{"rendered_body":"\u003cp\u003e先日参加させていただいた勉強会 \u003ca href=\"https://classmethod.connpass.com/event/55140/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGo\u0026amp;Elixirでつくる分散アプリケーション\u003c/a\u003e にて\u003cbr\u003e\nエラトステネスの篩というアルゴリズムをGo言語で実装した例を紹介していました。\u003cbr\u003e\n(実はその勉強会で初めてこのアルゴリズムを知りました ^^;)\u003c/p\u003e\n\n\u003cp\u003eエラトステネスの篩はある指定された整数以下の素数を見つけるためのアルゴリズムとなります。\u003cbr\u003e\n詳細は\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%82%A8%E3%83%A9%E3%83%88%E3%82%B9%E3%83%86%E3%83%8D%E3%82%B9%E3%81%AE%E7%AF%A9\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWikipedia\u003c/a\u003eをご参照ください\u003c/p\u003e\n\n\u003cp\u003e勉強会での例ではGoのチャンネルを使って実装されていたので、\u003cbr\u003e\nElixirでは子プロセスを生成し、そちらで値のフィルタリングをしていくという\u003cbr\u003e\n方法で実装みたいと思います。\u003cbr\u003e\n\u003ca href=\"http://qiita.com/naoya@github/items/c71f614b5ed8c05b998c\" class=\"autolink\" id=\"reference-1fc1147a95d545bc02f1\"\u003ehttp://qiita.com/naoya@github/items/c71f614b5ed8c05b998c\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ex\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eerastosthenes.exs\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003edefmodule\u003c/span\u003e \u003cspan class=\"nc\"\u003eErastosthenes\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003esieve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elast?\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereceive\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n      \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"ow\"\u003ewhen\u003c/span\u003e \u003cspan class=\"n\"\u003erem\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprime\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esieve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elast?\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esend\u003c/span\u003e \u003cspan class=\"n\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enext\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003elast?\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n          \u003cspan class=\"c1\"\u003e# 自身が最後の篩だったら次の篩を生成する\u003c/span\u003e\n          \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003epid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"bp\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espawn_monitor\u003c/span\u003e \u003cspan class=\"nc\"\u003eErastosthenes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:sieve\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \n          \u003cspan class=\"n\"\u003epid\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n          \u003cspan class=\"n\"\u003enext\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esieve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"no\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereceive\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n      \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eIO\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eputs\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e is prime.\"\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eoutput\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eopid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espawn\u003c/span\u003e \u003cspan class=\"nc\"\u003eErastosthenes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:output\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003espid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"bp\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espawn_monitor\u003c/span\u003e \u003cspan class=\"nc\"\u003eErastosthenes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:sieve\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eopid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\n\u003cspan class=\"o\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eStream\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esend\u003c/span\u003e \u003cspan class=\"n\"\u003espid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ni\"\u003e\u0026amp;1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"o\"\u003e|\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eEnum\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_list\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eそれぞれの篩は以下の値を保持するようにしています\u003cbr\u003e\n- 素数\u003cbr\u003e\n- 次の篩、もしくは出力用プロセスのpid\u003cbr\u003e\n- 自身が最後の篩かどうか\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003esieve\u003c/code\u003e を子プロセスとしてどんどん生成いき、\u003cbr\u003e\n大元から渡された値を篩にかけていきます。\u003cbr\u003e\n渡された値が自身の素数で割り切れなかったら次の素数の篩に送ります。\u003cbr\u003e\nもし自身が最後の篩の場合、割り切れなかった値は\u003cbr\u003e\n素数なので次の素数の篩を生成しています。\u003c/p\u003e\n\n\u003cp\u003e実行結果がこちら\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"console\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"gp\"\u003e$\u003c/span\u003e iex\n\u003cspan class=\"go\"\u003eiex(1)\u0026gt; c\"erastosthenes.exs\"\u003c/span\u003e\n\u003cspan class=\"go\"\u003e3 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e5 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e7 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e11 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e13 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e17 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e19 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e23 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e29 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e31 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e37 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e41 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e[Erastosthenes]\u003c/span\u003e\n\u003cspan class=\"go\"\u003e43 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e47 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e53 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e59 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e61 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e67 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e71 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e73 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e79 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e83 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e89 is prime.\u003c/span\u003e\n\u003cspan class=\"go\"\u003e97 is prime.\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e親プロセスでreceiveしていないため、iexで実行しないと\u003cbr\u003e\n全部出力するまえに実行が終了してしまうのでわざわざiexで実行しています \u003cimg alt=\":sweat:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f613.png\" title=\":sweat:\" width=\"20\"\u003e\u003c/p\u003e\n\n\u003cp\u003eまた最初の素数である2だけは最初に篩を作ってあげる必要があるので、\u003cbr\u003e\n出力に表示されていないです \u003cimg alt=\":sweat:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f613.png\" title=\":sweat:\" width=\"20\"\u003e \u003cimg alt=\":sweat:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f613.png\" title=\":sweat:\" width=\"20\"\u003e \u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ的な何か\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81%E7%9A%84%E3%81%AA%E4%BD%95%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ的な何か\u003c/h1\u003e\n\n\u003cp\u003e今回は生spawnを使って書いてみましたが、\u003cbr\u003e\nsieve関数で状態を保持する必要があるのでAgentを使ったほうがよかったかなと\u003cbr\u003e\n思っています。\u003c/p\u003e\n\n\u003cp\u003eまた出力のとこも微妙になってしまったのがなんとも残念です。\u003cbr\u003e\n(Elixir力が足りない。。。)\u003c/p\u003e\n\n\u003cp\u003e何かご指摘等いただけますと嬉しいです。\u003c/p\u003e\n","body":"先日参加させていただいた勉強会 [Go\u0026Elixirでつくる分散アプリケーション](https://classmethod.connpass.com/event/55140/) にて\nエラトステネスの篩というアルゴリズムをGo言語で実装した例を紹介していました。\n(実はその勉強会で初めてこのアルゴリズムを知りました ^^;)\n\nエラトステネスの篩はある指定された整数以下の素数を見つけるためのアルゴリズムとなります。\n詳細は[Wikipedia](https://ja.wikipedia.org/wiki/%E3%82%A8%E3%83%A9%E3%83%88%E3%82%B9%E3%83%86%E3%83%8D%E3%82%B9%E3%81%AE%E7%AF%A9)をご参照ください\n\n勉強会での例ではGoのチャンネルを使って実装されていたので、\nElixirでは子プロセスを生成し、そちらで値のフィルタリングをしていくという\n方法で実装みたいと思います。\nhttp://qiita.com/naoya@github/items/c71f614b5ed8c05b998c\n# 実装\n\n```ex:erastosthenes.exs\ndefmodule Erastosthenes do\n\n  def sieve(prime, next, last?) do\n    receive do\n      n when rem(n, prime) == 0 -\u003e\n        sieve(prime, next, last?)\n      n -\u003e\n        send next, n\n        next = if last? do\n          # 自身が最後の篩だったら次の篩を生成する\n          {pid, _} = spawn_monitor Erastosthenes, :sieve, [n, next, true] \n          pid\n        else\n          next\n        end\n        sieve(prime, next, false)\n    end\n  end\n\n  def output do\n    receive do\n      n -\u003e\n        IO.puts \"#{n} is prime.\"\n        output()\n    end\n  end\nend\n\nopid = spawn Erastosthenes, :output, []\n{spid, _} = spawn_monitor Erastosthenes, :sieve, [2, opid, true]\n\n2..100\n|\u003e Stream.map(\u0026(send spid, \u00261))\n|\u003e Enum.to_list\n```\n\nそれぞれの篩は以下の値を保持するようにしています\n- 素数\n- 次の篩、もしくは出力用プロセスのpid\n- 自身が最後の篩かどうか\n\n`sieve` を子プロセスとしてどんどん生成いき、\n大元から渡された値を篩にかけていきます。\n渡された値が自身の素数で割り切れなかったら次の素数の篩に送ります。\nもし自身が最後の篩の場合、割り切れなかった値は\n素数なので次の素数の篩を生成しています。\n\n\n実行結果がこちら\n\n```console\n$ iex\niex(1)\u003e c\"erastosthenes.exs\"\n3 is prime.\n5 is prime.\n7 is prime.\n11 is prime.\n13 is prime.\n17 is prime.\n19 is prime.\n23 is prime.\n29 is prime.\n31 is prime.\n37 is prime.\n41 is prime.\n[Erastosthenes]\n43 is prime.\n47 is prime.\n53 is prime.\n59 is prime.\n61 is prime.\n67 is prime.\n71 is prime.\n73 is prime.\n79 is prime.\n83 is prime.\n89 is prime.\n97 is prime.\n```\n\n親プロセスでreceiveしていないため、iexで実行しないと\n全部出力するまえに実行が終了してしまうのでわざわざiexで実行しています :sweat:\n\nまた最初の素数である2だけは最初に篩を作ってあげる必要があるので、\n出力に表示されていないです :sweat: :sweat: \n\n# まとめ的な何か\n\n今回は生spawnを使って書いてみましたが、\nsieve関数で状態を保持する必要があるのでAgentを使ったほうがよかったかなと\n思っています。\n\nまた出力のとこも微妙になってしまったのがなんとも残念です。\n(Elixir力が足りない。。。)\n\n何かご指摘等いただけますと嬉しいです。\n\n","coediting":false,"created_at":"2017-05-17T18:21:10+09:00","group":null,"id":"8b97e93f94fdb014100b","private":false,"tags":[{"name":"Elixir","versions":[]},{"name":"エラトステネスの篩","versions":[]}],"title":"Elixirでエラトステネスの篩を実装してみた","updated_at":"2017-05-17T18:21:10+09:00","url":"http://qiita.com/tamanugi/items/8b97e93f94fdb014100b","user":{"description":null,"facebook_id":null,"followees_count":6,"followers_count":2,"github_login_name":"tamanugi","id":"tamanugi","items_count":31,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":55219,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/55219/profile-images/1473693620","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"機械学習メモ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E3%83%A1%E3%83%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e機械学習メモ\u003c/h1\u003e\n\n\u003cp\u003e大学の研究で機械学習をやりたいと思っているので\u003cbr\u003e\n機械学習について学んだことをメモしていきたいと思っています。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eやろうと思っていることや意気込み\u003c/strong\u003e →ここは飛ばしておっけい。\u003cbr\u003e\n機械学習って何？？という初心者が\u003cbr\u003e\n機械学習でやりたいこと・できること・を学び\u003cbr\u003e\n開発環境の決定などを自分用のメモとして残しておきます。\u003c/p\u003e\n\n\u003cp\u003e使われている機械学習の知識\u003cbr\u003e\n自動運転・レコメンド機能・言語ルールと組み合わせて言語理解・不正検知\u003c/p\u003e\n\n\u003cp\u003e社会問題・ビジネス課題\u003c/p\u003e\n\n\u003cp\u003eしたいこと\u003cbr\u003e\nたくさんのデータの中からもらって未来予測\u003c/p\u003e\n\n\u003cp\u003eここでは例として株orFXを目的としてもいいのかもしれない。\u003c/p\u003e\n\n\u003cp\u003e自分の行動を予測して\u003cbr\u003e\n何の日に何をすればいいか教えてくれる秘書システム\u003cbr\u003e\nコンシェルジュサービス\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"本編\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E7%B7%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本編\u003c/h1\u003e\n\n\u003cp\u003e\u003cstrong\u003e強化学習\u003c/strong\u003e\u003cbr\u003e\n成功報酬というものを与えて、プログラムがその高い報酬を手に入れるためにどのようにすればいいか工夫するもの\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e見ようと思っているスライドのまとめのまとめ\u003c/strong\u003e　→いつか必要なものだけをまとめておく。\u003cbr\u003e\n機械学習が素早く学べるコンテンツとライブラリ20選: \u003ca href=\"http://ur0.link/DyG9\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ur0.link/DyG9\u003c/a\u003e\u003cbr\u003e\n今すぐにでも機械学習・ディープラーニングの勉強を始められるスライド１１：　\u003ca href=\"http://ur0.link/DyGH\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ur0.link/DyGH\u003c/a\u003e\u003cbr\u003e\n機械学習はじめの一歩に役立つ記事のまとめ：　\u003ca href=\"http://ur0.link/DyGX\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ur0.link/DyGX\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"単語メモ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%98%E8%AA%9E%E3%83%A1%E3%83%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e単語メモ\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eライブラリ・・・すでに使えるプログラムの部品をいっぱい集めたファイル\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003eライブラリ一覧\u003c/strong\u003e\u003cbr\u003e\n* tensorflow　: Googleが作ったニューラルネットワークの最新ライブラリ　計算をデータフローやグラフで表すことができる。ディープラーニングにも用いられている。\u003cbr\u003e\n* scikit-learn : 統計学・パターン認識・データ解析の技法が豊富に使うことができる。機械学習の基盤となっているライブラリ\u003cbr\u003e\n* Theano : 多次元配列を含んでいる数式を定めて最適化して使うことができる機械学習ライブラリ。チュートリアルが豊富\u003cbr\u003e\n* Pattern : 貴秋学習のアルゴリズムだけではなく、データを集めて、分析するのを援助するためのツールも提供している。GoogleやTwitterなどのWebサービスからデータを集めてくるときに役に立つ。\u003cbr\u003e\n* Caffe : 画像をはじめとする視覚的なものを機械学習するときに有用なライブラリ\u003cbr\u003e\n* NumPy : 数値計算を効率的に処理するためのライブラリ。配列の操作がとても簡単になるので行列計算には必須である。\u003cbr\u003e\n* SciPy : 様々な科学計算が実装されたライブラリであり内部でNumPyを利用している。\u003cbr\u003e\n* matplotib : グラフ描画のライブラリである内部でNumPyを利用している\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e開発環境作成するために必要なもの\u003c/strong\u003e\u003cbr\u003e\n* pyenv : Pythonのバージョン切り替えを管理できるコマンドラインツール\u003cbr\u003e\n* virtualenv : プロジェクトごとの仮想環境ツール\u003cbr\u003e\n* homebrew : OSX上で動くパッケージ管理システム→ターミナルから簡単にソフトウェアをインストールできるようにするもの\u003cbr\u003e\n* PyPI(pip) : Pythonのパッケージ管理ツール。ぱいぱいと呼ぶ必須ツールである。デフォルトでインストールされている。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"tensorflowとpython開発環境用作成の目処\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tensorflow%E3%81%A8python%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E7%94%A8%E4%BD%9C%E6%88%90%E3%81%AE%E7%9B%AE%E5%87%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTensorFlowとPython開発環境用作成の目処\u003c/h1\u003e\n\n\u003cp\u003e気持ちとしてはtensorflowを使っての開発を行いたいと思っているので\u003cbr\u003e\ntensorflowを使うためにはどのような開発環境を作って行く必要があるのか調べていく。\u003c/p\u003e\n\n\u003cp\u003epythonの環境構築からTensorFlowのインストール: \u003ca href=\"http://ur0.link/DyJe\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ur0.link/DyJe\u003c/a\u003e\u003cbr\u003e\n機械学習の初心者でもすぐに出来るTensorFlowのインストール方法: \u003ca href=\"http://ur0.link/DyK9\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ur0.link/DyK9\u003c/a\u003e\u003cbr\u003e\nPython3(Anaconda)でtensorFlow環境を構築して見る : \u003ca href=\"http://ur0.link/DySU\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ur0.link/DySU\u003c/a\u003e\u003cbr\u003e\nMacでPythonを使って「機械学習」を学ぶための環境構築　\u003ca href=\"http://ur0.link/DyT9\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://ur0.link/DyT9\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"次回への課題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AC%A1%E5%9B%9E%E3%81%B8%E3%81%AE%E8%AA%B2%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e次回への課題\u003c/h1\u003e\n\n\u003cp\u003e本日はスライド探しに力を注いだ。\u003cbr\u003e\n次回はスライドを実際に見て機械学習はどのように進めて行くのか or\u003cbr\u003e\n機械学習のための開発環境作成をやっていきたいと思っている。\u003c/p\u003e\n","body":"# 機械学習メモ\n大学の研究で機械学習をやりたいと思っているので\n機械学習について学んだことをメモしていきたいと思っています。\n\n**やろうと思っていることや意気込み** →ここは飛ばしておっけい。\n機械学習って何？？という初心者が\n機械学習でやりたいこと・できること・を学び\n開発環境の決定などを自分用のメモとして残しておきます。\n\n\n使われている機械学習の知識\n自動運転・レコメンド機能・言語ルールと組み合わせて言語理解・不正検知\n\n社会問題・ビジネス課題\n\nしたいこと\nたくさんのデータの中からもらって未来予測\n\nここでは例として株orFXを目的としてもいいのかもしれない。\n\n自分の行動を予測して\n何の日に何をすればいいか教えてくれる秘書システム\nコンシェルジュサービス\n\n# 本編\n**強化学習**\n成功報酬というものを与えて、プログラムがその高い報酬を手に入れるためにどのようにすればいいか工夫するもの\n\n**見ようと思っているスライドのまとめのまとめ**　→いつか必要なものだけをまとめておく。\n機械学習が素早く学べるコンテンツとライブラリ20選: http://ur0.link/DyG9\n今すぐにでも機械学習・ディープラーニングの勉強を始められるスライド１１：　http://ur0.link/DyGH\n機械学習はじめの一歩に役立つ記事のまとめ：　http://ur0.link/DyGX\n\n# 単語メモ\n* ライブラリ・・・すでに使えるプログラムの部品をいっぱい集めたファイル\n\n**ライブラリ一覧**\n* tensorflow　: Googleが作ったニューラルネットワークの最新ライブラリ　計算をデータフローやグラフで表すことができる。ディープラーニングにも用いられている。\n* scikit-learn : 統計学・パターン認識・データ解析の技法が豊富に使うことができる。機械学習の基盤となっているライブラリ\n* Theano : 多次元配列を含んでいる数式を定めて最適化して使うことができる機械学習ライブラリ。チュートリアルが豊富\n* Pattern : 貴秋学習のアルゴリズムだけではなく、データを集めて、分析するのを援助するためのツールも提供している。GoogleやTwitterなどのWebサービスからデータを集めてくるときに役に立つ。\n* Caffe : 画像をはじめとする視覚的なものを機械学習するときに有用なライブラリ\n* NumPy : 数値計算を効率的に処理するためのライブラリ。配列の操作がとても簡単になるので行列計算には必須である。\n* SciPy : 様々な科学計算が実装されたライブラリであり内部でNumPyを利用している。\n* matplotib : グラフ描画のライブラリである内部でNumPyを利用している\n\n**開発環境作成するために必要なもの**\n* pyenv : Pythonのバージョン切り替えを管理できるコマンドラインツール\n* virtualenv : プロジェクトごとの仮想環境ツール\n* homebrew : OSX上で動くパッケージ管理システム→ターミナルから簡単にソフトウェアをインストールできるようにするもの\n* PyPI(pip) : Pythonのパッケージ管理ツール。ぱいぱいと呼ぶ必須ツールである。デフォルトでインストールされている。\n\n\n# TensorFlowとPython開発環境用作成の目処\n気持ちとしてはtensorflowを使っての開発を行いたいと思っているので\ntensorflowを使うためにはどのような開発環境を作って行く必要があるのか調べていく。\n\npythonの環境構築からTensorFlowのインストール: http://ur0.link/DyJe\n機械学習の初心者でもすぐに出来るTensorFlowのインストール方法: http://ur0.link/DyK9\nPython3(Anaconda)でtensorFlow環境を構築して見る : http://ur0.link/DySU\nMacでPythonを使って「機械学習」を学ぶための環境構築　http://ur0.link/DyT9\n\n# 次回への課題\n本日はスライド探しに力を注いだ。\n次回はスライドを実際に見て機械学習はどのように進めて行くのか or\n機械学習のための開発環境作成をやっていきたいと思っている。\n","coediting":false,"created_at":"2017-05-17T18:16:11+09:00","group":null,"id":"2182e71afe225cd90a31","private":false,"tags":[{"name":"機械学習","versions":[]},{"name":"入門","versions":[]}],"title":"機械学習スライドまとめのまとめ","updated_at":"2017-05-17T18:16:11+09:00","url":"http://qiita.com/knight0503/items/2182e71afe225cd90a31","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":"itia1","id":"knight0503","items_count":1,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":181968,"profile_image_url":"https://avatars1.githubusercontent.com/u/14173875?v=3","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003eクエリのパフォーマンスチェックにMySQLの\u003ccode\u003eEXPLAIN\u003c/code\u003eを使っている方も多いと思います（私もその一人です）。\u003cbr\u003e\nRailsコードとMySQLの行き来が多く、時間がかかります。\u003cbr\u003e\nもっと、開発スピードもあげたいものです・・・！😩\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"今回使うテーブル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E4%BD%BF%E3%81%86%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回使うテーブル\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003ePostsテーブル\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e名前\u003c/th\u003e\n\u003cth\u003e型\u003c/th\u003e\n\u003cth\u003e制約\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eid\u003c/td\u003e\n\u003ctd\u003eAUTO INCREMENT\u003c/td\u003e\n\u003ctd\u003eNOT NULL ( ※ プライマリーキーなので、INDEXあり)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003etitle\u003c/td\u003e\n\u003ctd\u003eVARCHAR\u003c/td\u003e\n\u003ctd\u003e-\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003econtent\u003c/td\u003e\n\u003ctd\u003eTEXT\u003c/td\u003e\n\u003ctd\u003e-\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003euser_id\u003c/td\u003e\n\u003ctd\u003eINTEGER\u003c/td\u003e\n\u003ctd\u003eNOT NULL, INDEX\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"よくやる方法rails--mysql\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%88%E3%81%8F%E3%82%84%E3%82%8B%E6%96%B9%E6%B3%95rails--mysql\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eよくやる方法（Rails ←→ MySQL）\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eRailsで、該当のモデルで\u003ccode\u003e.to_sql\u003c/code\u003eし、SQLクエリを発行する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003euser_ids\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"no\"\u003ePosts\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003euser_id\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003euser_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_sql\u003c/span\u003e\n\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"no\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"sb\"\u003e`posts`\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n n-Operator\"\u003e*\u003c/span\u003e \u003cspan class=\"no\"\u003eFROM\u003c/span\u003e \u003cspan class=\"sb\"\u003e`posts`\u003c/span\u003e \u003cspan class=\"no\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"sb\"\u003e`posts`\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n n-Operator\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eperson_id\u003c/span\u003e\u003cspan class=\"sb\"\u003e` IN (1, 2, 3)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003eMySQLに何らかの方法でログインする\n\n\u003cul\u003e\n\u003cli\u003eご自由に！\n\n\u003cul\u003e\n\u003cli\u003eコンソール\u003c/li\u003e\n\u003cli\u003eGUI\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eクエリの先頭に\u003ccode\u003eEXPLAIN\u003c/code\u003eをつけて実行\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"sql\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003emysql\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003eEXPLAIN\u003c/span\u003e \u003cspan class=\"k\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eposts\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003eFROM\u003c/span\u003e \u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eposts\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e \u003cspan class=\"k\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eposts\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eperson_id\u003c/span\u003e\u003cspan class=\"o\"\u003e`\u003c/span\u003e \u003cspan class=\"k\"\u003eIN\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"c1\"\u003e----+-------------+-------------+------+--------------------------------+------+---------+------+------+-------------+\u003c/span\u003e\n\u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eselect_type\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003etable\u003c/span\u003e       \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003etype\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003epossible_keys\u003c/span\u003e                  \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003ekey\u003c/span\u003e  \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003ekey_len\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eref\u003c/span\u003e  \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003erows\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eExtra\u003c/span\u003e       \u003cspan class=\"o\"\u003e|\u003c/span\u003e\n\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"c1\"\u003e----+-------------+-------------+------+--------------------------------+------+---------+------+------+-------------+\u003c/span\u003e\n\u003cspan class=\"o\"\u003e|\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eSIMPLE\u003c/span\u003e      \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eposts\u003c/span\u003e       \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eALL\u003c/span\u003e  \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eindex_posts_on_user_id\u003c/span\u003e         \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eNULL\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eNULL\u003c/span\u003e    \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eNULL\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"mi\"\u003e1234\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003eUsing\u003c/span\u003e \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\n\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"c1\"\u003e----+-------------+-------------+------+--------------------------------+------+---------+------+------+-------------+\u003c/span\u003e\n\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"k\"\u003erow\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"k\"\u003eset\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e01\u003c/span\u003e \u003cspan class=\"n\"\u003esec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの結果を見て、チューニング。\u003cbr\u003e\nRailsコードとMySQLの行き来が発生します。\u003cbr\u003e\n非常に手間ですね😇\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"railsだけで完結させる方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rails%E3%81%A0%E3%81%91%E3%81%A7%E5%AE%8C%E7%B5%90%E3%81%95%E3%81%9B%E3%82%8B%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRailsだけで完結させる方法\u003c/h1\u003e\n\n\u003cp\u003eあまり知られていないようですが、Railsでは\u003cstrong\u003eMySQLのEXPLAINを実行する\u003ccode\u003e.explain\u003c/code\u003eメソッドを提供\u003c/strong\u003eしています。\u003cbr\u003e\n（私もおとといくらいにRailsのコードを読んでいて気づきました。）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eactiverecord/lib/active_record/connection_adapters/abstract_mysql_adapter\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# ActiveRecord::ConnectionAdapters::AbstractMysqlAdapter#explain\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# https://github.com/rails/rails/blob/8b69e32412cc2867b5fdd9a33cf4e4e759057e95/activerecord/lib/active_record/connection_adapters/abstract_mysql_adapter.rb#L178\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eexplain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebinds\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[]\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# クエリの先頭に「EXPLAIN」をつける\u003c/span\u003e\n  \u003cspan class=\"n\"\u003esql\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"EXPLAIN \u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003eto_sql\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebinds\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\n  \u003cspan class=\"n\"\u003estart\u003c/span\u003e   \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eTime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enow\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# クエリを実行する\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eresult\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eexec_query\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esql\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"EXPLAIN\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebinds\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eelapsed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eTime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enow\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003estart\u003c/span\u003e\n\n  \u003cspan class=\"no\"\u003eMySQL\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eExplainPrettyPrinter\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enew\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eelapsed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eRailsで、該当のモデルで\u003ccode\u003e.explain\u003c/code\u003eする\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003euser_ids\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"no\"\u003ePosts\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhere\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003euser_id\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003euser_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexplain\u003c/span\u003e\n\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"no\"\u003eEXPLAIN\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"sb\"\u003e`posts`\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n n-Operator\"\u003e*\u003c/span\u003e \u003cspan class=\"no\"\u003eFROM\u003c/span\u003e \u003cspan class=\"sb\"\u003e`posts`\u003c/span\u003e \u003cspan class=\"no\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"sb\"\u003e`posts`\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n n-Operator\"\u003e`\u003c/span\u003e\u003cspan class=\"n\"\u003eperson_id\u003c/span\u003e\u003cspan class=\"sb\"\u003e` IN (1, 2, 3)\u003c/span\u003e\n\u003cspan class=\"sb\"\u003e+----+-------------+-------------+------+--------------------------------+------+---------+------+------+-------------+\u003c/span\u003e\n\u003cspan class=\"sb\"\u003e| id | select_type | table       | type | possible_keys                  | key  | key_len | ref  | rows | Extra       |\u003c/span\u003e\n\u003cspan class=\"sb\"\u003e+----+-------------+-------------+------+--------------------------------+------+----!-----+------+------+-------------+\u003c/span\u003e\n\u003cspan class=\"sb\"\u003e|  1 | SIMPLE      | posts       | ALL  | index_posts_on_user_id         | NULL | NULL    | NULL | 1234 | Using where |\u003c/span\u003e\n\u003cspan class=\"sb\"\u003e+----+-------------+-------------+------+--------------------------------+------+---------+------+------+-------------+\u003c/span\u003e\n\u003cspan class=\"sb\"\u003e1 row in set (0.01 sec)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eexplain\u003c/code\u003eメソッドで返ってくる結果は、MySQLで表示されているものと同じなのです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"explainの読み方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#explain%E3%81%AE%E8%AA%AD%E3%81%BF%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEXPLAINの読み方\u003c/h1\u003e\n\n\u003cp\u003e読み方に関しては、Qiitaやブログでまとめられているので、あえて書きません。\u003cbr\u003e\nオススメは、下記のサイトがわかりやすいです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://nippondanji.blogspot.jp/2009/03/mysqlexplain.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMySQLのEXPLAINを徹底解説!!\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e参考にどうぞ！\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003e今までMySQLで確認していたことが、Rails内で完結できるって便利ですよね。\u003cbr\u003e\nこれで、パフォーマンスチューニングがはかどりそうです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"読んだコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AA%AD%E3%82%93%E3%81%A0%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e読んだコード\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/rails/rails/blob/8b69e32412cc2867b5fdd9a33cf4e4e759057e95/activerecord/lib/active_record/connection_adapters/abstract_mysql_adapter.rb#L178\" rel=\"nofollow noopener\" target=\"_blank\"\u003eActiveRecord::ConnectionAdapters::AbstractMysqlAdapter#explain\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":"クエリのパフォーマンスチェックにMySQLの`EXPLAIN`を使っている方も多いと思います（私もその一人です）。\nRailsコードとMySQLの行き来が多く、時間がかかります。\nもっと、開発スピードもあげたいものです・・・！😩\n\n# 今回使うテーブル\n- Postsテーブル\n\n|名前  |型  |制約  |\n|---|---|---|\n|id  | AUTO INCREMENT |NOT NULL ( ※ プライマリーキーなので、INDEXあり)  |\n|title  | VARCHAR  | -  |\n|content  | TEXT  | -  |\n|user_id  | INTEGER | NOT NULL, INDEX  |\n\n\n\n# よくやる方法（Rails ←→ MySQL）\n- Railsで、該当のモデルで`.to_sql`し、SQLクエリを発行する\n\n```rb\nuser_ids = [1, 2, 3]\nPosts.where(user_id: user_ids).to_sql\n\n=\u003e SELECT `posts`.* FROM `posts` WHERE `posts`.`person_id` IN (1, 2, 3)\n```\n- MySQLに何らかの方法でログインする\n   - ご自由に！\n     - コンソール\n     - GUI\n- クエリの先頭に`EXPLAIN`をつけて実行\n\n```sql\nmysql\u003e EXPLAIN SELECT `posts`.* FROM `posts` WHERE `posts`.`person_id` IN (1, 2, 3)\n\n+----+-------------+-------------+------+--------------------------------+------+---------+------+------+-------------+\n| id | select_type | table       | type | possible_keys                  | key  | key_len | ref  | rows | Extra       |\n+----+-------------+-------------+------+--------------------------------+------+---------+------+------+-------------+\n|  1 | SIMPLE      | posts       | ALL  | index_posts_on_user_id         | NULL | NULL    | NULL | 1234 | Using where |\n+----+-------------+-------------+------+--------------------------------+------+---------+------+------+-------------+\n1 row in set (0.01 sec)\n```\n\nこの結果を見て、チューニング。\nRailsコードとMySQLの行き来が発生します。\n非常に手間ですね😇\n\n# Railsだけで完結させる方法\nあまり知られていないようですが、Railsでは**MySQLのEXPLAINを実行する`.explain`メソッドを提供**しています。\n（私もおとといくらいにRailsのコードを読んでいて気づきました。）\n\n```rb:activerecord/lib/active_record/connection_adapters/abstract_mysql_adapter\n# ActiveRecord::ConnectionAdapters::AbstractMysqlAdapter#explain\n# https://github.com/rails/rails/blob/8b69e32412cc2867b5fdd9a33cf4e4e759057e95/activerecord/lib/active_record/connection_adapters/abstract_mysql_adapter.rb#L178\n\ndef explain(arel, binds = [])\n  # クエリの先頭に「EXPLAIN」をつける\n  sql     = \"EXPLAIN #{to_sql(arel, binds)}\"\n  start   = Time.now\n  # クエリを実行する\n  result  = exec_query(sql, \"EXPLAIN\", binds)\n  elapsed = Time.now - start\n\n  MySQL::ExplainPrettyPrinter.new.pp(result, elapsed)\nend\n```\n\nRailsで、該当のモデルで`.explain`する\n\n```rb\nuser_ids = [1, 2, 3]\nPosts.where(user_id: user_ids).explain\n\n=\u003e EXPLAIN for: SELECT `posts`.* FROM `posts` WHERE `posts`.`person_id` IN (1, 2, 3)\n+----+-------------+-------------+------+--------------------------------+------+---------+------+------+-------------+\n| id | select_type | table       | type | possible_keys                  | key  | key_len | ref  | rows | Extra       |\n+----+-------------+-------------+------+--------------------------------+------+----!-----+------+------+-------------+\n|  1 | SIMPLE      | posts       | ALL  | index_posts_on_user_id         | NULL | NULL    | NULL | 1234 | Using where |\n+----+-------------+-------------+------+--------------------------------+------+---------+------+------+-------------+\n1 row in set (0.01 sec)\n```\n\n`explain`メソッドで返ってくる結果は、MySQLで表示されているものと同じなのです。\n\n# EXPLAINの読み方\n読み方に関しては、Qiitaやブログでまとめられているので、あえて書きません。\nオススメは、下記のサイトがわかりやすいです。\n\n- [MySQLのEXPLAINを徹底解説!!](http://nippondanji.blogspot.jp/2009/03/mysqlexplain.html)\n\n参考にどうぞ！\n\n\n# まとめ\n今までMySQLで確認していたことが、Rails内で完結できるって便利ですよね。\nこれで、パフォーマンスチューニングがはかどりそうです。\n\n### 読んだコード\n\n- [ActiveRecord::ConnectionAdapters::AbstractMysqlAdapter#explain](https://github.com/rails/rails/blob/8b69e32412cc2867b5fdd9a33cf4e4e759057e95/activerecord/lib/active_record/connection_adapters/abstract_mysql_adapter.rb#L178)\n","coediting":false,"created_at":"2017-05-17T18:12:06+09:00","group":null,"id":"109bc81a225d04abec76","private":false,"tags":[{"name":"Rails","versions":[]},{"name":"MySQL","versions":[]},{"name":"ActiveRecord","versions":[]},{"name":"パフォーマンス","versions":[]}],"title":"そのクエリ、ちゃんとチューニングされてる？Railsで確認する方法","updated_at":"2017-05-17T18:12:06+09:00","url":"http://qiita.com/yn-misaki/items/109bc81a225d04abec76","user":{"description":"見習いRubyエンジニア。（元インフラ）エディタはVim派です。","facebook_id":"","followees_count":6,"followers_count":19,"github_login_name":"yn-misaki","id":"yn-misaki","items_count":17,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":49238,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/49238/profile-images/1473691654","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003e\u003ccode\u003e\u0026lt;iframe\u0026gt;\u003c/code\u003e の中で Twitter Bootstrap3 の Modal を表示する際、スクロールを考慮した位置に正しく表示しようと思い下記のように\u003ccode\u003e$(this)\u003c/code\u003eの\u003ccode\u003etop\u003c/code\u003eを変更したところ、iOS/Safari の環境でのみmodalの表示アニメーション完了と同時に画面が大きく下にスクロールしてしまい、Modalの表示位置もおかしくなる不具合が発生していました。\u003c/p\u003e\n\n\u003cp\u003e下記は現象発生時のjavascriptと（無理矢理）解決した方法です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"environment\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#environment\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEnvironment\u003c/h1\u003e\n\n\u003cp\u003eUserAgent: \u003ccode\u003eMozilla/5.0 (iPhone; CPU iPhone OS 10_2_1 like Mac OS X) AppleWebKit/602.4.6 (KHTML, like Gecko) Version/10.0 Mobile/14D27 Safari/602.1\u003c/code\u003e\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e発生環境\u003c/th\u003e\n\u003cth\u003e発生バージョン\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ebootstrap\u003c/td\u003e\n\u003ctd\u003e3.3.7\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eDevice\u003c/td\u003e\n\u003ctd\u003eiPhone7\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eiOS\u003c/td\u003e\n\u003ctd\u003e10.2.1\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"buggy\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#buggy\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBuggy\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'.hoge-button'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eclick\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epreventDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003e$modal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'#hogeModal'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'#hogeModal'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'show.bs.modal'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eiframe\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'iframe'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eiframe\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003erect\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eiframe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetBoundingClientRect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ecss\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'top'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003erect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etop\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//set modal position\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$modal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodal\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"solved\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#solved\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSolved\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'.hoge-button'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eclick\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epreventDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003e$modal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'#hogeModal'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003escrollPos\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003escrollX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ey\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003escrollY\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'#hogeModal'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'show.bs.modal'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eiframe\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'iframe'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eiframe\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003erect\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eiframe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetBoundingClientRect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ecss\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'top'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003erect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etop\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//set modal position\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'#hogeModal'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'shown.bs.modal'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003escrollTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003escrollPos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003escrollPos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// for iOS Safari Auto Scrolling bug\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003e$modal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodal\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"`\u003ciframe\u003e` の中で Twitter Bootstrap3 の Modal を表示する際、スクロールを考慮した位置に正しく表示しようと思い下記のように`$(this)`の`top`を変更したところ、iOS/Safari の環境でのみmodalの表示アニメーション完了と同時に画面が大きく下にスクロールしてしまい、Modalの表示位置もおかしくなる不具合が発生していました。\n\n下記は現象発生時のjavascriptと（無理矢理）解決した方法です。\n\n# Environment\n\nUserAgent: `Mozilla/5.0 (iPhone; CPU iPhone OS 10_2_1 like Mac OS X) AppleWebKit/602.4.6 (KHTML, like Gecko) Version/10.0 Mobile/14D27 Safari/602.1`\n\n| 発生環境 | 発生バージョン |\n| --- | --- |\n| bootstrap | 3.3.7 |\n| Device| iPhone7 |\n| iOS | 10.2.1 |\n\n# Buggy\n\n```javascript\n$('.hoge-button').click(function(e) {\n  e.preventDefault();\n  var $modal = $('#hogeModal');\n  $('#hogeModal').on('show.bs.modal', function (e) {\n    var iframe = window.top.document.querySelector('iframe');\n    if (iframe) {\n      var rect = iframe.getBoundingClientRect();\n      $(this).css('top', -rect.top); //set modal position\n    }\n  });\n  $modal.modal();\n});\n```\n\n# Solved\n\n```javascript\n$('.hoge-button').click(function(e) {\n  e.preventDefault();\n  var $modal = $('#hogeModal');\n  var scrollPos = {x: window.parent.scrollX, y: window.parent.scrollY};\n  $('#hogeModal').on('show.bs.modal', function (e) {\n    var iframe = window.top.document.querySelector('iframe');\n    if (iframe) {\n      var rect = iframe.getBoundingClientRect();\n      $(this).css('top', -rect.top); //set modal position\n    }\n  });\n  $('#hogeModal').on('shown.bs.modal', function (e) {\n    window.parent.scrollTo(scrollPos.x, scrollPos.y); // for iOS Safari Auto Scrolling bug\n  });\n  $modal.modal();\n});\n```\n","coediting":false,"created_at":"2017-05-17T17:58:43+09:00","group":null,"id":"52caa31f019f7995d157","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"iOS","versions":[]},{"name":"Safari","versions":[]},{"name":"Bootstrap3","versions":[]}],"title":"iOS/Safariでiframe内にBootstrap3のModalを表示する時のアレ","updated_at":"2017-05-17T17:58:43+09:00","url":"http://qiita.com/letsspeak/items/52caa31f019f7995d157","user":{"description":"","facebook_id":"","followees_count":6,"followers_count":14,"github_login_name":"letsspeak","id":"letsspeak","items_count":17,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":36244,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/36244/profile-images/1473687003","twitter_screen_name":"letsspeak","website_url":""}},{"rendered_body":"\n\u003ch3\u003e\n\u003cspan id=\"open-db-for-readwrite\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#open-db-for-readwrite\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eOpen DB For Read/Write\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003e$ sqlite3 myDatabase.sqlite\u003c/code\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"you-can-see-for-special-command-with-help\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#you-can-see-for-special-command-with-help\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eYou can see for special command with \u003ccode\u003e.help\u003c/code\u003e\n\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003esqlite\u0026gt; .help\u003c/code\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"create-table\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#create-table\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCreate Table\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003esqlite\u0026gt; CREATE TABLE tblGeneral ([general_no] INTEGER NOT NULL,\u003cbr\u003e\n[general_name] TEXT NOT NULL,PRIMARY KEY(general_no,general_name));\u003c/code\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"delete-data-from-table\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#delete-data-from-table\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDelete Data From Table\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003esqlite\u0026gt; delete from tblGeneral;\u003c/code\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"import-data-from-csv-to-table\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#import-data-from-csv-to-table\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eImport Data From CSV to Table\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003esqlite\u0026gt; .separator \",\" /* To separate column in table */\u003c/code\u003e\u003cbr\u003e\n\u003ccode\u003esqlite\u0026gt; .import tblGeneral.CSV tblGeneral\u003c/code\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"exit-db\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#exit-db\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eExit DB\u003c/h3\u003e\n\n\u003cp\u003eIf your process is finish need to exit that db\u003cbr\u003e\n\u003ccode\u003esqlite\u0026gt; .exit\u003c/code\u003e\u003c/p\u003e\n","body":"### Open DB For Read/Write \n`$ sqlite3 myDatabase.sqlite`\n\n### You can see for special command with `.help`\n`sqlite\u003e .help`\n\n### Create Table\n`sqlite\u003e CREATE TABLE tblGeneral ([general_no] INTEGER NOT NULL,\n[general_name] TEXT NOT NULL,PRIMARY KEY(general_no,general_name));`\n\n### Delete Data From Table\n`sqlite\u003e delete from tblGeneral;`\n\n### Import Data From CSV to Table\n`sqlite\u003e .separator \",\" /* To separate column in table */`\n`sqlite\u003e .import tblGeneral.CSV tblGeneral`\n\n### Exit DB\nIf your process is finish need to exit that db\n`sqlite\u003e .exit`\n","coediting":false,"created_at":"2017-05-17T17:55:20+09:00","group":null,"id":"cb9c9cff9dd5e9a27dec","private":false,"tags":[{"name":"sqlite","versions":[]}],"title":"Sqlite Command Note","updated_at":"2017-05-17T17:55:20+09:00","url":"http://qiita.com/nuthairoo/items/cb9c9cff9dd5e9a27dec","user":{"description":"","facebook_id":"","followees_count":1,"followers_count":2,"github_login_name":null,"id":"nuthairoo","items_count":2,"linkedin_id":"","location":"","name":"テーウー ヌ","organization":"","permanent_id":178655,"profile_image_url":"https://lh4.googleusercontent.com/-np4lQGvK-pk/AAAAAAAAAAI/AAAAAAAAAIQ/JMq7jbzFOio/photo.jpg?sz=50","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"前回の要約\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E5%9B%9E%E3%81%AE%E8%A6%81%E7%B4%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前回の要約\u003c/h1\u003e\n\n\u003cp\u003e前回の記事はひと月近く前なので要約から始める。長いしね。\u003c/p\u003e\n\n\u003cp\u003eまず現状のウェブの条件としてこんなのがある。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eサーバー側は低コスト、ユーザー側はそれなりの高コストで処理するべき。従って処理はできる限りクライアントサイドでやるべき。\u003c/li\u003e\n\u003cli\u003eアクセスは検索エンジンから。クローラに理解させないといけない。\u003c/li\u003e\n\u003cli\u003eセキュリティ重要。\u003c/li\u003e\n\u003cli\u003eデザイナとプログラマは分けないとね。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e現状はAJAXも静的サイトも動的サイトも問題含みだからいかんね。\u003cbr\u003e\nだからXMLサーバーとか良いんじゃない、という話だった。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"忘れていた事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%98%E3%82%8C%E3%81%A6%E3%81%84%E3%81%9F%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e忘れていた事\u003c/h1\u003e\n\n\u003cp\u003e前回書き忘れていた。意識はしていた気がするんだけど。\u003cbr\u003e\nというわけで条件に以下を追加。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eファイルアクセスの粒度はできるだけ大きい方がいい。\n\n\u003col\u003e\n\u003cli\u003eハードディスクはランダムアクセスが苦手。\u003c/li\u003e\n\u003cli\u003eSSDは高い。使いたくない。\u003c/li\u003e\n\u003cli\u003eネットの速度はかなり速くなった。スマホで動画とか見る。\u003c/li\u003e\n\u003cli\u003e現在のウェブサイトは一ページ数MBとか。\u003c/li\u003e\n\u003cli\u003e大抵のサイトのユーザーデータは一人で1MBもない。\n\n\u003col\u003e\n\u003cli\u003eEvernoteとかメールとかはその限りではないけどね。それでも一画面の一覧は1MB以下程度だろう。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e粒度を細かくする為に色々するのは手間でバグの温床。統一的な取り扱いもしにくい。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e前回のXMLサーバーはそういう点でもメリットがある。\u003c/p\u003e\n\n\u003cp\u003e今回以降は、非現実的だけど新しく設計するとしたら、という提案を行おうと思う。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"htmlcssはui構築言語ではない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#htmlcss%E3%81%AFui%E6%A7%8B%E7%AF%89%E8%A8%80%E8%AA%9E%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHTML+CSSはUI構築言語ではない\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"要約\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A6%81%E7%B4%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e要約\u003c/h2\u003e\n\n\u003cp\u003eHTMLは意味論が混ざってレイアウトもしづらいゴミ。\u003cbr\u003e\nだから、CSS的なものが混ざった新レイアウト言語を作るべきじゃない。XAMLみたいな。\u003cbr\u003e\nHTMLは意味論だけやってもらって、やりやすいようにサブセットのプロファイルを用意すればいいんじゃないか。\u003cbr\u003e\nHTMLはレイアウト言語に変換するイメージならレイアウトも直感的でわかりやすいよね。\u003c/p\u003e\n\n\u003cp\u003e以下本文です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"本文\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E6%96%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本文\u003c/h2\u003e\n\n\u003cp\u003eHTMLの大きな不満点はレイアウトがめんどくさいってのがあるだろう。\u003cbr\u003e\n特にXAMLなんかを使っていると、HTMLなんか欠陥言語だと思いたくなる。\u003cbr\u003e\nそもそもHTMLはリフロードキュメントを定義する意味論を持つ言語だ。にもかかわらず現在はたいていUIの構築に使っている。\u003c/p\u003e\n\n\u003cp\u003e具体的な問題はこんなのだ。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eレイアウト周りの機能が少ない。MVVMもない。UI構築には不要な意味論が付与されてる。\n\n\u003col\u003e\n\u003cli\u003eXAMLやAndroidのXMLに比べるといろいろと欠けてる。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eレイアウトを定義するにはCSSを知らないといけない。\u003c/li\u003e\n\u003cli\u003eCSSはデザインしにくい。結果が分かり辛い。難しい。\n\n\u003col\u003e\n\u003cli\u003eしかもなぜかXMLではない。覚える事が増えるし補助機能も作りづらい。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eCSSだけではデザインできない。HTMLを変えないとできないレイアウトがある。\u003c/li\u003e\n\u003cli\u003eドキュメントを定義するという点ではHTMLは高機能すぎる。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"解決策\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決策\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"新しいレイアウト定義言語\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B0%E3%81%97%E3%81%84%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E5%AE%9A%E7%BE%A9%E8%A8%80%E8%AA%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e新しいレイアウト定義言語\u003c/h3\u003e\n\n\u003cp\u003eUI構築用のレイアウト定義言語を新たに作るというのが私の解決策だ。\u003cbr\u003e\nXAMLみたいなのが良い。\u003cbr\u003e\n強力なレイアウト機構を持ち、意味論は存在せず、デザインも一貫してできる。\u003c/p\u003e\n\n\u003cp\u003eそしてHTMLのような意味論用の言語はドキュメントの意味を示す役割に徹底してもらう。\u003cbr\u003e\n結果的にデザインはHTMLからこの新言語に変換する形で行う事になる。\u003cbr\u003e\nそれはXSLTのようなものでもいいし、JavaScriptとかC#的な言語でもいいし、CSSの延長でもいい。\u003cbr\u003e\nめんどくさい人は意味論なしでこの新言語で書くことになるだろう。\u003cbr\u003e\nそれはパーサーにはあまり理解されないがドキュメントではないから仕方ないし、現状程度の理解はできるだろう。\u003c/p\u003e\n\n\u003cp\u003eイメージで言うと、セマンティックなHTML→XSLTとか→レイアウト用言語って事。\u003cbr\u003e\n追記：その前段に、用途に応じたXML→XSLTとか→HTML、という形も積極的に取り入れるべきだ。現状でもあるけどレイアウトを考えなくていい分やりやすくなるだろう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"htmlのサブセット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#html%E3%81%AE%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHTMLのサブセット\u003c/h3\u003e\n\n\u003cp\u003eHTMLは意味を持つドキュメントを担当する。\u003cbr\u003e\nその意味で現状のHTMLは高機能すぎる。\u003cbr\u003e\nそれはHTMLをUI構築言語として使い、なんでもかんでも詰め込んだからだ。\u003cbr\u003e\n現実の大抵のドキュメントには機能過剰だし、一方でMS Wordとかと比べ欠けている基本機能もある。\u003c/p\u003e\n\n\u003cp\u003eMarkdownのような軽量マークアップ言語が必要なのはそういう経緯だ。\u003cbr\u003e\n具体的には以下のような問題への対処だ。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eHTMLは高機能すぎて統一的な取り扱いがしづらい。\n\n\u003col\u003e\n\u003cli\u003eレイアウトが崩れる。\u003c/li\u003e\n\u003cli\u003eCSSで十分定義していないタグが書けてしまう。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eそのままテキストとして埋め込むと権限外の事が出来てしまう。サニタイズ必須。\u003c/li\u003e\n\u003cli\u003eレイアウトだけが必要な場合、意味論だけが必要な場合がある。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e別にMarkdownは難しくはないし便利なんだが、なんで一々別の記法を覚えないといけないのか。ばかばかしい話だ。\u003cbr\u003e\nコードを書くのも、統一的に扱えないのも、方言があるのもバカバカしい。\u003c/p\u003e\n\n\u003cp\u003e私が提唱するのはHTMLのサブセットを作る事だ。\u003cbr\u003e\n具体的にはいくつかの定義済みプロファイルや自由な定義で利用可能なタグを限定する事だ。\u003cbr\u003e\n例えば、markdownと同等のタグを定義すれば、それをmarkdown代わりに使える。\u003cbr\u003e\nあるいは、レイアウト周りのタグのみを定義すれば意味の不在を強調できる(ワードパッドのイメージ)。\u003cbr\u003e\nCSS的な物を使うにしてもフルで定義が出来ている事を担保できる。PDFとかへの変換もしやすい。\u003c/p\u003e\n\n\u003cp\u003eしかしサニタイズの問題はXMLでやる以上難しい。\u003cbr\u003e\n解決策の一つは上に挙げたレイアウト言語のレイヤーで取り扱うという事だろう。\u003cbr\u003e\nあるいはより扱いやすい、レイアウトの適用を外部からできたりするインラインフレームとかだろうか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"次回\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AC%A1%E5%9B%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e次回\u003c/h1\u003e\n\n\u003cp\u003e長くなったので続きは次回。\u003c/p\u003e\n\n\u003cp\u003e次回以降はこんなことを言うと思う。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e一々サーバーサイドで処理をするんじゃなくて、サイトアクセス時にレイアウトやリソース・ロジック・ユーザーデータを一括でダウンロードしてサイト滞在中はローカルで処理するべき。\n\n\u003col\u003e\n\u003cli\u003eファイルアクセスの粒度が大きくなって、サーバーの処理は単純になって、キャッシュも分かりやすい。いいことづくめだよね。\u003c/li\u003e\n\u003cli\u003eAJAXも似たような事がしたかったんだろうけど惜しかったよね。ブラウザバック周りとか。\u003c/li\u003e\n\u003cli\u003eそれってモバイルアプリじゃないの？でも確かに規格を統一して軽くアクセスできれば便利かな。\u003c/li\u003e\n\u003cli\u003eついでにデータをローカルやサードパーティークラウドで保存できるようにすれば信頼できる。でもますますアプリだね。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eJavaScriptやめろ。\n\n\u003col\u003e\n\u003cli\u003eみんな知ってる事だから一応触れておく。\u003c/li\u003e\n\u003cli\u003eでも、あんまり経験ないから大した事言えないんだよね。\u003c/li\u003e\n\u003cli\u003eC#最高。\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e自然言語レベルの事を機械可読にできないだろうか。\n\n\u003col\u003e\n\u003cli\u003eなぜWebはCyc(知識ベース)的な方向に進まず、自然言語のごみを量産する方向に進んでしまったのか。\u003c/li\u003e\n\u003cli\u003e辞書の全単語に番号を振って、自然言語の構造をXMLか何かに起こせば便利だよね。絶対やりたくないけど。\u003c/li\u003e\n\u003cli\u003eそうすれば多言語対応が簡単、中間表現からドキュメント作成とコード作成が同時にできて業務改善、無理やり解析するAIどころではない頭の良さ、翻訳システムの中間表現に手を入れて品質向上。素晴らしすぎる。\u003c/li\u003e\n\u003cli\u003e入力は大変だろうから自然言語で入力して意味を尋ねられる形になるのかな？\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eこの要約だけでも割と十分だから一々書かないかも。\u003c/p\u003e\n","body":"# 前回の要約\n前回の記事はひと月近く前なので要約から始める。長いしね。\n\nまず現状のウェブの条件としてこんなのがある。\n\n1. サーバー側は低コスト、ユーザー側はそれなりの高コストで処理するべき。従って処理はできる限りクライアントサイドでやるべき。\n2. アクセスは検索エンジンから。クローラに理解させないといけない。\n3. セキュリティ重要。\n4. デザイナとプログラマは分けないとね。\n\n現状はAJAXも静的サイトも動的サイトも問題含みだからいかんね。\nだからXMLサーバーとか良いんじゃない、という話だった。\n\n# 忘れていた事\n前回書き忘れていた。意識はしていた気がするんだけど。\nというわけで条件に以下を追加。\n\n5. ファイルアクセスの粒度はできるだけ大きい方がいい。\n    1. ハードディスクはランダムアクセスが苦手。\n    2. SSDは高い。使いたくない。\n    3. ネットの速度はかなり速くなった。スマホで動画とか見る。\n    4. 現在のウェブサイトは一ページ数MBとか。\n    5. 大抵のサイトのユーザーデータは一人で1MBもない。\n        1. Evernoteとかメールとかはその限りではないけどね。それでも一画面の一覧は1MB以下程度だろう。\n    6. 粒度を細かくする為に色々するのは手間でバグの温床。統一的な取り扱いもしにくい。\n\n前回のXMLサーバーはそういう点でもメリットがある。\n\n今回以降は、非現実的だけど新しく設計するとしたら、という提案を行おうと思う。\n\n# HTML+CSSはUI構築言語ではない\n## 要約\nHTMLは意味論が混ざってレイアウトもしづらいゴミ。\nだから、CSS的なものが混ざった新レイアウト言語を作るべきじゃない。XAMLみたいな。\nHTMLは意味論だけやってもらって、やりやすいようにサブセットのプロファイルを用意すればいいんじゃないか。\nHTMLはレイアウト言語に変換するイメージならレイアウトも直感的でわかりやすいよね。\n\n以下本文です。\n## 本文\nHTMLの大きな不満点はレイアウトがめんどくさいってのがあるだろう。\n特にXAMLなんかを使っていると、HTMLなんか欠陥言語だと思いたくなる。\nそもそもHTMLはリフロードキュメントを定義する意味論を持つ言語だ。にもかかわらず現在はたいていUIの構築に使っている。\n\n具体的な問題はこんなのだ。\n\n1. レイアウト周りの機能が少ない。MVVMもない。UI構築には不要な意味論が付与されてる。\n    1. XAMLやAndroidのXMLに比べるといろいろと欠けてる。\n2. レイアウトを定義するにはCSSを知らないといけない。\n3. CSSはデザインしにくい。結果が分かり辛い。難しい。\n    1. しかもなぜかXMLではない。覚える事が増えるし補助機能も作りづらい。\n4. CSSだけではデザインできない。HTMLを変えないとできないレイアウトがある。\n5. ドキュメントを定義するという点ではHTMLは高機能すぎる。\n\n## 解決策\n### 新しいレイアウト定義言語\nUI構築用のレイアウト定義言語を新たに作るというのが私の解決策だ。\nXAMLみたいなのが良い。\n強力なレイアウト機構を持ち、意味論は存在せず、デザインも一貫してできる。\n\nそしてHTMLのような意味論用の言語はドキュメントの意味を示す役割に徹底してもらう。\n結果的にデザインはHTMLからこの新言語に変換する形で行う事になる。\nそれはXSLTのようなものでもいいし、JavaScriptとかC#的な言語でもいいし、CSSの延長でもいい。\nめんどくさい人は意味論なしでこの新言語で書くことになるだろう。\nそれはパーサーにはあまり理解されないがドキュメントではないから仕方ないし、現状程度の理解はできるだろう。\n\nイメージで言うと、セマンティックなHTML→XSLTとか→レイアウト用言語って事。\n追記：その前段に、用途に応じたXML→XSLTとか→HTML、という形も積極的に取り入れるべきだ。現状でもあるけどレイアウトを考えなくていい分やりやすくなるだろう。\n### HTMLのサブセット\nHTMLは意味を持つドキュメントを担当する。\nその意味で現状のHTMLは高機能すぎる。\nそれはHTMLをUI構築言語として使い、なんでもかんでも詰め込んだからだ。\n現実の大抵のドキュメントには機能過剰だし、一方でMS Wordとかと比べ欠けている基本機能もある。\n\nMarkdownのような軽量マークアップ言語が必要なのはそういう経緯だ。\n具体的には以下のような問題への対処だ。\n\n1. HTMLは高機能すぎて統一的な取り扱いがしづらい。\n    1. レイアウトが崩れる。\n    2. CSSで十分定義していないタグが書けてしまう。\n2. そのままテキストとして埋め込むと権限外の事が出来てしまう。サニタイズ必須。\n3. レイアウトだけが必要な場合、意味論だけが必要な場合がある。\n\n別にMarkdownは難しくはないし便利なんだが、なんで一々別の記法を覚えないといけないのか。ばかばかしい話だ。\nコードを書くのも、統一的に扱えないのも、方言があるのもバカバカしい。\n\n私が提唱するのはHTMLのサブセットを作る事だ。\n具体的にはいくつかの定義済みプロファイルや自由な定義で利用可能なタグを限定する事だ。\n例えば、markdownと同等のタグを定義すれば、それをmarkdown代わりに使える。\nあるいは、レイアウト周りのタグのみを定義すれば意味の不在を強調できる(ワードパッドのイメージ)。\nCSS的な物を使うにしてもフルで定義が出来ている事を担保できる。PDFとかへの変換もしやすい。\n\nしかしサニタイズの問題はXMLでやる以上難しい。\n解決策の一つは上に挙げたレイアウト言語のレイヤーで取り扱うという事だろう。\nあるいはより扱いやすい、レイアウトの適用を外部からできたりするインラインフレームとかだろうか。\n\n#次回\n長くなったので続きは次回。\n\n次回以降はこんなことを言うと思う。\n\n1. 一々サーバーサイドで処理をするんじゃなくて、サイトアクセス時にレイアウトやリソース・ロジック・ユーザーデータを一括でダウンロードしてサイト滞在中はローカルで処理するべき。\n    1. ファイルアクセスの粒度が大きくなって、サーバーの処理は単純になって、キャッシュも分かりやすい。いいことづくめだよね。\n    2. AJAXも似たような事がしたかったんだろうけど惜しかったよね。ブラウザバック周りとか。\n    3. それってモバイルアプリじゃないの？でも確かに規格を統一して軽くアクセスできれば便利かな。\n    4. ついでにデータをローカルやサードパーティークラウドで保存できるようにすれば信頼できる。でもますますアプリだね。\n2. JavaScriptやめろ。\n    1. みんな知ってる事だから一応触れておく。\n    2. でも、あんまり経験ないから大した事言えないんだよね。\n    3. C#最高。\n3. 自然言語レベルの事を機械可読にできないだろうか。\n    1. なぜWebはCyc(知識ベース)的な方向に進まず、自然言語のごみを量産する方向に進んでしまったのか。\n    2. 辞書の全単語に番号を振って、自然言語の構造をXMLか何かに起こせば便利だよね。絶対やりたくないけど。\n    3. そうすれば多言語対応が簡単、中間表現からドキュメント作成とコード作成が同時にできて業務改善、無理やり解析するAIどころではない頭の良さ、翻訳システムの中間表現に手を入れて品質向上。素晴らしすぎる。\n    4. 入力は大変だろうから自然言語で入力して意味を尋ねられる形になるのかな？\n\nこの要約だけでも割と十分だから一々書かないかも。\n","coediting":false,"created_at":"2017-05-17T17:53:05+09:00","group":null,"id":"9578e6f707222d5a2438","private":false,"tags":[{"name":"Web","versions":[]},{"name":"日記","versions":[]}],"title":"Webの気にくわない所 その2","updated_at":"2017-05-17T20:40:33+09:00","url":"http://qiita.com/kurema/items/9578e6f707222d5a2438","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":"kurema","id":"kurema","items_count":2,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":146467,"profile_image_url":"https://avatars.githubusercontent.com/u/10556974?v=3","twitter_screen_name":"kurema_makoto","website_url":""}},{"rendered_body":"\u003cp\u003e最近FCMを利用したWebPush通知を実装する機会があったため、\u003cbr\u003e\nその備忘録として簡単にまとめておきます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"webpushについて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#webpush%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWebPushについて\u003c/h1\u003e\n\n\u003cp\u003eFacebookやGmail、SlackやChatworkなどを利用されているとブラウザの画面右上に飛んでくる通知。\u003cbr\u003e\n（※ 画像はサンプルで開発したWebPush通知のスクショです）\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/17346/261d2f2d-6907-ea64-2f9e-c46ecd21845d.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/17346/261d2f2d-6907-ea64-2f9e-c46ecd21845d.png\" alt=\"FCMを利用したWebPush.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれをFCMを利用して実装してみました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"fcmとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#fcm%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFCMとは\u003c/h1\u003e\n\n\u003cp\u003eFCMとは、Firebase Cloud Messagingの略で、\u003cbr\u003e\nW3CをIETFで標準化が進むWebPushをFCMを利用して通知を送信できるようになりました。\u003c/p\u003e\n\n\u003cp\u003eこれまでは、Firefoxでは事前のキーやIDが必要なくWebPushを送信出来ていましたが、\u003cbr\u003e\nGoogleChromeではAndroidのアプリケーションと同様に\u003cbr\u003e\nGoogleCloudMessaging（GCM）の登録やキーとIDの取得が必要な状態でした。\u003c/p\u003e\n\n\u003cp\u003eFCMでは、VAPIDによる認証を利用することで、\u003cbr\u003e\nGCMのような登録を不要としたWebPushを実現することが可能になっています。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"webpushの流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#webpush%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWebPushの流れ\u003c/h1\u003e\n\n\u003cp\u003ePush送信までの流れを簡単に説明すると\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eアプリケーションサーバで鍵を生成する\u003c/li\u003e\n\u003cli\u003eブラウザは、アプリケーションサーバから公開鍵を受け取る\u003c/li\u003e\n\u003cli\u003eブラウザは、取得した公開鍵を利用して、プッシュサーバにプッシュ通知の購読を登録する\u003c/li\u003e\n\u003cli\u003eアプリケーションサーバから、プッシュサーバに対して通知を送信する\n\n\u003cul\u003e\n\u003cli\u003eこの際にブラウザ側で取得したEndpointや認証情報は、アプリケーションサーバに渡しておく\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eプッシュサーバから対象のブラウザに対して通知を送信する\u003c/li\u003e\n\u003cli\u003eブラウザは、ServiceWorkerでpushイベントを購読し、受信すれば何かしらの動作を行う\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e詳細については下記記事が分かりやすくまとまっていました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://firebase.google.com/docs/cloud-messaging/server\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGCMの登録が不要になったChromeのWeb Pushを試してみる\n\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"プログラム\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプログラム\u003c/h1\u003e\n\n\u003cp\u003eNode.js ver7.6.0を利用して実装してみました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"認証鍵の生成と交換アプリケーションサーバ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AA%8D%E8%A8%BC%E9%8D%B5%E3%81%AE%E7%94%9F%E6%88%90%E3%81%A8%E4%BA%A4%E6%8F%9B%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B5%E3%83%BC%E3%83%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e認証鍵の生成と交換（アプリケーションサーバ）\u003c/h2\u003e\n\n\u003cp\u003e下記のようにアプリケーションサーバ側で鍵を生成し、\u003cbr\u003e\nブラウザからAPIが呼ばれたときに公開鍵を返すようにしています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNode.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ewebpush\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'web-push'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003evapidKeys\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ewebpush\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egenerateVAPIDKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/getpush'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003epublicKey\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003evapidKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epublicKey\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プッシュ通知購読処理ブラウザ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%83%E3%82%B7%E3%83%A5%E9%80%9A%E7%9F%A5%E8%B3%BC%E8%AA%AD%E5%87%A6%E7%90%86%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプッシュ通知購読処理（ブラウザ）\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ewebpush.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"cm\"\u003e/**\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * npm web-push パッケージ サイトを参考\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e *    https://www.npmjs.com/package/web-push\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eurlBase64ToUint8Array\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebase64String\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epadding\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'='\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erepeat\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003ebase64String\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ebase64\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebase64String\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003epadding\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\\-/g\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'+'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/_/g\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'/'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003erawData\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eatob\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebase64\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eoutputArray\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eUint8Array\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erawData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003erawData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eoutputArray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erawData\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003echarCodeAt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eoutputArray\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * serviceWorkerからSubscriptionを取得する\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003easync\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003egetsubscription\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ereg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003enavigator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eserviceWorker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eready\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003esub\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003ereg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epushManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetSubscription\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * Subscriptionを取得するためにサーバ側で生成された\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * WebPush送信のための公開鍵をAPI経由で取得する\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003easync\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003egetPublicKey\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'getpush'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"nx\"\u003emethod\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'GET'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"nx\"\u003eheaders\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s1\"\u003e'Content-Type'\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'application/json'\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                  \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'APIのレスポンス'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epublicKey\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epublicKey\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * サーバから取得した公開鍵を元に\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * ServiceWorkerからSubscriptionを取得する\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003easync\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eoption\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ereg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003enavigator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eserviceWorker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eready\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003esub\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003ereg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epushManager\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eoption\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * サーバから公開鍵を取得し、\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * ServiceWorkerからSubscriptionを取得する\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003cspan class=\"nx\"\u003easync\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003einitSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003evapidPublicKey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003egetPublicKey\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eoption\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003euserVisibleOnly\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eapplicationServerKey\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eurlBase64ToUint8Array\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evapidPublicKey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eoption\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * ページの読み込みが完了すれば、\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e * WebPushを受け取るための準備を行う\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'load'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003enavigator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eserviceWorker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eregister\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'./serviceworker.js'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003esub\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003egetsubscription\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ブラウザに通知許可を要求する\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003epermission\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003eNotification\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erequestPermission\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eNotification\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'WebPushの設定をしました'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epermission\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"s1\"\u003e'denied'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'ブラウザの通知設定をONにしてください'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003esub\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003einitSubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"push送信処理アプリケーションサーバ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#push%E9%80%81%E4%BF%A1%E5%87%A6%E7%90%86%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B5%E3%83%BC%E3%83%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePush送信処理（アプリケーションサーバ）\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNode.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'/send/webpush'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// ブラウザ側でプッシュサーバから取得した、Endpointとp256dh、authの認証情報をセットする\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003epushSubscription\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ekeys\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003ep256dh\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ep256dh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003eauth\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eauth\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// 送信するメッセージは、Json形式で送る必要がある\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estringify\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eicon\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eicon\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elink\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elink\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eTTL\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003evapidDetails\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003esubject\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elink\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// 先ほど生成したVAPIDの鍵情報をセットする\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003epublicKey\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003evapidKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epublicKey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eprivateKey\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003evapidKeys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprivateKey\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// npmのweb-pushライブラリを利用して、通知を送信する\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ewebpush\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esendNotification\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epushSubscription\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003estatusCode\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estatusCode\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// 通知送信時にフォーマットエラーや必須パラメータの欠如、送信先が不明な場合などにエラーを検知する\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003estatusCode\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estatusCode\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"s1\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"通知受信設定ブラウザ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%80%9A%E7%9F%A5%E5%8F%97%E4%BF%A1%E8%A8%AD%E5%AE%9A%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e通知受信設定（ブラウザ）\u003c/h2\u003e\n\n\u003cp\u003eServiceWorkerを利用して、通知イベントを検知したときの処理を記載しておきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eserviceworker.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ブラウザに対して通知イベントを検知した際に実行される処理を定義\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'push'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003etitle\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eicon\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eicon\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003elink_to\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elink\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewaitUntil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eregistration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eshowNotification\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 通知バーがクリックされた際に実行される処理を定義\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'notificationclick'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enotification\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewaitUntil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eclients\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eopenWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enotification\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elink_to\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h1\u003e\n\n\u003cp\u003eGithubにFCMを利用したWebPushのサンプルプログラムをアップしておりますので、試してみたい方は是非どうぞ。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eFCMWebPush サンプルプログラム: \n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/megadreams14/FCMWebPush\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/megadreams14/FCMWebPush\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://firebase.google.com/docs/cloud-messaging/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFirebase Cloud Messaging\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/tomoyukilabs/items/9346eb44b5a48b294762\" id=\"reference-c51df33426b055e68343\"\u003eGCMの登録が不要になったChromeのWeb Pushを試してみる\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/tomoyukilabs/items/217915676603fda73b0a\" id=\"reference-46364ea0321e59108aa0\"\u003eWeb Pushでブラウザにプッシュ通知を送ってみる\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.ipentec.com/document/document.aspx?page=software-google-chrome-send-push-messaging-and-notification-using-firebase\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFirebase (FCM)を利用して Google Chrome にプッシュ通知を送信する\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":"最近FCMを利用したWebPush通知を実装する機会があったため、\nその備忘録として簡単にまとめておきます。\n\n# WebPushについて\n\nFacebookやGmail、SlackやChatworkなどを利用されているとブラウザの画面右上に飛んでくる通知。\n（※ 画像はサンプルで開発したWebPush通知のスクショです）\n\n![FCMを利用したWebPush.png](https://qiita-image-store.s3.amazonaws.com/0/17346/261d2f2d-6907-ea64-2f9e-c46ecd21845d.png)\n\nこれをFCMを利用して実装してみました。\n\n# FCMとは\n\nFCMとは、Firebase Cloud Messagingの略で、\nW3CをIETFで標準化が進むWebPushをFCMを利用して通知を送信できるようになりました。\n\nこれまでは、Firefoxでは事前のキーやIDが必要なくWebPushを送信出来ていましたが、\nGoogleChromeではAndroidのアプリケーションと同様に\nGoogleCloudMessaging（GCM）の登録やキーとIDの取得が必要な状態でした。\n\nFCMでは、VAPIDによる認証を利用することで、\nGCMのような登録を不要としたWebPushを実現することが可能になっています。\n\n# WebPushの流れ\n\nPush送信までの流れを簡単に説明すると\n\n1. アプリケーションサーバで鍵を生成する\n2. ブラウザは、アプリケーションサーバから公開鍵を受け取る\n3. ブラウザは、取得した公開鍵を利用して、プッシュサーバにプッシュ通知の購読を登録する\n4. アプリケーションサーバから、プッシュサーバに対して通知を送信する\n   - この際にブラウザ側で取得したEndpointや認証情報は、アプリケーションサーバに渡しておく\n5. プッシュサーバから対象のブラウザに対して通知を送信する\n6. ブラウザは、ServiceWorkerでpushイベントを購読し、受信すれば何かしらの動作を行う\n\n\n詳細については下記記事が分かりやすくまとまっていました。\n\n- [GCMの登録が不要になったChromeのWeb Pushを試してみる\n](https://firebase.google.com/docs/cloud-messaging/server)\n\n# プログラム\n\nNode.js ver7.6.0を利用して実装してみました。\n\n## 認証鍵の生成と交換（アプリケーションサーバ）\n下記のようにアプリケーションサーバ側で鍵を生成し、\nブラウザからAPIが呼ばれたときに公開鍵を返すようにしています。\n\n```Node.js\nconst webpush = require('web-push');\nconst vapidKeys = webpush.generateVAPIDKeys();\n\napp.get('/getpush', (req, res) =\u003e {\n  return res.json({\n    publicKey: vapidKeys.publicKey\n  });\n});\n```\n\n## プッシュ通知購読処理（ブラウザ）\n\n```webpush.js\n/**\n * npm web-push パッケージ サイトを参考\n *    https://www.npmjs.com/package/web-push\n */\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i \u003c rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\n\n/**\n * serviceWorkerからSubscriptionを取得する\n */\nasync function getsubscription() {\n  var reg = await navigator.serviceWorker.ready;\n  var sub = await reg.pushManager.getSubscription();\n  return sub;\n}\n\n/**\n * Subscriptionを取得するためにサーバ側で生成された\n * WebPush送信のための公開鍵をAPI経由で取得する\n */\nasync function getPublicKey() {\n  var res = await fetch('getpush', {\n                    method: 'GET',\n                    headers: { 'Content-Type': 'application/json' }\n                  }).then((res) =\u003e res.json());\n  console.log('APIのレスポンス');\n  console.log(res.publicKey);\n  return res.publicKey;\n}\n\n/**\n * サーバから取得した公開鍵を元に\n * ServiceWorkerからSubscriptionを取得する\n */\nasync function subscribe(option) {\n  var reg = await navigator.serviceWorker.ready;\n  var sub = await reg.pushManager.subscribe(option);\n  return sub;\n}\n\n/**\n * サーバから公開鍵を取得し、\n * ServiceWorkerからSubscriptionを取得する\n */\nasync function initSubscribe() {\n  var vapidPublicKey = await getPublicKey();\n  let option = {\n    userVisibleOnly: true,\n    applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)\n  }\n  return await subscribe(option);\n}\n\n/**\n * ページの読み込みが完了すれば、\n * WebPushを受け取るための準備を行う\n */\nwindow.addEventListener('load', async () =\u003e {\n  navigator.serviceWorker.register('./serviceworker.js');\n  var sub = await getsubscription();\n  if (!sub) {\n    // ブラウザに通知許可を要求する\n    var permission = await Notification.requestPermission();\n    new Notification('WebPushの設定をしました');\n    if (permission === 'denied') {\n      return alert('ブラウザの通知設定をONにしてください');\n    } else {\n      sub = await initSubscribe();\n    }\n  }\n  console.log(sub);\n});\n```\n\n## Push送信処理（アプリケーションサーバ）\n\n```Node.js\napp.post('/send/webpush', (req, res) =\u003e {\n  // ブラウザ側でプッシュサーバから取得した、Endpointとp256dh、authの認証情報をセットする\n  var pushSubscription = {\n      endpoint: req.body.endpoint,\n      keys: {\n          p256dh: req.body.p256dh,\n          auth: req.body.auth\n      }\n  };\n  // 送信するメッセージは、Json形式で送る必要がある\n  var message = JSON.stringify({\n    title: req.body.title,\n    body: req.body.body,\n    icon: req.body.icon,\n    link: req.body.link,\n  });\n  var options = {\n    TTL: 10000,\n    vapidDetails: {\n      subject: req.body.link,\n      // 先ほど生成したVAPIDの鍵情報をセットする\n      publicKey: vapidKeys.publicKey,\n      privateKey: vapidKeys.privateKey\n    }\n  }\n  // npmのweb-pushライブラリを利用して、通知を送信する\n  webpush.sendNotification(pushSubscription, message, options).then((response)=\u003e{\n    return res.json({\n      statusCode: response.statusCode || -1,\n      message: response.message || '',\n    });\n  // 通知送信時にフォーマットエラーや必須パラメータの欠如、送信先が不明な場合などにエラーを検知する\n  }).catch((error) =\u003e {\n    console.log(error);\n    return res.json({\n      statusCode: error.statusCode || -1,\n      message: error.message || '',\n    });\n  });\n});\n```\n\n## 通知受信設定（ブラウザ）\n\nServiceWorkerを利用して、通知イベントを検知したときの処理を記載しておきます。\n\n```serviceworker.js\n\n// ブラウザに対して通知イベントを検知した際に実行される処理を定義\nself.addEventListener('push', (e) =\u003e {\n  var data = e.data.json();\n  var title = data.title;\n  var options = {\n    body : data.body,\n    icon: data.icon,\n    data: {\n      link_to: data.link\n    }\n  };\n  e.waitUntil(self.registration.showNotification(title, options));\n});\n// 通知バーがクリックされた際に実行される処理を定義\nself.addEventListener('notificationclick', (e) =\u003e {\n  e.notification.close();\n  e.waitUntil(clients.openWindow(e.notification.data.link_to));\n});\n```\n\n# 実装\n\nGithubにFCMを利用したWebPushのサンプルプログラムをアップしておりますので、試してみたい方は是非どうぞ。\n\n- FCMWebPush サンプルプログラム: \n   - https://github.com/megadreams14/FCMWebPush\n\n\n## 参考\n- [Firebase Cloud Messaging](https://firebase.google.com/docs/cloud-messaging/)\n- [GCMの登録が不要になったChromeのWeb Pushを試してみる](http://qiita.com/tomoyukilabs/items/9346eb44b5a48b294762)\n- [Web Pushでブラウザにプッシュ通知を送ってみる](http://qiita.com/tomoyukilabs/items/217915676603fda73b0a)\n- [Firebase (FCM)を利用して Google Chrome にプッシュ通知を送信する](https://www.ipentec.com/document/document.aspx?page=software-google-chrome-send-push-messaging-and-notification-using-firebase)\n","coediting":false,"created_at":"2017-05-17T17:52:06+09:00","group":null,"id":"2f4221c3cc2a39663d7d","private":false,"tags":[{"name":"Node.js","versions":[]},{"name":"es6","versions":[]},{"name":"WebPush","versions":[]},{"name":"FCM","versions":[]}],"title":"Firebase Cloud Messaging(FCM)を利用したWebPush通知の実装について","updated_at":"2017-05-17T17:52:06+09:00","url":"http://qiita.com/megadreams14/items/2f4221c3cc2a39663d7d","user":{"description":"","facebook_id":"","followees_count":14,"followers_count":10,"github_login_name":null,"id":"megadreams14","items_count":7,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":17346,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/17346/profile-images/1473682132","twitter_screen_name":"megadreams14","website_url":"http://megadreams14.com"}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"この講座で登場するワード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E8%AC%9B%E5%BA%A7%E3%81%A7%E7%99%BB%E5%A0%B4%E3%81%99%E3%82%8B%E3%83%AF%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこの講座で登場するワード\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e変数：ものをストックしておく箱。(雑)\u003c/li\u003e\n\u003cli\u003e型：パソコンには「1」が文字なのか数字なのかの区別がつかないので、区別するためのラベル\u003c/li\u003e\n\u003cli\u003eprint文：文字を表示させるコマンド。\u003c/li\u003e\n\u003cli\u003eif文：「もしもこうならAをして、そうでなければBをやって」という命令に使えます\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"代入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%A3%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e代入\u003c/h1\u003e\n\n\u003cp\u003eプログラミングをしていく上で非常に大切な考え方です。\u003cbr\u003e\n簡単に言えば、「計算結果・途中のものを一時的に変数のなかに保存することができる」モノだと考えておいてください。\u003c/p\u003e\n\n\u003cp\u003e例えば\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esubs.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003ehello\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Hello World\"\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# helloの中には\"Hello World\"が入っている\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"n\"\u003ehello\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# Hello Worldが出力される\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eは変数helloに\"Hello World\"が代入されている状態です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"型について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9E%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e型について\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"int型整数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#int%E5%9E%8B%E6%95%B4%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eint型(整数)\u003c/h2\u003e\n\n\u003cp\u003e基本の型の一つです。1,2,3,4,...や-1,-2,-3,...はすべてint型です。\u003cbr\u003e\n以下のような形で用います\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eint.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e#aは2\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"double型小数\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#double%E5%9E%8B%E5%B0%8F%E6%95%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edouble型(小数)\u003c/h2\u003e\n\n\u003cp\u003eこちらも基本の型の一つです。使い方はint型と同じなので省略\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"string型文字列\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#string%E5%9E%8B%E6%96%87%E5%AD%97%E5%88%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003estring型(文字列)\u003c/h2\u003e\n\n\u003cp\u003e初心者には少しやっかいな型。コードの上では、変数と文字列の区別をつけるために文字列には必ず''(シングルクォーテーション)か\"\"(ダブルクォーテーション)で括る決まりがあります。\u003cbr\u003e\nまた、string型同士も足し算をすることができ、文字列の連結を意味します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003estring.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"hoge\"\u003c/span\u003e \u003cspan class=\"c1\"\u003e#aはhoge\u003c/span\u003e\n\u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"org\"\u003c/span\u003e \u003cspan class=\"c1\"\u003e# bはorg\u003c/span\u003e\n\u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"c1\"\u003e# cはhogeorg\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eまた、\"1\"や\"1.2345\"は文字列になります。だってほら、\"\"で括ってあるし……ね？\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"list型\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#list%E5%9E%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003elist型\u003c/h2\u003e\n\n\u003cp\u003eいくつかのデータを保存する時、例えば100個くらいの整数を使いまわしたいときなど、一つ一つに変数を宣言していてはキリがない……\u003cbr\u003e\nそんな奥様にオススメの型がこちら！list型です！\u003c/p\u003e\n\n\u003cp\u003e詳細な使い方はおいおい(実践で)学んでほしいのですが、いわば「複数個のデータや情報を一括して管理することのできる」型です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elist.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003edays\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Sun\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Mon\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Tue\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Wed\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Thu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Fri\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 曜日を保持したリスト\u003c/span\u003e\n\u003cspan class=\"n\"\u003edays\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#\"Sun\"\u003c/span\u003e\n\u003cspan class=\"n\"\u003edays\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# error\u003c/span\u003e\n\u003cspan class=\"n\"\u003edays\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Sat\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# .append()はリスト専用の関数。()の中身を追加する\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# days = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eリストには変数[数字]でアクセスして、格納されているデータのやり取りができます。\u003cbr\u003e\nまた、似た型にタプル(tuple)というものもありますが、今は置いておきましょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"print文\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#print%E6%96%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eprint文\u003c/h1\u003e\n\n\u003cp\u003eもうすでに登場してしまっていましたが、改めてprint文についてです。\u003cbr\u003e\n書き方は、「print(半角スペース)モノ」と書きましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eprint.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003ehoge\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"hoge\"\u003c/span\u003e\n\u003cspan class=\"n\"\u003einteger\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e123456\u003c/span\u003e\n\u003cspan class=\"n\"\u003eList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einteger\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mf\"\u003e3.14159265358979\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"n\"\u003ehoge\u003c/span\u003e \u003cspan class=\"c1\"\u003e# hoge\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"n\"\u003einteger\u003c/span\u003e \u003cspan class=\"c1\"\u003e# integer\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e \u003cspan class=\"c1\"\u003e# [\"hoge\", 123456, 3.14159265358979]\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"hoge\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 改行がなくなる\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"n\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einteger\u003c/span\u003e \u003cspan class=\"c1\"\u003e# \"hoge\"123456\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e……語ることは、特にないかな？(震え声)\u003cbr\u003e\nTipsとしては、print文の文末に,を置くと改行がスキップ、,で区切っていくつかの変数を同時に出力させるなんてこともできます\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"if文\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#if%E6%96%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eif文\u003c/h1\u003e\n\n\u003cp\u003eヾ( 〃∇〃)ﾂ ｷｬｰｰｰｯﾀﾞｲﾃｰｯ♪ってくらい使います。はい、今後生涯の友です。\u003cbr\u003e\nif文は直後に条件式を持ってきて、正しければ中身を、そうでなければif文の終わりにスキップさせるということができます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eif.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e20\u003c/span\u003e\n\u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# aと表示される\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"a\"\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# bと表示されない\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"b\"\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e書き方は\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eif.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"err\"\u003e条件\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# 中身\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eと書きます。ifの直後には半角スペース、忘れないように……\u003cbr\u003e\nまた、中身を書くときに気を付けないといけないのがインデントです(Tabキー1回)\u003cbr\u003e\nPythonではif文やfor文(次回)の中身範囲を{}ではなくインデントの高さで決めているので、注意しましょう。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"条件式について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9D%A1%E4%BB%B6%E5%BC%8F%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e条件式について\u003c/h3\u003e\n\n\u003cp\u003e条件式に使えるものはたくさんありますが、よく使うものは以下\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ebinary.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"c1\"\u003e# aがbより大きければ正しい\u003c/span\u003e\n\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 一致していれば正しい\u003c/span\u003e\n\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"c1\"\u003e# aの型次第だが、例えばaが整数の場合aが0でなければ正しい\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e条件式は一から自作することもできますが、それはまた後程……\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"演習問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BC%94%E7%BF%92%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e演習問題\u003c/h1\u003e\n\n\u003cp\u003e以下のソースコードを見てください\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"python\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elesson1.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e#coding: UTF-8\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e############ここより上は書き換え禁止############\u003c/span\u003e\n\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e20\u003c/span\u003e\n\u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"hoge\"\u003c/span\u003e\n\u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\"\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 直下のif文の条件が正しくなるように、条件式を書き換えなさい\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# aの中身を表示させなさい\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 直下のif文の条件が正しくなるように、cを書き換えなさい\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# bの中身を表示させなさい\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eソースの中に書いてあるコメント文にしたがって、書き換えてましょう\u003c/p\u003e\n\n\u003cp\u003e正しく動作すると\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e20\u003cbr\u003e\nhoge\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eと表示されるはずです。\u003c/p\u003e\n","body":"# この講座で登場するワード\n- 変数：ものをストックしておく箱。(雑)\n- 型：パソコンには「1」が文字なのか数字なのかの区別がつかないので、区別するためのラベル\n- print文：文字を表示させるコマンド。\n- if文：「もしもこうならAをして、そうでなければBをやって」という命令に使えます\n\n# 代入\nプログラミングをしていく上で非常に大切な考え方です。\n簡単に言えば、「計算結果・途中のものを一時的に変数のなかに保存することができる」モノだと考えておいてください。\n\n例えば\n\n```python:subs.py\nhello = \"Hello World\"\n# helloの中には\"Hello World\"が入っている\nprint hello\n# Hello Worldが出力される\n```\n\nは変数helloに\"Hello World\"が代入されている状態です。\n\n# 型について\n\n## int型(整数)\n基本の型の一つです。1,2,3,4,...や-1,-2,-3,...はすべてint型です。\n以下のような形で用います\n\n```python:int.py\na = 1+1 #aは2\n```\n\n## double型(小数)\nこちらも基本の型の一つです。使い方はint型と同じなので省略\n\n## string型(文字列)\n初心者には少しやっかいな型。コードの上では、変数と文字列の区別をつけるために文字列には必ず''(シングルクォーテーション)か\"\"(ダブルクォーテーション)で括る決まりがあります。\nまた、string型同士も足し算をすることができ、文字列の連結を意味します。\n\n```python:string.py\na = \"hoge\" #aはhoge\nb = \"org\" # bはorg\nc = a+b # cはhogeorg\n```\n\nまた、\"1\"や\"1.2345\"は文字列になります。だってほら、\"\"で括ってあるし……ね？\n\n## list型\nいくつかのデータを保存する時、例えば100個くらいの整数を使いまわしたいときなど、一つ一つに変数を宣言していてはキリがない……\nそんな奥様にオススメの型がこちら！list型です！\n\n詳細な使い方はおいおい(実践で)学んでほしいのですが、いわば「複数個のデータや情報を一括して管理することのできる」型です。\n\n```python:list.py\ndays = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\"]\n# 曜日を保持したリスト\ndays[0] #\"Sun\"\ndays[10] # error\ndays.append(\"Sat\") # .append()はリスト専用の関数。()の中身を追加する\n# days = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\n```\n\nリストには変数[数字]でアクセスして、格納されているデータのやり取りができます。\nまた、似た型にタプル(tuple)というものもありますが、今は置いておきましょう。\n\n# print文\nもうすでに登場してしまっていましたが、改めてprint文についてです。\n書き方は、「print(半角スペース)モノ」と書きましょう。\n\n```python:print.py\nhoge = \"hoge\"\ninteger = 123456\nList = [hoge, integer, 3.14159265358979]\n\nprint hoge # hoge\nprint integer # integer\nprint List # [\"hoge\", 123456, 3.14159265358979]\n\nprint \"hoge\", # 改行がなくなる\nprint hoge, integer # \"hoge\"123456\n```\n\n……語ることは、特にないかな？(震え声)\nTipsとしては、print文の文末に,を置くと改行がスキップ、,で区切っていくつかの変数を同時に出力させるなんてこともできます\n\n# if文\nヾ( 〃∇〃)ﾂ ｷｬｰｰｰｯﾀﾞｲﾃｰｯ♪ってくらい使います。はい、今後生涯の友です。\nif文は直後に条件式を持ってきて、正しければ中身を、そうでなければif文の終わりにスキップさせるということができます。\n\n```python:if.py\na = 20\nb = 1\n\nif a \u003e 10:\n\t# aと表示される\n\tprint \"a\"\n\nif b \u003e 10:\n\t# bと表示されない\n\tprint \"b\"\n```\n\n書き方は\n\n```python:if.py\nif 条件:\n\t# 中身\n```\nと書きます。ifの直後には半角スペース、忘れないように……\nまた、中身を書くときに気を付けないといけないのがインデントです(Tabキー1回)\nPythonではif文やfor文(次回)の中身範囲を{}ではなくインデントの高さで決めているので、注意しましょう。\n\n### 条件式について\n条件式に使えるものはたくさんありますが、よく使うものは以下\n\n```python:binary.py\na \u003e b # aがbより大きければ正しい\na == b # 一致していれば正しい\na # aの型次第だが、例えばaが整数の場合aが0でなければ正しい\n```\n\n条件式は一から自作することもできますが、それはまた後程……\n\n# 演習問題\n\n以下のソースコードを見てください\n\n```python:lesson1.py\n#coding: UTF-8\n\n############ここより上は書き換え禁止############\na = 20\nb = \"hoge\"\nc = \"\"\n\n# 直下のif文の条件が正しくなるように、条件式を書き換えなさい\nif a \u003c 20:\n\t# aの中身を表示させなさい\n\n# 直下のif文の条件が正しくなるように、cを書き換えなさい\nif b == c:\n\t# bの中身を表示させなさい\n```\n\nソースの中に書いてあるコメント文にしたがって、書き換えてましょう\n\n正しく動作すると\n\u003e 20\n\u003e hoge\n\nと表示されるはずです。\n\n","coediting":false,"created_at":"2017-05-17T17:37:58+09:00","group":null,"id":"5dd28c1536b94e260485","private":false,"tags":[{"name":"Python","versions":[]}],"title":"初心者*3講座：基本事項(print, if文)","updated_at":"2017-05-17T17:37:58+09:00","url":"http://qiita.com/RyuSA/items/5dd28c1536b94e260485","user":{"description":"PythonとRoRをほそぼそと勉強中の大学院生です。\r\nAndroid開発もやってみたい…Webアプリケーションもやってみたい…","facebook_id":"","followees_count":0,"followers_count":3,"github_login_name":"RyuSA","id":"RyuSA","items_count":9,"linkedin_id":"","location":"Tokyo","name":"RyuSA","organization":"","permanent_id":136539,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/136539/profile-images/1488360778","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\n\u003ch2\u003e\n\u003cspan id=\"やりたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたいこと\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eある入力項目に複数のバリデーションルールを設定する\u003c/li\u003e\n\u003cli\u003eN個目のルールがクリアできたらN+1個目のルールでバリデーション\u003c/li\u003e\n\u003cli\u003eもしバリデーションエラーになったら、後続のバリデーションは打ち切る\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"解決方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決方法\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003ebail\u003c/code\u003eルールを入れておけばよい。\u003cbr\u003e\n\u003ca href=\"https://laravel.com/docs/5.4/validation\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://laravel.com/docs/5.4/validation\u003c/a\u003e （Stopping On First Validation Failureの箇所）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"php\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"s1\"\u003e'input'\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e'bail|required|date_format:Y-m-d|custom_rule1|・・・'\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"bailが何をしているのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bail%E3%81%8C%E4%BD%95%E3%82%92%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ebail\u003c/code\u003eが何をしているのか？\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eValidatesAttributes\u003c/code\u003eや\u003ccode\u003eValidator\u003c/code\u003eあたりを見ればわかる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"php\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eValidatesAttributes.php\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e    \u003cspan class=\"sd\"\u003e/**\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     * \"Break\" on first validation fail.\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     *\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     * Always returns true, just lets us put \"bail\" in rules.\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     *\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     * @return bool\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003evalidateBail\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eValidatesAttributes::validateBailbail()自体には特に意味がなく常にtrueを返している。 \u003cbr\u003e\n色々と制御しているのはValidator::passes()、Validator::shouldStopValidating()。 \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"php\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eValidator.php\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e    \u003cspan class=\"sd\"\u003e/**\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     * Determine if the data passes the validation rules.\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     *\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     * @return bool\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003epasses\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003emessages\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eMessageBag\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// We'll spin through each rule, validating the attributes attached to that\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// rule. Any error messages will be added to the containers with each of\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// the other error messages, returning true if we don't have messages.\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003erules\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$rules\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003estr_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\\.'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'-\u0026gt;'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$rules\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nv\"\u003e$rule\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003evalidateAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$rule\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eshouldStopValidating\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// Here we will spin through all of the \"after\" hooks on this validator and\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// fire them off. This gives the callbacks a chance to perform all kinds\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// of other validation that needs to get wrapped up in this operation.\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eforeach\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eafter\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nv\"\u003e$after\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nb\"\u003ecall_user_func\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$after\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003emessages\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eisEmpty\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"sd\"\u003e/**\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     * Check if we should stop further validations on a given attribute.\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     *\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     * @param  string  $attribute\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     * @return bool\u003c/span\u003e\n\u003cspan class=\"sd\"\u003e     */\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eshouldStopValidating\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ehasRule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e'Bail'\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003emessages\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ehas\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eisset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003efailedRules\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n            \u003cspan class=\"nb\"\u003ein_array\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'uploaded'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003earray_keys\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003efailedRules\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e])))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// In case the attribute has any rule that indicates that the field is required\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// and that rule already failed then we should stop validation at this point\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// as now there is no point in calling other rules with this field empty.\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003ehasRule\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eimplicitRules\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n               \u003cspan class=\"nb\"\u003eisset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003efailedRules\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n               \u003cspan class=\"nb\"\u003earray_intersect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003earray_keys\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003efailedRules\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e]),\u003c/span\u003e \u003cspan class=\"nv\"\u003e$this\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003eimplicitRules\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eValidator::passes()からValidator::shouldStopValidating()を呼び出している。\u003cbr\u003e\n passes()：バリデーションのメインに当たる関数\u003cbr\u003e\n shouldStopValidating()：bailルールを含んでいる場合は、現在格納されているエラーメッセージ配列を確認して何らかの値が入っていれば呼び元にtrueを返すようにしている。\u003cbr\u003e\n\u003cstrong\u003e（実際には他にも色々やっているが関係のある処理だけ抜粋）\u003c/strong\u003e\u003c/p\u003e\n","body":"## やりたいこと\n\n- ある入力項目に複数のバリデーションルールを設定する\n- N個目のルールがクリアできたらN+1個目のルールでバリデーション\n- もしバリデーションエラーになったら、後続のバリデーションは打ち切る\n\n## 解決方法\n\n`bail`ルールを入れておけばよい。\nhttps://laravel.com/docs/5.4/validation （Stopping On First Validation Failureの箇所）\n\n```php\n'input' =\u003e 'bail|required|date_format:Y-m-d|custom_rule1|・・・'\n```\n\n## `bail`が何をしているのか？\n\n`ValidatesAttributes`や`Validator`あたりを見ればわかる。\n\n```php:ValidatesAttributes.php\n    /**\n     * \"Break\" on first validation fail.\n     *\n     * Always returns true, just lets us put \"bail\" in rules.\n     *\n     * @return bool\n     */\n    protected function validateBail()\n    {\n        return true;\n    }\n```\nValidatesAttributes::validateBailbail()自体には特に意味がなく常にtrueを返している。 \n色々と制御しているのはValidator::passes()、Validator::shouldStopValidating()。 \n\n```php:Validator.php\n    /**\n     * Determine if the data passes the validation rules.\n     *\n     * @return bool\n     */\n    public function passes()\n    {\n        $this-\u003emessages = new MessageBag;\n\n        // We'll spin through each rule, validating the attributes attached to that\n        // rule. Any error messages will be added to the containers with each of\n        // the other error messages, returning true if we don't have messages.\n        foreach ($this-\u003erules as $attribute =\u003e $rules) {\n            $attribute = str_replace('\\.', '-\u003e', $attribute);\n\n            foreach ($rules as $rule) {\n                $this-\u003evalidateAttribute($attribute, $rule);\n\n                if ($this-\u003eshouldStopValidating($attribute)) {\n                    break;\n                }\n            }\n        }\n\n        // Here we will spin through all of the \"after\" hooks on this validator and\n        // fire them off. This gives the callbacks a chance to perform all kinds\n        // of other validation that needs to get wrapped up in this operation.\n        foreach ($this-\u003eafter as $after) {\n            call_user_func($after);\n        }\n\n        return $this-\u003emessages-\u003eisEmpty();\n    }\n\n    /**\n     * Check if we should stop further validations on a given attribute.\n     *\n     * @param  string  $attribute\n     * @return bool\n     */\n    protected function shouldStopValidating($attribute)\n    {\n        if ($this-\u003ehasRule($attribute, ['Bail'])) {\n            return $this-\u003emessages-\u003ehas($attribute);\n        }\n\n        if (isset($this-\u003efailedRules[$attribute]) \u0026\u0026\n            in_array('uploaded', array_keys($this-\u003efailedRules[$attribute]))) {\n            return true;\n        }\n\n        // In case the attribute has any rule that indicates that the field is required\n        // and that rule already failed then we should stop validation at this point\n        // as now there is no point in calling other rules with this field empty.\n        return $this-\u003ehasRule($attribute, $this-\u003eimplicitRules) \u0026\u0026\n               isset($this-\u003efailedRules[$attribute]) \u0026\u0026\n               array_intersect(array_keys($this-\u003efailedRules[$attribute]), $this-\u003eimplicitRules);\n    }\n```\n\nValidator::passes()からValidator::shouldStopValidating()を呼び出している。\n passes()：バリデーションのメインに当たる関数\n shouldStopValidating()：bailルールを含んでいる場合は、現在格納されているエラーメッセージ配列を確認して何らかの値が入っていれば呼び元にtrueを返すようにしている。\n**（実際には他にも色々やっているが関係のある処理だけ抜粋）**\n","coediting":false,"created_at":"2017-05-17T17:27:14+09:00","group":null,"id":"2573249c750a111a6dfc","private":false,"tags":[{"name":"laravel","versions":[]},{"name":"laravel5.4","versions":[]}],"title":"ある入力項目に複数のルールを設定している状態で、1つでもエラーを検知した場合は後続のルールを適用しないで打ち切る方法","updated_at":"2017-05-17T17:27:14+09:00","url":"http://qiita.com/shima_6_you/items/2573249c750a111a6dfc","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":0,"github_login_name":"Yosuke-Shimada","id":"shima_6_you","items_count":6,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":154029,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/154029/profile-images/1488635940","twitter_screen_name":"shima_6_you","website_url":null}},{"rendered_body":"\u003cp\u003e\u003ca href=\"http://qiita.com/yan_hisa_/items/111deebea38dbf4b7101\" id=\"reference-c1570c4a3f724ea2f5ac\"\u003e若手エンジニアがビジネス寄りの展示会で感じたこと(その１)\u003c/a\u003eの続きです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"備えあれば憂い無し\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%82%99%E3%81%88%E3%81%82%E3%82%8C%E3%81%B0%E6%86%82%E3%81%84%E7%84%A1%E3%81%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e備えあれば憂い無し\u003c/h1\u003e\n\n\u003cp\u003eイベントに出展するにあたり、用意しておくと役に立つものを紹介する。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"資料\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%B3%87%E6%96%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e資料\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e説明シナリオ\u003c/li\u003e\n\u003cli\u003eFAQ\u003c/li\u003e\n\u003cli\u003e操作マニュアル\u003c/li\u003e\n\u003cli\u003eシフト表\u003c/li\u003e\n\u003cli\u003e会場マップ（パンフレット）\u003c/li\u003e\n\u003cli\u003eアンケート\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e説明シナリオ、FAQ、操作マニュアルは当日の説明で慌てないために用意しておきたい。\u003cbr\u003e\nシフト表、会場マップは説明員が迷わないために作成、確保しておく。\u003cbr\u003e\nアンケートは生の声を聞くためには必須。併せてバインダーも忘れずに。名刺をアンケートに貼れるようにすると時短になる。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"持ってきていそうで忘れがちなものたち\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8C%81%E3%81%A3%E3%81%A6%E3%81%8D%E3%81%A6%E3%81%84%E3%81%9D%E3%81%86%E3%81%A7%E5%BF%98%E3%82%8C%E3%81%8C%E3%81%A1%E3%81%AA%E3%82%82%E3%81%AE%E3%81%9F%E3%81%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e持ってきていそうで忘れがちなものたち\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eガムテープ\u003c/li\u003e\n\u003cli\u003eマジック\u003c/li\u003e\n\u003cli\u003e電源タップ\u003c/li\u003e\n\u003cli\u003eゴミ袋\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eガムテープは万能選手である。名札にも使える、イベント後の梱包に使える、メモにも使える。\u003cbr\u003e\nマジックはガムテープとペアで使うことが多かったです。\u003cbr\u003e\n会場で十分に電源が用意されていることは少ない。PCやWi-Fi、タブレットを充電しておくためにも１つは用意しておきたい。\u003cbr\u003e\n昼食時のゴミや撤収のときに出たゴミをまとめるために、ゴミ袋は持参しておく。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"領収書\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%A0%98%E5%8F%8E%E6%9B%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e領収書\u003c/h1\u003e\n\n\u003cp\u003e各自で領収書を切っているとイベント後の処理が大変\u003cbr\u003e\nお財布を１つにしておくか、領収書を逐次集めておく\u003cbr\u003e\n仕組みを作っておいた方がいい。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"担当者間連絡\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8B%85%E5%BD%93%E8%80%85%E9%96%93%E9%80%A3%E7%B5%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e担当者間連絡\u003c/h1\u003e\n\n\u003cp\u003e今となっては当たり前のツールであるが、\u003cbr\u003e\nLINE、Slack等で随時連絡を取り合えるようにしておくこと。（社内規定で阻まれることも･･･）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h1\u003e\n\n\u003cp\u003e展示会終了時には1日立ちっぱなしで、疲労困憊でしょう。\u003cbr\u003e\nそんなときに役立つ品々を紹介しました。\u003cbr\u003e\n忘れ物、落とし物なく帰路についてもらえると幸いです。\u003c/p\u003e\n","body":"[若手エンジニアがビジネス寄りの展示会で感じたこと(その１)](http://qiita.com/yan_hisa_/items/111deebea38dbf4b7101)の続きです。\n\n#備えあれば憂い無し\nイベントに出展するにあたり、用意しておくと役に立つものを紹介する。\n\n# 資料\n- 説明シナリオ\n- FAQ\n- 操作マニュアル\n- シフト表\n- 会場マップ（パンフレット）\n- アンケート\n\n説明シナリオ、FAQ、操作マニュアルは当日の説明で慌てないために用意しておきたい。\nシフト表、会場マップは説明員が迷わないために作成、確保しておく。\nアンケートは生の声を聞くためには必須。併せてバインダーも忘れずに。名刺をアンケートに貼れるようにすると時短になる。\n\n# 持ってきていそうで忘れがちなものたち\n- ガムテープ\n- マジック\n- 電源タップ\n- ゴミ袋\n\nガムテープは万能選手である。名札にも使える、イベント後の梱包に使える、メモにも使える。\nマジックはガムテープとペアで使うことが多かったです。\n会場で十分に電源が用意されていることは少ない。PCやWi-Fi、タブレットを充電しておくためにも１つは用意しておきたい。\n昼食時のゴミや撤収のときに出たゴミをまとめるために、ゴミ袋は持参しておく。\n\n# 領収書\n各自で領収書を切っているとイベント後の処理が大変\nお財布を１つにしておくか、領収書を逐次集めておく\n仕組みを作っておいた方がいい。\n\n#担当者間連絡\n今となっては当たり前のツールであるが、\nLINE、Slack等で随時連絡を取り合えるようにしておくこと。（社内規定で阻まれることも･･･）\n\n#最後に\n展示会終了時には1日立ちっぱなしで、疲労困憊でしょう。\nそんなときに役立つ品々を紹介しました。\n忘れ物、落とし物なく帰路についてもらえると幸いです。\n","coediting":false,"created_at":"2017-05-17T17:14:50+09:00","group":null,"id":"fd4563be33500eff44cc","private":false,"tags":[{"name":"イベント","versions":[]},{"name":"poem","versions":[]}],"title":"若手エンジニアがビジネス寄りの展示会で感じたこと(その2)","updated_at":"2017-05-17T17:24:30+09:00","url":"http://qiita.com/yan_hisa_/items/fd4563be33500eff44cc","user":{"description":"","facebook_id":"hisaya.sakurai","followees_count":24,"followers_count":11,"github_login_name":null,"id":"yan_hisa_","items_count":4,"linkedin_id":"","location":"Tokyo","name":"Hisaya Sakurai","organization":"TIS Inc.","permanent_id":105945,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105945/profile-images/1495012744","twitter_screen_name":"yan_hisa_","website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"複数行の入力を受け取る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E8%A1%8C%E3%81%AE%E5%85%A5%E5%8A%9B%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数行の入力を受け取る\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ereadlines\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 入力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 120\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 115\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 122\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 116\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 119\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 117\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003eprint\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e \n\u003cspan class=\"c1\"\u003e# 出力結果\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# [\"120\\n\", \"115\\n\", \"122\\n\", \"116\\n\", \"119\\n\", \"117 \"]\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 出力結果\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 120\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 115\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 122\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 116\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 119\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 117 \u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"複数行の入力を改行なしで受け取る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E8%A1%8C%E3%81%AE%E5%85%A5%E5%8A%9B%E3%82%92%E6%94%B9%E8%A1%8C%E3%81%AA%E3%81%97%E3%81%A7%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数行の入力を改行なしで受け取る\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003ereadlines\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"ss\"\u003e:chomp\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 入力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 120\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 115\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 122\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 116\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 119\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 117\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003eprint\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e \n\u003cspan class=\"c1\"\u003e# 出力結果\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# [\"120\", \"115\", \"122\", \"116\", \"119\", \"117\"]\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 出力結果\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 120\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 115\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 122\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 116\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 119\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"\n#複数行の入力を受け取る\n\n``` ruby\ninput = readlines\n\n# 入力\n# 120\n# 115\n# 122\n# 116\n# 119\n# 117\n\nprint input \n# 出力結果\n# [\"120\\n\", \"115\\n\", \"122\\n\", \"116\\n\", \"119\\n\", \"117 \"]\n\nputs input\n# 出力結果\n# 120\n# 115\n# 122\n# 116\n# 119\n# 117 \n```\n\n#複数行の入力を改行なしで受け取る\n\n```ruby\ninput = readlines.map \u0026:chomp\n\n# 入力\n# 120\n# 115\n# 122\n# 116\n# 119\n# 117\n\nprint input \n# 出力結果\n# [\"120\", \"115\", \"122\", \"116\", \"119\", \"117\"]\n\nputs input\n# 出力結果\n# 120\n# 115\n# 122\n# 116\n# 119\n```\n","coediting":false,"created_at":"2017-05-17T17:13:57+09:00","group":null,"id":"e95f803d78c2a75e1fa7","private":false,"tags":[{"name":"Ruby","versions":[]}],"title":"Ruby 複数行の入力を受け取る　改行なしで受け取る","updated_at":"2017-05-17T17:13:57+09:00","url":"http://qiita.com/ayacai115/items/e95f803d78c2a75e1fa7","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":"ayacai115","id":"ayacai115","items_count":5,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":176100,"profile_image_url":"https://avatars0.githubusercontent.com/u/27493179?v=3","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003emoshiのバージョン1.5で、 \u003ccode\u003e@Json(name = \"ts\") val timestamp: String\u003c/code\u003e のようにフィールドとプロパティ名を別にして対応づけたんですが、うまくいきませんでした。\u003c/p\u003e\n\n\u003cp\u003eどうやら moshi1.5から moshi-kotlin というモジュールが加わったので、それを使わないといけないっぽいです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://medium.com/square-corner-blog/kotlins-a-great-language-for-json-fcd6ef99256b\" rel=\"nofollow noopener\" target=\"_blank\"\u003eKotlin’s a great language for JSON – Square Corner Blog – Medium\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"対処法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AF%BE%E5%87%A6%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e対処法\u003c/h2\u003e\n\n\u003cp\u003egradleに \u003ccode\u003ecompile 'com.squareup.moshi:moshi-kotlin:1.5.0'\u003c/code\u003e を追加し、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"kotlin\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003emoshi\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMoshi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBuilder\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eKotlinJsonAdapterFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebuild\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとしたらうまくいきました。\u003c/p\u003e\n","body":"moshiのバージョン1.5で、 `@Json(name = \"ts\") val timestamp: String` のようにフィールドとプロパティ名を別にして対応づけたんですが、うまくいきませんでした。\n\nどうやら moshi1.5から moshi-kotlin というモジュールが加わったので、それを使わないといけないっぽいです。\n\n[Kotlin’s a great language for JSON – Square Corner Blog – Medium](https://medium.com/square-corner-blog/kotlins-a-great-language-for-json-fcd6ef99256b)\n\n## 対処法\n\ngradleに `compile 'com.squareup.moshi:moshi-kotlin:1.5.0'` を追加し、\n\n```kotlin\nval moshi = Moshi.Builder()\n        .add(KotlinJsonAdapterFactory())\n        .build()\n```\n\nとしたらうまくいきました。\n","coediting":false,"created_at":"2017-05-17T17:01:53+09:00","group":null,"id":"abd7d066cd707c0972a7","private":false,"tags":[{"name":"Android","versions":[]},{"name":"Kotlin","versions":[]},{"name":"Moshi","versions":[]}],"title":"moshiをkotlinで使ってて、JSONのマッピングがうまくいかないときの対処法","updated_at":"2017-05-17T17:01:53+09:00","url":"http://qiita.com/sagaraya/items/abd7d066cd707c0972a7","user":{"description":"","facebook_id":"","followees_count":64,"followers_count":45,"github_login_name":"sagaraya","id":"sagaraya","items_count":29,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":12352,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/12352/profile-images/1473682375","twitter_screen_name":"sagaraya","website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"ruby-241が入らなかった\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ruby-241%E3%81%8C%E5%85%A5%E3%82%89%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eruby 2.4.1が入らなかった\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ rbenv install \u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.1\nruby-build: definition not found: \u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.1\n\nThe following versions contain \u003cspan class=\"sb\"\u003e`\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.1\u003cspan class=\"s1\"\u003e' in the name:\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e  rbx-2.4.1\u003c/span\u003e\n\n\u003cspan class=\"s1\"\u003eSee all available versions with `rbenv install --list'\u003c/span\u003e.\n\nIf the version you need is missing, try upgrading ruby-build:\n\n  \u003cspan class=\"nb\"\u003ecd\u003c/span\u003e ~/.rbenv/plugins/ruby-build \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e git pull \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003ecd\u003c/span\u003e -\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e2.4.1が入らない。\u003cbr\u003e\nなんでや \u003cimg alt=\":angry:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f620.png\" title=\":angry:\" width=\"20\"\u003e \u003cimg alt=\":anger:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f4a2.png\" title=\":anger:\" width=\"20\"\u003e \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ rbenv install --list\n\u003cspan class=\"c1\"\u003e# 略\u003c/span\u003e\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.3.3\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.3.4\n\u003cspan class=\"c1\"\u003e# 略\u003c/span\u003e\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.0\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.5.0 beta\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eインストール一覧に出てこない... \u003cimg alt=\":thinking:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f914.png\" title=\":thinking:\" width=\"20\"\u003e \u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"rbenvをアップデートする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rbenv%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003erbenvをアップデートする\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ rbenv update\n$ rbenv install --list\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.3.3\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.3.4\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.0-dev\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.0-preview1\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.0-preview2\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.0-preview3\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.0-rc1\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.0\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.1\n\u003cspan class=\"m\"\u003e2\u003c/span\u003e.5.0-dev\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあった \u003cimg alt=\":laughing:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f606.png\" title=\":laughing:\" width=\"20\"\u003e \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ rbenv install \u003cspan class=\"m\"\u003e2\u003c/span\u003e.4.1\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eできた \u003cimg alt=\":laughing:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f606.png\" title=\":laughing:\" width=\"20\"\u003e \u003c/p\u003e\n","body":"# ruby 2.4.1が入らなかった\n\n```bash\n$ rbenv install 2.4.1\nruby-build: definition not found: 2.4.1\n\nThe following versions contain `2.4.1' in the name:\n  rbx-2.4.1\n\nSee all available versions with `rbenv install --list'.\n\nIf the version you need is missing, try upgrading ruby-build:\n\n  cd ~/.rbenv/plugins/ruby-build \u0026\u0026 git pull \u0026\u0026 cd -\n```\n\n2.4.1が入らない。\nなんでや :angry: :anger: \n\n```bash\n$ rbenv install --list\n# 略\n2.3.3\n2.3.4\n# 略\n2.4.0\n2.5.0 beta\n```\n\nインストール一覧に出てこない... :thinking: \n\n# rbenvをアップデートする\n\n```bash\n$ rbenv update\n$ rbenv install --list\n2.3.3\n2.3.4\n2.4.0-dev\n2.4.0-preview1\n2.4.0-preview2\n2.4.0-preview3\n2.4.0-rc1\n2.4.0\n2.4.1\n2.5.0-dev\n```\n\nあった :laughing: \n\n```bash\n$ rbenv install 2.4.1\n```\n\nできた :laughing: \n","coediting":false,"created_at":"2017-05-17T16:56:51+09:00","group":null,"id":"96093b69ba45723c2e9f","private":false,"tags":[{"name":"Ruby","versions":[]}],"title":"rbenvでruby2.4.1を入れる(メモ)","updated_at":"2017-05-17T17:00:04+09:00","url":"http://qiita.com/emahiro/items/96093b69ba45723c2e9f","user":{"description":"web engineer at shibuya","facebook_id":"","followees_count":38,"followers_count":15,"github_login_name":"ememhr","id":"emahiro","items_count":75,"linkedin_id":"","location":"Tokyo","name":"","organization":"","permanent_id":28230,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/28230/profile-images/1493097421","twitter_screen_name":null,"website_url":"https://github.com/emahiro"}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"経緯\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%8C%E7%B7%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■経緯\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eCloudwatch有効活用できてないなー\n\n\u003cul\u003e\n\u003cli\u003e使えばAuto Scaleとかできるのに・・・\u003c/li\u003e\n\u003cli\u003eせっかくなので、nginxのrequest timeが大きくなった時にAuto Scaleとかやってみたい。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eNGINXのログをサーバに見に行くのもうしんどい・・・\n\n\u003cul\u003e\n\u003cli\u003eFluentd -\u0026gt; Elasticsearchでログ飛ばしてるけど、t1とかt2のインスタンスだから、しばらく使うと悲鳴を上げて泣く \u003cimg alt=\":cry:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f622.png\" title=\":cry:\" width=\"20\"\u003e \u003c/li\u003e\n\u003cli\u003eFluentdのログ集約用サーバもログ用のElasticsearchサーバももう管理したくない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"考えた解決手段\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%80%83%E3%81%88%E3%81%9F%E8%A7%A3%E6%B1%BA%E6%89%8B%E6%AE%B5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■考えた解決手段\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eサーバのCPU使用量とか、メモリ使用量とか、稼働時間とかもついでにCloudwatchに飛ばしちゃえ\u003c/li\u003e\n\u003cli\u003eさらに、NGINXのエラーログもCloudwatchに飛ばしちゃえ\u003c/li\u003e\n\u003cli\u003erequest time取れるようにして、Auto Scalingしてみる。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■実行\u003c/h1\u003e\n\n\u003cp\u003e参考サイト見ると、Cloudwatchがカスタムメトリクス送れるようになったからって、\u003cbr\u003e\nスクリプトとかcron使ってやってる人いるけど、それではやりたくない。\u003cbr\u003e\ncron仕込んだとか、シェルスクリプトどこだっけとか覚えたくないし、このためにコード書きたくないしね。\u003cbr\u003e\nなるべくサービス使ってやる方針でやってみた。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"使ったツール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%84%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使ったツール\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://collectd.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ecollectd\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eCloudWatch Logs(awslogs)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eまずは、collectdのインストールから進めたが、下記のサイトの通り進めるとエラーになった・・・\u003cbr\u003e\n- \u003ca href=\"http://dev.classmethod.jp/cloud/aws/collectd-cloudwatch/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ecollectdのCloudWatchプラグインを試してみた ｜ Developers.IO\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eインストールの流れ\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ sudo ./setup.py\nTraceback \u003cspan class=\"o\"\u003e(\u003c/span\u003emost recent call last\u003cspan class=\"o\"\u003e)\u003c/span\u003e:\n  File \u003cspan class=\"s2\"\u003e\"./setup.py\"\u003c/span\u003e, line \u003cspan class=\"m\"\u003e26\u003c/span\u003e, in \u0026lt;module\u0026gt;\n    from subprocess import check_output, CalledProcessError, Popen, PIPE\nImportError: cannot import name check_output\n\n\u003cspan class=\"c1\"\u003e# むむっ・・・と思ってとりあえず、pythonのバージョンか何かかなと思って、確認。\u003c/span\u003e\n$ python --version\nPython \u003cspan class=\"m\"\u003e2\u003c/span\u003e.6.9　# 古いw\n\n\u003cspan class=\"c1\"\u003e# うーん、、、ってここでつまずくのイヤだったので、とりあえず2.7にアップデートして試してみた\u003c/span\u003e\n$ sudo yum upgrade\n$ sudo yum -y install make automake gcc gcc-c++ kernel-devel git-core python27 python27-devel\n$ which python27\n$ python -V\n\n\u003cspan class=\"c1\"\u003e# python2.7を見るように変える。\u003c/span\u003e\n$ sudo rm /usr/bin/python\n$ sudo ln -s /usr/bin/python27 /usr/bin/python\n$ python -V\n\n\u003cspan class=\"c1\"\u003e# yumもpython2.7を使うように変えておく。他のツールインストールするときにエラーになるらしい。\u003c/span\u003e\n$ sudo cp /usr/bin/yum /usr/bin/_yum_old\n$ sudo sed -i s/python/python26/g /usr/bin/yum\n\n\u003cspan class=\"c1\"\u003e# これが成功したら大丈夫だってさ。\u003c/span\u003e\n$ yum list\n\n\u003cspan class=\"c1\"\u003e# 次はeazy_installやpipのインストール\u003c/span\u003e\n$ sudo curl -o /tmp/ez_setup.py https://bootstrap.pypa.io/ez_setup.py\n$ sudo /usr/bin/python /tmp/ez_setup.py\n$ sudo /usr/bin/easy_install-2.7 pip\n\n\u003cspan class=\"c1\"\u003e# collectdで送り先のリージョンとか自動取得するのに、awscli使うっぽかったので、aws-cliもアップデートしておく\u003c/span\u003e\n$ aws --version\n$ sudo /usr/local/bin/pip install --upgrade awscli\n\n\u003cspan class=\"c1\"\u003e# 再度、サイトの流れで./setup.pyまで実行\u003c/span\u003e\n$ sudo yum -y install collectd\n$ git clone https://github.com/awslabs/collectd-cloudwatch.git\n$ \u003cspan class=\"nb\"\u003ecd\u003c/span\u003e collectd-cloudwatch/src/\n\n\u003cspan class=\"c1\"\u003e# またエラー・・・・\u003c/span\u003e\n$ sudo ./setup.py\nInstalling dependencies ... OK\nInstalling python dependencies ... NOT OK\nInstallation cancelled due to an error.\nExecuted command: \u003cspan class=\"s1\"\u003e'/usr/bin/pip install --quiet --upgrade --force-reinstall requests'\u003c/span\u003e.\nError output: \u003cspan class=\"s1\"\u003e'Traceback (most recent call last):\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e  File \"/usr/bin/pip\", line 5, in \u0026lt;module\u0026gt;\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e    from pkg_resources import load_entry_point\u003c/span\u003e\n\u003cspan class=\"s1\"\u003e  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 3019, in \u0026lt;module\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"s1\"\u003e  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 3003, in _call_aside\u003c/span\u003e\n\n\u003cspan class=\"s1\"\u003e  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 3032, in _initialize_master_working_set\u003c/span\u003e\n\n\u003cspan class=\"s1\"\u003e  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 657, in _build_master\u003c/span\u003e\n\n\u003cspan class=\"s1\"\u003e  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 670, in _build_from_requirements\u003c/span\u003e\n\n\u003cspan class=\"s1\"\u003e  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 849, in resolve\u003c/span\u003e\n\n\u003cspan class=\"s1\"\u003epkg_resources.DistributionNotFound: The '\u003c/span\u003e\u003cspan class=\"nv\"\u003epip\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"m\"\u003e7\u003c/span\u003e.1.0\u003cspan class=\"s1\"\u003e' distribution was not found and is required by the application'\u003c/span\u003e.\n\n\n\u003cspan class=\"c1\"\u003e# python2.6のpipではなく、2.7のが動くように交換。これやらなかったら上記エラーになってた\u003c/span\u003e\n$ sudo cp /usr/bin/pip /usr/bin/pip26\n$ sudo cp /usr/local/bin/pip /usr/bin/pip\n$ sudo ./setup.py\nInstalling dependencies ... OK\nInstalling python dependencies ... OK\nDownloading plugin ... OK\nExtracting plugin ... OK\nMoving to collectd plugins directory ... OK\nCopying CloudWatch plugin include file ... OK\n\nChoose AWS region \u003cspan class=\"k\"\u003efor\u003c/span\u003e published metrics:\n  \u003cspan class=\"m\"\u003e1\u003c/span\u003e. Automatic \u003cspan class=\"o\"\u003e[\u003c/span\u003eap-northeast-1\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"m\"\u003e2\u003c/span\u003e. Custom\nEnter choice \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e\nChoose hostname \u003cspan class=\"k\"\u003efor\u003c/span\u003e published metrics:\n  \u003cspan class=\"m\"\u003e1\u003c/span\u003e. EC2 instance id \u003cspan class=\"o\"\u003e[\u003c/span\u003ei-XXXXXXXXXXXX\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"m\"\u003e2\u003c/span\u003e. Custom\nEnter choice \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e: \u003cspan class=\"m\"\u003e2\u003c/span\u003e\nEnter hostname \u003cspan class=\"o\"\u003e[\u003c/span\u003eip-10-30-X-XXX\u003cspan class=\"o\"\u003e]\u003c/span\u003e: \n\nChoose authentication method:\n  \u003cspan class=\"m\"\u003e1\u003c/span\u003e. IAM Role \u003cspan class=\"o\"\u003e[\u003c/span\u003eXXXXXXXX-DefaultRole-XXXXXXX\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# ポリシーをセットしたロールを選択。\u003c/span\u003e\n  \u003cspan class=\"m\"\u003e2\u003c/span\u003e. IAM User\nEnter choice \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\nEnter proxy server name:\n  \u003cspan class=\"m\"\u003e1\u003c/span\u003e. None\n  \u003cspan class=\"m\"\u003e2\u003c/span\u003e. Custom\nEnter choice \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e　# とりあえずデフォルトにした\n\nEnter proxy server port:\n  \u003cspan class=\"m\"\u003e1\u003c/span\u003e. None\n  \u003cspan class=\"m\"\u003e2\u003c/span\u003e. Custom\nEnter choice \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e: \u003cspan class=\"m\"\u003e1\u003c/span\u003e　# とりあえずデフォルトにした\n\nChoose how to install CloudWatch plugin in collectd:\n  \u003cspan class=\"m\"\u003e1\u003c/span\u003e. Do not modify existing collectd configuration\n  \u003cspan class=\"m\"\u003e2\u003c/span\u003e. Add plugin to the existing configuration\n  \u003cspan class=\"m\"\u003e3\u003c/span\u003e. Use CloudWatch recommended configuration \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e metrics\u003cspan class=\"o\"\u003e)\u003c/span\u003e\nEnter choice \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e: \u003cspan class=\"m\"\u003e2\u003c/span\u003e\nPlugin configuration written successfully.\nStopping collectd process ... NOT OK\nStarting collectd process ... NOT OK　# またエラー・・・参考サイトだと動くはずなのだが・・・\nInstallation cancelled due to an error.\nExecuted command: \u003cspan class=\"s1\"\u003e'/usr/sbin/collectd'\u003c/span\u003e.\nError output: \u003cspan class=\"s1\"\u003e''\u003c/span\u003e.\n\n$ cat /opt/collectd-plugins/cloudwatch/config/blocked_metrics\n\u003cspan class=\"c1\"\u003e# This file is automatically generated - do not modify this file.    \u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# Use this file to find metrics to be added to the whitelist file instead.\u003c/span\u003e\n上記のコメントだけで、何も書かれてなかった\n\n$ cat /opt/collectd-plugins/cloudwatch/config/whitelist.conf\nここは何も書かれてなかった\n\n\u003cspan class=\"c1\"\u003e# エラーになってしまったら、syslogプラグイン有効にして起動したら `/var/log/messages` に\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# エラーが出るそうなので見たら、下記が出てた。デフォルトだと「FQDNLookup」しちゃうらしい。。。\u003c/span\u003e\nLooking up \u003cspan class=\"s2\"\u003e\"ip-10-30-X-XXX\"\u003c/span\u003e failed. You have \u003cspan class=\"nb\"\u003eset\u003c/span\u003e the \u003cspan class=\"s2\"\u003e\"FQDNLookup\"\u003c/span\u003e option, but I cannot resolve my hostname to a fully qualified domain name. Please fix the network configuration.\n\n\u003cspan class=\"c1\"\u003e# ってことでとりあえずconfを書き換える。下記を追加。\u003c/span\u003e\n$ sudo vim /etc/collectd.conf\nFQDNLookup   \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\nAutoLoadPlugin \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# このファイルも下記を追加\u003c/span\u003e\n$ cat /opt/collectd-plugins/cloudwatch/config/whitelist.conf\ncpu-0-cpu-.*\ninterface-eth0-.*\nmemory--memory-.*\n\n$ sudo service collectd start\nStarting collectd:                                         \u003cspan class=\"o\"\u003e[\u003c/span\u003e  OK  \u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#　やったー！\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eんで、Cloudwatch見てみたら、できてた \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e  \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e  \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e ここまでで３時間くらい使った・・・orz\u003cbr\u003e\n\u003ca href=\"https://ca-advance.qiita.com/files/bb5342e5-2b08-0388-96ea-44ebedd5c8dd.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://ca-advance.qiita.com/files/bb5342e5-2b08-0388-96ea-44ebedd5c8dd.jpeg\" alt=\"CloudWatch Management Console.jpg\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"続きやります\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B6%9A%E3%81%8D%E3%82%84%E3%82%8A%E3%81%BE%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e続きやります。\u003c/h3\u003e\n\n\u003cp\u003enginxプラグインでStatusをログとって、さらにrequest timeが取れるようにします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003econfig修正\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ sudo vim /etc/nginx/nginx.conf\n\u003cspan class=\"c1\"\u003e# 下記を追加。\u003c/span\u003e\nlocation /nginx-status \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    stub_status on\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n$ sudo service nginx reload\nReloading nginx:                                           \u003cspan class=\"o\"\u003e[\u003c/span\u003e  OK  \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\n$ curl http://localhost/nginx-status\nActive connections: \u003cspan class=\"m\"\u003e4\u003c/span\u003e \nserver accepts handled requests\n \u003cspan class=\"m\"\u003e406\u003c/span\u003e \u003cspan class=\"m\"\u003e406\u003c/span\u003e \u003cspan class=\"m\"\u003e2658\u003c/span\u003e \nReading: \u003cspan class=\"m\"\u003e0\u003c/span\u003e Writing: \u003cspan class=\"m\"\u003e1\u003c/span\u003e Waiting: \u003cspan class=\"m\"\u003e3\u003c/span\u003e \n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"collectdのnginxプラグインをインストールします\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#collectd%E3%81%AEnginx%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%BE%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecollectdのnginxプラグインをインストールします。\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ sudo yum -y install collectd-nginx\n\n\u003cspan class=\"c1\"\u003e# /etc/collectd.conf に以下の設定をする\u003c/span\u003e\nLoadPlugin nginx のコメントアウトを外す\n\n\u003cspan class=\"c1\"\u003e# さらに下記を追記する\u003c/span\u003e\n\u0026lt;Plugin nginx\u0026gt;\n    URL \u003cspan class=\"s2\"\u003e\"http://localhost/nginx-status\"\u003c/span\u003e\n    CACert \u003cspan class=\"s2\"\u003e\"/etc/pki/tls/certs/server.crt\"\u003c/span\u003e　#　ここはhttpsを使ってる場合で良さそう。\n\u0026lt;/Plugin\u0026gt;\n\n\u003cspan class=\"c1\"\u003e# 再起動\u003c/span\u003e\n$ sudo service collectd restart\nStopping collectd:                                         \u003cspan class=\"o\"\u003e[\u003c/span\u003e  OK  \u003cspan class=\"o\"\u003e]\u003c/span\u003e\nStarting collectd:                                         \u003cspan class=\"o\"\u003e[\u003c/span\u003e  OK  \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 下記のものがblocked_metricsに追加されているので確認。\u003c/span\u003e\n$ cat /opt/collectd-plugins/cloudwatch/config/blocked_metrics\n〜略〜\nnginx--nginx_connections-active\nnginx--connections-accepted\nnginx--connections-handled\nnginx--nginx_connections-reading\nnginx--nginx_connections-writing\nnginx--nginx_connections-waiting\nnginx--nginx_requests-\n\n\u003cspan class=\"c1\"\u003e# CloudWatch に送る対象として、上記をホワイトリストに追記する\u003c/span\u003e\n$ sudo sh -c \u003cspan class=\"s1\"\u003e'echo \"nginx--.*\" \u0026gt;\u0026gt; /opt/collectd-plugins/cloudwatch/config/whitelist.conf'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 再起動\u003c/span\u003e\n$ sudo service collectd restart\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eCloudWatchを見ると、、、、できてる \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e  \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e  \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e\u003cbr\u003e\n\u003ca href=\"https://ca-advance.qiita.com/files/4c1cf4bb-46c7-5c87-0dee-2949a984e85b.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://ca-advance.qiita.com/files/4c1cf4bb-46c7-5c87-0dee-2949a984e85b.jpeg\" alt=\"CloudWatch Management Console (2).jpg\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"collectdにてrequest_time-の値を-cloudwatch-に連携\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#collectd%E3%81%AB%E3%81%A6request_time-%E3%81%AE%E5%80%A4%E3%82%92-cloudwatch-%E3%81%AB%E9%80%A3%E6%90%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ecollectdにて、$request_time の値を CloudWatch に連携\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# /etc/nginx/nginx.confに以下のように設定したとする\u003c/span\u003e\n※末尾にした理由は、正規表現でマッチさせやすくするため\n〜略〜\nlog_format main \u003cspan class=\"s1\"\u003e'$remote_addr - $remote_user [$time_local] \"$request\" '\u003c/span\u003e\n                \u003cspan class=\"s1\"\u003e'$status $body_bytes_sent \"$http_referer\" '\u003c/span\u003e\n                \u003cspan class=\"s1\"\u003e'\"$http_user_agent\" \"$http_x_forwarded_for\" '\u003c/span\u003e\n                \u003cspan class=\"s1\"\u003e'\"$request_time\"'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n〜略〜\n\n\n\u003cspan class=\"c1\"\u003e# /etc/collectd.conf に以下の設定をする\u003c/span\u003e\nLoadPlugin tail のコメントアウトを外す\n\n\u003cspan class=\"c1\"\u003e# さらに下記を追記する\u003c/span\u003e\n\u0026lt;Plugin \u003cspan class=\"s2\"\u003e\"tail\"\u003c/span\u003e\u0026gt;\n  \u0026lt;File \u003cspan class=\"s2\"\u003e\"/var/log/nginx/access_443.log\"\u003c/span\u003e\u0026gt;\n    Instance \u003cspan class=\"s2\"\u003e\"nginx\"\u003c/span\u003e\n    \u0026lt;Match\u0026gt;\n      Regex \u003cspan class=\"s2\"\u003e\"\\\" \\\"([0-9.]+)\\\"\u003c/span\u003e$\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\n      DSType \u003cspan class=\"s2\"\u003e\"GaugeAverage\"\u003c/span\u003e\n      Type \u003cspan class=\"s2\"\u003e\"response_time\"\u003c/span\u003e\n      Instance \u003cspan class=\"s2\"\u003e\"AvgRespTime\"\u003c/span\u003e\n    \u0026lt;/Match\u0026gt;\n    \u0026lt;Match\u0026gt;\n      Regex \u003cspan class=\"s2\"\u003e\"\\\" \\\"([0-9.]+)\\\"\u003c/span\u003e$\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\n      DSType \u003cspan class=\"s2\"\u003e\"GaugeMin\"\u003c/span\u003e\n      Type \u003cspan class=\"s2\"\u003e\"response_time\"\u003c/span\u003e\n      Instance \u003cspan class=\"s2\"\u003e\"MinRespTime\"\u003c/span\u003e\n    \u0026lt;/Match\u0026gt;\n    \u0026lt;Match\u0026gt;\n      Regex \u003cspan class=\"s2\"\u003e\"\\\" \\\"([0-9.]+)\\\"\u003c/span\u003e$\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\n      DSType \u003cspan class=\"s2\"\u003e\"GaugeMax\"\u003c/span\u003e\n      Type \u003cspan class=\"s2\"\u003e\"response_time\"\u003c/span\u003e\n      Instance \u003cspan class=\"s2\"\u003e\"MaxRespTime\"\u003c/span\u003e\n    \u0026lt;/Match\u0026gt;\n  \u0026lt;/File\u0026gt;\n\u0026lt;/Plugin\u0026gt;\n\n\u003cspan class=\"c1\"\u003e# 再起動\u003c/span\u003e\n$ sudo service collectd restart\nStopping collectd:                                         \u003cspan class=\"o\"\u003e[\u003c/span\u003e  OK  \u003cspan class=\"o\"\u003e]\u003c/span\u003e\nStarting collectd:                                         \u003cspan class=\"o\"\u003e[\u003c/span\u003e  OK  \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 下記のものがblocked_metricsに追加されているので確認。\u003c/span\u003e\n$ cat /opt/collectd-plugins/cloudwatch/config/blocked_metrics\n〜略〜\ntail-nginx-response_time-AvgRespTime\ntail-nginx-response_time-MinRespTime\ntail-nginx-response_time-MaxRespTime\n\n\u003cspan class=\"c1\"\u003e# CloudWatch に送る対象として、上記をホワイトリストに追記する\u003c/span\u003e\n$ sudo sh -c \u003cspan class=\"s1\"\u003e'echo \"tail-nginx-response_time-.*\" \u0026gt;\u0026gt; /opt/collectd-plugins/cloudwatch/config/whitelist.conf'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 再起動\u003c/span\u003e\n$ sudo service collectd restart\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eCloudWatchを見ると、、、、できてる \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e  \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e  \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e\u003cbr\u003e\n\u003ca href=\"https://ca-advance.qiita.com/files/21f76d14-a827-ab92-7e1e-b6d125c6e797.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://ca-advance.qiita.com/files/21f76d14-a827-ab92-7e1e-b6d125c6e797.jpeg\" alt=\"CloudWatch Management Console (3).jpg\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"次にawslogsインストールしてエラーログ飛ばす\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AC%A1%E3%81%ABawslogs%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%A6%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%AD%E3%82%B0%E9%A3%9B%E3%81%B0%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e次に、awslogsインストールして、エラーログ飛ばす。\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eEC2インスタンス(AmazonLinux)にIAMロールを設定し、以下のようなIAMポリシーを設定します。\u003c/li\u003e\n\u003cli\u003e設定後は、nginxの起動しているインスタンスにポリシーをアタッチしてください。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e作成したIAMポリシー\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\"Version\"\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\"2012-10-17\"\u003c/span\u003e,\n  \u003cspan class=\"s2\"\u003e\"Statement\"\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"s2\"\u003e\"Action\"\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"s2\"\u003e\"logs:*\"\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e]\u003c/span\u003e,\n      \u003cspan class=\"s2\"\u003e\"Effect\"\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\"Allow\"\u003c/span\u003e,\n      \u003cspan class=\"s2\"\u003e\"Resource\"\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\"*\"\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eawslogsインストール\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ sudo yum install -y awslogs\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"awslogsconf修正\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#awslogsconf%E4%BF%AE%E6%AD%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eawslogs.conf修正\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e/etc/awslogs/awslogs.confに下記を追加\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e/var/log/nginx/error.log\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"nv\"\u003elog_group_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e nginx-error_log\n\u003cspan class=\"nv\"\u003elog_stream_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003einstance_id\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nv\"\u003efile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e /var/log/nginx/error.log\n\u003cspan class=\"nv\"\u003edatetime_format\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e %Y-%m-%d %H:%M:%S,%3N\n\u003cspan class=\"nv\"\u003einitial_position\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e start_of_file\n\u003cspan class=\"nv\"\u003ebuffer_duration\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e5000\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"awscliconf修正\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#awscliconf%E4%BF%AE%E6%AD%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eawscli.conf修正\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e/etc/awslogs/awscli.conf\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eplugins\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"nv\"\u003ecwlogs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e cwlogs\n\u003cspan class=\"o\"\u003e[\u003c/span\u003edefault\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"nv\"\u003eregion\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e ap-northeast-1\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"awslogs起動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#awslogs%E8%B5%B7%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eawslogs起動\u003c/h4\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eawslogs起動\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e$ sudo service awslogs start\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eCloudwatch見てみたら、できてた \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e  \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e  \u003cimg alt=\":exclamation:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/2757-fe0f.png\" title=\":exclamation:\" width=\"20\"\u003e これは簡単でした。\u003cbr\u003e\n\u003ca href=\"https://ca-advance.qiita.com/files/cdbef84e-c56b-8ec0-83ca-832204c9e564.jpeg\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://ca-advance.qiita.com/files/cdbef84e-c56b-8ec0-83ca-832204c9e564.jpeg\" alt=\"CloudWatch Management Console (1).jpg\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"最後にrequest-timeによるアラート作成からのauto-scalingをやる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%ABrequest-time%E3%81%AB%E3%82%88%E3%82%8B%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88%E4%BD%9C%E6%88%90%E3%81%8B%E3%82%89%E3%81%AEauto-scaling%E3%82%92%E3%82%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に、request timeによるアラート作成からのAuto Scalingをやる\u003c/h3\u003e\n\n\u003cp\u003eこれについては下記のページの「アラームの作成」から先を対応することでできた\u003cbr\u003e\n- \u003ca href=\"https://www.skyarch.net/blog/?p=10330\" rel=\"nofollow noopener\" target=\"_blank\"\u003eレスポンスタイムでAuto Scaling | Skyarch Broadcasting\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考サイト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■参考サイト\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.slideshare.net/ikedai/aws-opszabbix\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAWS Ops系サービスが更に便利になる中、それでもなおZabbixとセットで考えたほうが良いのか？\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/ryou1173/items/aaaa6cdbaae6915efb22\"\u003enginxのエラーログをcloudwatch logsに送信する - Qiita\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/toshihirock/items/9d8f104e09493eae4472\"\u003eCloudWatchLogsとSNSを使ってnginxで4xxエラーの際にメールを送信する - Qiita\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://ceblog.mediba.jp/post/154965685362/nginx-%E3%81%AE%E5%90%84%E7%A8%AE%E6%83%85%E5%A0%B1%E3%82%92-collectd-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6-cloudwatch-%E3%81%AB%E9%80%A3%E6%90%BA%E3%81%99%E3%82%8B\" rel=\"nofollow noopener\" target=\"_blank\"\u003enginx の各種情報を collectd を使って CloudWatch に連携する | mediba Creator × Engineer Blog\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.lanches.co.jp/blog/6022\" rel=\"nofollow noopener\" target=\"_blank\"\u003eEC2を起動したらやることメモ | 株式会社ランチェスター\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.skyarch.net/blog/?p=10330\" rel=\"nofollow noopener\" target=\"_blank\"\u003eレスポンスタイムでAuto Scaling | Skyarch Broadcasting\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.adachin.me/wordpress/?p=4832\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【AWS】【EC2】CloudWatchでメモリー使用率とかディスク容量とかロードアベレージとかをモニタリングしたい – ADACHIN SERVER Lab\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://blue-bear.jp/kb/aws-ec2%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%84%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E4%BD%BF%E7%94%A8%E9%87%8F%E3%82%92cloudwatch%E3%81%AB/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e[AWS] EC2インスタンスのメモリやディスク使用量をCloudWatchに送信する | BlueBear I/O\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://recipe.kc-cloud.jp/archives/4296\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAmazon Linux のPython をアップデートしてbotoをインストールします。 | ナレコムAWSレシピ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://dev.classmethod.jp/cloud/aws/collectd-cloudwatch/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ecollectdのCloudWatchプラグインを試してみた ｜ Developers.IO\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/wadatin/items/7236aafe5a3f553d86ff\"\u003eEC2のメモリ使用量とdisk使用量をcollectdでサクッとCloudWatchに登録 - Qiita\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://dev.classmethod.jp/cloud/aws/preparing-ec2-python-environment/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAmazon EC2上でPython2.7及び各種ライブラリ環境を整える ｜ Developers.IO\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://aws.amazon.com/jp/blogs/news/new-cloudwatch-plugin-for-collectd/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e新しい collectd の CloudWatch プラグイン | Amazon Web Services ブログ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://collectd.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eStart page – collectd – The system statistics collection daemon\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://dev.classmethod.jp/server-side/server/use-stress-tool-on-ec2/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eEC2でサーバーに負荷を発生させる stress ツールを使ってみる ｜ Developers.IO\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e■まとめ\u003c/h1\u003e\n\n\u003cp\u003e使ってるEC2が古すぎて、かなり苦戦した・・・ \u003cimg alt=\":sweat_smile:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f605.png\" title=\":sweat_smile:\" width=\"20\"\u003e \u003cbr\u003e\nこれでうまーくAutoScalingされるといいけどなー\u003cbr\u003e\nさて、問題なく動作するだろうか・・・\u003c/p\u003e\n","body":"#■経緯\n- Cloudwatch有効活用できてないなー\n    - 使えばAuto Scaleとかできるのに・・・\n    - せっかくなので、nginxのrequest timeが大きくなった時にAuto Scaleとかやってみたい。\n- NGINXのログをサーバに見に行くのもうしんどい・・・\n    - Fluentd -\u003e Elasticsearchでログ飛ばしてるけど、t1とかt2のインスタンスだから、しばらく使うと悲鳴を上げて泣く :cry: \n    - Fluentdのログ集約用サーバもログ用のElasticsearchサーバももう管理したくない\n\n#■考えた解決手段\n- サーバのCPU使用量とか、メモリ使用量とか、稼働時間とかもついでにCloudwatchに飛ばしちゃえ\n- さらに、NGINXのエラーログもCloudwatchに飛ばしちゃえ\n- request time取れるようにして、Auto Scalingしてみる。\n\n#■実行\n参考サイト見ると、Cloudwatchがカスタムメトリクス送れるようになったからって、\nスクリプトとかcron使ってやってる人いるけど、それではやりたくない。\ncron仕込んだとか、シェルスクリプトどこだっけとか覚えたくないし、このためにコード書きたくないしね。\nなるべくサービス使ってやる方針でやってみた。\n\n###使ったツール\n- [collectd](https://collectd.org/)\n- CloudWatch Logs(awslogs)\n\nまずは、collectdのインストールから進めたが、下記のサイトの通り進めるとエラーになった・・・\n- [collectdのCloudWatchプラグインを試してみた ｜ Developers.IO](http://dev.classmethod.jp/cloud/aws/collectd-cloudwatch/)\n\n```bash:インストールの流れ\n$ sudo ./setup.py\nTraceback (most recent call last):\n  File \"./setup.py\", line 26, in \u003cmodule\u003e\n    from subprocess import check_output, CalledProcessError, Popen, PIPE\nImportError: cannot import name check_output\n\n# むむっ・・・と思ってとりあえず、pythonのバージョンか何かかなと思って、確認。\n$ python --version\nPython 2.6.9　# 古いw\n\n# うーん、、、ってここでつまずくのイヤだったので、とりあえず2.7にアップデートして試してみた\n$ sudo yum upgrade\n$ sudo yum -y install make automake gcc gcc-c++ kernel-devel git-core python27 python27-devel\n$ which python27\n$ python -V\n\n# python2.7を見るように変える。\n$ sudo rm /usr/bin/python\n$ sudo ln -s /usr/bin/python27 /usr/bin/python\n$ python -V\n\n# yumもpython2.7を使うように変えておく。他のツールインストールするときにエラーになるらしい。\n$ sudo cp /usr/bin/yum /usr/bin/_yum_old\n$ sudo sed -i s/python/python26/g /usr/bin/yum\n\n# これが成功したら大丈夫だってさ。\n$ yum list\n\n# 次はeazy_installやpipのインストール\n$ sudo curl -o /tmp/ez_setup.py https://bootstrap.pypa.io/ez_setup.py\n$ sudo /usr/bin/python /tmp/ez_setup.py\n$ sudo /usr/bin/easy_install-2.7 pip\n\n# collectdで送り先のリージョンとか自動取得するのに、awscli使うっぽかったので、aws-cliもアップデートしておく\n$ aws --version\n$ sudo /usr/local/bin/pip install --upgrade awscli\n\n# 再度、サイトの流れで./setup.pyまで実行\n$ sudo yum -y install collectd\n$ git clone https://github.com/awslabs/collectd-cloudwatch.git\n$ cd collectd-cloudwatch/src/\n\n# またエラー・・・・\n$ sudo ./setup.py\nInstalling dependencies ... OK\nInstalling python dependencies ... NOT OK\nInstallation cancelled due to an error.\nExecuted command: '/usr/bin/pip install --quiet --upgrade --force-reinstall requests'.\nError output: 'Traceback (most recent call last):\n  File \"/usr/bin/pip\", line 5, in \u003cmodule\u003e\n    from pkg_resources import load_entry_point\n  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 3019, in \u003cmodule\u003e\n    \n  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 3003, in _call_aside\n    \n  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 3032, in _initialize_master_working_set\n    \n  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 657, in _build_master\n    \n  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 670, in _build_from_requirements\n    \n  File \"build/bdist.linux-x86_64/egg/pkg_resources/__init__.py\", line 849, in resolve\n    \npkg_resources.DistributionNotFound: The 'pip==7.1.0' distribution was not found and is required by the application'.\n\n\n# python2.6のpipではなく、2.7のが動くように交換。これやらなかったら上記エラーになってた\n$ sudo cp /usr/bin/pip /usr/bin/pip26\n$ sudo cp /usr/local/bin/pip /usr/bin/pip\n$ sudo ./setup.py\nInstalling dependencies ... OK\nInstalling python dependencies ... OK\nDownloading plugin ... OK\nExtracting plugin ... OK\nMoving to collectd plugins directory ... OK\nCopying CloudWatch plugin include file ... OK\n\nChoose AWS region for published metrics:\n  1. Automatic [ap-northeast-1]\n  2. Custom\nEnter choice [1]: 1\nChoose hostname for published metrics:\n  1. EC2 instance id [i-XXXXXXXXXXXX]\n  2. Custom\nEnter choice [1]: 2\nEnter hostname [ip-10-30-X-XXX]: \n\nChoose authentication method:\n  1. IAM Role [XXXXXXXX-DefaultRole-XXXXXXX] # ポリシーをセットしたロールを選択。\n  2. IAM User\nEnter choice [1]: 1\n\nEnter proxy server name:\n  1. None\n  2. Custom\nEnter choice [1]: 1　# とりあえずデフォルトにした\n\nEnter proxy server port:\n  1. None\n  2. Custom\nEnter choice [1]: 1　# とりあえずデフォルトにした\n\nChoose how to install CloudWatch plugin in collectd:\n  1. Do not modify existing collectd configuration\n  2. Add plugin to the existing configuration\n  3. Use CloudWatch recommended configuration (4 metrics)\nEnter choice [3]: 2\nPlugin configuration written successfully.\nStopping collectd process ... NOT OK\nStarting collectd process ... NOT OK　# またエラー・・・参考サイトだと動くはずなのだが・・・\nInstallation cancelled due to an error.\nExecuted command: '/usr/sbin/collectd'.\nError output: ''.\n\n$ cat /opt/collectd-plugins/cloudwatch/config/blocked_metrics\n# This file is automatically generated - do not modify this file.    \n# Use this file to find metrics to be added to the whitelist file instead.\n上記のコメントだけで、何も書かれてなかった\n\n$ cat /opt/collectd-plugins/cloudwatch/config/whitelist.conf\nここは何も書かれてなかった\n\n# エラーになってしまったら、syslogプラグイン有効にして起動したら `/var/log/messages` に\n# エラーが出るそうなので見たら、下記が出てた。デフォルトだと「FQDNLookup」しちゃうらしい。。。\nLooking up \"ip-10-30-X-XXX\" failed. You have set the \"FQDNLookup\" option, but I cannot resolve my hostname to a fully qualified domain name. Please fix the network configuration.\n\n# ってことでとりあえずconfを書き換える。下記を追加。\n$ sudo vim /etc/collectd.conf\nFQDNLookup   false\nAutoLoadPlugin true\n\n# このファイルも下記を追加\n$ cat /opt/collectd-plugins/cloudwatch/config/whitelist.conf\ncpu-0-cpu-.*\ninterface-eth0-.*\nmemory--memory-.*\n\n$ sudo service collectd start\nStarting collectd:                                         [  OK  ] #　やったー！\n```\n\nんで、Cloudwatch見てみたら、できてた :exclamation:  :exclamation:  :exclamation: ここまでで３時間くらい使った・・・orz\n![CloudWatch Management Console.jpg](https://ca-advance.qiita.com/files/bb5342e5-2b08-0388-96ea-44ebedd5c8dd.jpeg)\n\n###続きやります。\nnginxプラグインでStatusをログとって、さらにrequest timeが取れるようにします。\n\n```bash:config修正\n$ sudo vim /etc/nginx/nginx.conf\n# 下記を追加。\nlocation /nginx-status {\n    stub_status on;\n}\n$ sudo service nginx reload\nReloading nginx:                                           [  OK  ]\n\n$ curl http://localhost/nginx-status\nActive connections: 4 \nserver accepts handled requests\n 406 406 2658 \nReading: 0 Writing: 1 Waiting: 3 \n\n```\n\n###collectdのnginxプラグインをインストールします。\n\n```bash:\n$ sudo yum -y install collectd-nginx\n\n# /etc/collectd.conf に以下の設定をする\nLoadPlugin nginx のコメントアウトを外す\n\n# さらに下記を追記する\n\u003cPlugin nginx\u003e\n    URL \"http://localhost/nginx-status\"\n    CACert \"/etc/pki/tls/certs/server.crt\"　#　ここはhttpsを使ってる場合で良さそう。\n\u003c/Plugin\u003e\n\n# 再起動\n$ sudo service collectd restart\nStopping collectd:                                         [  OK  ]\nStarting collectd:                                         [  OK  ]\n\n# 下記のものがblocked_metricsに追加されているので確認。\n$ cat /opt/collectd-plugins/cloudwatch/config/blocked_metrics\n〜略〜\nnginx--nginx_connections-active\nnginx--connections-accepted\nnginx--connections-handled\nnginx--nginx_connections-reading\nnginx--nginx_connections-writing\nnginx--nginx_connections-waiting\nnginx--nginx_requests-\n\n# CloudWatch に送る対象として、上記をホワイトリストに追記する\n$ sudo sh -c 'echo \"nginx--.*\" \u003e\u003e /opt/collectd-plugins/cloudwatch/config/whitelist.conf'\n\n# 再起動\n$ sudo service collectd restart\n```\n\nCloudWatchを見ると、、、、できてる :exclamation:  :exclamation:  :exclamation:\n![CloudWatch Management Console (2).jpg](https://ca-advance.qiita.com/files/4c1cf4bb-46c7-5c87-0dee-2949a984e85b.jpeg)\n\n###collectdにて、$request_time の値を CloudWatch に連携\n\n```bash:\n# /etc/nginx/nginx.confに以下のように設定したとする\n※末尾にした理由は、正規表現でマッチさせやすくするため\n〜略〜\nlog_format main '$remote_addr - $remote_user [$time_local] \"$request\" '\n                '$status $body_bytes_sent \"$http_referer\" '\n                '\"$http_user_agent\" \"$http_x_forwarded_for\" '\n                '\"$request_time\"';\n〜略〜\n\n\n# /etc/collectd.conf に以下の設定をする\nLoadPlugin tail のコメントアウトを外す\n\n# さらに下記を追記する\n\u003cPlugin \"tail\"\u003e\n  \u003cFile \"/var/log/nginx/access_443.log\"\u003e\n    Instance \"nginx\"\n    \u003cMatch\u003e\n      Regex \"\\\" \\\"([0-9.]+)\\\"$\"\n      DSType \"GaugeAverage\"\n      Type \"response_time\"\n      Instance \"AvgRespTime\"\n    \u003c/Match\u003e\n    \u003cMatch\u003e\n      Regex \"\\\" \\\"([0-9.]+)\\\"$\"\n      DSType \"GaugeMin\"\n      Type \"response_time\"\n      Instance \"MinRespTime\"\n    \u003c/Match\u003e\n    \u003cMatch\u003e\n      Regex \"\\\" \\\"([0-9.]+)\\\"$\"\n      DSType \"GaugeMax\"\n      Type \"response_time\"\n      Instance \"MaxRespTime\"\n    \u003c/Match\u003e\n  \u003c/File\u003e\n\u003c/Plugin\u003e\n\n# 再起動\n$ sudo service collectd restart\nStopping collectd:                                         [  OK  ]\nStarting collectd:                                         [  OK  ]\n\n# 下記のものがblocked_metricsに追加されているので確認。\n$ cat /opt/collectd-plugins/cloudwatch/config/blocked_metrics\n〜略〜\ntail-nginx-response_time-AvgRespTime\ntail-nginx-response_time-MinRespTime\ntail-nginx-response_time-MaxRespTime\n\n# CloudWatch に送る対象として、上記をホワイトリストに追記する\n$ sudo sh -c 'echo \"tail-nginx-response_time-.*\" \u003e\u003e /opt/collectd-plugins/cloudwatch/config/whitelist.conf'\n\n# 再起動\n$ sudo service collectd restart\n```\n\nCloudWatchを見ると、、、、できてる :exclamation:  :exclamation:  :exclamation:\n![CloudWatch Management Console (3).jpg](https://ca-advance.qiita.com/files/21f76d14-a827-ab92-7e1e-b6d125c6e797.jpeg)\n\n\n###次に、awslogsインストールして、エラーログ飛ばす。\n- EC2インスタンス(AmazonLinux)にIAMロールを設定し、以下のようなIAMポリシーを設定します。\n- 設定後は、nginxの起動しているインスタンスにポリシーをアタッチしてください。\n\n```bash:作成したIAMポリシー\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"logs:*\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n```\n\n```bash:awslogsインストール\n$ sudo yum install -y awslogs\n```\n\n####awslogs.conf修正\n```bash:/etc/awslogs/awslogs.confに下記を追加\n[/var/log/nginx/error.log]\nlog_group_name = nginx-error_log\nlog_stream_name = {instance_id}\nfile = /var/log/nginx/error.log\ndatetime_format = %Y-%m-%d %H:%M:%S,%3N\ninitial_position = start_of_file\nbuffer_duration = 5000\n```\n\n####awscli.conf修正\n```bash:/etc/awslogs/awscli.conf\n[plugins]\ncwlogs = cwlogs\n[default]\nregion = ap-northeast-1\n```\n\n####awslogs起動\n```bash:awslogs起動\n$ sudo service awslogs start\n```\n\nCloudwatch見てみたら、できてた :exclamation:  :exclamation:  :exclamation: これは簡単でした。\n![CloudWatch Management Console (1).jpg](https://ca-advance.qiita.com/files/cdbef84e-c56b-8ec0-83ca-832204c9e564.jpeg)\n\n### 最後に、request timeによるアラート作成からのAuto Scalingをやる\nこれについては下記のページの「アラームの作成」から先を対応することでできた\n- [レスポンスタイムでAuto Scaling | Skyarch Broadcasting](https://www.skyarch.net/blog/?p=10330)\n\n#■参考サイト\n- [AWS Ops系サービスが更に便利になる中、それでもなおZabbixとセットで考えたほうが良いのか？](https://www.slideshare.net/ikedai/aws-opszabbix)\n- [nginxのエラーログをcloudwatch logsに送信する - Qiita](http://qiita.com/ryou1173/items/aaaa6cdbaae6915efb22)\n- [CloudWatchLogsとSNSを使ってnginxで4xxエラーの際にメールを送信する - Qiita](http://qiita.com/toshihirock/items/9d8f104e09493eae4472)\n- [nginx の各種情報を collectd を使って CloudWatch に連携する | mediba Creator × Engineer Blog](http://ceblog.mediba.jp/post/154965685362/nginx-%E3%81%AE%E5%90%84%E7%A8%AE%E6%83%85%E5%A0%B1%E3%82%92-collectd-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6-cloudwatch-%E3%81%AB%E9%80%A3%E6%90%BA%E3%81%99%E3%82%8B)\n- [EC2を起動したらやることメモ | 株式会社ランチェスター](http://www.lanches.co.jp/blog/6022)\n- [レスポンスタイムでAuto Scaling | Skyarch Broadcasting](https://www.skyarch.net/blog/?p=10330)\n- [【AWS】【EC2】CloudWatchでメモリー使用率とかディスク容量とかロードアベレージとかをモニタリングしたい – ADACHIN SERVER Lab](https://blog.adachin.me/wordpress/?p=4832)\n- [\\[AWS\\] EC2インスタンスのメモリやディスク使用量をCloudWatchに送信する | BlueBear I/O](http://blue-bear.jp/kb/aws-ec2%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E3%82%84%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E4%BD%BF%E7%94%A8%E9%87%8F%E3%82%92cloudwatch%E3%81%AB/)\n- [Amazon Linux のPython をアップデートしてbotoをインストールします。 | ナレコムAWSレシピ](https://recipe.kc-cloud.jp/archives/4296)\n- [collectdのCloudWatchプラグインを試してみた ｜ Developers.IO](http://dev.classmethod.jp/cloud/aws/collectd-cloudwatch/)\n- [EC2のメモリ使用量とdisk使用量をcollectdでサクッとCloudWatchに登録 - Qiita](http://qiita.com/wadatin/items/7236aafe5a3f553d86ff)\n- [Amazon EC2上でPython2.7及び各種ライブラリ環境を整える ｜ Developers.IO](http://dev.classmethod.jp/cloud/aws/preparing-ec2-python-environment/)\n- [新しい collectd の CloudWatch プラグイン | Amazon Web Services ブログ](https://aws.amazon.com/jp/blogs/news/new-cloudwatch-plugin-for-collectd/)\n- [Start page – collectd – The system statistics collection daemon](https://collectd.org/)\n- [EC2でサーバーに負荷を発生させる stress ツールを使ってみる ｜ Developers.IO](http://dev.classmethod.jp/server-side/server/use-stress-tool-on-ec2/)\n\n#■まとめ\n使ってるEC2が古すぎて、かなり苦戦した・・・ :sweat_smile: \nこれでうまーくAutoScalingされるといいけどなー\nさて、問題なく動作するだろうか・・・\n","coediting":false,"created_at":"2017-05-17T16:55:34+09:00","group":null,"id":"7942cfa12f2aa63e1214","private":false,"tags":[{"name":"nginx","versions":[]},{"name":"EC2","versions":[]},{"name":"CloudWatch","versions":[]},{"name":"AutoScaling","versions":[]},{"name":"運用","versions":[]}],"title":"ec2にcollectdを入れて、nginxのrequest timeによるAuto Scalingをやってみた。","updated_at":"2017-05-17T16:57:35+09:00","url":"http://qiita.com/takarake/items/7942cfa12f2aa63e1214","user":{"description":"沖縄のさえないエンジニアです。\r\nBBQが大好きです。\r\n\r\n■SlideShare\r\n・ChatOpsでシステムの運用が改善された話 : http://www.slideshare.net/shinyatakara3/chatops-69577241\r\n・ElasticSearchでいろいろやってる話 : http://www.slideshare.net/shinyatakara3/sm","facebook_id":"shinya.takara.3","followees_count":23,"followers_count":19,"github_login_name":"TakaraShinya","id":"takarake","items_count":21,"linkedin_id":"","location":"Urasoe, Okinawa, Japan","name":"やんすぃ～","organization":"株式会社シーエー・アドバンス（CA ADvance,Inc）","permanent_id":14268,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/14268/profile-images/1473683260","twitter_screen_name":"takarake","website_url":""}},{"rendered_body":"\u003cp\u003eありそうでなかったので投稿\u003c/p\u003e\n\n\u003cp\u003eVSCodeで\u003ccode\u003eファイル -\u0026gt; 基本設定 -\u0026gt; 設定\u003c/code\u003eで以下のJSONをいい感じに挿入すると\u003cbr\u003e\nJS、JSXファイルでVSCode組み込みのEmmetが略語を展開してくれる。（TABキーで展開）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"JSON\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\"emmet.syntaxProfiles\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\"javascript\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"jsx\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e情報源っぽいの（正確なのが思い出せない・・・）\u003cbr\u003e\n\u003ca href=\"https://code.visualstudio.com/updates/v1_5#_settings-to-enabledisable-emmet-for-languages\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://code.visualstudio.com/updates/v1_5#_settings-to-enabledisable-emmet-for-languages\u003c/a\u003e\u003c/p\u003e\n","body":"ありそうでなかったので投稿\n\nVSCodeで`ファイル -\u003e 基本設定 -\u003e 設定`で以下のJSONをいい感じに挿入すると\nJS、JSXファイルでVSCode組み込みのEmmetが略語を展開してくれる。（TABキーで展開）\n\n```JSON\n{\n    \"emmet.syntaxProfiles\": {\n        \"javascript\": \"jsx\"\n    }\n}\n```\n\n情報源っぽいの（正確なのが思い出せない・・・）\nhttps://code.visualstudio.com/updates/v1_5#_settings-to-enabledisable-emmet-for-languages\n","coediting":false,"created_at":"2017-05-17T16:54:56+09:00","group":null,"id":"cd543c7042f9e4c49614","private":false,"tags":[{"name":"JavaScript","versions":[]},{"name":"React","versions":[]},{"name":"VisualStudioCode","versions":[]}],"title":"VSCodeとReactを使っている時に、EmmetでJSファイル内のHTMLタグを展開する","updated_at":"2017-05-17T17:31:03+09:00","url":"http://qiita.com/migeru/items/cd543c7042f9e4c49614","user":{"description":"","facebook_id":"","followees_count":1,"followers_count":1,"github_login_name":"migutw42","id":"migeru","items_count":3,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":55873,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/55873/profile-images/1473693818","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"swift3対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#swift3%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSwift3対応\u003c/h1\u003e\n\n\u003cp\u003e最新のOSがもうXcode8.3以上じゃないとビルドできないし、検証端末をうっかりアップデートしてしまったので、泣く泣く対応することにした。Swift2.3でお茶を濁していたのがあかんかった。\u003c/p\u003e\n\n\u003cp\u003eうちのアプリはViewControllerの数が５０個弱。containerになっているものもあるので、たいして多くはないけど変更料としては以下の通りで、間に仕事割り込まれたりしながら1週間弱かかった。\u003c/p\u003e\n\n\u003cp\u003e時間かかるしスイッチングが結構頭使うので時間とって上長に理解してもらって粛々と進めるべし。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/31237/242ccdec-d177-7009-1cf7-024ae585ac3f.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"702\" alt=\"スクリーンショット 2017-05-17 14.42.29.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/31237/242ccdec-d177-7009-1cf7-024ae585ac3f.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"対応した流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AF%BE%E5%BF%9C%E3%81%97%E3%81%9F%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e対応した流れ\u003c/h1\u003e\n\n\u003col\u003e\n\u003cli\u003epodの修正\u003c/li\u003e\n\u003cli\u003e自動コンバート\u003c/li\u003e\n\u003cli\u003eエラーを逐次修正\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eになると思う。でやる時に結構大事になのが\u003cstrong\u003e作業ディレクトリをコピーしておく\u003c/strong\u003eこと。\u003cbr\u003e\n超アナログだけどswift3作業は長いので、その途中で急にビルドしなければいけない時とかにcheckoutしてビルドし直すと時間のロスが大きい。gitで管理するよりより物理的に分けておけば当然ながら早い。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"podfileを変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#podfile%E3%82%92%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003epodfileを変更\u003c/h2\u003e\n\n\u003cp\u003eswift3でビルドすることを明示\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"groff\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift2.3\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003epost_install do |installer|\n  installer.pods_project.targets.each do |target|\n    target.build_configurations.each do |config|\n      config.build_settings['EXPANDED_CODE_SIGN_IDENTITY'] = \"\"\n      config.build_settings['CODE_SIGNING_REQUIRED'] = \"NO\"\n      config.build_settings['CODE_SIGNING_ALLOWED'] = \"NO\"\n      config.build_settings['ENABLE_BITCODE'] = 'NO'\n      config.build_settings['SWIFT_VERSION'] = \"2.0\"\n      config.build_settings['ALWAYS_EMBED_SWIFT_STANDARD_LIBRARIES'] = 'NO'\n    end\n  end\nend\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift3.0\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003epost_install do |installer|\n  installer.pods_project.targets.each do |target|\n    target.build_configurations.each do |config|\n      config.build_settings['EXPANDED_CODE_SIGN_IDENTITY'] = \"\"\n      config.build_settings['CODE_SIGNING_REQUIRED'] = \"NO\"\n      config.build_settings['CODE_SIGNING_ALLOWED'] = \"NO\"\n      config.build_settings['ENABLE_BITCODE'] = 'NO'\n      // ここの指定を変更する\n      config.build_settings['SWIFT_VERSION'] = \"3.0\"\n      config.build_settings['ALWAYS_EMBED_SWIFT_STANDARD_LIBRARIES'] = 'NO'\n    end\n  end\nend\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"自動コンバート\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%8B%95%E3%82%B3%E3%83%B3%E3%83%90%E3%83%BC%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自動コンバート\u003c/h2\u003e\n\n\u003cp\u003eこれで \u003cem\u003epod install\u003c/em\u003e してXcode8.3系で開くとコンバートするか聞かれるので言われるがまま実施。この時ライブラリ群はチェックからはずしておく。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"エラーを逐次修正\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A8%E3%83%A9%E3%83%BC%E3%82%92%E9%80%90%E6%AC%A1%E4%BF%AE%E6%AD%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eエラーを逐次修正\u003c/h2\u003e\n\n\u003cp\u003eここからが本当の戦い。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ライブラリをswift3用にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92swift3%E7%94%A8%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eライブラリをswift3用にする\u003c/h3\u003e\n\n\u003cp\u003e変更が必要だったのはうちではこの辺のライブラリ。\u003cbr\u003e\nそれぞれswift3で動くバージョンを探してビルドしてを繰り返す。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift3.0\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e +  pod 'Alamofire', '4.0.1'\n +  pod 'CocoaLumberjack/Swift', '3.0.0'\n +  pod 'Himotoki', '3.0.1'\n +  pod 'ObjectMapper', '2.0.0'\n +  pod 'RxSwift',    '~\u0026gt; 3.0'\n +  pod 'RxCocoa',    '~\u0026gt; 3.0'\n +  pod 'SwiftDate', '4.0.13'\n +  pod 'RxDataSources','1.0'\n +  pod 'KeychainAccess', '3.0.0'\n +  pod 'RealmSwift','2.1.0'\n +  pod 'CryptoSwift','0.6.9'\n +  pod 'Firebase/Core'\n +  pod 'ReachabilitySwift', '~\u0026gt; 3'\n +  pod 'Ji', '~\u0026gt; 2.0.0'\n +  pod 'PagingMenuController', '1.4.0'\n +  pod 'SkyWay-iOS-SDK'\n +  pod 'JSQMessagesViewController'\n +  pod 'SwiftyJSON', '3.1.0'\n +  pod 'APIKit', '3.0.0'\n +  pod 'DynamicButton', '~\u0026gt; 4.0.0'\n +  pod \"KeyboardObserver\", '~\u0026gt;1.0.0'\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e大変だったのがAPIKitとFirebaseとRxSwift。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"apikit\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#apikit\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAPIKit\u003c/h4\u003e\n\n\u003cp\u003e諸事情でAPIKitを一部変更して使っていた。ただちゃんと調べるとやりたかったことをするインターフェースちゃんとあってほんと感謝しながらpodに変更。Himotokiと一緒に使っていたため、\u003ca href=\"https://github.com/ishkawa/APIKit/blob/master/Documentation/DefiningRequestProtocolForWebService.md\" rel=\"nofollow noopener\" target=\"_blank\"\u003eサンプル\u003c/a\u003eにあるように以下のような実装がRequestに求められる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift3.0\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eimport Himotoki\n\nextension GitHubRequest where Response: Decodable {\n    func response(from object: Any, urlResponse: HTTPURLResponse) throws -\u0026gt; Response {\n        return try Response.decodeValue(object)\n    }\n}\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの処理を共通化する必要があり、以下のように共通のRequest classを作り環境ごとに接続先を切り替える設定やレスポンスへの共通の処理を実装した。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift3.0\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eenum APIBaseURL:String{\n    case Uat1 = \"XXXXX\"\n    case Uat2 = \"XXXXX\"\n    case Uat3 = \"XXXXX\"\n    case Stg =  \"XXXXX\"\n    case Prod = \"XXXXX\"\n}\n\nprotocol RJRequestType : Request {\n\n}\n\nextension RJRequestType {\n    var baseURL:URL {\n        #if DEV1\n            return URL(string: \"http://\\(APIBaseURL.Dev1.rawValue)\")!\n        #elseif DEV1\n            return URL(string: \"http://\\(APIBaseURL.Dev2.rawValue)\")!\n        #elseif STAGING\n            return URL(string: \"https://\\(APIBaseURL.Stg.rawValue)\")!\n        #else\n            return URL(string: \"https://\\(APIBaseURL.Prod.rawValue)\")!\n        #endif\n    }\n}\n\n\nextension RJRequestType where Response: Decodable {\n\n    func interceptObject(_ object: AnyObject, URLResponse: HTTPURLResponse) throws -\u0026gt; AnyObject {\n        switch URLResponse.statusCode {\n        case 200:\n            let err = RJAPIError(object: object)\n            if err.errorCode != nil{\n                throw err\n            }\n            return object\n\n        default:\n            throw ResponseError.unacceptableStatusCode(URLResponse.statusCode)\n        }\n    }\n}\n\nextension RJAuthRequestType where Response: Decodable  {\n    func response(from object: Any, urlResponse: HTTPURLResponse) throws -\u0026gt; Response {\n        return try decodeValue(object)\n    }\n}\n\nextension RJAuthRequestType where Response: Mappable{\n\n    func response(from object: Any, urlResponse: HTTPURLResponse)-\u0026gt; Response? {\n        guard let dictionary = object as? [String: AnyObject] else {\n            return nil\n        }\n\n        let mapper = Mapper\u0026lt;Response\u0026gt;()\n        guard let object = mapper.map(JSONObject: dictionary) else {\n            return nil\n        }\n\n        return object\n    }\n}\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこれによってAPIKitで必要なRequestの共通処理を一箇所で記述した。 \u003cimg alt=\":metal:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f918.png\" title=\":metal:\" width=\"20\"\u003e\u003cbr\u003e\n感謝が止まらない。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"firebase\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#firebase\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFirebase\u003c/h4\u003e\n\n\u003cp\u003e最初は以下を指定していたんだけどビルド時にエラーがでた。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"groff\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift2.3\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003epod 'Firebase','3.3.0'\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eld: 89 duplicate symbols for architecture x86_64\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e見れみるとリンカエラーで他ライブラリと競合している可能性があるバージョンだったので、これはと思い以下に変更、無事ビルド \u003cimg alt=\":metal:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f918.png\" title=\":metal:\" width=\"20\"\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift3.0\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003epod 'Firebase/Core'\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eGoogleのiOSライブラリはトラウマがある。昔あるライブラリが依存も何も見ずに動いててios8だと落ちるバグがあった。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"rxswift\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#rxswift\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRxSwift\u003c/h4\u003e\n\n\u003cp\u003e厄介な変更点が多い。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"groff\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift2.3\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003erx_text\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift3.0\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003erx.text\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"groff\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift2.3\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e.\u003cspan class=\"k\"\u003esubscribeNext\u003c/span\u003e\u003cspan class=\"s\"\u003e{}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift3.0\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e.subscribe(onNext: { })\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eこの辺はプロジェクト全体に対してreplaceをかける。もうほんとかけまくる。一つ修正が必要なのを見つけたらプロジェクト全体で似たようなコードを探してreplaceを繰り返す。心は殺す。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/31237/3212e824-86ca-4c37-b80b-666b9af91abf.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/31237/3212e824-86ca-4c37-b80b-666b9af91abf.png\" alt=\"スクリーンショット 2017-05-17 15.17.51.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eあとは実装ミスのせいかもしれないが以下のように実装しているとsubscribeした時に値がnilもくるようになっていた。実装方法がいけなかったのかもしれないのでもうちょっと勉強する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"groff\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift2.3\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003elet validatedEmail = Variable\u0026lt;String\u0026gt;(\"\")\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"nsのプレフィックスが消えたことへの対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ns%E3%81%AE%E3%83%97%E3%83%AC%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E3%81%8C%E6%B6%88%E3%81%88%E3%81%9F%E3%81%93%E3%81%A8%E3%81%B8%E3%81%AE%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eNSのプレフィックスが消えたことへの対応\u003c/h3\u003e\n\n\u003cp\u003eNSError, NSURL, NSData, NSDateが消えることとなった。\u003cbr\u003e\nこの辺は\u003ca href=\"https://www.slideshare.net/tomohirokumagai54/ns-prefix-swift-3-startupmobile\" rel=\"nofollow noopener\" target=\"_blank\"\u003ekumagai氏の資料が熱い\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003e結論を引用すると\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e・積極的に使おう\u003cbr\u003e\n・値型になっていることに注意\u003cbr\u003e\n・ブリッジすると別インスタンスになる\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこの辺を注意してばんばんなくしていく \u003cimg alt=\":metal:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f918.png\" title=\":metal:\" width=\"20\"\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"引数の変更によるエラーがわかりにくい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BC%95%E6%95%B0%E3%81%AE%E5%A4%89%E6%9B%B4%E3%81%AB%E3%82%88%E3%82%8B%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E3%82%8F%E3%81%8B%E3%82%8A%E3%81%AB%E3%81%8F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e引数の変更によるエラーがわかりにくい\u003c/h3\u003e\n\n\u003cp\u003e適切な引数を呼ばないとinvoke系のエラーに悩まされることになる。気をつけていこう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"groff\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift2.3\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e    func setImageSmoothly(_ url: NSURL, placeholderImage: UIImage?) {\n        sd_setImageWithURL(url, placeholderImage: placeholderImage) { [weak self] image, error, cacheType, imageUrl in\n            if error != nil {\n                return\n            }\n            if image != nil \u0026amp;\u0026amp; cacheType == .None {\n                self?.fadeIn(FadeType.Normal)\n            }\n        }\n    }\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eswift3.0\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e    func setImageSmoothly(_ url: NSURL, placeholderImage: UIImage?) {\n        sd_setImage(with: url as URL, placeholderImage: placeholderImage, options: []) { image, error, cacheType, imageUrl in\n            if error != nil {\n                return\n            }\n            if image != nil \u0026amp;\u0026amp; cacheType == .none {\n                self.fadeIn(FadeType.normal)\n            }\n        }\n    }\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"その他\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://samekard.blogspot.jp/2016/09/swift22swift30.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSwift2.2からSwift3.0への変換を行ってみて \u003cbr\u003e\n\u003c/a\u003eの記事がとてもよくまとまっていて参考になりました。ありがとうございます。 \u003cimg alt=\":metal:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f918.png\" title=\":metal:\" width=\"20\"\u003e\u003c/p\u003e\n\n\u003cp\u003e自動コンバートしてDeletegaメソッドの実装時に引数が間違ってて適切に呼ばれないこととかあったりして辛かった。\u003c/p\u003e\n","body":"# Swift3対応\n最新のOSがもうXcode8.3以上じゃないとビルドできないし、検証端末をうっかりアップデートしてしまったので、泣く泣く対応することにした。Swift2.3でお茶を濁していたのがあかんかった。\n\nうちのアプリはViewControllerの数が５０個弱。containerになっているものもあるので、たいして多くはないけど変更料としては以下の通りで、間に仕事割り込まれたりしながら1週間弱かかった。\n\n時間かかるしスイッチングが結構頭使うので時間とって上長に理解してもらって粛々と進めるべし。\n\n\u003cimg width=\"702\" alt=\"スクリーンショット 2017-05-17 14.42.29.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/31237/242ccdec-d177-7009-1cf7-024ae585ac3f.png\"\u003e\n\n\n# 対応した流れ\n1. podの修正\n2. 自動コンバート\n3. エラーを逐次修正\n\nになると思う。でやる時に結構大事になのが**作業ディレクトリをコピーしておく**こと。\n超アナログだけどswift3作業は長いので、その途中で急にビルドしなければいけない時とかにcheckoutしてビルドし直すと時間のロスが大きい。gitで管理するよりより物理的に分けておけば当然ながら早い。\n\n##  podfileを変更\nswift3でビルドすることを明示\n\n```swift2.3\npost_install do |installer|\n  installer.pods_project.targets.each do |target|\n    target.build_configurations.each do |config|\n      config.build_settings['EXPANDED_CODE_SIGN_IDENTITY'] = \"\"\n      config.build_settings['CODE_SIGNING_REQUIRED'] = \"NO\"\n      config.build_settings['CODE_SIGNING_ALLOWED'] = \"NO\"\n      config.build_settings['ENABLE_BITCODE'] = 'NO'\n      config.build_settings['SWIFT_VERSION'] = \"2.0\"\n      config.build_settings['ALWAYS_EMBED_SWIFT_STANDARD_LIBRARIES'] = 'NO'\n    end\n  end\nend\n```\n\n```swift3.0\npost_install do |installer|\n  installer.pods_project.targets.each do |target|\n    target.build_configurations.each do |config|\n      config.build_settings['EXPANDED_CODE_SIGN_IDENTITY'] = \"\"\n      config.build_settings['CODE_SIGNING_REQUIRED'] = \"NO\"\n      config.build_settings['CODE_SIGNING_ALLOWED'] = \"NO\"\n      config.build_settings['ENABLE_BITCODE'] = 'NO'\n      // ここの指定を変更する\n      config.build_settings['SWIFT_VERSION'] = \"3.0\"\n      config.build_settings['ALWAYS_EMBED_SWIFT_STANDARD_LIBRARIES'] = 'NO'\n    end\n  end\nend\n\n```\n\n## 自動コンバート\nこれで *pod install* してXcode8.3系で開くとコンバートするか聞かれるので言われるがまま実施。この時ライブラリ群はチェックからはずしておく。\n\n## エラーを逐次修正\nここからが本当の戦い。\n\n### ライブラリをswift3用にする\n変更が必要だったのはうちではこの辺のライブラリ。\nそれぞれswift3で動くバージョンを探してビルドしてを繰り返す。\n\n```swift3.0\n +  pod 'Alamofire', '4.0.1'\n +  pod 'CocoaLumberjack/Swift', '3.0.0'\n +  pod 'Himotoki', '3.0.1'\n +  pod 'ObjectMapper', '2.0.0'\n +  pod 'RxSwift',    '~\u003e 3.0'\n +  pod 'RxCocoa',    '~\u003e 3.0'\n +  pod 'SwiftDate', '4.0.13'\n +  pod 'RxDataSources','1.0'\n +  pod 'KeychainAccess', '3.0.0'\n +  pod 'RealmSwift','2.1.0'\n +  pod 'CryptoSwift','0.6.9'\n +  pod 'Firebase/Core'\n +  pod 'ReachabilitySwift', '~\u003e 3'\n +  pod 'Ji', '~\u003e 2.0.0'\n +  pod 'PagingMenuController', '1.4.0'\n +  pod 'SkyWay-iOS-SDK'\n +  pod 'JSQMessagesViewController'\n +  pod 'SwiftyJSON', '3.1.0'\n +  pod 'APIKit', '3.0.0'\n +  pod 'DynamicButton', '~\u003e 4.0.0'\n +  pod \"KeyboardObserver\", '~\u003e1.0.0'\n```\n\n大変だったのがAPIKitとFirebaseとRxSwift。\n\n#### APIKit\n諸事情でAPIKitを一部変更して使っていた。ただちゃんと調べるとやりたかったことをするインターフェースちゃんとあってほんと感謝しながらpodに変更。Himotokiと一緒に使っていたため、[サンプル](https://github.com/ishkawa/APIKit/blob/master/Documentation/DefiningRequestProtocolForWebService.md)にあるように以下のような実装がRequestに求められる。\n\n\n```swift3.0\nimport Himotoki\n\nextension GitHubRequest where Response: Decodable {\n    func response(from object: Any, urlResponse: HTTPURLResponse) throws -\u003e Response {\n        return try Response.decodeValue(object)\n    }\n}\n```\n\nこの処理を共通化する必要があり、以下のように共通のRequest classを作り環境ごとに接続先を切り替える設定やレスポンスへの共通の処理を実装した。\n\n```swift3.0\nenum APIBaseURL:String{\n    case Uat1 = \"XXXXX\"\n    case Uat2 = \"XXXXX\"\n    case Uat3 = \"XXXXX\"\n    case Stg =  \"XXXXX\"\n    case Prod = \"XXXXX\"\n}\n\nprotocol RJRequestType : Request {\n    \n}\n\nextension RJRequestType {\n    var baseURL:URL {\n        #if DEV1\n            return URL(string: \"http://\\(APIBaseURL.Dev1.rawValue)\")!\n        #elseif DEV1\n            return URL(string: \"http://\\(APIBaseURL.Dev2.rawValue)\")!\n        #elseif STAGING\n            return URL(string: \"https://\\(APIBaseURL.Stg.rawValue)\")!\n        #else\n            return URL(string: \"https://\\(APIBaseURL.Prod.rawValue)\")!\n        #endif\n    }\n}\n\n\nextension RJRequestType where Response: Decodable {\n    \n    func interceptObject(_ object: AnyObject, URLResponse: HTTPURLResponse) throws -\u003e AnyObject {\n        switch URLResponse.statusCode {\n        case 200:\n            let err = RJAPIError(object: object)\n            if err.errorCode != nil{\n                throw err\n            }\n            return object\n            \n        default:\n            throw ResponseError.unacceptableStatusCode(URLResponse.statusCode)\n        }\n    }\n}\n\nextension RJAuthRequestType where Response: Decodable  {\n    func response(from object: Any, urlResponse: HTTPURLResponse) throws -\u003e Response {\n        return try decodeValue(object)\n    }\n}\n\nextension RJAuthRequestType where Response: Mappable{\n    \n    func response(from object: Any, urlResponse: HTTPURLResponse)-\u003e Response? {\n        guard let dictionary = object as? [String: AnyObject] else {\n            return nil\n        }\n        \n        let mapper = Mapper\u003cResponse\u003e()\n        guard let object = mapper.map(JSONObject: dictionary) else {\n            return nil\n        }\n        \n        return object\n    }\n}\n\n```\n\nこれによってAPIKitで必要なRequestの共通処理を一箇所で記述した。 :metal:\n感謝が止まらない。\n\n#### Firebase\n最初は以下を指定していたんだけどビルド時にエラーがでた。\n\n```swift2.3\npod 'Firebase','3.3.0'\n```\n\n\u003e ld: 89 duplicate symbols for architecture x86_64\n\n見れみるとリンカエラーで他ライブラリと競合している可能性があるバージョンだったので、これはと思い以下に変更、無事ビルド :metal:\n\n```swift3.0\npod 'Firebase/Core'\n```\n\nGoogleのiOSライブラリはトラウマがある。昔あるライブラリが依存も何も見ずに動いててios8だと落ちるバグがあった。\n\n\n#### RxSwift\n厄介な変更点が多い。\n\n```swift2.3\nrx_text\n```\n\n```swift3.0\nrx.text\n```\n\n```swift2.3\n.subscribeNext{}\n```\n\n```swift3.0\n.subscribe(onNext: { })\n```\n\nこの辺はプロジェクト全体に対してreplaceをかける。もうほんとかけまくる。一つ修正が必要なのを見つけたらプロジェクト全体で似たようなコードを探してreplaceを繰り返す。心は殺す。\n\n![スクリーンショット 2017-05-17 15.17.51.png](https://qiita-image-store.s3.amazonaws.com/0/31237/3212e824-86ca-4c37-b80b-666b9af91abf.png)\n\n\nあとは実装ミスのせいかもしれないが以下のように実装しているとsubscribeした時に値がnilもくるようになっていた。実装方法がいけなかったのかもしれないのでもうちょっと勉強する。\n\n```swift2.3\nlet validatedEmail = Variable\u003cString\u003e(\"\")\n```\n\n### NSのプレフィックスが消えたことへの対応\nNSError, NSURL, NSData, NSDateが消えることとなった。\nこの辺は[kumagai氏の資料が熱い](https://www.slideshare.net/tomohirokumagai54/ns-prefix-swift-3-startupmobile)。\n\n結論を引用すると\n\u003e ・積極的に使おう\n\u003e ・値型になっていることに注意\n\u003e ・ブリッジすると別インスタンスになる\n\nこの辺を注意してばんばんなくしていく :metal:\n\n### 引数の変更によるエラーがわかりにくい\n\n適切な引数を呼ばないとinvoke系のエラーに悩まされることになる。気をつけていこう。\n\n```swift2.3\n    func setImageSmoothly(_ url: NSURL, placeholderImage: UIImage?) {\n        sd_setImageWithURL(url, placeholderImage: placeholderImage) { [weak self] image, error, cacheType, imageUrl in\n            if error != nil {\n                return\n            }\n            if image != nil \u0026\u0026 cacheType == .None {\n                self?.fadeIn(FadeType.Normal)\n            }\n        }\n    }\n```\n\n```swift3.0\n    func setImageSmoothly(_ url: NSURL, placeholderImage: UIImage?) {\n        sd_setImage(with: url as URL, placeholderImage: placeholderImage, options: []) { image, error, cacheType, imageUrl in\n            if error != nil {\n                return\n            }\n            if image != nil \u0026\u0026 cacheType == .none {\n                self.fadeIn(FadeType.normal)\n            }\n        }\n    }\n```\n\n### その他\n[Swift2.2からSwift3.0への変換を行ってみて \n](https://samekard.blogspot.jp/2016/09/swift22swift30.html)の記事がとてもよくまとまっていて参考になりました。ありがとうございます。 :metal:\n\n自動コンバートしてDeletegaメソッドの実装時に引数が間違ってて適切に呼ばれないこととかあったりして辛かった。\n","coediting":false,"created_at":"2017-05-17T16:54:40+09:00","group":null,"id":"84365f140d7bc7baa092","private":false,"tags":[{"name":"Swift","versions":[]},{"name":"Swift3.0","versions":[]}],"title":"Swift3対応でやったこと（また更新します）","updated_at":"2017-05-17T16:54:40+09:00","url":"http://qiita.com/jumbOrNot/items/84365f140d7bc7baa092","user":{"description":"レアジョブという英会話の会社で唯一の Mobile Developerとして毎日愉快にAndroid/iOS開発をしています。\r\nまたLandskipという動画メディアサービスでGolangを使ってバックエンド開発にハーフコミットで参加しています。","facebook_id":"","followees_count":32,"followers_count":62,"github_login_name":null,"id":"jumbOrNot","items_count":69,"linkedin_id":"","location":"東新宿","name":"","organization":"Rarejob, Landskip","permanent_id":31237,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/31237/profile-images/1473685650","twitter_screen_name":"jumboOrNot","website_url":""}},{"rendered_body":"\u003cp\u003eこのエラーは、使用されたメールアドレスがPayPal Sandboxアカウントに関連付けられていないことを示しています。\u003c/p\u003e\n\n\u003cp\u003eこの問題を解決するには、APIコールの支払い先メールアドレスが、有効なSandboxアカウントに登録されていることを確認してください。メールアドレスは本物ではなくてもかまいませんが、PayPalアカウントとして存在している必要があります。\u003cbr\u003e\n\u003cbr\u003e\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"このエラーは、使用されたメールアドレスがPayPal Sandboxアカウントに関連付けられていないことを示しています。\n\nこの問題を解決するには、APIコールの支払い先メールアドレスが、有効なSandboxアカウントに登録されていることを確認してください。メールアドレスは本物ではなくてもかまいませんが、PayPalアカウントとして存在している必要があります。\n\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T16:41:04+09:00","group":null,"id":"7c70108eb8cf6cff482e","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"PayPal Sandbox環境でPayPalのアダプティブペイメントAPIを使用して分割支払いを実装しようとすると、エラー「Account not found. Unilateral receiver not allowed in chained payment is restricted (アカウントが見つかりません。チェーン型支払いで許可されていないメールアドレス未登録/未確認の受取人が制限されています)」が出るのはなぜですか?","updated_at":"2017-05-17T16:41:04+09:00","url":"http://qiita.com/PayPal_MTS/items/7c70108eb8cf6cff482e","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003e定期支払いはバッチジョブで処理され、バッチ処理のタイミングによっては遅延が発生することがあります。取引処理用に関連する設定が選択されると、支払いが行われます。\u003cbr\u003e\n\u003cbr\u003e\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"定期支払いはバッチジョブで処理され、バッチ処理のタイミングによっては遅延が発生することがあります。取引処理用に関連する設定が選択されると、支払いが行われます。\n\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T16:39:49+09:00","group":null,"id":"4d9803b23ddda05593b3","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"PayPal定期支払い設定の使用中、初回の支払いの一部が遅延することがありますが、なぜですか?","updated_at":"2017-05-17T16:39:49+09:00","url":"http://qiita.com/PayPal_MTS/items/4d9803b23ddda05593b3","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003e基本的な購読ボタンの設定IDは、\u003ca href=\"https://developer.paypal.com/docs/classic/api/merchant/GetRecurringPaymentsProfileDetails_API_Operation_NVP/?mark=getrecurringpaymentsprofiledetails\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGetRecurringPaymentsProfileDetails API\u003c/a\u003eではサポートされていません。このAPIは、\u003ca href=\"https://developer.paypal.com/docs/classic/api/merchant/CreateRecurringPaymentsProfile_API_Operation_NVP/?mark=createrecurringpaymentsprofile\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCreateRecurringPaymentsProfile API\u003c/a\u003e経由で、エクスプレス チェックアウト(APIベースの決済ソリューション)により作成された、購読または定期支払いのアカウント設定でのみ機能します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://developer.paypal.com/docs/classic/ipn/gs_IPN/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e即時支払い通知(IPN)\u003c/a\u003e経由で基本的な購読情報を収集し、自分のデータベースに格納するか、お使いのPayPalアカウントで情報を表示することをおすすめします。\u003cbr\u003e\n\u003cbr\u003e\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"基本的な購読ボタンの設定IDは、[GetRecurringPaymentsProfileDetails API](https://developer.paypal.com/docs/classic/api/merchant/GetRecurringPaymentsProfileDetails_API_Operation_NVP/?mark=getrecurringpaymentsprofiledetails)ではサポートされていません。このAPIは、[CreateRecurringPaymentsProfile API](https://developer.paypal.com/docs/classic/api/merchant/CreateRecurringPaymentsProfile_API_Operation_NVP/?mark=createrecurringpaymentsprofile)経由で、エクスプレス チェックアウト(APIベースの決済ソリューション)により作成された、購読または定期支払いのアカウント設定でのみ機能します。\n\n[即時支払い通知(IPN)](https://developer.paypal.com/docs/classic/ipn/gs_IPN/)経由で基本的な購読情報を収集し、自分のデータベースに格納するか、お使いのPayPalアカウントで情報を表示することをおすすめします。\n\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T16:38:58+09:00","group":null,"id":"cd2908bf2b6aa607157d","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"PayPal定期請求の更新中に、エラー「Subscription Profiles not supported by Recurring Payment APIs (購読設定は定期支払いAPIではサポートされていません)」が出るのはなぜですか?","updated_at":"2017-05-17T16:38:58+09:00","url":"http://qiita.com/PayPal_MTS/items/cd2908bf2b6aa607157d","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003eStoryboardからViewControllerのインスタンスを得る仕組みとして \u003ccode\u003e\u0026lt;#クラス#\u0026gt;.fromStoryboard()\u003c/code\u003e という共通のAPIにまとめてみました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"macos\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#macos\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003emacOS\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eNSViewController.swift\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eCocoa\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"nc\"\u003eStoryboardInstantiatable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"cm\"\u003e/*\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e    継承クラスで以下を定義してください\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e    typealias StoryboardInstantiatableViewController = \u0026lt;#YourViewController#\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e    static var storyboardName: String {\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e        return \"\u0026lt;#Storyboard Name#\u0026gt;\"\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e    }\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e    */\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eassociatedtype\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNSViewController\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// Storyboard 名を返す\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"kr\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// Initial View Controller をロードするには nil を返す\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"kr\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithStoryboardID\u003c/span\u003e \u003cspan class=\"n\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"nc\"\u003eStoryboardInstantiatable\u003c/span\u003e \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"kc\"\u003eSelf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNSViewController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Main\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// デフォルト実装では View Controller 名を ID として返す\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e\\(\u003c/span\u003e\u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"si\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithStoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithStoryboardID\u003c/span\u003e \u003cspan class=\"n\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003esb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNSStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003estoryboardName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebundle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estoryboardID\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einstantiateController\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithIdentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einstantiateInitialController\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使い方storyboard名のみを指定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%96%B9storyboard%E5%90%8D%E3%81%AE%E3%81%BF%E3%82%92%E6%8C%87%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い方：Storyboard名のみを指定\u003c/h2\u003e\n\n\u003cp\u003etypealiasとStoryboard名が必須です。\u003cbr\u003e\nInitial View Controller、あるいはクラス名のStoryboard IDで自動判定します。Storyboard側でクラス名と同じものをStoryboard IDとして設定しておきましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStoryboard名のみを指定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNSViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003etypealias\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eViewController\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"MyStoryboardName\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e呼び出し\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003evc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使い方storyboard名とstoryboard-idを指定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%96%B9storyboard%E5%90%8D%E3%81%A8storyboard-id%E3%82%92%E6%8C%87%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い方：Storyboard名とStoryboard IDを指定\u003c/h2\u003e\n\n\u003cp\u003e特定のStoryboard IDでインスタンスを得ます。IDが不正だとクラッシュします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStoryboard名のみを指定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNSViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003etypealias\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eViewController\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"MyStoryboardName\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"UltraViewController\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e呼び出し\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003evc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"使い方storyboard名とinitial-view-controllerを指定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%96%B9storyboard%E5%90%8D%E3%81%A8initial-view-controller%E3%82%92%E6%8C%87%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い方：Storyboard名とInitial View Controllerを指定\u003c/h2\u003e\n\n\u003cp\u003eStoryboard IDでnilを返すとInitial View Controllerのインスタンスを得ます。うまく設定されていなければクラッシュします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eStoryboard名のみを指定\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNSViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003etypealias\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eViewController\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"MyStoryboardName\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e呼び出し\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003evc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ios\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ios\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eiOS\u003c/h1\u003e\n\n\u003cp\u003e使い方は基本的に同じ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUIViewController.swift\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eUIKit\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"nc\"\u003eStoryboardInstantiatable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"cm\"\u003e/*\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e    継承クラスで以下を定義してください\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e    typealias StoryboardInstantiatableViewController = \u0026lt;#YourViewController#\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e    static var storyboardName: String {\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e        return \"\u0026lt;#Storyboard Name#\u0026gt;\"\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e    }\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e    */\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eassociatedtype\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"bp\"\u003eUIViewController\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e/// Storyboard 名を返す\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"kr\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e/// Initial View Controller をロードするには nil を返す\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"kr\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithStoryboardID\u003c/span\u003e \u003cspan class=\"n\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"nc\"\u003eStoryboardInstantiatable\u003c/span\u003e \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"kc\"\u003eSelf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"bp\"\u003eUIViewController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Main\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// デフォルト実装では View Controller 名を ID として返す\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e\\(\u003c/span\u003e\u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"si\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithStoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efromStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithStoryboardID\u003c/span\u003e \u003cspan class=\"n\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003esb\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eUIStoryboard\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003estoryboardName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebundle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003estoryboardID\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estoryboardID\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einstantiateViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithIdentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003estoryboardID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einstantiateInitialViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e \u003cspan class=\"n\"\u003eStoryboardInstantiatableViewController\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n","body":"StoryboardからViewControllerのインスタンスを得る仕組みとして `\u003c#クラス#\u003e.fromStoryboard()` という共通のAPIにまとめてみました。\n\n# macOS\n\n```swift:NSViewController.swift\n\nimport Cocoa\n\nprotocol StoryboardInstantiatable: class {\n\t\n\t/*\n\t継承クラスで以下を定義してください\n\ttypealias StoryboardInstantiatableViewController = \u003c#YourViewController#\u003e\n\tstatic var storyboardName: String {\n\t\treturn \"\u003c#Storyboard Name#\u003e\"\n\t}\n\t*/\n\t\n\tassociatedtype StoryboardInstantiatableViewController: NSViewController\n\t\n\t/// Storyboard 名を返す\n\tstatic var storyboardName: String {get}\n\t/// Initial View Controller をロードするには nil を返す\n\tstatic var storyboardID: String? {get}\n\t\n\tstatic func fromStoryboard(withStoryboardID storyboardID: String?) -\u003e StoryboardInstantiatableViewController\n\tstatic func fromStoryboard() -\u003e StoryboardInstantiatableViewController\n\t\n}\n\nextension StoryboardInstantiatable where Self: NSViewController {\n\t\n\tstatic var storyboardName: String {\n\t\treturn \"Main\"\n\t}\n\t\n\t// デフォルト実装では View Controller 名を ID として返す\n\tstatic var storyboardID: String? {\n\t\treturn \"\\(self)\"\n\t}\n\t\n\tstatic func fromStoryboard() -\u003e StoryboardInstantiatableViewController {\n\t\treturn fromStoryboard(withStoryboardID: self.storyboardID)\n\t}\n\t\n\tstatic func fromStoryboard(withStoryboardID storyboardID: String?) -\u003e StoryboardInstantiatableViewController {\n\t\tlet sb = NSStoryboard(name: storyboardName, bundle: nil)\n\t\t\n\t\tif let storyboardID = storyboardID {\n\t\t\treturn sb.instantiateController(withIdentifier: storyboardID) as! StoryboardInstantiatableViewController\n\t\t}\n\t\telse {\n\t\t\treturn sb.instantiateInitialController() as! StoryboardInstantiatableViewController\n\t\t}\n\t}\n\t\n}\n\n```\n\n## 使い方：Storyboard名のみを指定\n\ntypealiasとStoryboard名が必須です。\nInitial View Controller、あるいはクラス名のStoryboard IDで自動判定します。Storyboard側でクラス名と同じものをStoryboard IDとして設定しておきましょう。\n\n```swift:Storyboard名のみを指定\n\nclass ViewController: NSViewController, StoryboardInstantiatable {\n\n\ttypealias StoryboardInstantiatableViewController = ViewController\n\tstatic var storyboardName: String {\n\t\treturn \"MyStoryboardName\"\n\t}\n\n}\n```\n\n```swift:呼び出し\nlet vc = ViewController.fromStoryboard()\n```\n\n## 使い方：Storyboard名とStoryboard IDを指定\n\n特定のStoryboard IDでインスタンスを得ます。IDが不正だとクラッシュします。\n\n```swift:Storyboard名のみを指定\n\nclass ViewController: NSViewController, StoryboardInstantiatable {\n\n\ttypealias StoryboardInstantiatableViewController = ViewController\n\tstatic var storyboardName: String {\n\t\treturn \"MyStoryboardName\"\n\t}\n\tstatic var storyboardId: String? {\n\t\treturn \"UltraViewController\"\n\t}\n\n}\n```\n\n```swift:呼び出し\nlet vc = ViewController.fromStoryboard()\n```\n\n## 使い方：Storyboard名とInitial View Controllerを指定\n\nStoryboard IDでnilを返すとInitial View Controllerのインスタンスを得ます。うまく設定されていなければクラッシュします。\n\n```swift:Storyboard名のみを指定\n\nclass ViewController: NSViewController, StoryboardInstantiatable {\n\n\ttypealias StoryboardInstantiatableViewController = ViewController\n\tstatic var storyboardName: String {\n\t\treturn \"MyStoryboardName\"\n\t}\n\tstatic var storyboardId: String? {\n\t\treturn nil\n\t}\n\n}\n```\n\n```swift:呼び出し\nlet vc = ViewController.fromStoryboard()\n```\n\n# iOS\n\n使い方は基本的に同じ。\n\n```swift:UIViewController.swift\nimport UIKit\n\nprotocol StoryboardInstantiatable: class {\n\t\n\t/*\n\t継承クラスで以下を定義してください\n\ttypealias StoryboardInstantiatableViewController = \u003c#YourViewController#\u003e\n\tstatic var storyboardName: String {\n\t\treturn \"\u003c#Storyboard Name#\u003e\"\n\t}\n\t*/\n\t\n\tassociatedtype StoryboardInstantiatableViewController: UIViewController\n\t\n\t/// Storyboard 名を返す\n\tstatic var storyboardName: String {get}\n\t/// Initial View Controller をロードするには nil を返す\n\tstatic var storyboardID: String? {get}\n\t\n\tstatic func fromStoryboard(withStoryboardID storyboardID: String?) -\u003e StoryboardInstantiatableViewController\n\tstatic func fromStoryboard() -\u003e StoryboardInstantiatableViewController\n\t\n}\n\nextension StoryboardInstantiatable where Self: UIViewController {\n\t\n\tstatic var storyboardName: String {\n\t\treturn \"Main\"\n\t}\n\t\n\t// デフォルト実装では View Controller 名を ID として返す\n\tstatic var storyboardID: String? {\n\t\treturn \"\\(self)\"\n\t}\n\t\n\tstatic func fromStoryboard() -\u003e StoryboardInstantiatableViewController {\n\t\treturn fromStoryboard(withStoryboardID: self.storyboardID)\n\t}\n\t\n\tstatic func fromStoryboard(withStoryboardID storyboardID: String?) -\u003e StoryboardInstantiatableViewController {\n\t\tlet sb = UIStoryboard(name: storyboardName, bundle: nil)\n\t\t\n\t\tif let storyboardID = storyboardID {\n\t\t\treturn sb.instantiateViewController(withIdentifier: storyboardID) as! StoryboardInstantiatableViewController\n\t\t}\n\t\telse {\n\t\t\treturn sb.instantiateInitialViewController() as! StoryboardInstantiatableViewController\n\t\t}\n\t}\n\t\n}\n\n```\n\n","coediting":false,"created_at":"2017-05-17T16:38:33+09:00","group":null,"id":"3a32ee63d9e331c98da9","private":false,"tags":[{"name":"Mac","versions":[]},{"name":"MacOSX","versions":[]},{"name":"iOS","versions":[]},{"name":"Cocoa","versions":[]},{"name":"Swift","versions":["3"]}],"title":"ViewController インスタンスを Storyboard から取得する extension","updated_at":"2017-05-17T16:38:33+09:00","url":"http://qiita.com/usagimaru/items/3a32ee63d9e331c98da9","user":{"description":"Interface Developer / Mac / iOS","facebook_id":"","followees_count":8,"followers_count":288,"github_login_name":"usagimaru","id":"usagimaru","items_count":171,"linkedin_id":"","location":"","name":"usagimaru","organization":"","permanent_id":3603,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/3603/profile-images/1473683336","twitter_screen_name":"usagimaruma","website_url":"https://medium.com/@usagimaru"}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"目的\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E7%9A%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目的\u003c/h1\u003e\n\n\u003cp\u003ePythonで学べること、できることをざっくりと学んでみよう！というのが本講座の目的です\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePythonでどんなことができるの？\u003c/li\u003e\n\u003cli\u003ePythonを勉強するメリットは？\u003c/li\u003e\n\u003cli\u003ePythonでこんなことができるんだ！\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eといった、目的ベースで学ぶことができるように(心がけた)講座です。\u003cbr\u003e\n……そんな大したことはやらなかったりしますので、Python玄人は回れ右(またはコメントで修正案を出してもらえると……)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h1\u003e\n\n\u003cp\u003eこの講座では以下の環境が整っていることを前提としています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePython2.7.xx\u003c/li\u003e\n\u003cli\u003epip 9.0\u003c/li\u003e\n\u003cli\u003eWindows10\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e一応、こちらではAtomテキストエディタを用いていますが\u003cbr\u003e\nデフォルトのIDLEなどのエディタでも構いません。(コードが書ければよい)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"目次\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E6%AC%A1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目次\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/RyuSA/items/e2dbd61e4becc80f236e\" id=\"reference-339b50ab36bf74a2761e\"\u003eインストール編\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://qiita.com/RyuSA/items/5dd28c1536b94e260485\" id=\"reference-0f42f9a0f525c4ae0637\"\u003e基本事項(型・print文・if文)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e基本事項(for文・while文)\u003c/li\u003e\n\u003cli\u003e基本事項(関数の定義)\u003c/li\u003e\n\u003cli\u003eデータベースの基本\u003c/li\u003e\n\u003cli\u003eクラスの基本\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"github\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#github\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003egithub\u003c/h1\u003e\n\n\u003cp\u003e用いたコードは以下のページにて公開してあります。\u003cbr\u003e\n使いたい人はどうぞ。\u003c/p\u003e\n","body":"# 目的\nPythonで学べること、できることをざっくりと学んでみよう！というのが本講座の目的です\n\n- Pythonでどんなことができるの？\n- Pythonを勉強するメリットは？\n- Pythonでこんなことができるんだ！\n\nといった、目的ベースで学ぶことができるように(心がけた)講座です。\n……そんな大したことはやらなかったりしますので、Python玄人は回れ右(またはコメントで修正案を出してもらえると……)\n\n# 環境\nこの講座では以下の環境が整っていることを前提としています。\n\n- Python2.7.xx\n- pip 9.0\n- Windows10\n\n一応、こちらではAtomテキストエディタを用いていますが\nデフォルトのIDLEなどのエディタでも構いません。(コードが書ければよい)\n\n# 目次\n\n- [インストール編](http://qiita.com/RyuSA/items/e2dbd61e4becc80f236e)\n- [基本事項(型・print文・if文)](http://qiita.com/RyuSA/items/5dd28c1536b94e260485)\n- 基本事項(for文・while文)\n- 基本事項(関数の定義)\n- データベースの基本\n- クラスの基本\n\n# github\n用いたコードは以下のページにて公開してあります。\n使いたい人はどうぞ。\n","coediting":false,"created_at":"2017-05-17T16:36:22+09:00","group":null,"id":"69d9d18768bd54175433","private":false,"tags":[{"name":"Python","versions":[]},{"name":"初心者","versions":[]},{"name":"python2.7","versions":[]}],"title":"初心者の初心者による初心者のためのPython講座","updated_at":"2017-05-17T17:41:14+09:00","url":"http://qiita.com/RyuSA/items/69d9d18768bd54175433","user":{"description":"PythonとRoRをほそぼそと勉強中の大学院生です。\r\nAndroid開発もやってみたい…Webアプリケーションもやってみたい…","facebook_id":"","followees_count":0,"followers_count":3,"github_login_name":"RyuSA","id":"RyuSA","items_count":9,"linkedin_id":"","location":"Tokyo","name":"RyuSA","organization":"","permanent_id":136539,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/136539/profile-images/1488360778","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003e指定された\u003ca href=\"http://developer.paypal.com/docs/rest/api/identity/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eredirect_uri\u003c/a\u003eの要素は、プロトコル、ホスト、ポート、およびコンテキストパスを含め、すべて、登録されている復帰URLに一致する必要があります。お客さまの復帰URLは、\u003ca href=\"http://developer.paypal.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDeveloper Portal(デベロッパーポータル)\u003c/a\u003eにログインして、\u003ca href=\"https://developer.paypal.com/developer/applications\" rel=\"nofollow noopener\" target=\"_blank\"\u003e「My Apps \u0026amp; Credentials (アプリ・認証情報)」\u003c/a\u003eページで確認できます。\u003c/p\u003e\n\n\u003cp\u003eアカウントとコードに矛盾があると、Redirect_uriエラーが発生します。変更する場合は、必ずお客さまのアカウントおよびコードで同じ更新を適用してください。値の更新には数時間かかる場合があります。\u003cbr\u003e\n\u003cbr\u003e\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"指定された[redirect_uri](http://developer.paypal.com/docs/rest/api/identity/)の要素は、プロトコル、ホスト、ポート、およびコンテキストパスを含め、すべて、登録されている復帰URLに一致する必要があります。お客さまの復帰URLは、[Developer Portal(デベロッパーポータル)](http://developer.paypal.com/)にログインして、[「My Apps \u0026 Credentials (アプリ・認証情報)」](https://developer.paypal.com/developer/applications)ページで確認できます。\n\nアカウントとコードに矛盾があると、Redirect_uriエラーが発生します。変更する場合は、必ずお客さまのアカウントおよびコードで同じ更新を適用してください。値の更新には数時間かかる場合があります。\n\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T16:35:58+09:00","group":null,"id":"1b0d1e5d6b62687d5e91","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"PayPalでログイン（Login with PayPal）のリダイレクトURLを設定する方法を教えてください。","updated_at":"2017-05-17T16:35:58+09:00","url":"http://qiita.com/PayPal_MTS/items/1b0d1e5d6b62687d5e91","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003ePayPal PHP SDKを「Sandboxでの使用」から「本番」に切り替える方法は以下のとおりです。\u003cbr\u003e\n1. 以下の2つの方法のいずれかの方法ｄ、SDKのモードを「live」に設定します。\u003cbr\u003e\na.  \u003ca href=\"http://github.com/paypal/PayPal-PHP-SDK/blob/master/sample/sdk_config.ini#L24\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSdk_config.ini\u003c/a\u003eを使用: \u003cbr\u003e\n \u003ca href=\"https://www.paypal-knowledge.com/library/PAYPAL/TECHNICAL_SUPPORT/FAQ1992/1sdk_configini.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://www.paypal-knowledge.com/library/PAYPAL/TECHNICAL_SUPPORT/FAQ1992/1sdk_configini.png\" alt=\"image\"\u003e\u003c/a\u003e\u003cbr\u003e\nb.  \u003ca href=\"https://github.com/paypal/PayPal-PHP-SDK/blob/master/sample/bootstrap.php#L74\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAPIContext\u003c/a\u003eを使用: \u003cbr\u003e\n \u003ca href=\"https://www.paypal-knowledge.com/library/PAYPAL/TECHNICAL_SUPPORT/FAQ1992/2APIContext.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://www.paypal-knowledge.com/library/PAYPAL/TECHNICAL_SUPPORT/FAQ1992/2APIContext.png\" alt=\"image\"\u003e\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e\n2. 本番環境の\u003cstrong\u003eclientId\u003c/strong\u003eと\u003cstrong\u003esecret\u003c/strong\u003eを有効にします。これは、Sandboxと本番環境では動作が大きく異なるためです。\u003cbr\u003e\na.  \u003ca href=\"http://developer.paypal.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eデベロッパーポータル\u003c/a\u003eにログインします。\u003cbr\u003e\nb.  \u003cstrong\u003e[Dashboard(ダッシュボード)]\u003c/strong\u003eをクリックします。\u003cbr\u003e\nc.  \u003cstrong\u003e「My Apps \u0026amp; Credentials (アプリ・認証情報)」\u003c/strong\u003eで、編集するアプリを選択します。\u003cbr\u003e\nd.  アプリを、\u003cstrong\u003eSandbox\u003c/strong\u003eから\u003cstrong\u003eLive\u003c/strong\u003eに切り替えます。\u003cbr\u003e\ne.  表示されている本番環境のAPI認証情報を使用して、SDKまたはショッピングカートの認証情報を設定します。\u003cbr\u003e\n\u003cbr\u003e\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"PayPal PHP SDKを「Sandboxでの使用」から「本番」に切り替える方法は以下のとおりです。\n1. 以下の2つの方法のいずれかの方法ｄ、SDKのモードを「live」に設定します。\na.\t[Sdk_config.ini](http://github.com/paypal/PayPal-PHP-SDK/blob/master/sample/sdk_config.ini#L24)を使用: \n ![image](https://www.paypal-knowledge.com/library/PAYPAL/TECHNICAL_SUPPORT/FAQ1992/1sdk_configini.png)\nb.\t[APIContext](https://github.com/paypal/PayPal-PHP-SDK/blob/master/sample/bootstrap.php#L74)を使用: \n ![image](https://www.paypal-knowledge.com/library/PAYPAL/TECHNICAL_SUPPORT/FAQ1992/2APIContext.png)  \n2. 本番環境の**clientId**と**secret**を有効にします。これは、Sandboxと本番環境では動作が大きく異なるためです。\na.\t[デベロッパーポータル](http://developer.paypal.com/)にログインします。\nb.\t**[Dashboard(ダッシュボード)]**をクリックします。\nc.\t**「My Apps \u0026 Credentials (アプリ・認証情報)」**で、編集するアプリを選択します。\nd.\tアプリを、**Sandbox**から**Live**に切り替えます。\ne.\t表示されている本番環境のAPI認証情報を使用して、SDKまたはショッピングカートの認証情報を設定します。\n\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T16:33:23+09:00","group":null,"id":"f94f2523af8e783e5b00","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"PayPal PHP SDKを「Sandboxでの使用」から「本番」に切り替える方法を教えてください。","updated_at":"2017-05-17T16:33:23+09:00","url":"http://qiita.com/PayPal_MTS/items/f94f2523af8e783e5b00","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003e画像系の事じゃない、言語とか音声のRNNをコネコネしていると、Encoder-DecoderモデルでDecoderの系列がクッソ長い場合にVARMに計算履歴が乗らなくなったりするので、いい感じにtruncateしたい。\u003c/p\u003e\n\n\u003cp\u003e適当にunchain_backwardしてしまうとencoederのchainも切られてしまうので、unchainした次のupdateの時点でencoderがupdateされない。backwardを追う限り切られてるっぽい。ホントはなんも気にしなくても良いのかもしれないけど。\u003c/p\u003e\n\n\u003cp\u003eそこで糞ハックをする。cut_unchainingというattributeが生えてるValiableは、creatorのfunctionとの接続はunchainされず、それ以前の履歴はすべて残るようにする。これでよいのかどうかは知らんしpr出すのもだるいのでmonkey patchする。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003edef new_unchain_backward(self):\n    cand_funcs = []\n    seen_set = set()\n\n    def add_cand(cand):\n        if cand is not None and cand not in seen_set:\n            cand_funcs.append(cand)\n            seen_set.add(cand)\n    add_cand(self.creator)\n\n    while cand_funcs:\n        func = cand_funcs.pop()\n        for var in func.inputs:\n            if not hasattr(var, \"cut_unchaining\"):\n                add_cand(var.creator)\n        func.unchain()\n\ndef new_unchain(self):\n    cut_unchaining = False\n    for y in self.outputs:\n        y_ref = y()\n        if hasattr(y_ref, \"cut_unchaining\"):\n            cut_unchaining = True\n        if y_ref is not None and not(hasattr(y_ref, \"cut_unchaining\")):\n            y_ref.creator = None\n    if not(cut_unchaining):\n        self.inputs = None  # inputが複数ある場合死ぬかも\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以下擬似コード\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003ewith mock.patch('chainer.variable.Variable.unchain_backward', new_unchain_backward):\n    with mock.patch('chainer.function.Function.unchain', new_unchain):\n        count = 0\n        for X, Y in batch_gen():\n            encoder_out = encoder(X)\n            encoder_out.cut_unchaining = True\n            acc_loss = chainer.Variable(xp.zeros((), dtype=xp.float32))\n            for loss in samples(encoder_out , Y):\n                count += 1\n                acc_loss += loss\n                if count % 1000 = 0:\n                    optimizer.target.cleargrads()\n                    acc_loss.backward()\n                    acc_loss.unchain_backward()  # encoder_outより前のchainは切られない\n                    optimizer.update()\n            optimizer.target.cleargrads()\n            acc_loss.backward()\n            optimizer.update()\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"\n画像系の事じゃない、言語とか音声のRNNをコネコネしていると、Encoder-DecoderモデルでDecoderの系列がクッソ長い場合にVARMに計算履歴が乗らなくなったりするので、いい感じにtruncateしたい。\n\n適当にunchain_backwardしてしまうとencoederのchainも切られてしまうので、unchainした次のupdateの時点でencoderがupdateされない。backwardを追う限り切られてるっぽい。ホントはなんも気にしなくても良いのかもしれないけど。\n\nそこで糞ハックをする。cut_unchainingというattributeが生えてるValiableは、creatorのfunctionとの接続はunchainされず、それ以前の履歴はすべて残るようにする。これでよいのかどうかは知らんしpr出すのもだるいのでmonkey patchする。\n\n```\ndef new_unchain_backward(self):\n    cand_funcs = []\n    seen_set = set()\n\n    def add_cand(cand):\n        if cand is not None and cand not in seen_set:\n            cand_funcs.append(cand)\n            seen_set.add(cand)\n    add_cand(self.creator)\n\n    while cand_funcs:\n        func = cand_funcs.pop()\n        for var in func.inputs:\n            if not hasattr(var, \"cut_unchaining\"):\n                add_cand(var.creator)\n        func.unchain()\n\ndef new_unchain(self):\n    cut_unchaining = False\n    for y in self.outputs:\n        y_ref = y()\n        if hasattr(y_ref, \"cut_unchaining\"):\n            cut_unchaining = True\n        if y_ref is not None and not(hasattr(y_ref, \"cut_unchaining\")):\n            y_ref.creator = None\n    if not(cut_unchaining):\n        self.inputs = None  # inputが複数ある場合死ぬかも\n```\n\n\n以下擬似コード\n\n```\nwith mock.patch('chainer.variable.Variable.unchain_backward', new_unchain_backward):\n    with mock.patch('chainer.function.Function.unchain', new_unchain):\n        count = 0\n        for X, Y in batch_gen():\n            encoder_out = encoder(X)\n            encoder_out.cut_unchaining = True\n            acc_loss = chainer.Variable(xp.zeros((), dtype=xp.float32))\n            for loss in samples(encoder_out , Y):\n                count += 1\n                acc_loss += loss\n                if count % 1000 = 0:\n                    optimizer.target.cleargrads()\n                    acc_loss.backward()\n                    acc_loss.unchain_backward()  # encoder_outより前のchainは切られない\n                    optimizer.update()\n            optimizer.target.cleargrads()\n            acc_loss.backward()\n            optimizer.update()\n```\n","coediting":false,"created_at":"2017-05-17T16:29:11+09:00","group":null,"id":"11a89194eec7c80562db","private":false,"tags":[{"name":"腕力","versions":[]}],"title":"Encoder-DecoderでDecoderの出力がクッソ長いときのTruncated BPTT","updated_at":"2017-05-18T00:22:25+09:00","url":"http://qiita.com/shunsukeaihara/items/11a89194eec7c80562db","user":{"description":"動物園ごときで飼い慣らされたりしない\r\n\r\nhttps://bitbucket.org/aihara","facebook_id":"shunsukeaihara","followees_count":7,"followers_count":22,"github_login_name":"shunsukeaihara","id":"shunsukeaihara","items_count":14,"linkedin_id":"shunsukeaihara","location":"ジャングル","name":"Aihara Shunsuke","organization":"Freelance","permanent_id":43606,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/43606/profile-images/1473689586","twitter_screen_name":"shunsukeaihara","website_url":"http://argmax.jp"}},{"rendered_body":"\u003cp\u003eまとまったshellscriptを書いて最近はまったところ\u003cbr\u003e\u003cbr\u003e\n忘れることが多いのでメモ  \u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003etrapは記述した以降の処理しかtrapできない\u003c/strong\u003e   \u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e時間がかかる処理なんだけど、\u003cbr\u003e\u003cbr\u003e\n外からkillされた時でもbackupしてほしいとかいう時に使うんですが、\u003cbr\u003e\u003cbr\u003e\nスクリプトの中にtrapが出る前にkillされたりすると、発動しない\u003cbr\u003e\u003cbr\u003e\nあたり前といえば当たり前。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e#!/bin/sh\n\n#処理A \n#ここで exit 1としてもtrapに行かない\n\ntrap backup 0 1 9\n\n#処理B ここで exit 1とかやるとtrapされる\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e複数行のものを引数に与える時は\"で囲む\u003c/strong\u003e   \u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこれも久々に思い出しったって感じ。\u003cbr\u003e\u003cbr\u003e\nそういえばそーだなーって。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e#!/bin/sh\n\nlist=`ls -la ./`\n\nfunc $list   #これだと初めの1行しか持って行かれない\nfunc \"$list\" #全部を処理したい場合はこうする\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eグローバル、ローカル変数を意識する\u003c/strong\u003e   \u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e負債的な感じのながーいshellscriptとかを分割するんだけど\u003cbr\u003e\u003cbr\u003e\n関数内であっても同じ変数名だとスコープが同じ。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e#########\n#mainA.sh\n#!/bin/sh\n\n. ./func.sh\n\nval=\"test\"\n\nfuncA val \necho val #この結果は \"A\"\n\n#########\n#mainB.sh\n#!/bin/sh\n\n. ./func.sh\n\nval=\"test\"\n\nfuncB val \necho val #この結果は \"test\"\n\n\n##########\n#func.sh\n#!/bin/sh\nfuncA(){\n  val=$1        #これだとvalを変更すると全部のvalが変更されてしまう。\n  val=\"A\"\n}\n\nfuncB(){\n  local val=$1  #localをつけるとスコープが変わる\n  val=\"B\"\n}\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"\nまとまったshellscriptを書いて最近はまったところ  \n忘れることが多いのでメモ  \n  \n\u003e **trapは記述した以降の処理しかtrapできない**   \n\n    \n時間がかかる処理なんだけど、  \n外からkillされた時でもbackupしてほしいとかいう時に使うんですが、  \nスクリプトの中にtrapが出る前にkillされたりすると、発動しない  \nあたり前といえば当たり前。  \n  \n```\n#!/bin/sh\n\n#処理A \n#ここで exit 1としてもtrapに行かない\n\ntrap backup 0 1 9\n\n#処理B ここで exit 1とかやるとtrapされる\n```\n      \n\u003e **複数行のものを引数に与える時は\"で囲む**   \n  \n\nこれも久々に思い出しったって感じ。  \nそういえばそーだなーって。  \n  \n\n```\n#!/bin/sh\n\nlist=`ls -la ./`\n\nfunc $list   #これだと初めの1行しか持って行かれない\nfunc \"$list\" #全部を処理したい場合はこうする\n```\n  \n\u003e **グローバル、ローカル変数を意識する**   \n\n負債的な感じのながーいshellscriptとかを分割するんだけど  \n関数内であっても同じ変数名だとスコープが同じ。  \n  \n\n```\n#########\n#mainA.sh\n#!/bin/sh\n\n. ./func.sh\n\nval=\"test\"\n\nfuncA val \necho val #この結果は \"A\"\n\n#########\n#mainB.sh\n#!/bin/sh\n\n. ./func.sh\n\nval=\"test\"\n\nfuncB val \necho val #この結果は \"test\"\n\n\n##########\n#func.sh\n#!/bin/sh\nfuncA(){\n  val=$1        #これだとvalを変更すると全部のvalが変更されてしまう。\n  val=\"A\"\n}\n\nfuncB(){\n  local val=$1  #localをつけるとスコープが変わる\n  val=\"B\"\n}\n```\n","coediting":false,"created_at":"2017-05-17T16:24:36+09:00","group":null,"id":"06b71345647f04ba8ae6","private":false,"tags":[{"name":"ShellScript","versions":[]}],"title":"shellスクリプトではまったところ","updated_at":"2017-05-17T16:24:36+09:00","url":"http://qiita.com/connvoi_tyou/items/06b71345647f04ba8ae6","user":{"description":"","facebook_id":"","followees_count":3,"followers_count":7,"github_login_name":"connvoi","id":"connvoi_tyou","items_count":6,"linkedin_id":"","location":"","name":"katsumi yagi","organization":"","permanent_id":28639,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/28639/profile-images/1473685228","twitter_screen_name":"connvoi_tyou","website_url":""}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"-事前準備として\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%A8%E3%81%97%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e○ 事前準備として\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"データベース定義クラス作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E5%AE%9A%E7%BE%A9%E3%82%AF%E3%83%A9%E3%82%B9%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデータベース定義クラス作成\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"java\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eAppDatabase.java\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nd\"\u003e@Database\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAppDatabase\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eNAME\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eversion\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAppDatabase\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eVERSION\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e　\u003cspan class=\"c1\"\u003e//用意されているDatabaseアノテーションを使用する　(*１)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAppDatabase\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efinal\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eNAME\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"AppDatabase\"\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efinal\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eVERSION\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e(補足)\u003cbr\u003e\n*1 ここでアノテーションつけてname=データベース名,version=バージョンを指定すると、ビルド時に（クラス名）_Databaseクラスが作成される。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"テーブル定義クラス作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%AE%9A%E7%BE%A9%E3%82%AF%E3%83%A9%E3%82%B9%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eテーブル定義クラス作成\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"java\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eUser.java\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"nd\"\u003e@Table\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edatabase\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAppDatabase\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e　\u003cspan class=\"c1\"\u003e//用意されているTableアノテーションを使用する(*2)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUser\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"n\"\u003eBaseModel\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e//用意されているBaseModelを継承しておく\u003c/span\u003e\n\n  \u003cspan class=\"nd\"\u003e@PrimaryKey\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 少なくとも一つ必要 //　データの更新、削除、追加の時の比較に使用されるはず\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eUUID\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e \n\n  \u003cspan class=\"nd\"\u003e@Column\u003c/span\u003e　\u003cspan class=\"c1\"\u003e//　カラム定義(PrimaryKeyの場合は省略できる)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"nd\"\u003e@Column\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edefaultValue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"20\"\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"c1\"\u003e//デフォルト値を設定できる\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"nd\"\u003e@Column\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003enickName\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//privateで定義するときは必ずgetterとsetterを用意する。(*3)\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003esetNickName\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003enickName\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003enickName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enickName\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003egetNickName\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enickName\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e(補足)\u003cbr\u003e\n*2 ここでアノテーションつけてname=データベース名,を指定すると、ビルド時に\u0026lt;クラス名\u0026gt;_Tableクラスが作成される。\u003cbr\u003e\n*3 \u0026lt;クラス名\u0026gt;_Tableでgetterとsetterメソッドが使用される。booleanの場合はis\u0026lt;変数名\u0026gt;とset\u0026lt;変数名\u0026gt;でメソッドの定義をする。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"-使用例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-%E4%BD%BF%E7%94%A8%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e○ 使用例\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003eUser user = new User();\nuser.id = UUID.randomUUID();\nuser.name = \"Andrew Grosner\";\nuser.age = 27;\n\n// BaseModelを継承しているテーブルなら、これらのメソッドが使用可能になる\nuser.insert(); //DBにデータ追加\nuser.update(); //DBのデータ更新\nuser.delete(); //DBのデータ削除\nuser.save(); //DBにデータ追加,存在していたらデータ更新\n\n// select文\nList\u0026lt;User\u0026gt; users = SQLite.select()\n                    .from(User.class)\n                    .where(User_Table.age.greaterThan(18))\n                    .queryList();\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e(参考資料)\u003cbr\u003e\n\u003ca href=\"https://agrosner.gitbooks.io/dbflow/content/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://agrosner.gitbooks.io/dbflow/content/\u003c/a\u003e    公式HP\u003cbr\u003e\n\u003ca href=\"http://chocolattips.hatenablog.com/entry/2017/01/31/000000\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://chocolattips.hatenablog.com/entry/2017/01/31/000000\u003c/a\u003e 【Android】DBFlowの基本的な使い方\u003c/p\u003e\n","body":"#○ 事前準備として\n##データベース定義クラス作成\n```AppDatabase.java\n@Database(name = AppDatabase.NAME, version = AppDatabase.VERSION)　//用意されているDatabaseアノテーションを使用する　(*１)\npublic class AppDatabase {\n\n  public static final String NAME = \"AppDatabase\";\n\n  public static final int VERSION = 1;\n}\n```\n\u003e(補足)\n*1 ここでアノテーションつけてname=データベース名,version=バージョンを指定すると、ビルド時に（クラス名）_Databaseクラスが作成される。\n\n##テーブル定義クラス作成\n```User.java\n@Table(database = AppDatabase.class)　//用意されているTableアノテーションを使用する(*2)\npublic class User extends BaseModel{ //用意されているBaseModelを継承しておく\n\n  @PrimaryKey // 少なくとも一つ必要 //　データの更新、削除、追加の時の比較に使用されるはず\n  UUID id; \n\n  @Column　//　カラム定義(PrimaryKeyの場合は省略できる)\n  String name;\n\n  @Column(defaultValue = \"20\")//デフォルト値を設定できる\n  int age;\n\n  @Column\n  private String nickName; //privateで定義するときは必ずgetterとsetterを用意する。(*3)\n\n  public void setNickName(String nickName) {\n    this.nickName = nickName;\n  }\n\n  public String getNickName() {\n    return nickName;\n  }\n}\n```\n\u003e(補足)\n*2 ここでアノテーションつけてname=データベース名,を指定すると、ビルド時に\u003cクラス名\u003e_Tableクラスが作成される。\n*3 \u003cクラス名\u003e\\_Tableでgetterとsetterメソッドが使用される。booleanの場合はis\u003c変数名\u003eとset\u003c変数名\u003eでメソッドの定義をする。\n\n\n#○ 使用例\n```\nUser user = new User();\nuser.id = UUID.randomUUID();\nuser.name = \"Andrew Grosner\";\nuser.age = 27;\n\n// BaseModelを継承しているテーブルなら、これらのメソッドが使用可能になる\nuser.insert(); //DBにデータ追加\nuser.update(); //DBのデータ更新\nuser.delete(); //DBのデータ削除\nuser.save(); //DBにデータ追加,存在していたらデータ更新\n\n// select文\nList\u003cUser\u003e users = SQLite.select()\n                    .from(User.class)\n                    .where(User_Table.age.greaterThan(18))\n                    .queryList();\n```\n\n(参考資料)\nhttps://agrosner.gitbooks.io/dbflow/content/\t公式HP\nhttp://chocolattips.hatenablog.com/entry/2017/01/31/000000 【Android】DBFlowの基本的な使い方\n","coediting":false,"created_at":"2017-05-17T16:23:13+09:00","group":null,"id":"d8faedf97eeacfed9213","private":false,"tags":[{"name":"Android","versions":[]},{"name":"DB","versions":[]},{"name":"ライブラリー","versions":[]}],"title":"DBFlowの使い方(Androidライブラリ)","updated_at":"2017-05-17T17:26:10+09:00","url":"http://qiita.com/haruki99/items/d8faedf97eeacfed9213","user":{"description":"はじめまして、まだまだ新米のエンジニアです。基本的なことを黙々と忘れないように記録していきたいと思っています。ゆるく見守ってください。","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":null,"id":"haruki99","items_count":2,"linkedin_id":"","location":"Osaka,Japan","name":"","organization":"","permanent_id":50917,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/50917/profile-images/1495005036","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003eこのエラーは、お客さまが、APIテスト用認証情報の代わりに、SandboxのAPI認証情報を使用していることを示しています。\u003c/p\u003e\n\n\u003cp\u003eこの問題を解決するには、PayPal SandboxアカウントからAPI認証情報を使用する必要があります。以下の手順を参照して行ってください。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.paypal.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePayPalアカウント\u003c/a\u003eにログインします。\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.sandbox.paypal.com/us/cgi-bin/webscr?cmd=_profile-api-signature\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAPI署名\u003c/a\u003eにアクセスします。\u003c/li\u003e\n\u003cli\u003e次のAppIDを入力してください:APP-80W284485P519543T\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eサンプルのAPI認証情報とアダプティブペイメントのサンプルアプリケーションを使用していない場合は、REST APIアプリケーションではなく\u003ca href=\"https://www.paypal-knowledge.com/infocenter/index?page=content\u0026amp;id=FAQ1633\u0026amp;expand=true\u0026amp;locale=en_US\" rel=\"nofollow noopener\" target=\"_blank\"\u003eClassic APIアプリケーションを作成する\u003c/a\u003e必要があります。\u003c/p\u003e\n\n\u003cp\u003eアダプティブペイメントAPIコールを行う場合は、\u003ca href=\"https://developer.paypal.com/docs/classic/adaptive-payments/gs_AdaptivePayments/#call\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMaking Your First Call(初回コールの実行)\u003c/a\u003eを参照してください。\u003cbr\u003e\n\u003cbr\u003e\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"このエラーは、お客さまが、APIテスト用認証情報の代わりに、SandboxのAPI認証情報を使用していることを示しています。\n\nこの問題を解決するには、PayPal SandboxアカウントからAPI認証情報を使用する必要があります。以下の手順を参照して行ってください。\n\n1. [PayPalアカウント](https://www.paypal.com/)にログインします。\n2. [API署名](https://www.sandbox.paypal.com/us/cgi-bin/webscr?cmd=_profile-api-signature)にアクセスします。\n3. 次のAppIDを入力してください:APP-80W284485P519543T\n\nサンプルのAPI認証情報とアダプティブペイメントのサンプルアプリケーションを使用していない場合は、REST APIアプリケーションではなく[Classic APIアプリケーションを作成する](https://www.paypal-knowledge.com/infocenter/index?page=content\u0026id=FAQ1633\u0026expand=true\u0026locale=en_US)必要があります。\n\nアダプティブペイメントAPIコールを行う場合は、[Making Your First Call(初回コールの実行)](https://developer.paypal.com/docs/classic/adaptive-payments/gs_AdaptivePayments/#call)を参照してください。\n\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T16:22:49+09:00","group":null,"id":"7cfbd5b534760b80f8ac","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"PayPal Sandbox環境へのPayPalアダプティブペイメントAPIコールを作成しようとして、エラー「認証に失敗しました。API認証情報が間違っています」が出るのはなぜですか?","updated_at":"2017-05-17T16:22:49+09:00","url":"http://qiita.com/PayPal_MTS/items/7cfbd5b534760b80f8ac","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"状況の簡単な説明\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%8A%B6%E6%B3%81%E3%81%AE%E7%B0%A1%E5%8D%98%E3%81%AA%E8%AA%AC%E6%98%8E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e状況の簡単な説明\u003c/h1\u003e\n\n\u003cp\u003eMBP(Late 2016)上のVMware Fusion 8で仮想マシンにRancherOSをインストールしようとしたら、画面が真っ黒でCDROM（ISO）から起動できない！（コンソール見えない！）って状況に陥ってしまった。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/35591/2c4c5fe7-d89d-6af1-e283-2f494aa0bb09.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"832\" alt=\"スクリーンショット 2017-05-17 16.17.51.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/35591/2c4c5fe7-d89d-6af1-e283-2f494aa0bb09.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e調べたところIntel GPUとドライバ周りの問題みたいで、Intel GPUのレンダリングに関するオプションをvmxファイルに書き込むことで改善できた。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eHardware\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003eMacbook Pro 13inch Late 2016 (with Touch Bar)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eSoftware\u003c/strong\u003e\n\n\u003cul\u003e\n\u003cli\u003emacOS Sierra 10.12.4\u003c/li\u003e\n\u003cli\u003eVMware Fusion 8.5.6\u003c/li\u003e\n\u003cli\u003eISO for VM : \u003ca href=\"https://releases.rancher.com/os/v1.0.1/rancheros.iso\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRancherOS 1.0.1\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"対応内容の要約\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AF%BE%E5%BF%9C%E5%86%85%E5%AE%B9%E3%81%AE%E8%A6%81%E7%B4%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e対応内容の要約\u003c/h1\u003e\n\n\u003cp\u003e作成した仮想マシンのvmxファイルをエディタで開き、次の1行を追記してからファイルを保存し、そのあと仮想マシンを起動する。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003emks.enableGLBasicRenderer = \"FALSE\"\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/35591/0d1132de-6dd9-e0ea-6c4d-3cbf6808e61a.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"832\" alt=\"スクリーンショット 2017-05-17 16.19.05.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/35591/0d1132de-6dd9-e0ea-6c4d-3cbf6808e61a.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"詳細\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A9%B3%E7%B4%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e詳細\u003c/h1\u003e\n\n\u003cp\u003eRancherOSを新規でインストールしたいと思って、ISOファイルをダウンロードして、新規VMを作成したが起動で失敗してしまった。\u003c/p\u003e\n\n\u003cp\u003e正確にいうと、起動エラーが出るわけではなくVMのコンソール画面が真っ黒でなにも表示されない状態になってしまう（画面が出ないのでフリーズしてしまったと最初は思っていた）。\u003c/p\u003e\n\n\u003cp\u003e別に所有していたMBP Mid 2013で試したところ、同じバージョンのVMware Fusionで同じバージョンのRancherOSが起動した。これは個別環境の問題かな？と思い、VMware Fusionの再インストールやISOのmd5チェックサム確認、macOSのユーザ切り替えなどを一通り試したが全て効果なし。\u003c/p\u003e\n\n\u003cp\u003eここでGoogle先生に頼り検索してみたが有益な情報はあまり見つからない。RancherOSが起動しないって話は海外のサイトにはいくつか投稿されているのだが、どれもBoot自体は成功しているみたいで自分の状況には当てはまらないものばかりだった。\u003c/p\u003e\n\n\u003cp\u003e色々キーワードを変えながら検索を繰り返したところ、最終的にVMwareコミュニティで同じ環境（MBP Late 2016/macOS 10.12.4/VMware Fusion 8.5.6）で同様の問題に直面したという投稿をすることができた。\u003c/p\u003e\n\n\u003cp\u003e対応内容は上記の要約の通り。\u003c/p\u003e\n\n\u003cp\u003eこのオプションのことを調べると、あまり詳細な情報は見つからなかったんだが、どうもIntel GPUを使用する環境で起動しようとしてるOSがVer1.2以前のIntel VA-APIドライバを使用しようとしている時に必要となるオプションのようだった（このへんはあまり私自身がGPU周りに詳しくないので十分に理解できていない・・・）。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eMacbook Pro 13inch Late 2016 (with Touch Bar)\u003c/code\u003eはグラフィックに\u003ccode\u003eIntel Iris Graphics 550\u003c/code\u003eを使用しているが、一部のOSではこのGPU環境で使用するのに明示的に\u003ccode\u003emks.enableGLBasicRenderer\u003c/code\u003eを\u003ccode\u003eFalse\u003c/code\u003eにしないといけない場合がある・・・のだろうと認識している。\u003c/p\u003e\n\n\u003cp\u003e尚、vmxファイルは仮想マシンの編集（設定変更）などにより上書きされてしまうことがあるので注意が必要である。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://communities.vmware.com/thread/560746\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVMware Fusion black screen on boot | VMware Comminities\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eこの問題の解決方法の元ネタ \u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://kb.vmware.com/selfservice/microsites/search.do?language=en_US\u0026amp;cmd=displayKC\u0026amp;externalId=2078678\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVMware Fusion 仮想マシンの .vmx ファイルの編集 (2078678) | VMware Knowledge Base\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003evmxファイルの編集方法 \u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.vmware.com/content/dam/digitalmarketing/vmware/ja/pdf/horizon-client-linux-44-document.pdf\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVMware Horizon Client for Linux の 使用 | Horizon Client 4.4\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003emks.enableGLBasicRendererについての参考情報\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# 状況の簡単な説明\nMBP(Late 2016)上のVMware Fusion 8で仮想マシンにRancherOSをインストールしようとしたら、画面が真っ黒でCDROM（ISO）から起動できない！（コンソール見えない！）って状況に陥ってしまった。\n\n\u003cimg width=\"832\" alt=\"スクリーンショット 2017-05-17 16.17.51.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/35591/2c4c5fe7-d89d-6af1-e283-2f494aa0bb09.png\"\u003e\n\n調べたところIntel GPUとドライバ周りの問題みたいで、Intel GPUのレンダリングに関するオプションをvmxファイルに書き込むことで改善できた。\n\n# 環境\n- **Hardware**\n  - Macbook Pro 13inch Late 2016 (with Touch Bar)\n- **Software**\n  - macOS Sierra 10.12.4\n  - VMware Fusion 8.5.6\n  - ISO for VM : [RancherOS 1.0.1](https://releases.rancher.com/os/v1.0.1/rancheros.iso)\n\n# 対応内容の要約\n作成した仮想マシンのvmxファイルをエディタで開き、次の1行を追記してからファイルを保存し、そのあと仮想マシンを起動する。\n\n`mks.enableGLBasicRenderer = \"FALSE\"`\n\n\u003cimg width=\"832\" alt=\"スクリーンショット 2017-05-17 16.19.05.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/35591/0d1132de-6dd9-e0ea-6c4d-3cbf6808e61a.png\"\u003e\n\n# 詳細\nRancherOSを新規でインストールしたいと思って、ISOファイルをダウンロードして、新規VMを作成したが起動で失敗してしまった。\n\n正確にいうと、起動エラーが出るわけではなくVMのコンソール画面が真っ黒でなにも表示されない状態になってしまう（画面が出ないのでフリーズしてしまったと最初は思っていた）。\n\n別に所有していたMBP Mid 2013で試したところ、同じバージョンのVMware Fusionで同じバージョンのRancherOSが起動した。これは個別環境の問題かな？と思い、VMware Fusionの再インストールやISOのmd5チェックサム確認、macOSのユーザ切り替えなどを一通り試したが全て効果なし。\n\nここでGoogle先生に頼り検索してみたが有益な情報はあまり見つからない。RancherOSが起動しないって話は海外のサイトにはいくつか投稿されているのだが、どれもBoot自体は成功しているみたいで自分の状況には当てはまらないものばかりだった。\n\n色々キーワードを変えながら検索を繰り返したところ、最終的にVMwareコミュニティで同じ環境（MBP Late 2016/macOS 10.12.4/VMware Fusion 8.5.6）で同様の問題に直面したという投稿をすることができた。\n\n対応内容は上記の要約の通り。\n\nこのオプションのことを調べると、あまり詳細な情報は見つからなかったんだが、どうもIntel GPUを使用する環境で起動しようとしてるOSがVer1.2以前のIntel VA-APIドライバを使用しようとしている時に必要となるオプションのようだった（このへんはあまり私自身がGPU周りに詳しくないので十分に理解できていない・・・）。\n\n`Macbook Pro 13inch Late 2016 (with Touch Bar)`はグラフィックに`Intel Iris Graphics 550`を使用しているが、一部のOSではこのGPU環境で使用するのに明示的に`mks.enableGLBasicRenderer`を`False`にしないといけない場合がある・・・のだろうと認識している。\n\n尚、vmxファイルは仮想マシンの編集（設定変更）などにより上書きされてしまうことがあるので注意が必要である。\n\n# 参考\n\n- [VMware Fusion black screen on boot | VMware Comminities](https://communities.vmware.com/thread/560746)\n  - この問題の解決方法の元ネタ \n- [VMware Fusion 仮想マシンの .vmx ファイルの編集 (2078678) | VMware Knowledge Base](https://kb.vmware.com/selfservice/microsites/search.do?language=en_US\u0026cmd=displayKC\u0026externalId=2078678)\n  - vmxファイルの編集方法 \n- [VMware Horizon Client for Linux の 使用 | Horizon Client 4.4](https://www.vmware.com/content/dam/digitalmarketing/vmware/ja/pdf/horizon-client-linux-44-document.pdf)\n  - mks.enableGLBasicRendererについての参考情報\n","coediting":false,"created_at":"2017-05-17T16:21:18+09:00","group":null,"id":"e007f6fc6628d4d95adb","private":false,"tags":[{"name":"VMwareFusion","versions":[]},{"name":"MacOS,","versions":[]},{"name":"RancherOS,","versions":[]},{"name":"MacbookPro,","versions":[]}],"title":"MBP(Late 2016)上のVMware Fusion 8でVMがBlackOutして苦労した話","updated_at":"2017-05-17T16:21:18+09:00","url":"http://qiita.com/tsukaman/items/e007f6fc6628d4d95adb","user":{"description":"＿・）だいたいぼーっとしてます。","facebook_id":"tsukaman","followees_count":14,"followers_count":12,"github_login_name":"tsukaman","id":"tsukaman","items_count":4,"linkedin_id":"","location":"Sakura, Chiba, Japan","name":"Masataka Tsukamoto","organization":"","permanent_id":35591,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/35591/profile-images/1481767212","twitter_screen_name":"tsukaman","website_url":""}},{"rendered_body":"\u003cp\u003e\u003cstrong\u003e定期支払い - 購読ボタン\u003c/strong\u003eの作成および使用に関する詳しいガイドは、\u003ca href=\"https://developer.paypal.com/webapps/developer/docs/classic/paypal-payments-standard/integration-guide/subscribe_buttons/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003eをクリックしてご覧ください。このガイドでは、購読ボタンのさまざまな機能を説明しており、多数の例やシナリオも提供しています。\u003cbr\u003e\u003cbr\u003e\n\u003cstrong\u003ePayPalペイメント スタンダード\u003c/strong\u003eとお客さまのECサイトまたはECアプリケーションとの統合(インテグレーション)に関するガイドは、\u003ca href=\"https://developer.paypal.com/webapps/developer/docs/classic/paypal-payments-standard/integration-guide/wp_standard_overview/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003eをクリックしてご覧ください。\u003cbr\u003e\n\u003cbr\u003e\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"**定期支払い - 購読ボタン**の作成および使用に関する詳しいガイドは、[ここ](https://developer.paypal.com/webapps/developer/docs/classic/paypal-payments-standard/integration-guide/subscribe_buttons/)をクリックしてご覧ください。このガイドでは、購読ボタンのさまざまな機能を説明しており、多数の例やシナリオも提供しています。  \n**PayPalペイメント スタンダード**とお客さまのECサイトまたはECアプリケーションとの統合(インテグレーション)に関するガイドは、[ここ](https://developer.paypal.com/webapps/developer/docs/classic/paypal-payments-standard/integration-guide/wp_standard_overview/)をクリックしてご覧ください。\n\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T16:19:09+09:00","group":null,"id":"c187eb2b6d83dfb3feef","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"PayPal[購読]ボタンのしくみを教えてください。","updated_at":"2017-05-17T16:19:29+09:00","url":"http://qiita.com/PayPal_MTS/items/c187eb2b6d83dfb3feef","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003eSandboxから本番環境に移行する際は、本番環境のPayPalサイトで新しいホスト型ボタンを作成する必要があります。これにより、ボタンの hosted_button_idの値が正しく設定されます。\u003cbr\u003e\nPayPalペイメントスタンダードでは、PayPalのサイトでボタンを作成し、保存することができます。これらのホスト型ボタンには、隠れ変数の hosted_button_idがあり、値に数値を持ちます。このID番号は、マーチャント、デベロッパーが作成した特定のボタンを指しています。また、このIDは、特定のPayPalアカウントに固有です。\u003cbr\u003e\n暗号化されていないボタンのコードは以下のとおりです。business変数の行は、PayPalシステムが、支払いを入金するPayPalアカウントを決定する方法を示します。以下の例で、お客さまの業務用メールアドレスが、本稼働のPayPalアカウントのメールアドレスであり、Sandboxアカウントのメールアドレスではないことを確認してください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u0026lt;form action=\"https://www.paypal.com/cgi-bin/webscr\" method=\"post\" target=\"_blank\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"cmd\" value=\"_cart\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"business\" value=\"seller@business.com\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"item_name\" value=\"testing_handling\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"item_number\" value=\"test\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"amount\" value=\"0.01\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"handling\" value=\"0.01\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"shipping\" value=\"0.01\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"lc\" value=\"US\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"bn\" value=\"PP-BuyNowBF\"\u0026gt;\n   \u0026lt;input type=\"image\" src=\"btn_buynow_LG.gif\" border=\"0\" name=\"submit\" alt=\"PayPal - The safer, easier way to pay online!\"\u0026gt;\n      \u0026lt;img alt=\" border=\"0\" src=\"pixel.gif\" width=\"1\" height=\"1\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"add\" value=\"1\"\u0026gt;\n\u0026lt;/form\u0026gt;\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以下にホスト型ボタンのコードを示します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u0026lt;form target=\"paypal\" action=\"https://www.paypal.com/cgi-bin/webscr\" method=\"post\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"cmd\" value=\"_s-xclick\"\u0026gt;\n   \u0026lt;input type=\"hidden\" name=\"hosted_button_id\" value=\"353581\"\u0026gt;\n   \u0026lt;input type=\"image\" src=\"https://www.paypal.com/en_US/i/btn/btn_cart_LG.gif\" border=\"0\" name=\"submit\" alt=\"\u0026gt;\n      \u0026lt;img alt=\" border=\"0\" src=\"https://www.paypal.com/en_US/i/scr/pixel.gif\" width=\"1\" height=\"1\"\u0026gt;\n\u0026lt;/form\u0026gt;\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以前は、デベロッパーがSandbox環境でボタンを作成し、それらのボタンを自分のウェブサイトや環境で本稼働させる場合は、HTMLフォームのアクションの値を\u003ca href=\"https://www.sandbox.paypal.com/cgi-bin/webscr\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.sandbox.paypal.com/cgi-bin/webscr\u003c/a\u003e から\u003ca href=\"https://www.paypal.com/cgi-bin/webscr\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.paypal.com/cgi-bin/webscr\u003c/a\u003e へ変更するだけでした。Sandboxで別のメールアドレスを使用した場合も、本稼働の準備ができたときにこの値を更新する必要がありました。\u003cbr\u003e\nしかし、Sandboxで作成されたホスト型ボタンについては、 hosted_button_id の値が、本番環境のPayPalサイトで作成されたボタンと必ずしも同じであるとは限りません。お客さまの実装環境で本稼働させる準備ができましたら、本番環境のPayPalサイトで、新しいホスト型ボタンを作成する必要があります。\u003cbr\u003e\nこれを行わないと、本稼働環境での支払いが別のPayPalアカウントに入金されてしまいます。また、 hosted_button_id の値が本番サイトのデータベースで検出されない場合は、買い手がボタンをクリックした際にエラーが発生する可能性があります。\u003c/p\u003e\n\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"Sandboxから本番環境に移行する際は、本番環境のPayPalサイトで新しいホスト型ボタンを作成する必要があります。これにより、ボタンの hosted_button_idの値が正しく設定されます。\nPayPalペイメントスタンダードでは、PayPalのサイトでボタンを作成し、保存することができます。これらのホスト型ボタンには、隠れ変数の hosted_button_idがあり、値に数値を持ちます。このID番号は、マーチャント、デベロッパーが作成した特定のボタンを指しています。また、このIDは、特定のPayPalアカウントに固有です。\n暗号化されていないボタンのコードは以下のとおりです。business変数の行は、PayPalシステムが、支払いを入金するPayPalアカウントを決定する方法を示します。以下の例で、お客さまの業務用メールアドレスが、本稼働のPayPalアカウントのメールアドレスであり、Sandboxアカウントのメールアドレスではないことを確認してください。\n\n```\n\u003cform action=\"https://www.paypal.com/cgi-bin/webscr\" method=\"post\" target=\"_blank\"\u003e\n   \u003cinput type=\"hidden\" name=\"cmd\" value=\"_cart\"\u003e\n   \u003cinput type=\"hidden\" name=\"business\" value=\"seller@business.com\"\u003e\n   \u003cinput type=\"hidden\" name=\"item_name\" value=\"testing_handling\"\u003e\n   \u003cinput type=\"hidden\" name=\"item_number\" value=\"test\"\u003e\n   \u003cinput type=\"hidden\" name=\"amount\" value=\"0.01\"\u003e\n   \u003cinput type=\"hidden\" name=\"handling\" value=\"0.01\"\u003e\n   \u003cinput type=\"hidden\" name=\"shipping\" value=\"0.01\"\u003e\n   \u003cinput type=\"hidden\" name=\"lc\" value=\"US\"\u003e\n   \u003cinput type=\"hidden\" name=\"bn\" value=\"PP-BuyNowBF\"\u003e\n   \u003cinput type=\"image\" src=\"btn_buynow_LG.gif\" border=\"0\" name=\"submit\" alt=\"PayPal - The safer, easier way to pay online!\"\u003e\n      \u003cimg alt=\" border=\"0\" src=\"pixel.gif\" width=\"1\" height=\"1\"\u003e\n   \u003cinput type=\"hidden\" name=\"add\" value=\"1\"\u003e\n\u003c/form\u003e\n```\n\n以下にホスト型ボタンのコードを示します。\n\n```\n\u003cform target=\"paypal\" action=\"https://www.paypal.com/cgi-bin/webscr\" method=\"post\"\u003e\n   \u003cinput type=\"hidden\" name=\"cmd\" value=\"_s-xclick\"\u003e\n   \u003cinput type=\"hidden\" name=\"hosted_button_id\" value=\"353581\"\u003e\n   \u003cinput type=\"image\" src=\"https://www.paypal.com/en_US/i/btn/btn_cart_LG.gif\" border=\"0\" name=\"submit\" alt=\"\u003e\n      \u003cimg alt=\" border=\"0\" src=\"https://www.paypal.com/en_US/i/scr/pixel.gif\" width=\"1\" height=\"1\"\u003e\n\u003c/form\u003e\n```\n\n以前は、デベロッパーがSandbox環境でボタンを作成し、それらのボタンを自分のウェブサイトや環境で本稼働させる場合は、HTMLフォームのアクションの値をhttps://www.sandbox.paypal.com/cgi-bin/webscr からhttps://www.paypal.com/cgi-bin/webscr へ変更するだけでした。Sandboxで別のメールアドレスを使用した場合も、本稼働の準備ができたときにこの値を更新する必要がありました。\nしかし、Sandboxで作成されたホスト型ボタンについては、 hosted_button_id の値が、本番環境のPayPalサイトで作成されたボタンと必ずしも同じであるとは限りません。お客さまの実装環境で本稼働させる準備ができましたら、本番環境のPayPalサイトで、新しいホスト型ボタンを作成する必要があります。\nこれを行わないと、本稼働環境での支払いが別のPayPalアカウントに入金されてしまいます。また、 hosted_button_id の値が本番サイトのデータベースで検出されない場合は、買い手がボタンをクリックした際にエラーが発生する可能性があります。\n\n\u003cbr\u003e\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T16:17:30+09:00","group":null,"id":"1ec677f67fa4fc13cc8b","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"（PayPal）ホスト型ボタンをSandboxから本番環境に移行する際に注意することを教えてください。","updated_at":"2017-05-17T16:17:30+09:00","url":"http://qiita.com/PayPal_MTS/items/1ec677f67fa4fc13cc8b","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003eボタンフォームフィールドを使用して拡張ASCII文字をPayPalに渡す場合は、文字エンコーディングを識別する「charset」フォーム変数を含める必要があります。これにより、お客さまのデータが正しく読み取られ、同じエンコーディングで応答が戻されます。\u003cbr\u003e\nPayPalは、次の文字セットをサポートしています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBig5 (台湾の繁体中国語)\u003c/li\u003e\n\u003cli\u003eEUC-JP\u003c/li\u003e\n\u003cli\u003eEUC-KR\u003c/li\u003e\n\u003cli\u003eEUC-TW\u003c/li\u003e\n\u003cli\u003egb2312 (簡体中国語)\u003c/li\u003e\n\u003cli\u003egbk\u003c/li\u003e\n\u003cli\u003eHZ-GB-2312 (香港の繁体中国語)\u003c/li\u003e\n\u003cli\u003eibm-862 (ユーロ記号付きヘブライ語)\u003c/li\u003e\n\u003cli\u003eISO-2022-CN\u003c/li\u003e\n\u003cli\u003eISO-2022-JP\u003c/li\u003e\n\u003cli\u003eISO-2022-KR\u003c/li\u003e\n\u003cli\u003eISO-8859-1 (西ヨーロッパ言語)\u003c/li\u003e\n\u003cli\u003eISO-8859-2\u003c/li\u003e\n\u003cli\u003eISO-8859-3\u003c/li\u003e\n\u003cli\u003eISO-8859-4\u003c/li\u003e\n\u003cli\u003eISO-8859-5\u003c/li\u003e\n\u003cli\u003eISO-8859-6\u003c/li\u003e\n\u003cli\u003eISO-8859-7\u003c/li\u003e\n\u003cli\u003eISO-8859-8\u003c/li\u003e\n\u003cli\u003eISO-8859-9\u003c/li\u003e\n\u003cli\u003eISO-8859-13\u003c/li\u003e\n\u003cli\u003eISO-8859-15\u003c/li\u003e\n\u003cli\u003eKOI8-R (キリル文字)\u003c/li\u003e\n\u003cli\u003eShift_JIS\u003c/li\u003e\n\u003cli\u003eUTF-7\u003c/li\u003e\n\u003cli\u003eUTF-8\u003c/li\u003e\n\u003cli\u003eUTF-16\u003c/li\u003e\n\u003cli\u003eUTF-16BE\u003c/li\u003e\n\u003cli\u003eUTF-16LE\u003c/li\u003e\n\u003cli\u003eUTF16_PlatformEndian\u003c/li\u003e\n\u003cli\u003eUTF16_OppositeEndian\u003c/li\u003e\n\u003cli\u003eUTF-32\u003c/li\u003e\n\u003cli\u003eUTF-32BE\u003c/li\u003e\n\u003cli\u003eUTF-32LE\u003c/li\u003e\n\u003cli\u003eUTF32_PlatformEndian\u003c/li\u003e\n\u003cli\u003eUTF32_OppositeEndian\u003c/li\u003e\n\u003cli\u003eUS-ASCII\u003c/li\u003e\n\u003cli\u003ewindows-1250\u003c/li\u003e\n\u003cli\u003ewindows-1251\u003c/li\u003e\n\u003cli\u003ewindows-1252\u003c/li\u003e\n\u003cli\u003ewindows-1253\u003c/li\u003e\n\u003cli\u003ewindows-1254\u003c/li\u003e\n\u003cli\u003ewindows-1255\u003c/li\u003e\n\u003cli\u003ewindows-1256\u003c/li\u003e\n\u003cli\u003ewindows-1257\u003c/li\u003e\n\u003cli\u003ewindows-1258\u003c/li\u003e\n\u003cli\u003ewindows-874 (タイ)\u003c/li\u003e\n\u003cli\u003ewindows-949 (韓国)\u003c/li\u003e\n\u003cli\u003ex-mac-greek\u003c/li\u003e\n\u003cli\u003ex-mac-turkish\u003c/li\u003e\n\u003cli\u003ex-mac-centraleurroman\u003c/li\u003e\n\u003cli\u003ex-mac-cyrillic\u003c/li\u003e\n\u003cli\u003eebcdic-cp-us\u003c/li\u003e\n\u003cli\u003eibm-1047\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e注: 上記の文字セットのいずれかを使用している場合、場合によってはPayPalアカウントにログインしてボタンのエンコーディング言語を変更する必要があります。ボタンのエンコーディング言語を変更するには、以下の手順を行ってください。\u003cbr\u003e\n1. \u003ca href=\"http://www.paypal.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003eをクリックしてPayPalアカウントにログインします。\u003cbr\u003e\n2. \u003cstrong\u003e[アカウント設定]\u003c/strong\u003eをクリックします。\u003cbr\u003e\n3. \u003cstrong\u003e[販売ツール]\u003c/strong\u003eをクリックします。\u003cbr\u003e\n4. \u003cstrong\u003e[PayPalボタンの言語コード化]\u003c/strong\u003eをクリックします。\u003cbr\u003e\n5. \u003cstrong\u003e[その他のオプション]\u003c/strong\u003eをクリックします。\u003cbr\u003e\n6. \u003cstrong\u003eエンコーディング言語\u003c/strong\u003eを選択します。\u003cbr\u003e\n7. \u003cstrong\u003e[保存]\u003c/strong\u003eをクリックします。\u003c/p\u003e\n","body":"ボタンフォームフィールドを使用して拡張ASCII文字をPayPalに渡す場合は、文字エンコーディングを識別する「charset」フォーム変数を含める必要があります。これにより、お客さまのデータが正しく読み取られ、同じエンコーディングで応答が戻されます。\nPayPalは、次の文字セットをサポートしています。\n\n- Big5 (台湾の繁体中国語)\n- EUC-JP\n- EUC-KR\n- EUC-TW\n- gb2312 (簡体中国語)\n- gbk\n- HZ-GB-2312 (香港の繁体中国語)\n- ibm-862 (ユーロ記号付きヘブライ語)\n- ISO-2022-CN\n- ISO-2022-JP\n- ISO-2022-KR\n- ISO-8859-1 (西ヨーロッパ言語)\n- ISO-8859-2\n- ISO-8859-3\n- ISO-8859-4\n- ISO-8859-5\n- ISO-8859-6\n- ISO-8859-7\n- ISO-8859-8\n- ISO-8859-9\n- ISO-8859-13\n- ISO-8859-15\n- KOI8-R (キリル文字)\n- Shift_JIS\n- UTF-7\n- UTF-8\n- UTF-16\n- UTF-16BE\n- UTF-16LE\n- UTF16_PlatformEndian\n- UTF16_OppositeEndian\n- UTF-32\n- UTF-32BE\n- UTF-32LE\n- UTF32_PlatformEndian\n- UTF32_OppositeEndian\n- US-ASCII\n- windows-1250\n- windows-1251\n- windows-1252\n- windows-1253\n- windows-1254\n- windows-1255\n- windows-1256\n- windows-1257\n- windows-1258\n- windows-874 (タイ)\n- windows-949 (韓国)\n- x-mac-greek\n- x-mac-turkish\n- x-mac-centraleurroman\n- x-mac-cyrillic\n- ebcdic-cp-us\n- ibm-1047\n\n \n注: 上記の文字セットのいずれかを使用している場合、場合によってはPayPalアカウントにログインしてボタンのエンコーディング言語を変更する必要があります。ボタンのエンコーディング言語を変更するには、以下の手順を行ってください。\n1. [ここ](http://www.paypal.com/)をクリックしてPayPalアカウントにログインします。\n2. **[アカウント設定]**をクリックします。\n3. **[販売ツール]**をクリックします。\n4. **[PayPalボタンの言語コード化]**をクリックします。\n5. **[その他のオプション]**をクリックします。\n6. **エンコーディング言語**を選択します。\n7. **[保存]**をクリックします。\n","coediting":false,"created_at":"2017-05-17T16:06:16+09:00","group":null,"id":"572278ba9924bb9ceafe","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"PayPal決済ボタンに使用されている「charset」とは何ですか?また、サポートされている文字セットも教えてください。","updated_at":"2017-05-17T16:07:00+09:00","url":"http://qiita.com/PayPal_MTS/items/572278ba9924bb9ceafe","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\u003cp\u003eお客さまのECサイトで使用しているのが、サードパーティのショッピングカートなのか、PayPal決済ボタンなのかによって、商品情報を編集する方法は異なります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eサードパーティのショッピングカート\u003cbr\u003e\nサードパーティのショッピングカートを使用している場合は、カートがすべてのボタンや外観などを管理しているので、カートのマニュアルをご覧ください。  \u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e暗号化されていないボタン\u003cbr\u003e\nHTMLを使って作成された、暗号化されていないPayPal決済ボタンを使用している場合は、お客さまのウェブサイトのコードを開くと、以下のような項目が表示されるはずです。\u003cbr\u003e\n\u003ccode\u003e\u003cbr\u003e\n\u0026lt;input type=\"hidden\" name=\"business\" value=\"email@emaildomain.com\"\u0026gt;\u003cbr\u003e\n\u0026lt;input type=\"hidden\" name=\"item_name\" value=\"my test item\"\u0026gt;\u003cbr\u003e\n\u0026lt;input type=\"hidden\" name=\"amount\" value=\"1\"\u0026gt;\u003cbr\u003e\n\u003c/code\u003e\u003cbr\u003e\nこのタイプのボタンは、値を変更するだけで編集できます。たとえば、請求額を1ドルから5ドルに増額する場合は、amount変数の値を「1」から「5」に変更し、コードの変更内容を保存します。  \u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eホスト型ボタン\u003cbr\u003e\u003cbr\u003e\nPayPalのホスト型ボタンを使用されている場合は、以下の例のようなコード行が表示されるはずです。\u003cbr\u003e\n\u003ccode\u003e\u003cbr\u003e\n\u0026lt;input type=\"hidden\" name=\"hosted_button_id\" value=\"FQCFAJW5BR9T4\"\u0026gt;\u003cbr\u003e\n\u003c/code\u003e\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003eホスト型ボタンを編集するには\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.paypal.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003eをクリックしてPayPalアカウントを開きます。\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e[ツール]\u003c/strong\u003eをクリックします。\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e[PayPal決済ボタン]\u003c/strong\u003eをクリックします。\n4.\u003cstrong\u003e[保存したボタン]\u003c/strong\u003eを選択します。\u003c/li\u003e\n\u003cli\u003eボタンの一覧から変更するボタンを選択し、\u003cstrong\u003e[アクション]\u003c/strong\u003eドロップダウンメニューで\u003cstrong\u003e[ボタンの編集]\u003c/strong\u003eをクリックします。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e注: ホスト型ボタンのドロップダウンメニューまたはテキストボックスを編集した場合は必ず、変更内容を保存した後に、変更したHTMLコードをお客さまのECサイトに貼り付けてください。新しく更新されたボタンのソースコードを使用して更新しないと、変更が本番サイトに反映されません。\u003c/p\u003e\n\n\u003cp\u003ePayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"お客さまのECサイトで使用しているのが、サードパーティのショッピングカートなのか、PayPal決済ボタンなのかによって、商品情報を編集する方法は異なります。\n\n- サードパーティのショッピングカート\nサードパーティのショッピングカートを使用している場合は、カートがすべてのボタンや外観などを管理しているので、カートのマニュアルをご覧ください。  \n\n- 暗号化されていないボタン\nHTMLを使って作成された、暗号化されていないPayPal決済ボタンを使用している場合は、お客さまのウェブサイトのコードを開くと、以下のような項目が表示されるはずです。\n```\n\u003cinput type=\"hidden\" name=\"business\" value=\"email@emaildomain.com\"\u003e\n\u003cinput type=\"hidden\" name=\"item_name\" value=\"my test item\"\u003e\n\u003cinput type=\"hidden\" name=\"amount\" value=\"1\"\u003e\n```\nこのタイプのボタンは、値を変更するだけで編集できます。たとえば、請求額を1ドルから5ドルに増額する場合は、amount変数の値を「1」から「5」に変更し、コードの変更内容を保存します。  \n  \n- ホスト型ボタン  \nPayPalのホスト型ボタンを使用されている場合は、以下の例のようなコード行が表示されるはずです。\n```\n\u003cinput type=\"hidden\" name=\"hosted_button_id\" value=\"FQCFAJW5BR9T4\"\u003e\n```\n\n**ホスト型ボタンを編集するには**\n\n1. [ここ](https://www.paypal.com/)をクリックしてPayPalアカウントを開きます。\n2. **[ツール]**をクリックします。\n3. **[PayPal決済ボタン]**をクリックします。\n4.**[保存したボタン]**を選択します。\n5. ボタンの一覧から変更するボタンを選択し、**[アクション]**ドロップダウンメニューで**[ボタンの編集]**をクリックします。\n\n注: ホスト型ボタンのドロップダウンメニューまたはテキストボックスを編集した場合は必ず、変更内容を保存した後に、変更したHTMLコードをお客さまのECサイトに貼り付けてください。新しく更新されたボタンのソースコードを使用して更新しないと、変更が本番サイトに反映されません。\n\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T16:00:32+09:00","group":null,"id":"fed81d677ed7d9927f90","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"PayPalペイメント スタンダードのボタンを編集する方法を教えてください。","updated_at":"2017-05-17T16:00:32+09:00","url":"http://qiita.com/PayPal_MTS/items/fed81d677ed7d9927f90","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eN88BASICを中学校のときに触りまくってしまったせいで、2X歳になった今年でも未だにすべてを\u003ca href=\"http://tsumari.zapto.org/detail.php?id=79\" rel=\"nofollow noopener\" target=\"_blank\"\u003e手続き型\u003c/a\u003eで書いてしまう私が、\u003cbr\u003e\nとうとう\u003ca href=\"http://tsumari.zapto.org/detail.php?id=80\" rel=\"nofollow noopener\" target=\"_blank\"\u003eオブジェクト指向\u003c/a\u003eの勉強をはじめました。\u003c/p\u003e\n\n\u003cp\u003eその中で、「インターフェイス」というわけのわからないものに出会ったので、備忘録がてら書いてみたいと思います。\u003cbr\u003e\n間違っていたらご指摘ください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"そもそもインターフェイスとはなんぞや\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%A8%E3%81%AF%E3%81%AA%E3%82%93%E3%81%9E%E3%82%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eそもそもインターフェイスとはなんぞや？\u003c/h1\u003e\n\n\u003cp\u003e「インターフェース」か「インターフェイス」かわかりませんが、私はインターフェース派です。\u003cbr\u003e\nしかし、教わった方がインターフェイスとおっしゃってたので、そっちが正しいのかな？と思っていたり。\u003c/p\u003e\n\n\u003cp\u003eで、何するやつかということを、すっっっっっっっごく噛み砕いて言うと、\u003cbr\u003e\n\u003cstrong\u003e定義したメソッドを使うことができるよ！\u003c/strong\u003e\u003cbr\u003e\nってことだそうです。\u003c/p\u003e\n\n\u003cp\u003e……は？\u003c/p\u003e\n\n\u003cp\u003eそんな反応になりますよね。僕もそうです。\u003c/p\u003e\n\n\u003cp\u003eようは、先にメソッド名を宣言しておいて、その中身をclassの中で定義していく……という風に使うんですって。\u003cbr\u003e\nなんじゃそりゃ。\u003cbr\u003e\nとりあえず、\u003ca href=\"http://php.net/manual/ja/language.oop5.interfaces.php\" rel=\"nofollow noopener\" target=\"_blank\"\u003e詳しい解説みたい人はPHPのリファレンス\u003c/a\u003eへ。。。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"とりあえずやってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eとりあえずやってみる\u003c/h1\u003e\n\n\u003cp\u003eまあ、兎にも角にも、コードを書いてみなければわかりません。\u003c/p\u003e\n\n\u003cp\u003e処理の内容としては、\u003cbr\u003e\n1. Hdmiというインターフェースにconnect（接続する）というメソッドを宣言しておきます。\u003cbr\u003e\n2. Displayというクラスで、Hdmiインタフェースをimplements（実装）します。\u003cbr\u003e\n3. connectメソッドの中身をDisplayクラスの中で定義します。\u003cbr\u003e\n4. 実際にDisplayオブジェクトを作成し、connectメソッドを実行してみます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"PHP\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# インタフェースの定義\u003c/span\u003e\n\u003cspan class=\"k\"\u003einterface\u003c/span\u003e \u003cspan class=\"nx\"\u003eHdmi\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# connectメソッドの宣言\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003econnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\n\u003cspan class=\"c1\"\u003e# Displayクラスの定義\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDisplay\u003c/span\u003e \u003cspan class=\"k\"\u003eimplements\u003c/span\u003e \u003cspan class=\"nx\"\u003eHdmi\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# connectメソッドの定義\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003econnect\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e'接続しました'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\u003cspan class=\"c1\"\u003e# なんとなくHdmi型のオブジェクトを渡す関数で実行してみる\u003c/span\u003e\n\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003ehdmiConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eHdmi\u003c/span\u003e \u003cspan class=\"nv\"\u003e$obj\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$obj\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"na\"\u003econnect\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\u003cspan class=\"c1\"\u003e# 実際にインスタンスを作って実行してみる\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$display\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eDisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ehdmiConnect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$display\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e↓　実行結果\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e接続しました\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこんな感じですね。\u003cbr\u003e\n……あんまり意味がない……と思えがちですが、\u003cbr\u003e\n例えば\u003cbr\u003e\n\u003ccode\u003eキメラclass\u003c/code\u003eと言うものを創るときに、\u003ccode\u003e獅子class\u003c/code\u003e、\u003ccode\u003e山羊class\u003c/code\u003e、\u003ccode\u003e毒蛇class\u003c/code\u003eのそれぞれのメソッドを継承したい。\u003cbr\u003e\nそしてそれぞれのメソッドの中身が、元の各動物のクラスと、キメラのクラスでは違ってくる……\u003cbr\u003e\nそんなときに使える！…………そうです（\u003c/p\u003e\n\n\u003cp\u003e私もまだ勉強途中なので、「へ〜、こんなのがあるんだ」くらいの認識ですが、同じ困っている仲間がいそうだったので書いてみました。\u003cbr\u003e\nまた知識が増えたら共有していきたいと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://php.net/manual/ja/language.oop5.interfaces.php\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://php.net/manual/ja/language.oop5.interfaces.php\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://tsumari.zapto.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://tsumari.zapto.org/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# はじめに\nN88BASICを中学校のときに触りまくってしまったせいで、2X歳になった今年でも未だにすべてを[手続き型](http://tsumari.zapto.org/detail.php?id=79)で書いてしまう私が、\nとうとう[オブジェクト指向](http://tsumari.zapto.org/detail.php?id=80)の勉強をはじめました。\n\nその中で、「インターフェイス」というわけのわからないものに出会ったので、備忘録がてら書いてみたいと思います。\n間違っていたらご指摘ください。\n\n\n\n# そもそもインターフェイスとはなんぞや？\n「インターフェース」か「インターフェイス」かわかりませんが、私はインターフェース派です。\nしかし、教わった方がインターフェイスとおっしゃってたので、そっちが正しいのかな？と思っていたり。\n\nで、何するやつかということを、すっっっっっっっごく噛み砕いて言うと、\n**定義したメソッドを使うことができるよ！**\nってことだそうです。\n\n……は？\n\nそんな反応になりますよね。僕もそうです。\n\nようは、先にメソッド名を宣言しておいて、その中身をclassの中で定義していく……という風に使うんですって。\nなんじゃそりゃ。\nとりあえず、[詳しい解説みたい人はPHPのリファレンス](http://php.net/manual/ja/language.oop5.interfaces.php)へ。。。\n\n\n\n# とりあえずやってみる\nまあ、兎にも角にも、コードを書いてみなければわかりません。\n\n処理の内容としては、\n1. Hdmiというインターフェースにconnect（接続する）というメソッドを宣言しておきます。\n2. Displayというクラスで、Hdmiインタフェースをimplements（実装）します。\n3. connectメソッドの中身をDisplayクラスの中で定義します。\n4. 実際にDisplayオブジェクトを作成し、connectメソッドを実行してみます。\n\n```PHP\n\u003c?php\n\n# インタフェースの定義\ninterface Hdmi{\n    # connectメソッドの宣言\n    public function connect();\n}\n\n\n\n# Displayクラスの定義\nclass Display implements Hdmi{\n    \n    # connectメソッドの定義\n    public function connect(){\n        echo '接続しました';\n    }\n    \n}\n\n\n# なんとなくHdmi型のオブジェクトを渡す関数で実行してみる\nfunction hdmiConnect(Hdmi $obj){\n    $obj-\u003econnect();\n}\n\n\n# 実際にインスタンスを作って実行してみる\n$display = new Display();\nhdmiConnect($display);\n```\n\n↓　実行結果\n\n```\n接続しました\n```\n\nこんな感じですね。\n……あんまり意味がない……と思えがちですが、\n例えば\n`キメラclass`と言うものを創るときに、`獅子class`、`山羊class`、`毒蛇class`のそれぞれのメソッドを継承したい。\nそしてそれぞれのメソッドの中身が、元の各動物のクラスと、キメラのクラスでは違ってくる……\nそんなときに使える！…………そうです（\n\n私もまだ勉強途中なので、「へ〜、こんなのがあるんだ」くらいの認識ですが、同じ困っている仲間がいそうだったので書いてみました。\nまた知識が増えたら共有していきたいと思います。\n\n\n# 参考\n- [http://php.net/manual/ja/language.oop5.interfaces.php](http://php.net/manual/ja/language.oop5.interfaces.php)\n- [http://tsumari.zapto.org/](http://tsumari.zapto.org/)\n","coediting":false,"created_at":"2017-05-17T15:57:21+09:00","group":null,"id":"4f4ddb8c4d785166262d","private":false,"tags":[{"name":"PHP","versions":[]},{"name":"オブジェクト指向","versions":[]},{"name":"初心者","versions":[]},{"name":"interface","versions":[]}],"title":"【Interface】オブジェクト指向の「インターフェイス」をなんとなく理解してみる（PHP）","updated_at":"2017-05-17T16:48:23+09:00","url":"http://qiita.com/nnahito/items/4f4ddb8c4d785166262d","user":{"description":"BASIC言語をこよなく愛するperlスクリプター！\r\nWeb系の研究室に配属され，Pythonをカタカタ書いています．\r\nPHP，JavaScriptもまれに使ってみたり……","facebook_id":"","followees_count":55,"followers_count":34,"github_login_name":"nnahito","id":"nnahito","items_count":24,"linkedin_id":"","location":"Kyoto,Japan","name":"Nな 人","organization":"","permanent_id":63338,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/63338/profile-images/1473696237","twitter_screen_name":"nnahito","website_url":"https://twitter.com/nnahito"}},{"rendered_body":"\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e結論\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e自由なIT環境をつくること\u2028\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e従来型の企業文化\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eトップダウン型\u003c/li\u003e\n\u003cli\u003e数値、お金目線\u003c/li\u003e\n\u003cli\u003e何をいうかより、誰がいうか\u2028\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e次世代型の企業文化\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eボトムアップ型\u003c/li\u003e\n\u003cli\u003e全社員がプロダクト(サービス、事業)目線\u003c/li\u003e\n\u003cli\u003e誰がいうかより、何をいうか\u2028\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e企業でいちばん大切なこと\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eいいプロダクトを作ること\n\n\u003cul\u003e\n\u003cli\u003eプロダクトとは、サービス、製品、事業のこと\u003c/li\u003e\n\u003cli\u003e世の中は非常に多くのプロダクトで溢れている\u003c/li\u003e\n\u003cli\u003eユーザには選ぶ権利があり、レビューをつけられる世の中\u2028\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eいいプロダクトを作るには、スゴい人たちが必要\n\n\u003cul\u003e\n\u003cli\u003eスゴい人たちとは、優秀な人という意味\u003c/li\u003e\n\u003cli\u003e優秀な人たちを獲得する仕組みが必要\u2028\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eスゴい人たちは、自由な環境に惹かれる\n\n\u003cul\u003e\n\u003cli\u003e自由な環境とは、\n\n\u003cul\u003e\n\u003cli\u003e裁量が大きい\u003c/li\u003e\n\u003cli\u003e制約(ルール)が少ない\u003c/li\u003e\n\u003cli\u003e細かい管理をされない\u003c/li\u003e\n\u003cli\u003e成長(チャレンジ)の機会がある\u003c/li\u003e\n\u003cli\u003e失敗に対して寛容\u2028\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e情シスでできること\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e自由なIT環境をつくる\n\n\u003cul\u003e\n\u003cli\u003e例）\n\n\u003cul\u003e\n\u003cli\u003e社員が使いたいツールを使う\u003c/li\u003e\n\u003cli\u003e新しいツール、仕組みを常に検討し、生産性を向上させる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","body":"- 結論\n    - 自由なIT環境をつくること\u2028\n\n- 従来型の企業文化\n    - トップダウン型\n    - 数値、お金目線\n    - 何をいうかより、誰がいうか\u2028\n\n- 次世代型の企業文化\n    - ボトムアップ型\n    - 全社員がプロダクト(サービス、事業)目線\n    - 誰がいうかより、何をいうか\u2028\n\n- 企業でいちばん大切なこと\n    - いいプロダクトを作ること\n        - プロダクトとは、サービス、製品、事業のこと\n        - 世の中は非常に多くのプロダクトで溢れている\n        - ユーザには選ぶ権利があり、レビューをつけられる世の中\u2028\n    - いいプロダクトを作るには、スゴい人たちが必要\n        - スゴい人たちとは、優秀な人という意味\n        - 優秀な人たちを獲得する仕組みが必要\u2028\n    - スゴい人たちは、自由な環境に惹かれる\n        - 自由な環境とは、\n            - 裁量が大きい\n            - 制約(ルール)が少ない\n            - 細かい管理をされない\n            - 成長(チャレンジ)の機会がある\n            - 失敗に対して寛容\u2028\n\n- 情シスでできること\n    - 自由なIT環境をつくる\n        - 例）\n            - 社員が使いたいツールを使う\n            - 新しいツール、仕組みを常に検討し、生産性を向上させる\n","coediting":false,"created_at":"2017-05-17T15:48:04+09:00","group":null,"id":"b3dab790407f7d1db2a7","private":false,"tags":[{"name":"社内インフラ","versions":[]},{"name":"情報システム","versions":[]}],"title":"情シス(社内インフラ)で大切なこと","updated_at":"2017-05-17T15:48:04+09:00","url":"http://qiita.com/samuraidays/items/b3dab790407f7d1db2a7","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":"samuraidays","id":"samuraidays","items_count":6,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":155456,"profile_image_url":"https://avatars.githubusercontent.com/u/4385484?v=3","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003e質問：\u003cbr\u003e\u003cbr\u003e\nPayPalウェブ ペイメント スタンダードまたはHTMLボタンが関わる取引が処理されていないため、次のようなエラーメッセージが表示されています。\u003cbr\u003e\n日本語：  申し訳ありませんが、現在問題が起きているようです。しばらくしてから再実行してください。\u003cbr\u003e\n英語：  Things don’t appear to be working at the moment. Please try again later.\u003c/p\u003e\n\n\u003cp\u003e回答：\u003cbr\u003e\n2017年3月29日に、PayPalの決済処理が更新されました。\u003cbr\u003e\n大半の実装環境では、新しいPayPal決済の処理が自動的に動作します。ただし、一部の実装環境では問題が発生し、ユーザーの操作が失敗する場合があります。検証確認が失敗する最も一般的な理由は次のとおりです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e「\\$」「£」などの通貨記号または1、2、3などの整数および小数点(「.」)以外の値を金額フィールドで送信している。たとえば、「1234.50」は正しく処理されますが「$1,234.50」は許可されていません。\u003c/li\u003e\n\u003cli\u003e国コードで3文字以上の値を送信している。たとえば、「FR」は正しく処理されますが「フランス」または「fr_FR」は許可されていません。\u003c/li\u003e\n\u003cli\u003eitem_numberフィールドで128文字以上の文字を送信している。「買い手へのメッセージ」などの入力に、item_numberフィールドを使用しないでください。\u003c/li\u003e\n\u003cli\u003eオプションフィールド(on0、on1など)で65文字以上の文字を送信している。\u003c/li\u003e\n\u003cli\u003e重複する空のパラメータを送信している。\u003c/li\u003e\n\u003cli\u003e住所を送信せずに address_override=1を送信している。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e解決方法の詳細につきましては下記URLをご参考ください。\u003cbr\u003e\n\u003ca href=\"https://www.paypal-knowledge.com/infocenter/index?page=content\u0026amp;id=FAQ2067\u0026amp;pmv=print\u0026amp;impressions=false\u0026amp;viewlocale=ja_JP\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.paypal-knowledge.com/infocenter/index?page=content\u0026amp;id=FAQ2067\u0026amp;pmv=print\u0026amp;impressions=false\u0026amp;viewlocale=ja_JP\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"質問：  \nPayPalウェブ ペイメント スタンダードまたはHTMLボタンが関わる取引が処理されていないため、次のようなエラーメッセージが表示されています。\n日本語：  申し訳ありませんが、現在問題が起きているようです。しばらくしてから再実行してください。\n英語：  Things don’t appear to be working at the moment. Please try again later.\n\n\n  \n回答：\n2017年3月29日に、PayPalの決済処理が更新されました。\n大半の実装環境では、新しいPayPal決済の処理が自動的に動作します。ただし、一部の実装環境では問題が発生し、ユーザーの操作が失敗する場合があります。検証確認が失敗する最も一般的な理由は次のとおりです。\n\n- 「\\$」「£」などの通貨記号または1、2、3などの整数および小数点(「.」)以外の値を金額フィールドで送信している。たとえば、「1234.50」は正しく処理されますが「$1,234.50」は許可されていません。\n- 国コードで3文字以上の値を送信している。たとえば、「FR」は正しく処理されますが「フランス」または「fr_FR」は許可されていません。\n- item_numberフィールドで128文字以上の文字を送信している。「買い手へのメッセージ」などの入力に、item_numberフィールドを使用しないでください。\n- オプションフィールド(on0、on1など)で65文字以上の文字を送信している。\n- 重複する空のパラメータを送信している。\n- 住所を送信せずに address_override=1を送信している。\n\n解決方法の詳細につきましては下記URLをご参考ください。\nhttps://www.paypal-knowledge.com/infocenter/index?page=content\u0026id=FAQ2067\u0026pmv=print\u0026impressions=false\u0026viewlocale=ja_JP\n\n\n  \nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T15:44:06+09:00","group":null,"id":"2ec88629756fdc68251a","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"実装環境で無効なデータがPayPalに送信されていることを確認しました。どうすればよいですか。","updated_at":"2017-05-17T15:51:44+09:00","url":"http://qiita.com/PayPal_MTS/items/2ec88629756fdc68251a","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"configfishに追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#configfish%E3%81%AB%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003econfig.fish\u003c/code\u003eに追加\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# ~/.config/fish/config.fish\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003esource\u003c/span\u003e /home/hogehoge/.pyenv/versions/anaconda3-4.3.1/etc/fish/conf.d/conda.fish\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e-\u003ccode\u003econda.fish\u003c/code\u003eまでのフルパスを指定しないとエラーになる。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/conda/conda/blob/ba75a87a71eb433f63e7297c8de1949fabafe4ce/shell/etc/fish/conf.d/conda.fish\" rel=\"nofollow noopener\" target=\"_blank\"\u003econda/conda.fish\u003c/a\u003e\u003c/p\u003e\n","body":"# `config.fish`に追加\n```bash\n# ~/.config/fish/config.fish\n\nsource /home/hogehoge/.pyenv/versions/anaconda3-4.3.1/etc/fish/conf.d/conda.fish`\n```\n-`conda.fish`までのフルパスを指定しないとエラーになる。\n\n# 参考\n [conda/conda.fish](https://github.com/conda/conda/blob/ba75a87a71eb433f63e7297c8de1949fabafe4ce/shell/etc/fish/conf.d/conda.fish)\n\n","coediting":false,"created_at":"2017-05-17T15:39:22+09:00","group":null,"id":"83fe1254a7e7705fa78b","private":false,"tags":[{"name":"Bash","versions":[]},{"name":"Windows","versions":[]},{"name":"fish","versions":[]},{"name":"Anaconda","versions":[]},{"name":"BashOnUbuntuOnWindows","versions":[]}],"title":"fish で conda を [activate/deactivate] する方法","updated_at":"2017-05-17T17:52:28+09:00","url":"http://qiita.com/yuntas/items/83fe1254a7e7705fa78b","user":{"description":"#like\r\n{OS:win10, centOS, ubuntu},{shell:zsh,fish}, {editor:vim, sublime}, {lang:python, SQL, R}","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":"yuntas","id":"yuntas","items_count":9,"linkedin_id":"","location":"Kyoto, Japan","name":"yuntas","organization":"","permanent_id":78079,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/78079/profile-images/1473701038","twitter_screen_name":null,"website_url":""}},{"rendered_body":"\u003cp\u003eすでに顧客の情報を入手している場合は、新規顧客の最初のページに事前に入力されるよう、その情報をPayPalに渡すことができます。最初に、以下のフィールドおよびパラメータからどれをPayPalに渡すかを選択します。これらはオプションなので、すべてを選択することも、何も選択しないことも可能です。登録ページでどのフィールドに事前入力されているかにかかわらず、顧客はその情報を編集できます。\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eフィールド\u003c/th\u003e\n\u003cth\u003e説明\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eaddress1\u003c/td\u003e\n\u003ctd\u003e住所1 (英数字で最大100文字)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eaddress2\u003c/td\u003e\n\u003ctd\u003e住所2 (英数字で最大100文字)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecbt\u003c/td\u003e\n\u003ctd\u003ePayPal支払い完了ページの[続行]ボタンのテキスト。復帰URLが必要です。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003echarset\u003c/td\u003e\n\u003ctd\u003eこの変数は、請求情報/PayPalウェブサイトのログインページで使用する文字セットおよびエンコーディングを設定します。また、ボタンのHTMLコードでPayPalに送信する情報にも同じ値を設定します。初期設定の値は、アカウント設定の言語のエンコーディング設定に基づきます。\u003cbr\u003e\u003ca href=\"https://developer.paypal.com/webapps/developer/docs/classic/paypal-payments-standard/integration-guide/formbasics/#id08A6F0RK0PN\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003eをクリックして、使用可能な文字セットの一覧をご覧ください。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e市区町村\u003c/td\u003e\n\u003ctd\u003e市区町村(英数字で最大40文字)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e国\u003c/td\u003e\n\u003ctd\u003e配送先および請求先の国(2文字の略語)。\u003cbr\u003e\u003ca href=\"https://developer.paypal.com/webapps/developer/docs/classic/api/country_codes/#CountryCodes_id083SG0U0OY4\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003eをクリックすると、PayPalがサポートしている国および地域を確認できます。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eメール\u003c/td\u003e\n\u003ctd\u003eメールアドレス(英数字で最大127文字)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elast_name\u003c/td\u003e\n\u003ctd\u003e名(英数字で最大32文字)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elast_name\u003c/td\u003e\n\u003ctd\u003e姓(英数字で最大32文字)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elc\u003c/td\u003e\n\u003ctd\u003eロケール - 請求情報/ログインページでのみ使用する買い手の言語(初期設定は米国英語)。\u003cbr\u003e\u003ca href=\"https://developer.paypal.com/webapps/developer/docs/classic/api/country_codes/#CountryCodes_id083SG0U0OY4\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003eをクリックすると、PayPalがサポートしている国および地域を確認できます。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003enight_phone_a\u003c/td\u003e\n\u003ctd\u003e米国の電話番号のエリアコード、または米国以外の電話番号の国コード(3桁までの数字)。これにより、買い手の自宅の電話番号が事前入力されます。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003enight_phone_b\u003c/td\u003e\n\u003ctd\u003e米国の電話番号の3桁の局番、または米国以外の電話番号の残りの部分(16桁までの数字)。これにより、買い手の自宅の電話番号が事前入力されます。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003enight_phone_c\u003c/td\u003e\n\u003ctd\u003e米国の電話番号の下4桁。これにより、買い手の自宅の電話番号が事前入力されます。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e都道府県\u003c/td\u003e\n\u003ctd\u003e州(公式の2文字の略語)。\u003cbr\u003e\u003ca href=\"http://pe.usps.gov/text/pub28/28apb.htm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003eをクリックすると、使用可能な略語リストを確認できます。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e郵便番号\u003c/td\u003e\n\u003ctd\u003e郵便番号(32桁までの数字)\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e\u003cstrong\u003eサンプルのHTMLコード\u003c/strong\u003e\u003cbr\u003e\u003cbr\u003e\n以下のサンプルコードは、決済ボタンに多数の事前入力フィールド(赤で表示)を挿入する方法を示しています。この情報は、HTMLの\"variable name = value\"で変数名と関連データをPayPalにPOSTすることにより、PayPal支払いページに渡されます。  \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u0026lt;form action=\"https://www.paypal.com/cgi-bin/webscr\" method=\"POST\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"cmd\" value=\"_xclick\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"business\" value=\"recipient@paypal.com\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"undefined_quantity\" value=\"1\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"item_name\" value=\"hat\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"item_number\" value=\"123\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"amount\" value=\"15.00\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"shipping\" value=\"1.00\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"shipping2\" value=\"0.50\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"currency_code\" value=\"USD\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"first_name\" value=\"John\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"last_name\" value=\"Doe\"\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"address1\" value=\"9 Elm Street\"\u0026gt;\u0026lt;/span\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"address2\" value=\"Apt 5\"\u0026gt;\u0026lt;/span\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"city\" value=\"Berwyn\"\u0026gt;\u0026lt;/span\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"state\" value=\"PA\"\u0026gt;\u0026lt;/span\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"zip\" value=\"19312\"\u0026gt;\u0026lt;/span\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"lc\" value=\"US\"\u0026gt;\u0026lt;/span\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"email\" value=\"buyer@domain.com\"\u0026gt;\u0026lt;/span\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"night_phone_a\" value=\"610\"\u0026gt;\u0026lt;/span\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"night_phone_b\" value=\"555\"\u0026gt;\u0026lt;/span\u0026gt;\n\u0026lt;input type=\"hidden\" name=\"night_phone_c\" value=\"1234\"\u0026gt;\u0026lt;/span\u0026gt;\n\u0026lt;input type=\"image\" src=\"http://www.paypal.com/en_US/i/btn/x-click-but01.gif\" border=\"0\" name=\"submit\" alt=\"PayPal\" を使用してお支払いを=\"\" -=\"\" 迅速、無料、安全です=\"\"\u0026gt;\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ePayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"すでに顧客の情報を入手している場合は、新規顧客の最初のページに事前に入力されるよう、その情報をPayPalに渡すことができます。最初に、以下のフィールドおよびパラメータからどれをPayPalに渡すかを選択します。これらはオプションなので、すべてを選択することも、何も選択しないことも可能です。登録ページでどのフィールドに事前入力されているかにかかわらず、顧客はその情報を編集できます。\n\nフィールド | 説明\n---|---\naddress1 | 住所1 (英数字で最大100文字)\naddress2 | 住所2 (英数字で最大100文字)\ncbt | PayPal支払い完了ページの[続行]ボタンのテキスト。復帰URLが必要です。\ncharset | この変数は、請求情報/PayPalウェブサイトのログインページで使用する文字セットおよびエンコーディングを設定します。また、ボタンのHTMLコードでPayPalに送信する情報にも同じ値を設定します。初期設定の値は、アカウント設定の言語のエンコーディング設定に基づきます。\u003cbr\u003e[ここ](https://developer.paypal.com/webapps/developer/docs/classic/paypal-payments-standard/integration-guide/formbasics/#id08A6F0RK0PN)をクリックして、使用可能な文字セットの一覧をご覧ください。\n市区町村 | 市区町村(英数字で最大40文字)\n国 | 配送先および請求先の国(2文字の略語)。\u003cbr\u003e[ここ](https://developer.paypal.com/webapps/developer/docs/classic/api/country_codes/#CountryCodes_id083SG0U0OY4)をクリックすると、PayPalがサポートしている国および地域を確認できます。\nメール | メールアドレス(英数字で最大127文字)\nlast_name | 名(英数字で最大32文字)\nlast_name | 姓(英数字で最大32文字)\nlc | ロケール - 請求情報/ログインページでのみ使用する買い手の言語(初期設定は米国英語)。\u003cbr\u003e[ここ](https://developer.paypal.com/webapps/developer/docs/classic/api/country_codes/#CountryCodes_id083SG0U0OY4)をクリックすると、PayPalがサポートしている国および地域を確認できます。\nnight_phone_a | 米国の電話番号のエリアコード、または米国以外の電話番号の国コード(3桁までの数字)。これにより、買い手の自宅の電話番号が事前入力されます。\nnight_phone_b | 米国の電話番号の3桁の局番、または米国以外の電話番号の残りの部分(16桁までの数字)。これにより、買い手の自宅の電話番号が事前入力されます。\nnight_phone_c | 米国の電話番号の下4桁。これにより、買い手の自宅の電話番号が事前入力されます。\n都道府県 | 州(公式の2文字の略語)。\u003cbr\u003e[ここ](http://pe.usps.gov/text/pub28/28apb.htm)をクリックすると、使用可能な略語リストを確認できます。\n郵便番号 | 郵便番号(32桁までの数字)\n\n\n\n**サンプルのHTMLコード**  \n以下のサンプルコードは、決済ボタンに多数の事前入力フィールド(赤で表示)を挿入する方法を示しています。この情報は、HTMLの\"variable name = value\"で変数名と関連データをPayPalにPOSTすることにより、PayPal支払いページに渡されます。  \n\n```\n\u003cform action=\"https://www.paypal.com/cgi-bin/webscr\" method=\"POST\"\u003e\n\u003cinput type=\"hidden\" name=\"cmd\" value=\"_xclick\"\u003e\n\u003cinput type=\"hidden\" name=\"business\" value=\"recipient@paypal.com\"\u003e\n\u003cinput type=\"hidden\" name=\"undefined_quantity\" value=\"1\"\u003e\n\u003cinput type=\"hidden\" name=\"item_name\" value=\"hat\"\u003e\n\u003cinput type=\"hidden\" name=\"item_number\" value=\"123\"\u003e\n\u003cinput type=\"hidden\" name=\"amount\" value=\"15.00\"\u003e\n\u003cinput type=\"hidden\" name=\"shipping\" value=\"1.00\"\u003e\n\u003cinput type=\"hidden\" name=\"shipping2\" value=\"0.50\"\u003e\n\u003cinput type=\"hidden\" name=\"currency_code\" value=\"USD\"\u003e\n\u003cinput type=\"hidden\" name=\"first_name\" value=\"John\"\u003e\n\u003cinput type=\"hidden\" name=\"last_name\" value=\"Doe\"\u003e\n\u003cinput type=\"hidden\" name=\"address1\" value=\"9 Elm Street\"\u003e\u003c/span\u003e\n\u003cinput type=\"hidden\" name=\"address2\" value=\"Apt 5\"\u003e\u003c/span\u003e\n\u003cinput type=\"hidden\" name=\"city\" value=\"Berwyn\"\u003e\u003c/span\u003e\n\u003cinput type=\"hidden\" name=\"state\" value=\"PA\"\u003e\u003c/span\u003e\n\u003cinput type=\"hidden\" name=\"zip\" value=\"19312\"\u003e\u003c/span\u003e\n\u003cinput type=\"hidden\" name=\"lc\" value=\"US\"\u003e\u003c/span\u003e\n\u003cinput type=\"hidden\" name=\"email\" value=\"buyer@domain.com\"\u003e\u003c/span\u003e\n\u003cinput type=\"hidden\" name=\"night_phone_a\" value=\"610\"\u003e\u003c/span\u003e\n\u003cinput type=\"hidden\" name=\"night_phone_b\" value=\"555\"\u003e\u003c/span\u003e\n\u003cinput type=\"hidden\" name=\"night_phone_c\" value=\"1234\"\u003e\u003c/span\u003e\n\u003cinput type=\"image\" src=\"http://www.paypal.com/en_US/i/btn/x-click-but01.gif\" border=\"0\" name=\"submit\" alt=\"PayPal\" を使用してお支払いを=\"\" -=\"\" 迅速、無料、安全です=\"\"\u003e\n```\n\n\n\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T15:33:32+09:00","group":null,"id":"db69f6c33eedda7f4d82","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"顧客のPayPal登録フォームに情報を事前入力する方法を教えてください（ウェブサイトペイメントスタンダード）。","updated_at":"2017-05-17T15:49:02+09:00","url":"http://qiita.com/PayPal_MTS/items/db69f6c33eedda7f4d82","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h1\u003e\n\n\u003cp\u003eAPI Gatewayを使うとき手が届かないむずかゆいところがたくさんあります（HTTPSのみしか受け付けないとか、前段にWAFおけないとか）。\u003cbr\u003e\nそのときに使われるのがCloudFrontになりますが（もちろん、API Gateway内部にCloudFrontが暗黙的に使われており、多段CloudFrontになるため遅延が大きいというのは承知）、API　Gatewayの前段用にCloudFront使うのもなんなのでS3オリジンの配信もやっちゃいたい、という内容です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eCloudFront + API Gateway + S3\u003c/li\u003e\n\u003cli\u003eS3はOAI(Object Access Identity)でアクセス制限\u003c/li\u003e\n\u003cli\u003eAPI Gatewayはカスタムオリジンヘッダによるアクセス制限はしない\n\n\u003cul\u003e\n\u003cli\u003eめんどいので\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAPI Gatewayはキャッシュしない\u003c/li\u003e\n\u003cli\u003eRoute53で取得したドメインを利用\u003c/li\u003e\n\u003cli\u003eACMで取得した証明書をHTTPS通信に利用\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"アーキテクチャ構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアーキテクチャ構成\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/0a4481b9-e92f-6948-d72c-3f43408c6a3e.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/0a4481b9-e92f-6948-d72c-3f43408c6a3e.png\" alt=\"arch.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e手順\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"route53の設定その１\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#route53%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%9D%E3%81%AE%EF%BC%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRoute53の設定（その１）\u003c/h2\u003e\n\n\u003cp\u003eCloudFrontのエンドポイントを覚えやすいドメイン名にするため、Route53でドメイン名を取得して設定する必要があります。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eDomain Resigtration\n\n\u003cul\u003e\n\u003cli\u003e独自ドメインをRoute53から取得します。[Domain Registration]-\u0026gt;[Resigter Domain]を選択し、ドメイン（xxxxxx.comなど）を取得してください。\u003c/li\u003e\n\u003cli\u003eメインを取得すると、ダッシュボードが下記になります\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/ff8d8c15-7647-0127-2968-8670a1488019.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/ff8d8c15-7647-0127-2968-8670a1488019.png\" alt=\"register.png\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"acmamazon-certificate-managerで証明書作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#acmamazon-certificate-manager%E3%81%A7%E8%A8%BC%E6%98%8E%E6%9B%B8%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eACM(Amazon Certificate Manager)で証明書作成\u003c/h2\u003e\n\n\u003cp\u003e独自ドメインに対してhttpsアクセスするために証明書を作成します。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eACM画面\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/fd1eb156-a607-f8f5-aff3-8c73fb8b142f.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/fd1eb156-a607-f8f5-aff3-8c73fb8b142f.png\" alt=\"top.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e登録画面　\u003cbr\u003e\nRoute53で取得したドメインを登録します。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/d314c690-b213-8838-73cc-e1326a6350e9.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/d314c690-b213-8838-73cc-e1326a6350e9.png\" alt=\"regist.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e確定画面　\u003cbr\u003e\n設定を確認し、確定します。確定するとドメインに関連付けられているメールアドレスにValidationメールが送付されます。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/61950c2f-5c02-504c-82f8-5fb81a79ce8c.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/61950c2f-5c02-504c-82f8-5fb81a79ce8c.png\" alt=\"confirm.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e仮登録完了画面\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/17396a6d-a907-c398-9812-556f78eccf0c.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/17396a6d-a907-c398-9812-556f78eccf0c.png\" alt=\"pre_done.png\"\u003e\u003c/a\u003e　　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eバリデーション画面\u003cbr\u003e\n送付されてきたメールリンクを押下すると下記画面となります。承認を押して確定してください。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/4410b161-66a0-eac0-57de-f2a8d5f2a149.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/4410b161-66a0-eac0-57de-f2a8d5f2a149.png\" alt=\"validation.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e完了画面\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/482ba63f-fafe-1c21-d272-ca3a7fee33bd.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/482ba63f-fafe-1c21-d272-ca3a7fee33bd.png\" alt=\"success.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eダッシュボード\u003cbr\u003e\n完了までするとステータスが発行済みとなり、使用中でないことを確認してください。以後、これを使ってHTTPS通信における証明をします。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/65f50364-b7db-8bc7-b8fe-0fc29ba10072.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/65f50364-b7db-8bc7-b8fe-0fc29ba10072.png\" alt=\"result.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"api-gatewayの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#api-gateway%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAPI Gatewayの設定\u003c/h2\u003e\n\n\u003cp\u003e詳細は割愛しますが、下記手順で実施します。完了後にAPI Gatewayのデプロイ完了画面が表示されるはずです。下記画像の通り、各リソースごと（メソッドごと）にURLエンドポイントが発行されています。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eAPI作成\u003c/li\u003e\n\u003cli\u003eリソース作成\u003c/li\u003e\n\u003cli\u003eメソッドの作成\u003c/li\u003e\n\u003cli\u003eAPIをステージへデプロイ\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/ee6633cc-9d30-5efa-7eea-ba58980156cd.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/ee6633cc-9d30-5efa-7eea-ba58980156cd.png\" alt=\"apiurl.png\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eここで使うのはURLの、\u003cstrong\u003e「\u003ca href=\"https://XXXXXXX.execute-api.ap-northeast-1.amazonaws.com/prod%E3%80%8D\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://XXXXXXX.execute-api.ap-northeast-1.amazonaws.com/prod」\u003c/a\u003e\u003c/strong\u003e\u003cbr\u003e\nまでの部分です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cloudfrontの設定その１\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cloudfront%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%9D%E3%81%AE%EF%BC%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCloudFrontの設定（その１）\u003c/h2\u003e\n\n\u003cp\u003eCloudFrontの設定に入ります。その１としているのは後でS3の設定が入るからです。\u003cbr\u003e\n注意として、CloudFrontのデプロイにはめちゃくちゃ時間がかかる（20分くらい）ので、あせらず実施してください。時間のあるときにやってください。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eCloudFrontを開くと下記画面が表示されるので、Distributionを作成します。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/2bdea6c7-f819-ec47-0090-66b5b3b955a8.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/2bdea6c7-f819-ec47-0090-66b5b3b955a8.png\" alt=\"dashboard.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003ewebを選択します。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/d6833a75-c243-1e92-675f-364c5ee18ad0.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/d6833a75-c243-1e92-675f-364c5ee18ad0.png\" alt=\"web.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eOrigin Settingsの設定\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/8861a9e3-ca95-6315-1e84-89c3eb0ff030.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/8861a9e3-ca95-6315-1e84-89c3eb0ff030.png\" alt=\"origin.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eBehavior Settingsの設定\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cul\u003e\n\u003cli\u003e注意点としては、HOSTヘッダーはForwardさせてはいけない。なぜかというとAPI Gateway自体がSNI前提のバーチャルホスト構成なのでHOSTが切り替えられなくなってしまうため。\u003c/li\u003e\n\u003cli\u003e見切れている下記オプションについて\n\n\u003cul\u003e\n\u003cli\u003eSmooth Streaming：動画配信でないため「No」\u003c/li\u003e\n\u003cli\u003eRestrict Viewer Access：今回は「No」\u003c/li\u003e\n\u003cli\u003eCompress Objects Automatically：Gzip圧縮しないので「No」\u003c/li\u003e\n\u003cli\u003eLambda Function Associations：S3オリジンにファイルが入ってInvalidationAPIたたいたりする設定。今回は「設定しない」　\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/d7fa37e9-3787-5cb3-1b0a-f5fe381d9d2c.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/d7fa37e9-3787-5cb3-1b0a-f5fe381d9d2c.png\" alt=\"behavior.png\"\u003e\u003c/a\u003e　\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eDistribution Settingsの設定\u003cbr\u003e\n見切れているオプションは特に変更せずデフォルトのままにする。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/e95189c8-730e-42cb-39ba-2520dc7c4deb.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/e95189c8-730e-42cb-39ba-2520dc7c4deb.png\" alt=\"distribution.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e作成！\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/0de6c142-eeb0-f011-f751-8cef0420e1ff.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/0de6c142-eeb0-f011-f751-8cef0420e1ff.png\" alt=\"progress.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cul\u003e\n\u003cli\u003eダッシュボードに戻り、Statusが「In Progress」になります。ここから20分ほど、ぐつぐつ煮込んでください）\u003c/li\u003e\n\u003cli\u003eStateがEnabledになったら無事完了です。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"route53の設定その２\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#route53%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%9D%E3%81%AE%EF%BC%92\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRoute53の設定（その２）\u003c/h2\u003e\n\n\u003cp\u003eCloudFrontの代替名を独自ドメインにしたのでRoute53の設定が必要です。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e上記で取得したドメインをCloudFrontへルーティングするためにDNSリソースレコードを追加する必要があります。[DNS management]-\u0026gt;[Domain Name]を選ぶと作成したDNSリソースが記載された画面に移動します。\u003c/li\u003e\n\u003cli\u003e[Create Record Set]を選択\n\n\u003cul\u003e\n\u003cli\u003eRecord setを下記の通り設定します。\u003c/li\u003e\n\u003cli\u003eName：ZoneApexを指定のため何も入力しない\u003c/li\u003e\n\u003cli\u003eType：Aレコード\u003c/li\u003e\n\u003cli\u003eAlias：Yes\u003c/li\u003e\n\u003cli\u003eAlias Target：CloudFrontDistribution名（xxxx.cloudfront.net.)\u003c/li\u003e\n\u003cli\u003eRouting policy: Simple\u003c/li\u003e\n\u003cli\u003eEvaluate Target Health: No\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eリソースレコードの登録が完了です。\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/e4b16db0-6204-e97d-d866-06d3f9ca660d.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/e4b16db0-6204-e97d-d866-06d3f9ca660d.png\" alt=\"dns.png\"\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"中間cp\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%AD%E9%96%93cp\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e中間CP\u003c/h2\u003e\n\n\u003cp\u003eいったん、ここまでの設定が動作確認してみます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAPI Gatewayは単純にSuccessと返すだけのMockエンドポイントを用意し、prodステージにデプロイしました。\n\n\u003cul\u003e\n\u003cli\u003eリソース名：success\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eブラウザから動作確認\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eアドレスバーに下記を入力して実行\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://xxxxxx.com/success\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://xxxxxx.com/success\u003c/a\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/e37c087b-8049-d4e9-cf64-848667007d63.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/e37c087b-8049-d4e9-cf64-848667007d63.png\" alt=\"cp.png\"\u003e\u003c/a\u003e　\u003c/li\u003e\n\u003cli\u003e補足）CloudFrontのDistribution設定でACMで取得した証明書を設定していない場合は下記のエラーになります。\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/1336ced4-918c-4f32-07d8-7786c5318b45.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/1336ced4-918c-4f32-07d8-7786c5318b45.png\" alt=\"sslerror.png\"\u003e\u003c/a\u003e　\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cloudfrontの設定その２\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cloudfront%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%9D%E3%81%AE%EF%BC%92\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCloudFrontの設定（その２）\u003c/h2\u003e\n\n\u003cp\u003e現在の設定ではAPI Gatewayに対してのパスしかないので、S3オリジンとパスを追加します。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eオリジンを追加するために、[Create Origin]を押下\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/42da8922-7f4d-9bdc-a1d7-64df65c5f930.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/42da8922-7f4d-9bdc-a1d7-64df65c5f930.png\" alt=\"s3_add_origin.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eS3オリジンの設定\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/aea6a670-94fb-7879-bc3f-a9ad7117135b.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/aea6a670-94fb-7879-bc3f-a9ad7117135b.png\" alt=\"s3_origin.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eS3オリジン設定完了\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/805e3b37-a5dc-8f99-2f7b-38a299ebc9a0.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/805e3b37-a5dc-8f99-2f7b-38a299ebc9a0.png\" alt=\"s3_origin_result.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eS3オリジンへのリクエストを受けるためのレスポンスを追加するために[Create Behavior]を押下\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/e1f1b3c6-1c4c-af8c-00ee-58542cef62d1.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/e1f1b3c6-1c4c-af8c-00ee-58542cef62d1.png\" alt=\"s3_add_behavior.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eS3 Behaviorの設定\u003cbr\u003e\n見切れているオプションについてはデフォルトのままで問題ありません。\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/d2bcb638-c56d-dab4-806f-4452f09a35d2.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/d2bcb638-c56d-dab4-806f-4452f09a35d2.png\" alt=\"s3_behavior.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eS3 Behaviorの設定完了\u003cbr\u003e\n\u003ca href=\"https://qiita-image-store.s3.amazonaws.com/0/123578/6c9a983d-f20d-bebf-1c75-5ba6b376fd15.png\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.amazonaws.com/0/123578/6c9a983d-f20d-bebf-1c75-5ba6b376fd15.png\" alt=\"s3_behavior._result.png\"\u003e\u003c/a\u003e　\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"s3のバケットプロパティの確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#s3%E3%81%AE%E3%83%90%E3%82%B1%E3%83%83%E3%83%88%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eS3のバケットプロパティの確認\u003c/h2\u003e\n\n\u003cp\u003eCloudFrontからコンテンツ配信するために下記設定を確認してください。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eStatic website hosting：Enabledとなっていること\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eバケットポリシーはOAIのみAllowとなっていること\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e例えば以前にS3からStatic website hostingしていた場合、下記の設定が残っていることがあります。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ebucket.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\"Version\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"2008-10-17\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\"Id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"test\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\"Statement\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n          \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n              \u003cspan class=\"nt\"\u003e\"Sid\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n              \u003cspan class=\"nt\"\u003e\"Effect\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Allow\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n              \u003cspan class=\"nt\"\u003e\"Principal\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                  \u003cspan class=\"nt\"\u003e\"AWS\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"*\"\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n              \u003cspan class=\"nt\"\u003e\"Action\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"s3:GetObject\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n              \u003cspan class=\"nt\"\u003e\"Resource\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"arn:aws:s3:::bucket-name/*\"\u003c/span\u003e\n          \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e上記の場合、CloudFrontからのアクセス＋S3への直接アクセスも許可していることになり、OAIで絞り込んでいる意味がないため削除し、プリンシパルがCloudFrontのみのアクセスだけ残してください。　\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ebucket.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\"Version\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"2008-10-17\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\"Id\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"PolicyForCloudFrontPrivateContent\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\"Statement\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\"Sid\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\"Effect\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"Allow\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\"Principal\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"nt\"\u003e\"AWS\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity XXXXXXXXXXXXXX\"\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\"Action\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"s3:GetObject\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\"Resource\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"arn:aws:s3:::bucket-name/*\"\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結果\u003c/h1\u003e\n\n\u003cp\u003e長かったですが、ここまでの設定内容を確認したら完了です。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eRoute53で取得したドメイン名でAPIコールが出来ること\u003c/li\u003e\n\u003cli\u003e Route53で取得したドメイン名でS3コンテンツを取得できること\u003c/li\u003e\n\u003cli\u003eS3のドメイン名でS3コンテンツを取得できないこと\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eCloudFront経由でAPI GatewayとS3を配信する構成を作成できました。\u003c/li\u003e\n\u003cli\u003eCloudFrontの設定が多く結構手こずりました。\n\n\u003cul\u003e\n\u003cli\u003eBlackbeltの資料など読んで各設定が何を意味しているか頭にいれておくとよいです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# 概要\nAPI Gatewayを使うとき手が届かないむずかゆいところがたくさんあります（HTTPSのみしか受け付けないとか、前段にWAFおけないとか）。\nそのときに使われるのがCloudFrontになりますが（もちろん、API Gateway内部にCloudFrontが暗黙的に使われており、多段CloudFrontになるため遅延が大きいというのは承知）、API　Gatewayの前段用にCloudFront使うのもなんなのでS3オリジンの配信もやっちゃいたい、という内容です。\n\n* CloudFront + API Gateway + S3\n* S3はOAI(Object Access Identity)でアクセス制限\n* API Gatewayはカスタムオリジンヘッダによるアクセス制限はしない\n  * めんどいので\n* API Gatewayはキャッシュしない\n* Route53で取得したドメインを利用\n* ACMで取得した証明書をHTTPS通信に利用\n\n# アーキテクチャ構成\n![arch.png](https://qiita-image-store.s3.amazonaws.com/0/123578/0a4481b9-e92f-6948-d72c-3f43408c6a3e.png)\n\n# 手順\n## Route53の設定（その１）\nCloudFrontのエンドポイントを覚えやすいドメイン名にするため、Route53でドメイン名を取得して設定する必要があります。\n\n1. Domain Resigtration\n    * 独自ドメインをRoute53から取得します。[Domain Registration]-\u003e[Resigter Domain]を選択し、ドメイン（xxxxxx.comなど）を取得してください。\n    * メインを取得すると、ダッシュボードが下記になります\n  ![register.png](https://qiita-image-store.s3.amazonaws.com/0/123578/ff8d8c15-7647-0127-2968-8670a1488019.png)\n\n\n## ACM(Amazon Certificate Manager)で証明書作成\n独自ドメインに対してhttpsアクセスするために証明書を作成します。\n\n  1. ACM画面\n  ![top.png](https://qiita-image-store.s3.amazonaws.com/0/123578/fd1eb156-a607-f8f5-aff3-8c73fb8b142f.png)　\n\n  2. 登録画面　\n  Route53で取得したドメインを登録します。\n  ![regist.png](https://qiita-image-store.s3.amazonaws.com/0/123578/d314c690-b213-8838-73cc-e1326a6350e9.png)　\n\n  3. 確定画面　\n  設定を確認し、確定します。確定するとドメインに関連付けられているメールアドレスにValidationメールが送付されます。\n![confirm.png](https://qiita-image-store.s3.amazonaws.com/0/123578/61950c2f-5c02-504c-82f8-5fb81a79ce8c.png)　\n\n  4. 仮登録完了画面\n![pre_done.png](https://qiita-image-store.s3.amazonaws.com/0/123578/17396a6d-a907-c398-9812-556f78eccf0c.png)　　\n\n  5. バリデーション画面\n  送付されてきたメールリンクを押下すると下記画面となります。承認を押して確定してください。\n![validation.png](https://qiita-image-store.s3.amazonaws.com/0/123578/4410b161-66a0-eac0-57de-f2a8d5f2a149.png)　\n\n  6. 完了画面\n![success.png](https://qiita-image-store.s3.amazonaws.com/0/123578/482ba63f-fafe-1c21-d272-ca3a7fee33bd.png)　\n\n  7. ダッシュボード\n  完了までするとステータスが発行済みとなり、使用中でないことを確認してください。以後、これを使ってHTTPS通信における証明をします。\n![result.png](https://qiita-image-store.s3.amazonaws.com/0/123578/65f50364-b7db-8bc7-b8fe-0fc29ba10072.png)　\n\n## API Gatewayの設定\n詳細は割愛しますが、下記手順で実施します。完了後にAPI Gatewayのデプロイ完了画面が表示されるはずです。下記画像の通り、各リソースごと（メソッドごと）にURLエンドポイントが発行されています。\n\n  1. API作成\n  2. リソース作成\n  3. メソッドの作成\n  4. APIをステージへデプロイ\n  \n![apiurl.png](https://qiita-image-store.s3.amazonaws.com/0/123578/ee6633cc-9d30-5efa-7eea-ba58980156cd.png)\n\nここで使うのはURLの、**「https://XXXXXXX.execute-api.ap-northeast-1.amazonaws.com/prod」**\nまでの部分です。\n\n## CloudFrontの設定（その１）\nCloudFrontの設定に入ります。その１としているのは後でS3の設定が入るからです。\n注意として、CloudFrontのデプロイにはめちゃくちゃ時間がかかる（20分くらい）ので、あせらず実施してください。時間のあるときにやってください。\n\n1. CloudFrontを開くと下記画面が表示されるので、Distributionを作成します。\n![dashboard.png](https://qiita-image-store.s3.amazonaws.com/0/123578/2bdea6c7-f819-ec47-0090-66b5b3b955a8.png)　\n\n1. webを選択します。\n![web.png](https://qiita-image-store.s3.amazonaws.com/0/123578/d6833a75-c243-1e92-675f-364c5ee18ad0.png)　\n\n2. Origin Settingsの設定\n![origin.png](https://qiita-image-store.s3.amazonaws.com/0/123578/8861a9e3-ca95-6315-1e84-89c3eb0ff030.png)　\n\n3. Behavior Settingsの設定\n\n  * 注意点としては、HOSTヘッダーはForwardさせてはいけない。なぜかというとAPI Gateway自体がSNI前提のバーチャルホスト構成なのでHOSTが切り替えられなくなってしまうため。\n  * 見切れている下記オプションについて\n    * Smooth Streaming：動画配信でないため「No」\n    * Restrict Viewer Access：今回は「No」\n    * Compress Objects Automatically：Gzip圧縮しないので「No」\n    * Lambda Function Associations：S3オリジンにファイルが入ってInvalidationAPIたたいたりする設定。今回は「設定しない」　\n![behavior.png](https://qiita-image-store.s3.amazonaws.com/0/123578/d7fa37e9-3787-5cb3-1b0a-f5fe381d9d2c.png)　\n\n1. Distribution Settingsの設定\n見切れているオプションは特に変更せずデフォルトのままにする。\n![distribution.png](https://qiita-image-store.s3.amazonaws.com/0/123578/e95189c8-730e-42cb-39ba-2520dc7c4deb.png)　\n\n\n2. 作成！\n![progress.png](https://qiita-image-store.s3.amazonaws.com/0/123578/0de6c142-eeb0-f011-f751-8cef0420e1ff.png)　\n\n  * ダッシュボードに戻り、Statusが「In Progress」になります。ここから20分ほど、ぐつぐつ煮込んでください）\n  * StateがEnabledになったら無事完了です。\n\n## Route53の設定（その２）\nCloudFrontの代替名を独自ドメインにしたのでRoute53の設定が必要です。\n\n- 上記で取得したドメインをCloudFrontへルーティングするためにDNSリソースレコードを追加する必要があります。[DNS management]-\u003e[Domain Name]を選ぶと作成したDNSリソースが記載された画面に移動します。\n- [Create Record Set]を選択\n  * Record setを下記の通り設定します。\n    * Name：ZoneApexを指定のため何も入力しない\n    * Type：Aレコード\n    * Alias：Yes\n    * Alias Target：CloudFrontDistribution名（xxxx.cloudfront.net.)\n    * Routing policy: Simple\n    * Evaluate Target Health: No\n* リソースレコードの登録が完了です。\n![dns.png](https://qiita-image-store.s3.amazonaws.com/0/123578/e4b16db0-6204-e97d-d866-06d3f9ca660d.png)\n\n## 中間CP\nいったん、ここまでの設定が動作確認してみます。\n\n* API Gatewayは単純にSuccessと返すだけのMockエンドポイントを用意し、prodステージにデプロイしました。\n  * リソース名：success\n* ブラウザから動作確認\n  * アドレスバーに下記を入力して実行\n    * https://xxxxxx.com/success\n     ![cp.png](https://qiita-image-store.s3.amazonaws.com/0/123578/e37c087b-8049-d4e9-cf64-848667007d63.png)　\n\n  * 補足）CloudFrontのDistribution設定でACMで取得した証明書を設定していない場合は下記のエラーになります。\n![sslerror.png](https://qiita-image-store.s3.amazonaws.com/0/123578/1336ced4-918c-4f32-07d8-7786c5318b45.png)　\n\n\n## CloudFrontの設定（その２）\n現在の設定ではAPI Gatewayに対してのパスしかないので、S3オリジンとパスを追加します。\n\n1. オリジンを追加するために、[Create Origin]を押下\n![s3_add_origin.png](https://qiita-image-store.s3.amazonaws.com/0/123578/42da8922-7f4d-9bdc-a1d7-64df65c5f930.png)　\n\n2. S3オリジンの設定\n![s3_origin.png](https://qiita-image-store.s3.amazonaws.com/0/123578/aea6a670-94fb-7879-bc3f-a9ad7117135b.png)　\n\n3. S3オリジン設定完了\n![s3_origin_result.png](https://qiita-image-store.s3.amazonaws.com/0/123578/805e3b37-a5dc-8f99-2f7b-38a299ebc9a0.png)　\n\n4. S3オリジンへのリクエストを受けるためのレスポンスを追加するために[Create Behavior]を押下\n![s3_add_behavior.png](https://qiita-image-store.s3.amazonaws.com/0/123578/e1f1b3c6-1c4c-af8c-00ee-58542cef62d1.png)　\n\n5. S3 Behaviorの設定\n見切れているオプションについてはデフォルトのままで問題ありません。\n![s3_behavior.png](https://qiita-image-store.s3.amazonaws.com/0/123578/d2bcb638-c56d-dab4-806f-4452f09a35d2.png)　\n\n6. S3 Behaviorの設定完了\n![s3_behavior._result.png](https://qiita-image-store.s3.amazonaws.com/0/123578/6c9a983d-f20d-bebf-1c75-5ba6b376fd15.png)　\n\n## S3のバケットプロパティの確認\nCloudFrontからコンテンツ配信するために下記設定を確認してください。\n\n  * Static website hosting：Enabledとなっていること\n  * バケットポリシーはOAIのみAllowとなっていること\n    * 例えば以前にS3からStatic website hostingしていた場合、下記の設定が残っていることがあります。\n\n    ```json:bucket.json\n        {\n          \"Version\": \"2008-10-17\",\n          \"Id\": \"test\",\n          \"Statement\": [\n              {\n                  \"Sid\": \"1\",\n                  \"Effect\": \"Allow\",\n                  \"Principal\": {\n                      \"AWS\": \"*\"\n                  },\n                  \"Action\": \"s3:GetObject\",\n                  \"Resource\": \"arn:aws:s3:::bucket-name/*\"\n              }\n          ]\n        }\n\n    ```\n\n    * 上記の場合、CloudFrontからのアクセス＋S3への直接アクセスも許可していることになり、OAIで絞り込んでいる意味がないため削除し、プリンシパルがCloudFrontのみのアクセスだけ残してください。　\n    \n    ```json:bucket.json\n        {\n            \"Version\": \"2008-10-17\",\n            \"Id\": \"PolicyForCloudFrontPrivateContent\",\n            \"Statement\": [\n                {\n                    \"Sid\": \"1\",\n                    \"Effect\": \"Allow\",\n                    \"Principal\": {\n                        \"AWS\": \"arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity XXXXXXXXXXXXXX\"\n                    },\n                    \"Action\": \"s3:GetObject\",\n                    \"Resource\": \"arn:aws:s3:::bucket-name/*\"\n                }\n            ]\n        }\n    ```\n\n# 結果\n長かったですが、ここまでの設定内容を確認したら完了です。\n\n  1. Route53で取得したドメイン名でAPIコールが出来ること\n  2.  Route53で取得したドメイン名でS3コンテンツを取得できること\n  3. S3のドメイン名でS3コンテンツを取得できないこと\n\n# まとめ\n\n* CloudFront経由でAPI GatewayとS3を配信する構成を作成できました。\n* CloudFrontの設定が多く結構手こずりました。\n  * Blackbeltの資料など読んで各設定が何を意味しているか頭にいれておくとよいです。\n\n","coediting":false,"created_at":"2017-05-17T15:30:12+09:00","group":null,"id":"3209083d9fb3a8441895","private":false,"tags":[{"name":"AWS","versions":[]},{"name":"S3","versions":[]},{"name":"CloudFront","versions":[]},{"name":"APIGateway","versions":[]},{"name":"acm","versions":[]}],"title":"CloudFrontに複数オリジン（API GatewayオリジンとS3オリジン）の設定","updated_at":"2017-05-17T15:38:03+09:00","url":"http://qiita.com/horsewin/items/3209083d9fb3a8441895","user":{"description":"SIerの上流工程で働くエンジニア。エンジニアとして手を動かさないのが嫌いなので手を動かしちゃうエンジニア。","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":"horsewin","id":"horsewin","items_count":2,"linkedin_id":"atsushi-umakatsu-09143a104","location":"Yokohama, Japan","name":"horsewin","organization":"","permanent_id":123578,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/123578/profile-images/1473715602","twitter_screen_name":"HorseVictory","website_url":""}},{"rendered_body":"\u003cp\u003ePayPal決済ボタンのソースコードを調べる場合、変数に数字が付加されているかどうかを確認します(例: 'cmd2'、'business2'、'item_name2'、'submit2' など)。これは列挙と呼ばれ、ウェブエディタによって発生したと思われます。\u003cbr\u003e\nお客さまの設定に応じて、一部のエディタ(特にDreamweaverおよびFrontPage 2003)は、HTMLコードのform変数を自動的に列挙します。弊社のサーバーがこれらの変更された変数を認識しないため、ボタンが正しく機能しません。このため、ボタンが、PayPalの決済ページではなく、PayPalのホームページにアクセスします。\u003c/p\u003e\n\n\u003cp\u003eHTMLコードを修正し、各変数の後の数字を削除する必要があります。\u003c/p\u003e\n\n\u003cp\u003eまた、以下の手順で、Dreamweaverの変数列挙を無効にすることもできます。\u003cbr\u003e\n1.  Dreamweaverで、[編集]をクリックします。\u003cbr\u003e\n2.  [環境設定]をクリックします。\u003cbr\u003e\n3.  [一般]の下で、[ペーストするときにフォームアイテムの名前を変更] (Dreamweaver MXの場合、このオプションは[コードの書き換え]の下にあります)の選択を解除します。\u003c/p\u003e\n\n\u003cp\u003eまた、以下の手順で、FrontPage 2003の変数列挙を無効にすることもできます。\u003cbr\u003e\n1.  FrontPage 2003で、[ツール]をクリックします。\u003cbr\u003e\n2.  [ページのオプション]をクリックします。\u003cbr\u003e\n3.  選択されていない場合は[全般]] タブを選択します。\u003cbr\u003e\n4.  [Make ID Unique on Paste(貼り付け時にIDを一意にする)]の横のチェックボックスをオフにします。\u003cbr\u003e\n5.  [OK]をクリックして変更内容を保存します。\u003c/p\u003e\n\n\u003cp\u003e注: DreamweaverまたはFrontPage 2003を使用していない場合は、エディタのヘルプで、この設定を無効にする方法を確認していただく必要があります。または、HTMLソースコードの変数名から追加された番号を手動で削除してください。\u003c/p\u003e\n\n\u003cp\u003ePayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/\u003c/a\u003e\u003cbr\u003e\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\u003cbr\u003e\n\u003ca href=\"https://jp.paypal-techsupport.com/app/ask\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://jp.paypal-techsupport.com/app/ask\u003c/a\u003e\u003c/p\u003e\n","body":"PayPal決済ボタンのソースコードを調べる場合、変数に数字が付加されているかどうかを確認します(例: 'cmd2'、'business2'、'item_name2'、'submit2' など)。これは列挙と呼ばれ、ウェブエディタによって発生したと思われます。\nお客さまの設定に応じて、一部のエディタ(特にDreamweaverおよびFrontPage 2003)は、HTMLコードのform変数を自動的に列挙します。弊社のサーバーがこれらの変更された変数を認識しないため、ボタンが正しく機能しません。このため、ボタンが、PayPalの決済ページではなく、PayPalのホームページにアクセスします。\n\nHTMLコードを修正し、各変数の後の数字を削除する必要があります。\n\nまた、以下の手順で、Dreamweaverの変数列挙を無効にすることもできます。\n1.\tDreamweaverで、[編集]をクリックします。\n2.\t[環境設定]をクリックします。\n3.\t[一般]の下で、\\[ペーストするときにフォームアイテムの名前を変更\\] (Dreamweaver MXの場合、このオプションは[コードの書き換え]の下にあります)の選択を解除します。\n\nまた、以下の手順で、FrontPage 2003の変数列挙を無効にすることもできます。\n1.\tFrontPage 2003で、[ツール]をクリックします。\n2.\t[ページのオプション]をクリックします。\n3.\t選択されていない場合は[全般]] タブを選択します。\n4.\t[Make ID Unique on Paste(貼り付け時にIDを一意にする)]の横のチェックボックスをオフにします。\n5.\t[OK]をクリックして変更内容を保存します。\n\n注: DreamweaverまたはFrontPage 2003を使用していない場合は、エディタのヘルプで、この設定を無効にする方法を確認していただく必要があります。または、HTMLソースコードの変数名から追加された番号を手動で削除してください。\n\n\n\nPayPalではテクニカルサポートの部署がありますので、何かPayPal実装関連の質問や技術的な質問がありましたら、下記URLで記事を検索してみてください。\nhttps://jp.paypal-techsupport.com/\n上記URLの一番下の「お問い合わせ」リンクをクリックしてまたは下記URLをアクセスして質問を送信してください。\nhttps://jp.paypal-techsupport.com/app/ask\n","coediting":false,"created_at":"2017-05-17T15:19:56+09:00","group":null,"id":"2134a8ed231b36e6c700","private":false,"tags":[{"name":"PayPal","versions":[]}],"title":"最初のPayPal決済ボタンは機能するのに、それ以降のボタンが機能しないのはなぜですか?","updated_at":"2017-05-17T15:49:19+09:00","url":"http://qiita.com/PayPal_MTS/items/2134a8ed231b36e6c700","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":6,"github_login_name":null,"id":"PayPal_MTS","items_count":74,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":124793,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/124793/profile-images/1473716011","twitter_screen_name":null,"website_url":null}}]